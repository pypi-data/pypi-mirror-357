Metadata-Version: 2.4
Name: evocloud-sdk
Version: 0.1.1
Summary: EVO Cloud Python SDK - å®˜æ–¹ Python å¼€å‘å·¥å…·åŒ…ï¼Œæ”¯æŒ LinkPayã€Merchant ç­‰å¤šç§æ”¯ä»˜æ–¹å¼
Author-email: EVO Cloud Team <support@everonet.com>
License: MIT
Project-URL: Homepage, https://github.com/everonet/evocloud-sdk-python
Project-URL: Documentation, https://docs.everonet.com/sdk/python
Project-URL: Repository, https://github.com/everonet/evocloud-sdk-python.git
Project-URL: Issues, https://github.com/everonet/evocloud-sdk-python/issues
Keywords: evocloud,payment,sdk,linkpay,merchant,alipay,wechat,visa,unionpay,e-commerce,fintech
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: Office/Business :: Financial :: Point-Of-Sale
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Operating System :: OS Independent
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: requests>=2.25.0
Requires-Dist: urllib3>=1.26.0
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-cov>=2.0; extra == "dev"
Requires-Dist: black>=21.0; extra == "dev"
Requires-Dist: flake8>=3.8; extra == "dev"
Requires-Dist: mypy>=0.800; extra == "dev"
Requires-Dist: pre-commit>=2.0; extra == "dev"
Provides-Extra: docs
Requires-Dist: sphinx>=4.0; extra == "docs"
Requires-Dist: sphinx-rtd-theme>=1.0; extra == "docs"
Requires-Dist: myst-parser>=0.15; extra == "docs"
Provides-Extra: test
Requires-Dist: pytest>=6.0; extra == "test"
Requires-Dist: pytest-cov>=2.0; extra == "test"
Requires-Dist: pytest-mock>=3.0; extra == "test"
Requires-Dist: responses>=0.18.0; extra == "test"

# EVO Cloud Python SDK

[![Python Version](https://img.shields.io/badge/python-3.12%2B-blue.svg)](https://python.org)
[![Version](https://img.shields.io/badge/version-0.1.0-green.svg)](https://github.com/your-org/evocloud-sdk)

EVO Cloud Python SDK æ˜¯ä¸€ä¸ªç”¨äºé›†æˆ EVO Cloud æ”¯ä»˜æœåŠ¡çš„å®˜æ–¹ Python å¼€å‘å·¥å…·åŒ…ã€‚è¯¥ SDK æä¾›äº†ç®€æ´æ˜“ç”¨çš„ API æ¥å£ï¼Œæ”¯æŒ LinkPay ç­‰å¤šç§æ”¯ä»˜æ–¹å¼ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **ç®€å•æ˜“ç”¨**: æä¾›ç›´è§‚çš„ API æ¥å£ï¼Œå¿«é€Ÿé›†æˆæ”¯ä»˜åŠŸèƒ½
- ğŸ” **å®‰å…¨å¯é **: å†…ç½®ç­¾åéªŒè¯æœºåˆ¶ï¼Œæ”¯æŒ SHA256/MD5 ç­‰å¤šç§ç­¾åç®—æ³•
- ğŸ”„ **è‡ªåŠ¨é‡è¯•**: å†…ç½®è¯·æ±‚é‡è¯•æœºåˆ¶ï¼Œæé«˜æ¥å£è°ƒç”¨æˆåŠŸç‡
- ğŸ“ **å®Œæ•´æ—¥å¿—**: è¯¦ç»†çš„è¯·æ±‚æ—¥å¿—è®°å½•ï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§
- ğŸŒ **å¤šæ”¯ä»˜æ–¹å¼**: æ”¯æŒ Alipayã€WeChat Payã€Visaã€UnionPay ç­‰å¤šç§æ”¯ä»˜æ–¹å¼
- ğŸ“± **LinkPay**: æ”¯æŒåˆ›å»ºæ”¯ä»˜é“¾æ¥ï¼Œé€‚ç”¨äºå„ç§æ”¯ä»˜åœºæ™¯
- ğŸ”” **Webhook æ”¯æŒ**: å®Œæ•´çš„ Webhook å¤„ç†å’ŒéªŒè¯æœºåˆ¶

## å®‰è£…

```bash
pip install evocloud-sdk
```

## å¼€å‘æ„å»º

### æ„å»ºæ•´ä¸ªé¡¹ç›®
```bash
python upload_to_pypi.py --build-only
```

### ä»…æ„å»º src ç›®å½•
```bash
python upload_to_pypi.py --src-only --build-only
```

### ä¸Šä¼ åˆ°æµ‹è¯•ç¯å¢ƒ
```bash
python upload_to_pypi.py --test --src-only
```

### æ¸…ç†æ„å»ºæ–‡ä»¶
```bash
python upload_to_pypi.py --clean
```

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€é…ç½®

```python
from evocloud_sdk import EVOCloudClient


# åˆå§‹åŒ–å®¢æˆ·ç«¯
client = EVOCloudClient(
    base_url="https://online-uat.everonet.com",  # æµ‹è¯•ç¯å¢ƒ
    sid="your_system_id",                        # EVO Cloud åˆ†é…çš„ç³»ç»ŸID
    sign_key="your_sign_key",                    # EVO Cloud åˆ†é…çš„ç­¾åå¯†é’¥
    sign_type=SignType.SHA256,                   # ç­¾åç®—æ³•
    timeout=60,                                  # è¯·æ±‚è¶…æ—¶æ—¶é—´
    max_retries=1                                # æœ€å¤§é‡è¯•æ¬¡æ•°
)
```

### åˆ›å»º LinkPay æ”¯ä»˜è®¢å•

```python
from datetime import datetime, timezone
from common.utils import generate_order_id, format_amount

# ç”Ÿæˆå”¯ä¸€è®¢å•ID
order_id = generate_order_id("PAY")

# åˆ›å»ºæ”¯ä»˜è®¢å•
order_data = {
    "merchantOrderInfo": {
        "merchantOrderID": order_id,
        "merchantOrderTime": datetime.now(timezone.utc).isoformat(),
        "enabledPaymentMethod": ["Alipay", "WeChat_Pay", "Visa"],
        "orderType": "Single"
    },
    "transAmount": {
        "currency": "USD",
        "value": format_amount(100.50)  # "100.50"
    },
    "tradeInfo": {
        "tradeType": "Payment",
        "goodsInfo": {
            "goodsName": "æµ‹è¯•å•†å“",
            "goodsDescription": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å•†å“"
        }
    }
}

try:
    # ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾
    with client:
        response = client._make_request(
            "POST", 
            f"/g2/v0/payment/mer/{client.sid}/evo.e-commerce.linkpay",
            data=order_data
        )
        
        if response.get('result', {}).get('code') == "S0000":
            payment_link = response['data']['paymentLink']
            print(f"æ”¯ä»˜é“¾æ¥åˆ›å»ºæˆåŠŸ: {payment_link}")
        else:
            print(f"åˆ›å»ºè®¢å•å¤±è´¥: {response.get('result', {}).get('message')}")
            
except Exception as e:
    print(f"åˆ›å»ºè®¢å•å¼‚å¸¸: {e}")
```

## API æ–‡æ¡£

### EVOCloudClient å®¢æˆ·ç«¯

#### åˆå§‹åŒ–å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `base_url` | str | æ˜¯ | EVO Cloud API åŸºç¡€URL |
| `sid` | str | æ˜¯ | ç³»ç»ŸID |
| `sign_key` | str | æ˜¯ | ç­¾åå¯†é’¥ |
| `sign_type` | SignType | å¦ | ç­¾åç®—æ³•ï¼Œé»˜è®¤ SHA256 |
| `timeout` | int | å¦ | è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 60 ç§’ |
| `max_retries` | int | å¦ | æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ 1 æ¬¡ |

#### ä¸»è¦æ–¹æ³•

##### `_make_request(method: str, url_path: str, data: dict = None) -> dict`

å‘é€ API è¯·æ±‚åˆ° EVO Cloud

**å‚æ•°:**
- `method`: HTTP æ–¹æ³• (GET, POST, PUT, DELETE)
- `url_path`: API ç«¯ç‚¹è·¯å¾„
- `data`: è¯·æ±‚æ•°æ®å­—å…¸

**è¿”å›:**
- API å“åº”æ•°æ®å­—å…¸

**ç¤ºä¾‹:**
```python
# åˆ›å»º LinkPay è®¢å•
response = client.linkpay._make_request(
    "POST",
    f"/g2/v0/payment/mer/{client.sid}/evo.e-commerce.linkpay",
    data=order_data
)

# æŸ¥è¯¢è®¢å•çŠ¶æ€
response = client.linkpay._make_request(
    "GET",
    f"/g2/v0/payment/mer/{client.sid}/order/{order_id}"
)
```

## æ”¯æŒçš„æ”¯ä»˜æ–¹å¼

æ ¹æ® LinkPay API è§„èŒƒï¼Œæ”¯æŒä»¥ä¸‹æ”¯ä»˜æ–¹å¼ï¼š

- **ç”µå­é’±åŒ…**: Alipay, WeChat_Pay
- **ä¿¡ç”¨å¡**: Visa, Mastercard, American_Express
- **å€Ÿè®°å¡**: UnionPay, Diners
- **é“¶è¡Œè½¬è´¦**: å„ç§æœ¬åœ°é“¶è¡Œæ”¯ä»˜æ–¹å¼
- **å…¶ä»–**: æ ¹æ®åœ°åŒºæ”¯æŒçš„æœ¬åœ°æ”¯ä»˜æ–¹å¼

## ç¯å¢ƒé…ç½®

### æµ‹è¯•ç¯å¢ƒ (UAT)
```python
base_url = "https://online-uat.everonet.com"
```

### ç”Ÿäº§ç¯å¢ƒ (Production)
```python
base_url = "https://online.everonet.com"
```

## é”™è¯¯å¤„ç†

SDK æä¾›äº†å®Œæ•´çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼š

```python
from common.exceptions import (
    EVOCloudException, 
    APIException, 
    ValidationException, 
    SignatureException
)

try:
    response = client._make_request("POST", endpoint, data=order_data)
    
    # æ£€æŸ¥ API å“åº”çŠ¶æ€
    result = response.get('result', {})
    if result.get('code') != "S0000":
        raise APIException(f"API Error: {result.get('message')}")
        
except ValidationException as e:
    print(f"å‚æ•°éªŒè¯é”™è¯¯: {e}")
except SignatureException as e:
    print(f"ç­¾åéªŒè¯é”™è¯¯: {e}")
except APIException as e:
    print(f"APIè°ƒç”¨é”™è¯¯: {e}")
except EVOCloudException as e:
    print(f"SDKé”™è¯¯: {e}")
except Exception as e:
    print(f"æœªçŸ¥é”™è¯¯: {e}")
```

## æ—¥å¿—é…ç½®

### å¯ç”¨è°ƒè¯•æ—¥å¿—

```python
# æ–¹æ³•1: ä½¿ç”¨å®¢æˆ·ç«¯æ–¹æ³•
client.enable_debug_logging()

# æ–¹æ³•2: ç›´æ¥è®¾ç½®æ—¥å¿—çº§åˆ«
import logging
client.set_log_level(logging.DEBUG)

# æ–¹æ³•3: ä½¿ç”¨å·¥å…·å‡½æ•°é…ç½®
from common.utils import configure_logging
configure_logging(level=logging.DEBUG)
```

### è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼

```python
import logging

# é…ç½®è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('evocloud_sdk.log'),
        logging.StreamHandler()
    ]
)
```

## å·¥å…·å‡½æ•°

SDK æä¾›äº†ä¸€äº›å®ç”¨çš„å·¥å…·å‡½æ•°ï¼š

```python
from common.utils import (
    generate_order_id,      # ç”Ÿæˆè®¢å•ID
    format_amount,          # æ ¼å¼åŒ–é‡‘é¢
    generate_trace_id,      # ç”Ÿæˆè¿½è¸ªID
    validate_webhook_headers, # éªŒè¯Webhookå¤´éƒ¨
    retry_on_failure,       # é‡è¯•è£…é¥°å™¨
    log_api_call           # APIè°ƒç”¨æ—¥å¿—è£…é¥°å™¨
)

# ç”Ÿæˆå”¯ä¸€è®¢å•ID
order_id = generate_order_id("PAY")  # "PAY_1703123456_abc12345"

# æ ¼å¼åŒ–é‡‘é¢ï¼ˆè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼‰
amount_str = format_amount(100.50, decimals=2)  # "100.50"

# ç”Ÿæˆè¿½è¸ªID
trace_id = generate_trace_id()

# éªŒè¯Webhookå¤´éƒ¨
headers = {"Authorization": "...", "DateTime": "...", "MsgID": "...", "SignType": "..."}
is_valid = validate_webhook_headers(headers)

# ä½¿ç”¨é‡è¯•è£…é¥°å™¨
@retry_on_failure(max_retries=3, delay=1.0)
def api_call():
    return client._make_request("GET", "/some/endpoint")

# ä½¿ç”¨APIè°ƒç”¨æ—¥å¿—è£…é¥°å™¨
@log_api_call
def create_order(order_data):
    return client._make_request("POST", "/create/order", data=order_data)
```

## æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨

```python
# æ¨èï¼šä½¿ç”¨ with è¯­å¥ç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾
with LinkpayClient(base_url, sid, sign_key) as client:
    response = client._make_request("POST", endpoint, data=order_data)
```

### 2. é”™è¯¯é‡è¯•æœºåˆ¶

```python
from common.utils import retry_on_failure

@retry_on_failure(max_retries=3, delay=1.0, backoff_factor=2.0)
def create_payment_order(order_data):
    with LinkpayClient(base_url, sid, sign_key) as client:
        return client._make_request(
            "POST", 
            f"/g2/v0/payment/mer/{client.sid}/evo.e-commerce.linkpay",
            data=order_data
        )
```

### 3. è®¢å•ID ç”Ÿæˆ

```python
from common.utils import generate_order_id
import time

# ä½¿ç”¨æ—¶é—´æˆ³å’Œéšæœºæ•°ç”Ÿæˆå”¯ä¸€è®¢å•ID
order_id = generate_order_id("ORDER")

# æˆ–è€…è‡ªå®šä¹‰æ ¼å¼
custom_order_id = f"SHOP_{int(time.time())}_{uuid.uuid4().hex[:8]}"
```

### 4. é‡‘é¢å¤„ç†

```python
from common.utils import format_amount

# ç¡®ä¿é‡‘é¢æ ¼å¼æ­£ç¡®
amount = 99.99
formatted_amount = format_amount(amount, decimals=2)  # "99.99"

# å¤„ç†ä¸åŒè´§å¸çš„å°æ•°ä½æ•°
usd_amount = format_amount(100.5, decimals=2)   # "100.50"
jpy_amount = format_amount(1000, decimals=0)    # "1000"
```

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
evocloud-sdk/
â”œâ”€â”€ common/              # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ __init__.py     # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ client.py       # åŸºç¡€å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ signature.py    # ç­¾åå¤„ç†
â”‚   â”œâ”€â”€ utils.py        # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ exceptions.py   # å¼‚å¸¸å®šä¹‰
â”œâ”€â”€ linkpay/            # LinkPay æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py     # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ client.py       # LinkPay å®¢æˆ·ç«¯
â”‚   â””â”€â”€ model.py        # æ•°æ®æ¨¡å‹
â”œâ”€â”€ merchant/           # å•†æˆ·æ¨¡å—ï¼ˆé¢„ç•™ï¼‰
â”œâ”€â”€ docs/               # æ–‡æ¡£
â”‚   â””â”€â”€ linkpayApiSwagger.json
â”œâ”€â”€ tests/              # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ examples/           # ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ README.md           # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ pyproject.toml      # é¡¹ç›®é…ç½®
â””â”€â”€ requirements.txt    # ä¾èµ–åˆ—è¡¨
```

### è´¡çŒ®ä»£ç 

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

### è¿è¡Œæµ‹è¯•

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install -e ".[test]"

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest tests/

# è¿è¡Œç‰¹å®šæµ‹è¯•
python -m pytest tests/test_linkpay.py

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest --cov=evocloud_sdk tests/
```

### ä»£ç è§„èŒƒ

é¡¹ç›®éµå¾ª PEP 8 ä»£ç è§„èŒƒï¼Œä½¿ç”¨ä»¥ä¸‹å·¥å…·è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥ï¼š

```bash
# ä»£ç æ ¼å¼åŒ–
black evocloud_sdk/

# ä»£ç æ£€æŸ¥
flake8 evocloud_sdk/

# ç±»å‹æ£€æŸ¥
mypy evocloud_sdk/
```

## å¸¸è§é—®é¢˜ (FAQ)

### Q: å¦‚ä½•å¤„ç†ç­¾åéªŒè¯å¤±è´¥ï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç¡®è®¤ `sign_key` æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ `sign_type` æ˜¯å¦ä¸æœåŠ¡ç«¯é…ç½®ä¸€è‡´
3. æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦å‡†ç¡®
4. ç¡®è®¤è¯·æ±‚ä½“å†…å®¹æ²¡æœ‰è¢«ä¿®æ”¹

### Q: æ”¯ä»˜é“¾æ¥å¤šé•¿æ—¶é—´æœ‰æ•ˆï¼Ÿ

A: LinkPay æ”¯ä»˜é“¾æ¥çš„æœ‰æ•ˆæœŸç”± EVO Cloud ç³»ç»Ÿé…ç½®å†³å®šï¼Œé€šå¸¸ä¸º 30 åˆ†é’Ÿåˆ° 24 å°æ—¶ä¸ç­‰ã€‚

### Q: å¦‚ä½•å¤„ç†ç½‘ç»œè¶…æ—¶ï¼Ÿ

A: å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†ï¼š
```python
# å¢åŠ è¶…æ—¶æ—¶é—´
client = LinkpayClient(base_url, sid, sign_key, timeout=120)

# å¢åŠ é‡è¯•æ¬¡æ•°
client = LinkpayClient(base_url, sid, sign_key, max_retries=3)

# ä½¿ç”¨é‡è¯•è£…é¥°å™¨
@retry_on_failure(max_retries=5, delay=2.0)
def robust_api_call():
    return client._make_request("POST", endpoint, data=data)
```

## ç‰ˆæœ¬å†å²

- **v0.1.0** (2024-01-01)
  - åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
  - æ”¯æŒ LinkPay åŸºç¡€åŠŸèƒ½
  - å®Œæ•´çš„ç­¾åéªŒè¯æœºåˆ¶
  - Webhook å¤„ç†æ”¯æŒ
  - å·¥å…·å‡½æ•°åº“

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## æ”¯æŒä¸è”ç³»

- ğŸ“§ é‚®ç®±: support@evocloud.com
- ğŸ“– æ–‡æ¡£: [EVO Cloud å¼€å‘è€…æ–‡æ¡£](https://docs.evocloud.com)
- ğŸ› é—®é¢˜åé¦ˆ: [GitHub Issues](https://github.com/your-org/evocloud-sdk/issues)
- ğŸ’¬ æŠ€æœ¯äº¤æµ: [å¼€å‘è€…ç¤¾åŒº](https://community.evocloud.com)

## ç›¸å…³é“¾æ¥

- [EVO Cloud å®˜ç½‘](https://www.evocloud.com)
- [API æ–‡æ¡£](https://docs.evocloud.com/api)
- [å¼€å‘è€…æ§åˆ¶å°](https://portal.evocloud.com)
- [SDK ç¤ºä¾‹ä»£ç ](https://github.com/your-org/evocloud-sdk-examples)
- [Postman Collection](https://www.postman.com/evocloud/workspace/evocloud-api)
