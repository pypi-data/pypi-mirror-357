var Dt=Object.defineProperty;var Ft=(t,r,s)=>r in t?Dt(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var M=(t,r,s)=>Ft(t,typeof r!="symbol"?r+"":r,s);import{r as Bt,g as at,a as h,u as De,b as zt,R as ot,L as ee,O as Ot,c as lt,d as Vt,B as Ut,e as Wt,f as J}from"./react-CCsofZeE.js";import{F as L,f as ct,S as V,r as Ht,a as Kt,b as Xt,c as Gt,d as Yt,L as te,e as qt,g as Jt,h as Qt,i as Zt,j as es,k as ts,l as ss,m as ns,n as Xe,o as Ge,p as Ye,q as ve,s as be,t as ye,u as je,v as rs,w as ut,x as dt,O as is}from"./vendor-lUBTm_OX.js";import{d as Fe,a as ht,b as mt,c as as,o as Be,l as pt,s as os,q as ls,e as ft,f as _t,g as cs,h as us,i as ds,j as gt,k as xt}from"./d3-BdqqTklI.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();var Re={exports:{}},ie={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qe;function hs(){if(qe)return ie;qe=1;var t=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function s(n,i,a){var o=null;if(a!==void 0&&(o=""+a),i.key!==void 0&&(o=""+i.key),"key"in i){a={};for(var d in i)d!=="key"&&(a[d]=i[d])}else a=i;return i=a.ref,{$$typeof:t,type:n,key:o,ref:i!==void 0?i:null,props:a}}return ie.Fragment=r,ie.jsx=s,ie.jsxs=s,ie}var Je;function ms(){return Je||(Je=1,Re.exports=hs()),Re.exports}var e=ms();Array.prototype.sortKey||(Array.prototype.sortKey=function(t){return this.sort((r,s)=>{const n=t(r),i=t(s);if(Array.isArray(n)&&Array.isArray(i)){for(let a=0;a<Math.min(n.length,i.length);a++){if(n[a]<i[a])return-1;if(n[a]>i[a])return 1}return 0}return n<i?-1:n>i?1:0})});var ps=Bt();const fs=at(ps);function _s({current:t,total:r,message:s}){const n=r>0?Math.round(t/r*100):0;return e.jsxs("div",{className:"progress-notification",children:[e.jsx("div",{className:"progress-notification__text",children:s}),e.jsx("div",{className:"progress-notification__bar",children:e.jsx("div",{className:"progress-notification__fill",style:{width:`${n}%`}})}),e.jsxs("div",{className:"progress-notification__percentage",children:[n,"%"]})]})}function gs({message:t,onDismiss:r,isVisible:s}){const[n,i]=h.useState(s);return h.useEffect(()=>{if(s){i(!0);return}else{const a=setTimeout(()=>{i(!1)},300);return()=>clearTimeout(a)}},[s]),n?e.jsxs("div",{className:`notification ${s?"notification--visible":"notification--hidden"}`,onClick:r,children:[e.jsx("div",{className:"notification__content",children:t}),e.jsx("button",{className:"notification__close",onClick:a=>{a.stopPropagation(),r()},"aria-label":"Close notification",children:e.jsx(L,{icon:ct})})]}):null}const vt=h.createContext(null);function xs({children:t}){const[r,s]=h.useState([]),n=h.useRef(new Map),i=h.useRef(0),a=h.useCallback(u=>{clearTimeout(n.current.get(u)),n.current.delete(u),s(l=>l.filter(c=>c.id!==u))},[]),o=h.useCallback((u,l)=>{const c=++i.current,m={id:c,message:u,duration:l};if(s(x=>[...x,m]),l!==null){const x=setTimeout(()=>{a(c)},l);n.current.set(c,x)}return c},[a]),d=h.useCallback((u,l,c)=>{if(s(m=>m.map(x=>x.id===u?{...x,message:l,duration:c}:x)),c!==null){clearTimeout(n.current.get(u));const m=setTimeout(()=>{a(u)},c);n.current.set(u,m)}},[a]);return e.jsxs(vt.Provider,{value:{addNotification:o,updateNotification:d,dismissNotification:a},children:[t,e.jsx("div",{className:"notifications",children:r.map((u,l)=>e.jsx("div",{className:"notification-wrapper",style:{top:`${20+l*80}px`},children:e.jsx(gs,{message:u.message,isVisible:!0,onDismiss:()=>a(u.id)})},u.id))})]})}function vs(){const t=h.useContext(vt);if(!t)throw new Error("useNotification must be used within a NotificationProvider");return t}function ze(){const[t,r]=h.useState(!1);return h.useEffect(()=>{function s(){r(window.matchMedia("(max-width: 768px)").matches)}return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),t}function re({value:t,onChange:r,options:s}){const n=ze();return console.assert(V(s.map(i=>i.value)).size===s.length),e.jsx("div",{className:"scale-toggle",children:s.map(i=>e.jsx("button",{className:`scale-toggle__button${t===i.value?" scale-toggle__button--active":""}`,onClick:()=>{if(s.length==2&&t===i.value){const a=s.find(o=>o.value!==i.value).value;r(a)}else r(i.value)},children:n?i.mobileContent??i.content:i.content},String(i.value)))})}class bt{constructor(r,s,n,i){M(this,"createdAt");this.name=r,this.predicate=s,this.component=n,this.extraData=i,this.createdAt=Date.now()}}const yt=h.createContext(void 0);function bs({children:t}){const[r,s]=h.useState(new Map([["covering",new Map],["rolling",new Map]])),[n,i]=h.useState("covering"),a=r.get(n)||new Map,o=l=>{s(c=>{const m=new Map(c);return m.set(n,l),m})},u={filters:a,setFilters:o,removeFilter:(l,c)=>{const m=new Map(a),p=(m.get(l)||[]).filter(f=>f.name!==c);p.length===0?m.delete(l):m.set(l,p),o(m)},observationCategory:n,setObservationCategory:i};return e.jsx(yt.Provider,{value:u,children:t})}function Ne(){const t=h.useContext(yt);if(t===void 0)throw new Error("useFilters must be used within a FilterProvider");return t}const jt=h.createContext(null);function ys({state:t}){return t.visible?zt.createPortal(e.jsx("div",{className:"cursor-tooltip",style:{position:"fixed",left:`${t.x+10}px`,top:`${t.y-28}px`,display:"block",pointerEvents:"none",zIndex:9999},dangerouslySetInnerHTML:{__html:t.content}}),document.body):null}function js({children:t}){const r=De(),[s,n]=h.useState({visible:!1,content:"",x:0,y:0,owner:null});h.useEffect(()=>{n(u=>({...u,visible:!1,owner:null}))},[r.pathname]);const i=h.useCallback((u,l,c,m)=>{n({visible:!0,content:u,x:l,y:c,owner:m})},[]),a=h.useCallback(u=>{n(l=>l.owner===u?{...l,visible:!1,owner:null}:l)},[]),o=h.useCallback((u,l,c)=>{n(m=>m.visible&&m.owner===c&&(m.x!==u||m.y!==l)?{...m,x:u,y:l}:m)},[]),d=h.useMemo(()=>({showTooltip:i,hideTooltip:a,moveTooltip:o,visible:s.visible}),[i,a,o,s.visible]);return e.jsxs(jt.Provider,{value:d,children:[t,e.jsx(ys,{state:s})]})}function Oe(){const t=h.useContext(jt);if(!t)throw new Error("useTooltip must be used within a TooltipProvider");return t}var ws=Ht();const he=at(ws);function wt(t,r=0){return Array.from(t).reduce((s,n)=>s+n,r)}function Nt(t,r=!1){t.current&&(r&&t.current.querySelectorAll("code").forEach(s=>{s.removeAttribute("data-highlighted")}),t.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(s=>{he.highlightElement(s)}))}function ue(t,r){if(r){let s=null,n=null;for(let i=0;i<t.length;i++){const a=t[i],o=r(a);o!=null&&(n===null||o>n)&&(n=o,s=a)}return s}else{let s=null;for(let n=0;n<t.length;n++){const i=t[n];i!=null&&(s===null||i>s)&&(s=i)}return s}}function Ns(t,r){{let s=null;for(let n=0;n<t.length;n++){const i=t[n];i!=null&&(s===null||i<s)&&(s=i)}return s}}function Ee(t,r,s){let n=0,i=t.length;for(;n<i;){const a=n+i>>>1;(s?s(t[a])<=r:t[a]<=r)?n=a+1:i=a}return n}let ae=null;function Ss(){return ae||(ae=document.createElement("div"),ae.style.cssText=`
      position: absolute;
      visibility: hidden;
      white-space: nowrap;
      top: -9999px;
      left: -9999px;
      pointer-events: none;
      z-index: -1;
    `,document.body.appendChild(ae)),ae}function Ce(t,r=""){const s=Ss();s.className=r,s.textContent=t;const n=s.getBoundingClientRect();return{width:n.width,height:n.height}}function St(t,r,s){if(t.metaKey||t.ctrlKey){const n=window.location,i=`${n.origin}${r}`;console.log(n.origin,n.pathname,r,i),window.open(i,"_blank")}else s(r)}function kt(t){return t.split("::").pop()||t}const G={select:Fe,scaleLinear:pt,scaleOrdinal:Be,scaleBand:as,axisBottom:mt,axisLeft:ht},Qe=5,X=2.5;function ks({feature:t,observations:r}){const s=h.useRef(null),n=h.useRef(null),{filters:i,setFilters:a}=Ne(),{showTooltip:o,hideTooltip:d,moveTooltip:u}=Oe(),l=i.get(t)||[],c=h.useMemo(()=>{if(l.length===0)return V();console.assert(l.length===1);const p=l[0];return V(p.extraData.selectedValues)},[l]),m=h.useMemo(()=>({raw:r.raw.filter(p=>p.status!=="gave_up"),filtered:r.filtered.filter(p=>p.status!=="gave_up")}),[r]),x=p=>{let f=V();c.equals(V([p]))?f=V():f=V([p]);let S;f.size===1?S=f.first():S=f.map(T=>`${T}`).join(" or ");const C=[];f.size>0&&C.push(new bt(S,T=>f.some(P=>T.features.get(t)===P),t,{selectedValues:f}));const _=new Map(i);_.set(t,C),a(_)};return h.useEffect(()=>{const p=V(m.raw.map(v=>v.features.get(t)));let f=new Map;for(const v of m.filtered){const $=v.features.get(t);f.set($,(f.get($)||0)+1)}const S=wt(Array.from(f.values()));f=new Map([...f.entries()].sortKey(([v,$])=>v===ge?0:v===xe?1:v)),G.select(n.current).selectAll("*").remove();const C=s.current.clientWidth,_=p.size<Qe?85:170,T=G.select(n.current).attr("width",C).attr("height",_).append("g"),P=function(v,$){const[b,y]=$;o(`${t}<br>${b}: ${y}`,v.clientX,v.clientY,"tyche-nominal")};if(p.size<Qe){const v={top:0,right:15,bottom:20,left:15},$=C-v.left-v.right,b=_-v.top-v.bottom,y=G.scaleLinear().domain([0,1]).range([0,$]);let j;f.has(ge)||f.has(xe)?j=U=>U===ge?W.SUCCESS:U===xe?W.ERROR:W.PRIMARY:j=G.scaleOrdinal().domain(Array.from(f.keys())).range([W.PRIMARY,W.ACCENT,W.ACCENT2,W.ACCENT3,W.ACCENT4]);const E=T.append("g").attr("transform",`translate(${v.left},${v.top})`);let N=0;const I=b-v.bottom;f.forEach((U,g)=>{const w=U/S*$,k=c.has(g);E.append("rect").attr("x",N).attr("y",0).attr("width",w).attr("height",I).attr("fill",j(g)).style("cursor","pointer").on("click",()=>x(g)).on("mouseover",A=>{P(A,[g,U])}).on("mousemove",A=>u(A.clientX,A.clientY,"tyche-nominal")).on("mouseleave",()=>d("tyche-nominal")),k&&E.append("rect").attr("x",N+X).attr("y",X).attr("width",w-2*X).attr("height",I-2*X).attr("fill",j(g)).attr("stroke","white").attr("stroke-width",X).style("pointer-events","none"),E.append("text").attr("x",N+w/2).attr("y",I/2).attr("text-anchor","middle").attr("dominant-baseline","central").attr("fill","white").text(g).style("font-size","12px"),N+=w}),E.append("g").attr("transform",`translate(0,${I})`).call(G.axisBottom(y).tickFormat(U=>`${Math.round(Number(U)*100)}%`)),E.append("text").attr("x",$/2).attr("y",I+30).attr("text-anchor","middle").text("% of observations").style("font-size","12px")}else{const v={top:5,right:5,bottom:30,left:30},$=C-v.left-v.right,b=_-v.top-v.bottom,y=G.scaleBand().domain(Array.from(f.keys())).range([0,$]).padding(.2),j=G.scaleLinear().domain([0,ue(Array.from(f.values()))||0]).range([b,0]),E=T.append("g").attr("transform",`translate(${v.left},${v.top})`);E.selectAll(".bar").data(Array.from(f.entries())).enter().append("rect").attr("class","bar").attr("x",([N,I])=>y(N)||0).attr("y",([N,I])=>j(I)).attr("width",y.bandwidth()).attr("height",([N,I])=>b-j(I)).attr("fill",W.PRIMARY).style("cursor","pointer").on("click",function(N,[I,U]){x(I)}).on("mouseover",function(N,I){P(N,I)}).on("mousemove",N=>u(N.clientX,N.clientY,"tyche-nominal")).on("mouseleave",()=>d("tyche-nominal")),E.selectAll(".inner-bar").data(Array.from(f.entries()).filter(([N,I])=>c.has(N))).enter().append("rect").attr("class","inner-bar").attr("x",([N,I])=>(y(N)||0)+X).attr("y",([N,I])=>j(I)+X).attr("width",y.bandwidth()-2*X).attr("height",([N,I])=>b-j(I)-2*X).attr("fill",W.PRIMARY).attr("stroke","white").attr("stroke-width",X).style("pointer-events","none"),E.append("g").attr("transform",`translate(0,${b})`).call(G.axisBottom(y)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),E.append("g").call(G.axisLeft(j).ticks(7).tickFormat(N=>Math.round(Number(N)).toString())),E.append("text").attr("transform","rotate(-90)").attr("y",-30).attr("x",-b/2).attr("text-anchor","middle").text("Count").style("font-size","12px")}},[m]),e.jsxs("div",{children:[e.jsx("div",{className:"tyche__nominal__feature",children:t}),e.jsx("div",{ref:s,className:"tyche__nominal__chart",children:e.jsx("svg",{ref:n,style:{width:"100%"}})})]})}function Ve({title:t,children:r,defaultState:s="open",onStateChange:n,headerClass:i="",contentClass:a=""}){const[o,d]=h.useState(s),u=()=>{const l=o==="open"?"closed":"open";d(l),n==null||n(l)};return e.jsxs("div",{children:[e.jsxs("div",{className:`collapsible__header ${i}`,onClick:u,children:[e.jsx("span",{className:"collapsible__toggle",children:o==="open"?e.jsx(L,{icon:Kt}):e.jsx(L,{icon:Xt})}),t]}),o==="open"&&e.jsx("div",{className:`${a}`,children:r})]})}function Ue({title:t,children:r,defaultState:s="open",onStateChange:n}){return e.jsx("div",{className:"tyche__section",children:e.jsx(Ve,{title:t,defaultState:s,onStateChange:n,headerClass:"tyche__section__header",contentClass:"tyche__section__content",children:r})})}function As({observations:t}){const r=new Set;return t.raw.forEach(s=>{for(const n of s.features.keys())n.startsWith("Retried draw from")||r.add(n)}),r.size===0?null:e.jsx(Ue,{title:"Features",children:Array.from(r).sort().map(s=>e.jsx(ks,{feature:s,observations:t}))})}function Rs(){const{filters:t,removeFilter:r}=Ne(),s=Array.from(t.values()).flat().sortKey(n=>n.createdAt);return s.length===0?null:e.jsxs("div",{className:"tyche__filters",children:[e.jsx("div",{className:"tyche__filters__title",children:"Current Filters"}),s.map(n=>e.jsxs("div",{className:"tyche__filters__filter",children:[e.jsxs("div",{className:"tyche__filters__filter__component",children:[e.jsx("div",{className:"tyche__filters__filter__remove",onClick:()=>r(n.component,n.name),children:e.jsx(L,{icon:ct})}),n.component]}),e.jsx("div",{className:"tyche__filters__filter__name",children:n.name})]},`${n.component}-${n.name}`))]})}function At(t){const r=t.regex,s=new RegExp("[\\p{XID_Start}_]\\p{XID_Continue}*","u"),n=["and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","match","nonlocal|10","not","or","pass","raise","return","try","while","with","yield"],d={$pattern:/[A-Za-z]\w+|__\w+__/,keyword:n,built_in:["__import__","abs","all","any","ascii","bin","bool","breakpoint","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],literal:["__debug__","Ellipsis","False","None","NotImplemented","True"],type:["Any","Callable","Coroutine","Dict","List","Literal","Generic","Optional","Sequence","Set","Tuple","Type","Union"]},u={className:"meta",begin:/^(>>>|\.\.\.) /},l={className:"subst",begin:/\{/,end:/\}/,keywords:d,illegal:/#/},c={begin:/\{\{/,relevance:0},m={className:"string",contains:[t.BACKSLASH_ESCAPE],variants:[{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?'''/,end:/'''/,contains:[t.BACKSLASH_ESCAPE,u],relevance:10},{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?"""/,end:/"""/,contains:[t.BACKSLASH_ESCAPE,u],relevance:10},{begin:/([fF][rR]|[rR][fF]|[fF])'''/,end:/'''/,contains:[t.BACKSLASH_ESCAPE,u,c,l]},{begin:/([fF][rR]|[rR][fF]|[fF])"""/,end:/"""/,contains:[t.BACKSLASH_ESCAPE,u,c,l]},{begin:/([uU]|[rR])'/,end:/'/,relevance:10},{begin:/([uU]|[rR])"/,end:/"/,relevance:10},{begin:/([bB]|[bB][rR]|[rR][bB])'/,end:/'/},{begin:/([bB]|[bB][rR]|[rR][bB])"/,end:/"/},{begin:/([fF][rR]|[rR][fF]|[fF])'/,end:/'/,contains:[t.BACKSLASH_ESCAPE,c,l]},{begin:/([fF][rR]|[rR][fF]|[fF])"/,end:/"/,contains:[t.BACKSLASH_ESCAPE,c,l]},t.APOS_STRING_MODE,t.QUOTE_STRING_MODE]},x="[0-9](_?[0-9])*",p=`(\\b(${x}))?\\.(${x})|\\b(${x})\\.`,f=`\\b|${n.join("|")}`,S={className:"number",relevance:0,variants:[{begin:`(\\b(${x})|(${p}))[eE][+-]?(${x})[jJ]?(?=${f})`},{begin:`(${p})[jJ]?`},{begin:`\\b([1-9](_?[0-9])*|0+(_?0)*)[lLjJ]?(?=${f})`},{begin:`\\b0[bB](_?[01])+[lL]?(?=${f})`},{begin:`\\b0[oO](_?[0-7])+[lL]?(?=${f})`},{begin:`\\b0[xX](_?[0-9a-fA-F])+[lL]?(?=${f})`},{begin:`\\b(${x})[jJ](?=${f})`}]},C={className:"comment",begin:r.lookahead(/# type:/),end:/$/,keywords:d,contains:[{begin:/# type:/},{begin:/#/,end:/\b\B/,endsWithParent:!0}]},_={className:"params",variants:[{className:"",begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:d,contains:["self",u,S,m,t.HASH_COMMENT_MODE]}]};return l.contains=[m,S,u],{name:"Python",aliases:["py","gyp","ipython"],unicodeRegex:!0,keywords:d,illegal:/(<\/|\?)|=>/,contains:[u,S,{scope:"variable.language",match:/\bself\b/},{beginKeywords:"if",relevance:0},{match:/\bor\b/,scope:"keyword"},m,C,t.HASH_COMMENT_MODE,{match:[/\bdef/,/\s+/,s],scope:{1:"keyword",3:"title.function"},contains:[_]},{variants:[{match:[/\bclass/,/\s+/,s,/\s*/,/\(\s*/,s,/\s*\)/]},{match:[/\bclass/,/\s+/,s]}],scope:{1:"keyword",3:"title.class",6:"title.class.inherited"}},{className:"meta",begin:/^[\t ]*@/,end:/(?=#)|$/,contains:[S,_,m]}]}}function Ze({currentPage:t,pageCount:r,onPageChange:s}){console.assert(r>1);function n(){return r<=7?Array.from({length:r},(u,l)=>l):t<=3?[0,1,2,3,4,"ellipsis",r-1]:t>=r-4?[0,"ellipsis",r-5,r-4,r-3,r-2,r-1]:[0,"ellipsis",t-1,t,t+1,"ellipsis",r-1]}const i=n();function a(u){typeof u=="number"&&t!==u&&s(u)}function o(){t>0&&s(t-1)}function d(){t<r-1&&s(t+1)}return e.jsxs("div",{className:"pagination",children:[e.jsx("div",{className:`pagination__nav pagination__nav--left ${t===0?"pagination__nav--disabled":""}`,onClick:o,children:e.jsx(L,{icon:Gt})}),i.map((u,l)=>{if(u==="ellipsis")return e.jsx("div",{className:" pagination__ellipsis",children:"..."},`ellipsis-${l}`);const c=u===t;return e.jsx("div",{className:`pagination__number ${c?"pagination__number--current":""}`,onClick:()=>a(u),children:u+1},u)}),e.jsx("div",{className:`pagination__nav pagination__nav--right ${t===r-1?"pagination__nav--disabled":""}`,onClick:d,children:e.jsx(L,{icon:Yt})})]})}he.registerLanguage("python",At);const Te=30;function Es({observations:t,observationCategory:r}){const s=h.useRef(null),[n,i]=h.useState(0);h.useEffect(()=>{i(0)},[r]);function a(){s.current&&s.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(l=>{he.highlightElement(l)})}h.useEffect(()=>{a()},[t,n]);const o=new Map;t.filtered.forEach(l=>{const c=l.representation;o.set(c,(o.get(c)||0)+1)});const d=Math.ceil(o.size/Te),u=Array.from(o.entries()).sortKey(([l,c])=>-c).slice(n*Te,(n+1)*Te);return e.jsx(Ue,{title:"Textual representation",defaultState:"closed",onStateChange:l=>{l==="open"&&requestAnimationFrame(()=>{a()})},children:e.jsxs("div",{ref:s,children:[d>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"12px"},children:e.jsx(Ze,{currentPage:n,pageCount:d,onPageChange:i})}),u.map(([l,c])=>e.jsxs("div",{style:{position:"relative"},className:"tyche__representation__example",children:[e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:l})}),c>1&&e.jsxs("div",{className:"tyche__representation__example__count",children:["x ",c]})]},l)),d>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"12px"},children:e.jsx(Ze,{currentPage:n,pageCount:d,onPageChange:i})})]})})}const et=640;function Cs({name:t,observations:r,verticalAxis:s,horizontalAxis:n,cssStyle:i=(a,o)=>({})}){const{filters:a,setFilters:o}=Ne(),{showTooltip:d,hideTooltip:u,moveTooltip:l}=Oe(),c=a.get(t)||[],m=h.useMemo(()=>{if(c.length===0)return V();console.assert(c.length===1);const g=c[0];return V(g.extraData.selectedCells)},[c]),x=[],p=Array(s.length).fill(0),f=Array(n.length).fill(0);let S=0;for(let g=0;g<s.length;g++){x[g]=[];for(let w=0;w<n.length;w++)x[g][w]={count:0,widthPercent:0}}r.filtered.forEach(g=>{for(let w=0;w<s.length;w++){const[,k]=s[w];if(k(g)){for(let A=0;A<n.length;A++){const[,D]=n[A];if(D(g)){x[w][A].count++,p[w]++,f[A]++,S++;break}}break}}});const C=p.map((g,w)=>g>0?w:null).filter(g=>g!==null),_=f.map((g,w)=>g>0?w:null).filter(g=>g!==null),T=(g,w)=>{let k=V();if(g!==null&&w!==null){const R=te([g,w]);m.equals(V([R]))?k=V():k=V([R])}else g!==null?(console.assert(w===null),_.forEach(R=>{x[g][R].count>0&&(k=k.add(te([g,R])))})):w!==null&&(console.assert(g===null),C.forEach(R=>{x[R][w].count>0&&(k=k.add(te([R,w])))}));function A(){if(k.size===0)return"";let R=k;const z=[],K=[...C.map(F=>({name:s[F][0],cells:_.filter(O=>x[F][O].count>0).map(O=>te([F,O]))})),..._.map(F=>({name:n[F][0],cells:C.filter(O=>x[O][F].count>0).map(O=>te([O,F]))}))];for(const F of K)F.cells.length>0&&F.cells.every(O=>R.has(O))&&(z.push(F.name),R=R.subtract(V(F.cells)));for(;R.size>0;){const F=R.first(),[O,Ae]=F.toArray();z.push(`${s[O][0]}+${n[Ae][0]}`),R=R.delete(F)}return console.assert(R.size==0),z.join(" or ")}const D=[];k.size>0&&D.push(new bt(A(),R=>k.some(z=>{const[K,F]=z.toArray(),O=s[K][1],Ae=n[F][1];return O(R)&&Ae(R)}),t,{selectedCells:k}));const H=new Map(a);H.set(t,D),o(H)};if(C.length===0||_.length===0)return e.jsx("div",{children:"No observations"});const P=30,v=30,$=45*C.length;for(let g=0;g<s.length;g++)for(let w=0;w<n.length;w++)x[g][w].widthPercent=p[g]>0?x[g][w].count/p[g]*100:0;const y=C.map(g=>p[g]/S*$).map(g=>Math.max(g,v)),j=_.map((g,w)=>w===0?0:w===_.length-1?100:w/(_.length-1)*100),{rowHeaderWidth:E,columnHeaderHeight:N,rowTotalWidth:I}=h.useMemo(()=>({rowHeaderWidth:Math.max(...C.map(g=>Ce(s[g][0],"tyche__mosaic__row-header").width)),columnHeaderHeight:Math.max(..._.map(g=>Ce(n[g][0],"tyche__mosaic__column-header").height)),rowTotalWidth:Math.max(...C.map(g=>Ce(p[g].toString(),"tyche__mosaic__row-total").width))}),[C,_,s,n,p]),U=et-E-I;return C.forEach(g=>{const w=_.map(A=>x[g][A]);if(w.reduce((A,D)=>A+D.widthPercent,0)>0){const D=w.map(R=>R.widthPercent/100*U).map((R,z)=>w[z].count>0&&R>0&&R<P?P:R),H=D.reduce((R,z)=>R+z,0);_.forEach((R,z)=>{x[g][R].widthPercent=H>0?D[z]/H*100:0})}}),e.jsxs("div",{className:"tyche__mosaic__container",style:{maxWidth:`${et}px`},children:[e.jsx("div",{className:"tyche__mosaic__column-headers",style:{marginLeft:`${E}px`,marginRight:`${I}px`,height:`${N}px`},children:_.map((g,w)=>{const k=w===0,A=w===_.length-1;return e.jsx("div",{className:"tyche__mosaic__column-header",style:{left:`${j[w]}%`,transform:k?"translateX(0%)":A?"translateX(-100%)":"translateX(-50%)",textAlign:k?"left":A?"right":"center"},onClick:()=>T(null,g),children:n[g][0]},`header-${g}`)})}),C.map((g,w)=>e.jsxs("div",{className:"tyche__mosaic__row",style:{height:`${y[w]}px`},children:[e.jsx("div",{className:"tyche__mosaic__row-header",style:{width:`${E}px`,cursor:"pointer"},onClick:()=>T(g,null),children:s[g][0]}),e.jsx("div",{className:"tyche__mosaic__row-cells",children:_.map(k=>{const A=x[g][k];if(A.count===0)return null;const D=m.has(te([g,k])),H=`${s[g][0]} and ${n[k][0]}<br>Count: ${A.count}`;return e.jsx("div",{className:`tyche__mosaic__cell${D?" tyche__mosaic__cell--selected":""}`,style:{width:`${A.widthPercent}%`,minWidth:`${P}px`,minHeight:`${v}px`,...i(s[g][0],n[k][0])},onClick:()=>T(g,k),onMouseEnter:R=>d(H,R.clientX,R.clientY,"tyche-mosaic"),onMouseMove:R=>l(R.clientX,R.clientY,"tyche-mosaic"),onMouseLeave:()=>u("tyche-mosaic"),children:e.jsx("span",{className:"tyche__mosaic__cell-value",children:A.count})},`cell-${g}-${k}`)})}),e.jsx("div",{className:"tyche__mosaic__row-total",style:{width:`${I}px`},children:p[g]})]},`row-${g}`)),e.jsxs("div",{className:"tyche__mosaic__column-totals-row",style:{height:`${N}px`},children:[e.jsx("div",{style:{width:`${E}px`}}),e.jsx("div",{className:"tyche__mosaic__column-totals",style:{marginRight:`${I}px`},children:_.map((g,w)=>{const k=w===0,A=w===_.length-1;return e.jsx("div",{className:"tyche__mosaic__column-total",style:{left:`${j[w]}%`,transform:k?"translateX(0%)":A?"translateX(-100%)":"translateX(-50%)",textAlign:k?"left":A?"right":"center"},children:f[g]},`total-${g}`)})}),e.jsx("div",{className:"tyche__mosaic__grand-total",style:{width:`${I}px`},children:S})]})]})}function Ts({observations:t}){function r(s,n){const i={};return s==="Passed"?i.backgroundColor=W.SUCCESS:s==="Invalid"?i.backgroundColor=W.WARNING:s==="Failed"&&(i.backgroundColor=W.ERROR),n==="Duplicate"&&(i.opacity=.7),i}return e.jsx(Ue,{title:"Sample breakdown",children:e.jsx(Cs,{name:"samples",observations:t,verticalAxis:[["Passed",s=>s.status==="passed"],["Invalid",s=>s.status==="gave_up"]],horizontalAxis:[["Unique",s=>s.isUnique??!1],["Duplicate",s=>s.isDuplicate??!1]],cssStyle:r})})}const ge="Present",xe="Not present";var W=(t=>(t.PRIMARY="#6b8ab5",t.SUCCESS="#8ba86b",t.WARNING="#d59a7e",t.ERROR="#c77a7e",t.ACCENT="#c1a2bb",t.ACCENT2="#9fc7c6",t.ACCENT3="#edd39a",t.ACCENT4="#99c7d6",t.ACCENT5="#8faac6",t))(W||{});function Ms({test:t}){const{filters:r,observationCategory:s,setObservationCategory:n}=Ne(),i=s==="rolling"?t.rolling_observations.sortKey(d=>-d.run_start):t.corpus_observations,a=h.useMemo(()=>{const d=Array.from(r.values()).flat();return d.length===0?i:i.filter(u=>d.every(l=>l.predicate(u)))},[i,r]),o={raw:i,filtered:a};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:e.jsx("span",{children:"Observations"})}),e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(re,{value:s,onChange:n,options:[{value:"covering",content:"Covering"},{value:"rolling",content:"Rolling"}]})}),e.jsx(Rs,{}),o.raw.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Ts,{observations:o}),e.jsx(As,{observations:o}),e.jsx(Es,{observations:o,observationCategory:s})]}):e.jsx("div",{className:"tyche__section",children:"No observations"})]})}function $s({test:t}){return e.jsx(bs,{children:e.jsx(Ms,{test:t})})}class me{withProperties(r){return Object.assign(Object.create(this.constructor.prototype),this,r)}}class de extends me{constructor(r,s){super(),this.state=r,this.observation=s}static fromJson(r){return new de(r.state,ke.fromJson(r.observation))}}class Z extends me{constructor(r=new Map([[0,0],[1,0],[2,0],[3,0]])){super(),this.counts=r}static fromJson(r){const s=new Map([[0,0],[1,0],[2,0],[3,0]]);for(const[n,i]of Object.entries(r))console.assert(typeof i=="number"),s.set(Number(n),i);return new Z(s)}add(r){const s=new Map(this.counts);for(const[n,i]of r.counts.entries())s.set(n,s.get(n)+i);return new Z(s)}subtract(r){const s=new Map(this.counts);for(const[n,i]of r.counts.entries())s.set(n,s.get(n)-i);return new Z(s)}sum(){return wt(this.counts.values())}}var Rt=(t=>(t[t.OVERRUN=0]="OVERRUN",t[t.INVALID=1]="INVALID",t[t.VALID=2]="VALID",t[t.INTERESTING=3]="INTERESTING",t))(Rt||{}),Me=(t=>(t.GENERATE="generate",t.REPLAY="replay",t.DISTILL="distill",t.SHRINK="shrink",t.FAILED="failed",t))(Me||{});class Se extends me{constructor(s,n,i,a,o,d,u,l){super();M(this,"status_counts_diff");M(this,"elapsed_time_diff");M(this,"timestamp_monotonic");this.elapsed_time=s,this.timestamp=n,this.status_counts=i,this.behaviors=a,this.fingerprints=o,this.since_new_behavior=d,this.phase=u,this.worker_uuid=l,this.status_counts_diff=null,this.elapsed_time_diff=null,this.timestamp_monotonic=null}get ninputs(){return this.status_counts.sum()}static fromJson(s,n){return new Se(n.elapsed_time,n.timestamp,Z.fromJson(n.status_counts),n.behaviors,n.fingerprints,n.since_new_behavior,n.phase,s)}}class ke extends me{constructor(s,n,i,a,o,d,u,l,c,m,x){super();M(this,"isDuplicate",null);M(this,"isUnique",null);this.type=s,this.status=n,this.status_reason=i,this.representation=a,this.arguments_=o,this.how_generated=d,this.features=u,this.timing=l,this.metadata=c,this.property=m,this.run_start=x}static fromJson(s){return new ke(s.type,s.status,s.status_reason,s.representation,new Map(Object.entries(s.arguments)),s.how_generated,new Map(Object.entries(s.features)),new Map(Object.entries(s.timing)),new Map(Object.entries(s.metadata)),s.property,Number(s.run_start))}}var Y=(t=>(t[t.FAILED=0]="FAILED",t[t.SHRINKING=1]="SHRINKING",t[t.RUNNING=2]="RUNNING",t[t.WAITING=3]="WAITING",t))(Y||{});function tt(t,r){const s=r?r.status_counts:new Z,n=r?r.elapsed_time:0,i=t.status_counts.subtract(s),a=t.elapsed_time-n,o=r?Math.max(t.timestamp,r.timestamp_monotonic+a):t.timestamp;return console.assert(Array.from(i.counts.values()).every(d=>d>=0)),console.assert(a>=0),t.withProperties({status_counts_diff:i,elapsed_time_diff:a,timestamp_monotonic:o})}const ce=class ce extends me{constructor(s,n,i,a,o,d){super();M(this,"linear_reports");M(this,"_status_counts_cumsum");M(this,"_elapsed_time_cumsum");M(this,"load_finished_at",null);this.database_key=s,this.nodeid=n,this.rolling_observations=i,this.corpus_observations=a,this.failures=o,this.reports_by_worker=d,this.linear_reports=[],this._status_counts_cumsum=new Map,this._elapsed_time_cumsum=new Map,this.load_finished_at=null;const u=this.reports_by_worker;this.reports_by_worker=new Map;const l=Array.from(u.entries()).flatMap(([c,m])=>m.map(x=>[c,x])).sortKey(([c,m])=>m.timestamp);for(const[c,m]of l)this.add_report(c,m);this._check_invariants()}static fromJson(s){return new ce(s.database_key,s.nodeid,[],[],new Map(Object.entries(s.failures).map(([n,i])=>[n,de.fromJson(i)])),new Map(Object.entries(s.reports_by_worker).map(([n,i])=>[n,i.map(Se.fromJson)])))}_assert_reports_ordered(s){for(let n=0;n<s.length-1;n++)console.assert(s[n].timestamp_monotonic<=s[n+1].timestamp_monotonic)}_check_invariants(){this._assert_reports_ordered(this.linear_reports);const s=this.linear_status_counts(null);for(let i=0;i<s.length-1;i++)console.assert(s[i].sum()<=s[i+1].sum());const n=this.linear_elapsed_time(null);for(let i=0;i<n.length-1;i++)console.assert(n[i]<=n[i+1]);console.assert(n.length===s.length&&s.length===this.linear_reports.length);for(const[i,a]of this.reports_by_worker.entries())this._assert_reports_ordered(a)}add_report(s,n){let i=null,a=0;if(this.reports_by_worker.has(s)){const d=this.reports_by_worker.get(s);a=Ee(d,n.elapsed_time,u=>u.elapsed_time),i=a!=0?d[a-1]:null}const o=tt(n,i);if(this.reports_by_worker.has(s)||this.reports_by_worker.set(s,[]),this.reports_by_worker.get(s).splice(a,0,o),o.phase!==Me.REPLAY||o.behaviors>=this.behaviors||o.fingerprints>=this.fingerprints){const d=Ee(this.linear_reports,o.timestamp_monotonic,u=>u.timestamp_monotonic);if(this.linear_reports.splice(d,0,o),d!=this.linear_reports.length-1){let u=null,l;for(l=0;l<this.linear_reports.length-(d+1);l++){const c=this.linear_reports[d+1+l];if(o.worker_uuid===c.worker_uuid){u=c;break}}u&&(console.assert(this.linear_reports[d+1+l]===u),this.linear_reports[d+1+l]=tt(u,o));for(const c of[this._status_counts_cumsum,this._elapsed_time_cumsum])for(const[m,[x,p]]of c.entries())d>=x&&c.set(m,[x,p.slice(0,d-x)])}}}get status(){if(this.failures.size>0)return Y.FAILED;if(this.linear_reports.length===0)return Y.WAITING;const s=this.linear_reports[this.linear_reports.length-1],n=new Date().getTime()/1e3;return s.phase==Me.SHRINK?Y.SHRINKING:s.ninputs===0||s.timestamp<n-ce.WAITING_STATUS_DURATION?Y.WAITING:Y.RUNNING}get behaviors(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].behaviors}get fingerprints(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].fingerprints}get since_new_behavior(){return this.linear_reports.length===0?null:this.linear_reports[this.linear_reports.length-1].since_new_behavior}elapsed_time(s){const n=this.linear_elapsed_time(s);return n.length===0?0:n[n.length-1]}ninputs(s){const n=this.linear_status_counts(s);return n.length===0?0:n[n.length-1].sum()}_cumsum(s,n,i,a,o){if(a===null&&(a=-1/0),s.has(a)){const[c,m]=s.get(a);if(m.length<this.linear_reports.slice(c).length){let x=m.length>0?m[m.length-1]:o;for(const p of this.linear_reports.slice(c+m.length))x=i(x,p[n]),m.push(x);s.set(a,[c,m])}return m}const d=[],u=Ee(this.linear_reports,a,c=>c.timestamp_monotonic);let l=o;for(const c of this.linear_reports.slice(u))l=i(l,c[n]),d.push(l);return s.set(a,[u,d]),d}linear_status_counts(s){return this._cumsum(this._status_counts_cumsum,"status_counts_diff",(n,i)=>n.add(i),s,new Z)}linear_elapsed_time(s){return this._cumsum(this._elapsed_time_cumsum,"elapsed_time_diff",(n,i)=>n+i,s,0)}};M(ce,"WAITING_STATUS_DURATION",120);let $e=ce;const Et=h.createContext(null);function st(t){const r=new Map;t.forEach(n=>{r.set(n.representation,(r.get(n.representation)||0)+1)}),t.forEach(n=>{const i=r.get(n.representation);n.isUnique=i==1,n.isDuplicate=i>1});const s=new Set;t.forEach(n=>{n.features.forEach((i,a)=>{s.add(a)})}),t.forEach(n=>{s.forEach(i=>{n.features.has(i)||n.features.set(i,xe)});for(const[i,a]of n.features)a===""&&n.features.set(i,ge)})}function Ls(t,r){const s=new Map(t);function n(i){if(s.has(i))return s.get(i);{const a=new $e(null,i,[],[],new Map,new Map);return s.set(a.nodeid,a),a}}switch(r.type){case 1:return t;case 2:{const{tests:i}=r;for(const{database_key:a,nodeid:o,failures:d}of i){const u=n(o);u.database_key=a,d.forEach((l,c)=>{u.failures.set(c,l)})}return s}case 3:{const{nodeid:i,worker_uuid:a,reports:o}=r,d=n(i);for(const u of o)d.add_report(a,u);return s}case 5:{const{nodeid:i,failures:a}=r,o=n(i);return a.forEach((d,u)=>{o.failures.set(u,d)}),s}case 4:{const{nodeid:i,observation_type:a,observations:o}=r,d=n(i);return a==="rolling"?(d.rolling_observations.push(...o),d.rolling_observations=d.rolling_observations.sortKey(u=>-u.run_start).slice(0,300),st(d.rolling_observations)):(console.assert(a==="corpus"),d.corpus_observations.push(...o),st(d.corpus_observations)),s}case 7:{const{nodeid:i}=r,a=n(i);return a.load_finished_at=Date.now(),s}default:throw new Error("non-exhaustive switch in testsReducer")}}function Is({children:t}){const[r,s]=h.useState(null),[n,i]=h.useReducer(Ls,new Map),[a,o]=h.useState(!1),[d,u]=h.useState(null),[l,c]=h.useState({count_tests:null,count_tests_loaded:null}),{addNotification:m,updateNotification:x,dismissNotification:p}=vs(),f=h.useRef(null),S=h.useCallback(_=>{o(!0),u(_)},[]),C=h.useCallback(()=>{const _=Date.now();return l.count_tests_loaded!==null&&l.count_tests!==null&&l.count_tests_loaded===l.count_tests&&Array.from(n.values()).every(T=>T.load_finished_at===null?!1:_-T.load_finished_at>200)},[l,n]);return h.useEffect(()=>{if(!a)return;n.clear(),c({count_tests:null,count_tests_loaded:null});const _=new URL(`ws${window.location.protocol==="https:"?"s":""}://${window.location.host}/ws`);d&&_.searchParams.set("nodeid",d);const T=new WebSocket(_);return T.onmessage=P=>{const v=JSON.parse(P.data),$=Number(v.type),b=Number(v.count_tests),y=Number(v.count_tests_loaded);switch($){case 1:{const j={count_tests:b,count_tests_loaded:y};if(c(j),i({type:1,loading_status:j}),y===b){f.current!==null&&(p(f.current),f.current=null);break}const E=ot.createElement(_s,{current:y,total:b,message:`Note: dashboard is still starting up (${y}/${b} tests loaded)`});f.current?x(f.current,E,null):f.current=m(E,null);break}case 2:{i({type:2,tests:v.tests.map(j=>({database_key:j.database_key,nodeid:j.nodeid,failures:new Map(Object.entries(j.failures).map(([E,N])=>[E,de.fromJson(N)]))}))});break}case 3:{i({type:3,nodeid:v.nodeid,worker_uuid:v.worker_uuid,reports:v.reports.map(j=>Se.fromJson(v.worker_uuid,j))});break}case 4:{i({type:4,nodeid:v.nodeid,observation_type:v.observation_type,observations:v.observations.map(ke.fromJson)});break}case 5:{i({type:5,nodeid:v.nodeid,failures:new Map(Object.entries(v.failures).map(([j,E])=>[j,de.fromJson(E)]))});break}case 7:{i({type:7,nodeid:v.nodeid});break}default:throw new Error(`Unknown event type: ${v.type}`)}},s(T),()=>{T.close()}},[d,a]),e.jsx(Et.Provider,{value:{tests:n,socket:r,doLoadData:S,testsLoaded:C},children:t})}function We(t=null){const r=h.useContext(Et);if(!r)throw new Error("useData must be used within a DataProvider");return h.useEffect(()=>{r.doLoadData(t)},[t,r.doLoadData]),r}function pe({to:t,children:r,isActive:s}){const n=De();return e.jsx(ee,{to:t,className:`sidebar__link ${s(n.pathname)?"sidebar__link--active":""}`,children:r})}function Ps(){const t=De(),[r,s]=h.useState(!1),n=h.useRef(null);return h.useEffect(()=>{function i(a){var o;r&&((o=n.current)==null?void 0:o.contains(a.target))===!1&&s(!1)}return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[r]),h.useEffect(()=>{s(!1)},[t]),e.jsxs("div",{className:"layout",children:[!r&&e.jsx("div",{className:"toggle-sidebar",onClick:()=>s(!0),children:e.jsx(L,{icon:qt,size:"lg"})}),r&&e.jsx("div",{className:"opacity-overlay"}),e.jsxs("div",{ref:n,className:`sidebar ${r?"sidebar--open":""}`,children:[e.jsx(ee,{to:"/",className:"sidebar__title",children:"HypoFuzz"}),e.jsxs("nav",{className:"sidebar__nav",children:[e.jsx(pe,{to:"/",isActive:i=>i==="/"||i.startsWith("/tests/"),children:"Tests"}),e.jsx(pe,{to:"/patches",isActive:i=>i==="/patches",children:"Patches"}),e.jsx(pe,{to:"/collected",isActive:i=>i==="/collected",children:"Collection"}),e.jsx(pe,{to:"/workers",isActive:i=>i==="/workers",children:"Workers"}),e.jsx("div",{className:"sidebar__separator"}),e.jsx("a",{href:`${"/".replace(/\/$/,"")}/docs/`,className:"sidebar__link",children:"Docs"})]})]}),e.jsx("div",{className:"content",children:e.jsx(Ot,{})})]})}function He({headers:t,data:r,row:s,mobileRow:n,getKey:i,onFilterChange:a,filterStrings:o}){const[d,u]=h.useState(null),[l,c]=h.useState(0),[m,x]=h.useState(""),p=ze(),f=h.useMemo(()=>{let _=r;if(m&&(_=r.filter(P=>o?o(P).some(v=>v.toLowerCase().includes(m.toLowerCase())):!0)),d===null)return _;const T=[..._].sortKey(P=>t[d].sortKey(P));return l===0?T:T.reverse()},[r,d,l,t,m,s,o,n,p]),S=_=>{t[_].sortKey&&(d===_?c(T=>T===0?1:0):(u(_),c(0)))};function C(_){x(_),a==null||a(_)}return e.jsxs("div",{className:"table",children:[o!==void 0&&e.jsxs("div",{className:"table__filter",children:[e.jsx("input",{type:"text",placeholder:"Filter",value:m,onChange:_=>C(_.target.value),className:"table__filter__input"}),m&&e.jsx("span",{className:"table__filter__clear",onClick:()=>C(""),children:e.jsx(L,{icon:Jt})})]}),n!==void 0&&p?f.map(_=>e.jsx("div",{children:n(_)},i?i(_):void 0)):e.jsxs("table",{className:"table__table",children:[e.jsx("thead",{children:e.jsx("tr",{children:t.map((_,T)=>e.jsx("th",{onClick:()=>S(T),className:_.sortKey?"table--sortable":"",children:e.jsxs("div",{className:`table__header table__header--${_.align??"left"}`,children:[_.content,_.sortKey&&e.jsx("div",{className:"table__sort",children:[0,1].map(P=>e.jsx("div",{className:`table__sort__arrow table__sort__arrow--${P===0?"asc":"desc"} ${d===T&&l===P?"table__sort__arrow--active":""}`,children:P===0?e.jsx(L,{icon:Qt}):e.jsx(L,{icon:Zt})}))})]})},T))})}),e.jsx("tbody",{children:f.map(_=>{const T=s(_);return console.assert(T.length===t.length),e.jsx("tr",{children:T.map((P,v)=>e.jsx("td",{children:P},v))},i?i(_):void 0)})})]}),m&&f.length<r.length&&e.jsxs("div",{className:"table__filter-status",children:["Showing ",f.length," of ",r.length," rows",e.jsx("span",{className:"table__filter-status__clear",onClick:()=>{x(""),a==null||a("")},children:"[clear]"})]})]})}async function Ke(t){try{return await(await fetch(`/api/${t}`)).json()}catch(r){return console.error(`Failed to fetch /api/${t}`,r),null}}async function Ds(t){return await Ke(`patches/${t}`)}async function Ct(){return await Ke("available_patches/")}async function Fs(){return await Ke("collection_status/")}const nt={not_collected:0,collected:1};function Bs(){const[t,r]=h.useState(null);if(h.useEffect(()=>{Fs().then(a=>{r(a)})},[]),t===null)return null;if(!t.length)return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection"}),"No tests collected."]});const s=[...t].sortKey(a=>[nt[a.status],a.status_reason,a.nodeid]),n=[{content:"Test",sortKey:a=>a.nodeid},{content:"Status",sortKey:a=>[nt[a.status],a.status_reason],align:"center"}],i=a=>[e.jsx("div",{style:{wordBreak:"break-all"},children:a.status=="collected"?e.jsx(ee,{to:`/tests/${encodeURIComponent(a.nodeid)}`,className:"test__link",children:a.nodeid}):a.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:a.status==="collected"?e.jsx("div",{className:"pill pill__success",children:"Collected"}):e.jsxs("div",{className:"pill pill__neutral",children:["Not collected (",a.status_reason,")"]})})];return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection status"}),e.jsx(He,{headers:n,data:s,row:i,getKey:a=>a.database_key,filterStrings:a=>[a.nodeid,a.status==="collected"?"Collected":`Not collected (${a.status_reason})`]})]})}function zs(){return e.jsx("h1",{children:"Page not found!"})}function Os(t){const r=t.regex;return{name:"Diff",aliases:["patch"],contains:[{className:"meta",relevance:10,match:r.either(/^@@ +-\d+,\d+ +\+\d+,\d+ +@@/,/^\*\*\* +\d+,\d+ +\*\*\*\*$/,/^--- +\d+,\d+ +----$/)},{className:"comment",variants:[{begin:r.either(/Index: /,/^index/,/={3,}/,/^-{3}/,/^\*{3} /,/^\+{3}/,/^diff --git/),end:/$/},{match:/^\*{15}$/}]},{className:"addition",begin:/^\+/,end:/$/},{className:"deletion",begin:/^-/,end:/$/},{className:"addition",begin:/^!/,end:/$/}]}}he.registerLanguage("diff",Os);function Tt({nodeid:t}){const[r,s]=h.useState({}),[n,i]=h.useState(!0),[a,o]=h.useState(null),[d,u]=h.useState(!1),l=h.useRef(null);if(h.useEffect(()=>{Ds(t).then(S=>{S&&s(S),i(!1)})},[t]),h.useEffect(()=>{Nt(l,!0)},[r,a]),n)return e.jsx("div",{className:"card",children:e.jsx("p",{children:"Loading patches..."})});if(Object.values(r).every(S=>S===null))return e.jsx("div",{className:"card",children:e.jsx("p",{children:"No patches for this test"})});const c=new Map([["failing","Failing"],["covering","Covering"]]),m=a??Array.from(c.keys()).find(S=>r[S]),x=r[m],p=async()=>{await navigator.clipboard.writeText(x),u(!0),setTimeout(()=>{u(!1)},2e3)},f=()=>{const S=new Blob([x],{type:"text/plain"}),C=URL.createObjectURL(S),_=document.createElement("a");_.href=C,_.download=`${m}-${t.split("::").pop()}.patch`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(C)};return e.jsxs("div",{ref:l,children:[e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(re,{value:m,onChange:o,options:Array.from(c.entries()).filter(([S])=>r[S]).map(([S,C])=>({value:S,content:C}))})}),e.jsxs("pre",{className:"patch__pre",children:[e.jsxs("div",{className:"patch__controls",children:[e.jsx("div",{className:`patch__controls__control ${d?"patch__controls__control--success":""}`,onClick:p,title:"Copy patch",children:e.jsx(L,{icon:d?es:ts})}),e.jsx("div",{className:"patch__controls__control",onClick:f,title:"Download patch",children:e.jsx(L,{icon:ss})})]}),e.jsx("code",{className:"language-diff",children:x})]})]})}function Vs(){const[t,r]=h.useState(null);return h.useEffect(()=>{Ct().then(s=>{r(s)})},[]),t===null||t.length===0?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Patches"}),e.jsx("p",{children:"No tests collected"})]}):e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",style:{marginBottom:"1rem"},children:"Patches"}),t.map(s=>e.jsx(Ve,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{children:s}),e.jsxs(ee,{to:`/tests/${encodeURIComponent(s)}`,style:{color:"var(--secondary-color, #888)",fontSize:"0.9em",textDecoration:"none",marginLeft:"12px"},children:["View test ",e.jsx(L,{icon:ns})]})]}),headerClass:"patches__test",defaultState:"closed",children:e.jsx(Tt,{nodeid:s})}))]})}const B={scaleSymlog:os,scaleLinear:pt,select:Fe,zoom:xt,zoomIdentity:gt,pointer:ds,line:us,axisBottom:mt,axisLeft:ht,brush:cs,scaleOrdinal:Be,schemeCategory10:_t,interpolateViridis:ft,quadtree:ls};class we{constructor(r,s,n,i,a){this.nodeid=r,this.linear_status_counts=s,this.linear_elapsed_time=n,this.behaviors=i,this.fingerprints=a}static fromReport(r,s){return new we(r,s.status_counts,s.elapsed_time,s.behaviors,s.fingerprints)}}const Us=10,Mt=270;class Ws{constructor(r,s,n,i,a,o,d,u){M(this,"lines");M(this,"scaleSetting");M(this,"scaleSettingY");M(this,"axisSettingX");M(this,"axisSettingY");M(this,"xValue");M(this,"yValue");M(this,"width");M(this,"height");M(this,"margin");M(this,"x");M(this,"y");M(this,"g");M(this,"zoom");M(this,"chartArea");M(this,"navigate");M(this,"tooltip");M(this,"brush",null);M(this,"eventListeners",new Map);M(this,"xAxis");M(this,"yAxis");M(this,"viewportX");M(this,"viewportY");M(this,"quadtree");this.lines=s,this.scaleSetting=n,this.scaleSettingY=i,this.axisSettingX=a,this.axisSettingY=o,this.navigate=d,this.xValue=c=>a=="time"?c.linear_elapsed_time:c.linear_status_counts.sum(),this.yValue=c=>o=="behaviors"?c.behaviors:c.fingerprints,this.margin={top:5,right:5,bottom:25,left:40},this.width=r.clientWidth-this.margin.left-this.margin.right,this.height=Mt-this.margin.top-this.margin.bottom;const l=s.map(c=>c.reports).flat();this.x=(n==="log"?B.scaleSymlog():B.scaleLinear()).domain([0,ue(l.map(c=>this.xValue(c)))||1]).range([0,this.width]),this.y=(i==="log"?B.scaleSymlog():B.scaleLinear()).domain([0,ue(l.map(c=>this.yValue(c)))||0]).range([this.height,0]),this.viewportX=this.x,this.viewportY=this.y,this.g=B.select(r).append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`),this.g.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",this.width).attr("height",this.height+5).attr("x",0).attr("y",-5),this.chartArea=this.g.append("g").attr("class","chart-area").attr("clip-path","url(#clip)"),this.chartArea.append("rect").attr("width",this.width).attr("height",this.height).attr("fill","none").attr("pointer-events","all"),this.zoom=B.zoom().scaleExtent([1,1/0]).on("zoom",c=>this.zoomTo(c.transform,!1)),this.chartArea.call(this.zoom),this.chartArea.on("dblclick.zoom",()=>{this.chartArea.transition().duration(500).call(this.zoom.transform,B.zoomIdentity)}),this.tooltip=B.select(".coverage-graph__tooltip"),this.xAxis=this.g.append("g").attr("transform",`translate(0,${this.height})`).call(this.createXAxis(this.x)),this.yAxis=this.g.append("g").call(this.createYAxis(this.y)),this.chartArea.on("mousemove",c=>{const[m,x]=B.pointer(c),p=this.quadtree.find(m,x,Us);p?this.tooltip.style("display","block").style("left",`${c.pageX+10}px`).style("top",`${c.pageY-10}px`).html(`
                <strong>${kt(p.nodeid)}</strong><br/>
                ${p.behaviors.toLocaleString()} behaviors / ${p.fingerprints.toLocaleString()} fingerprints<br/>
                ${p.linear_status_counts.sum().toLocaleString()} inputs / ${p.linear_elapsed_time.toFixed(1)} seconds
              `):this.tooltip.style("display","none")}).on("mouseout",()=>{this.tooltip.style("display","none")}),this.drawLines(),this.updateQuadtree()}logAxis(r,s){const n=[0];let i=1;for(;i<=s;)n.push(i),i*=10;return r.tickValues(n).tickFormat(a=>{const o=a.valueOf();return console.assert(o>=0),o>=1e6?`${Math.floor(o/1e6)}M`:o>=1e3?`${Math.floor(o/1e3)}k`:o>0?o.toLocaleString():"0"})}createXAxis(r){if(this.scaleSetting==="log"){const s=r.domain()[1];return this.logAxis(B.axisBottom(r),s)}else return B.axisBottom(r).ticks(5).tickFormat(s=>s.toLocaleString())}createYAxis(r){if(this.scaleSettingY==="log"){const s=r.domain()[1];return this.logAxis(B.axisLeft(r),s)}else return B.axisLeft(r).ticks(5)}updateQuadtree(){const r=this.lines.map(s=>s.reports).flat();this.quadtree=B.quadtree().x(s=>this.viewportX(this.xValue(s))).y(s=>this.viewportY(this.yValue(s))).addAll(r)}zoomTo(r,s){const n=r.rescaleX(this.x),i=s?r.rescaleY(this.y):this.y;this.viewportX=n,this.viewportY=i,this.xAxis.call(this.createXAxis(n)),s&&this.yAxis.call(this.createYAxis(i)),this.g.selectAll(".chart-area path").attr("d",B.line().x(a=>n(this.xValue(a))).y(a=>i(this.yValue(a)))),this.updateQuadtree()}drawLines(){const r=B.line().x(s=>this.x(this.xValue(s))).y(s=>this.y(this.yValue(s)));this.lines.forEach(s=>{this.chartArea.append("path").datum(s.reports).attr("fill","none").attr("stroke",s.color).attr("d",r).attr("class","coverage-line").style("cursor","pointer").on("mouseover",function(){B.select(this).classed("coverage-line__selected",!0)}).on("mouseout",function(){B.select(this).classed("coverage-line__selected",!1)}).on("click",n=>{s.url&&St(n,s.url,this.navigate)})})}enableBoxBrush(){for(const r of["wheel","mousedown","mousemove","mouseup"])this.chartArea.on(`${r}.zoom`,null);this.brush=B.brush().extent([[0,0],[this.width,this.height]]).on("end",r=>{if(!r.selection)return;const[[s,n],[i,a]]=r.selection;if(this.chartArea.call(this.brush.clear),this.chartArea.call(this.zoom),Math.abs(i-s)<5||Math.abs(a-n)<5){this.emit("boxSelectEnd");return}const o=this.width/(i-s),d=this.height/(a-n),u=Math.max(o,d),l=B.zoomIdentity.translate(this.width/2,this.height/2).scale(u).translate(-(s+i)/2,-(n+a)/2);this.chartArea.transition().duration(250).call(this.zoom.transform,l).on("end",()=>{this.emit("boxSelectEnd")})}),this.chartArea.style("cursor","crosshair").call(this.brush)}cleanup(){this.tooltip.style("display","none"),this.g.selectAll("path").classed("coverage-line__selected",!1)}on(r,s){this.eventListeners.has(r)||this.eventListeners.set(r,[]),this.eventListeners.get(r).push(s)}off(r,s){this.eventListeners.has(r)&&this.eventListeners.set(r,this.eventListeners.get(r).filter(n=>n!==s))}emit(r){this.eventListeners.has(r)&&this.eventListeners.get(r).forEach(s=>s())}}const oe=new Map;function q(t,r){const[s,n]=h.useState(()=>{const a=sessionStorage.getItem(t);return a===null?r:JSON.parse(a)});h.useEffect(()=>(oe.has(t)||oe.set(t,new Set),oe.get(t).add(n),()=>{oe.get(t).delete(n)}),[t]);function i(a){sessionStorage.setItem(t,JSON.stringify(a)),oe.get(t).forEach(o=>o(a))}return[s,i]}const se={zoom:xt,zoomIdentity:gt,select:Fe,scaleOrdinal:Be,interpolateViridis:ft,schemeCategory10:_t};var Le=(t=>(t.TOGETHER="linearized",t.SEPARATE="individual",t.LATEST="latest",t))(Le||{});function Hs(t,r){const s=t.linear_status_counts(r),n=t.linear_elapsed_time(r),i=[];for(let a=0;a<s.length;a++){const o=t.linear_reports[a];i.push({nodeid:t.nodeid,linear_status_counts:s[a],linear_elapsed_time:n[a],behaviors:o.behaviors,fingerprints:o.fingerprints})}return i}function $t({value:t,onChange:r}){return e.jsx(re,{value:t,onChange:r,options:[{value:"log",content:"Log"},{value:"linear",content:"Linear"}]})}function Ks(){const[t,r]=q("graph_scale_x","log"),[s,n]=q("graph_axis_x","time");return e.jsxs("div",{className:"coverage-graph__label coverage-graph__label--x",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(L,{icon:s==="inputs"?ye:je,style:{fontSize:"0.9rem"}}),s==="inputs"?"Inputs":"Time"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx($t,{value:t,onChange:r}),e.jsx(re,{value:s,onChange:n,options:[{value:"inputs",content:e.jsx(L,{icon:ye})},{value:"time",content:e.jsx(L,{icon:je})}]})]})]})}function Xs(){const[t,r]=q("graph_scale_y","linear"),[s,n]=q("graph_axis_y","behaviors");return e.jsxs("div",{className:"coverage-graph__label coverage-graph__label--y",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx($t,{value:t,onChange:r}),e.jsx(re,{value:s,onChange:n,options:[{value:"behaviors",content:e.jsx(L,{icon:ve})},{value:"fingerprints",content:e.jsx(L,{icon:be})}]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(L,{icon:s==="behaviors"?ve:be,style:{fontSize:"0.9rem"}}),s==="behaviors"?"Behaviors":"Fingerprints"]})]})}const rt={linearized:{content:e.jsxs(e.Fragment,{children:[e.jsx(L,{icon:Ye})," Together"]}),mobileContent:e.jsx(L,{icon:Ye})},individual:{content:e.jsxs(e.Fragment,{children:[e.jsx(L,{icon:Ge})," Separate"]}),mobileContent:e.jsx(L,{icon:Ge})},latest:{content:e.jsxs(e.Fragment,{children:[e.jsx(L,{icon:Xe})," Latest"]}),mobileContent:e.jsx(L,{icon:Xe})}};function Lt({tests:t,filterString:r="",testsLoaded:s,workers_after:n=null,workerViews:i=["linearized","individual","latest"],workerViewSetting:a}){const o=h.useRef(null),[d,u]=q("graph_scale_x","log"),[l,c]=q("graph_scale_y","linear"),[m,x]=q("graph_axis_x","time"),[p,f]=q("graph_axis_y","behaviors"),[S,C]=q(a,"linearized"),[_,T]=h.useState(!0),[P,v]=h.useState({transform:null,zoomY:!1}),[$,b]=h.useState(!1),y=lt(),j=ze(),[E,N]=h.useState(!1),I=se.scaleOrdinal(se.schemeCategory10).domain(Array.from(t.keys())),U=h.useMemo(()=>{let k=[];if(S==="linearized")k=Array.from(t.entries()).sortKey(([A,D])=>A).map(([A,D])=>({url:`/tests/${encodeURIComponent(A)}`,reports:Hs(D,n),color:I(A)}));else if(S==="individual"){let A=function(z){if(D.length<=1)return se.interpolateViridis(.5);const K=(z-H)/(R-H);return se.interpolateViridis(K)};const D=[];for(const z of t.values())for(const K of z.reports_by_worker.values())K.length>0&&D.push(K[0].timestamp);const H=Ns(D)??0,R=ue(D)??0;for(const[z,K]of t.entries())for(const F of K.reports_by_worker.values())F.length>0&&k.push({url:null,reports:F.map(O=>we.fromReport(z,O)),color:A(F[0].timestamp)})}else if(S==="latest")for(const[A,D]of t.entries()){const H=ue(Array.from(D.reports_by_worker.values()),R=>R[0].elapsed_time);H&&k.push({url:null,reports:H.map(R=>we.fromReport(A,R)),color:I(A)})}return k},[t,n,S]),g=h.useMemo(()=>r?U.filter(k=>{var A;return(A=k.url)==null?void 0:A.toLowerCase().includes(r.toLowerCase())}):U,[U,r]);h.useEffect(()=>{if(!o.current||!_&&E&&s())return;_&&T(!1),se.select(o.current).selectAll("*").remove();const k=new Ws(o.current,g,d,l,m,p,y,j);return P.transform&&k.zoom.transform(k.chartArea,P.transform),k.zoomTo(P.transform??se.zoomIdentity,P.zoomY),k.zoom.on("zoom.saveTransform",A=>{v({transform:A.transform,zoomY:!1})}),$&&k.enableBoxBrush(),k.on("boxSelectEnd",w),()=>{k.cleanup()}},[t,d,l,m,p,S,_,$,y]);const w=()=>{b(!$),T(!0)};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",style:{marginBottom:"1rem"},children:"Coverage"}),e.jsx("div",{className:"coverage-graph__tooltip"}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"1rem"},children:e.jsx(re,{value:S,onChange:C,options:i.map(k=>({value:k,content:rt[k].content,mobileContent:rt[k].mobileContent}))})}),e.jsx("div",{className:"coverage-graph__container",children:e.jsxs("div",{className:"coverage-graph__grid",style:{marginRight:"15px",flex:1,height:"auto"},children:[e.jsx(Xs,{}),e.jsx("svg",{className:"coverage-graph__svg",ref:o,style:{width:"100%",height:`${Mt}px`},onMouseEnter:()=>N(!0),onMouseLeave:()=>{N(!1),T(!0)}}),e.jsx("div",{}),e.jsx(Ks,{})]})})]})}function Ie({status:t}){return e.jsx("span",{style:{textAlign:"center"},children:t===Y.FAILED?e.jsx("span",{className:"pill pill__failure",children:"Failed"}):t===Y.SHRINKING?e.jsx("span",{className:"pill pill__warning",children:"Shrinking"}):t===Y.RUNNING?e.jsx("span",{className:"pill pill__success",children:"Running"}):e.jsx("span",{className:"pill pill__neutral",children:"Waiting"})})}function Q({content:t,tooltip:r}){return e.jsxs("span",{className:"tooltip",children:[t,e.jsx("div",{className:"tooltip__text",children:r})]})}function It(t){const r=Math.floor(t/3600),s=Math.floor(t%3600/60),n=Math.floor(t%60);return`${r>0?`${r}:${s.toString().padStart(2,"0")}`:s}:${n.toString().padStart(2,"0")}`}function Pt(t){const r=t.ninputs(null),s=t.elapsed_time(null);return s===0?null:r/s}function Pe(t){var s;if(t.linear_reports.length===0)return{inputs:"—",behaviors:"—",fingerprints:"—",executions:"—",inputsSinceBranch:"—",timeSpent:"—"};const r=Pt(t);return{inputs:t.ninputs(null).toLocaleString(),behaviors:t.behaviors.toLocaleString(),fingerprints:t.fingerprints.toLocaleString(),executions:r===null?"—":`${r.toFixed(1).toLocaleString()}/s`,inputsSinceBranch:((s=t.since_new_behavior)==null?void 0:s.toLocaleString())??"—",timeSpent:It(t.elapsed_time(null))}}he.registerLanguage("python",At);function Gs({failure:t}){return e.jsx("span",{style:{textAlign:"center"},children:t.state==="shrunk"?e.jsx("span",{className:"pill pill__neutral",children:"Fully shrunk"}):t.state==="unshrunk"?e.jsx("span",{className:"pill pill__neutral",children:"Still shrinking..."}):e.jsx(e.Fragment,{})})}function Ys({failure:t}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.7rem",marginBottom:"1rem"},children:[e.jsx("div",{className:"failure__title",children:"Failure"}),e.jsx(Gs,{failure:t})]}),e.jsxs("div",{className:"failure__item",children:[e.jsx("div",{className:"failure__item__subtitle",children:"Call"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:t.observation.metadata.get("reproduction_decorator")+`
`+t.observation.representation})}),e.jsx("div",{className:"failure__item__subtitle",children:"Traceback"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:t.observation.metadata.get("traceback")})})]})]})}function qs(){const{nodeid:t}=Vt(),{tests:r,testsLoaded:s}=We(t),n=h.useRef(null),[i,a]=h.useState(null);h.useEffect(()=>{Ct().then(l=>{a(l)})},[]);const o=r.get(t)??null;if(h.useEffect(()=>{o&&Nt(n)},[o==null?void 0:o.failures]),!t||!o)return e.jsx("div",{children:"Test not found"});const d=Pe(o),u=[{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(L,{icon:ye})}),tooltip:"Number of inputs"})},{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(L,{icon:ve})}),tooltip:"Number of behaviors (typically branches) found"})},{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(L,{icon:be})}),tooltip:"Number of fingerprints (sets of behaviors) found"})},{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(L,{icon:ut})}),tooltip:"Inputs per second"})},{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(L,{icon:dt})}),tooltip:"Number of inputs since a new behavior"})},{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(L,{icon:je})}),tooltip:"Total time spent running"})}];return e.jsxs("div",{ref:n,children:[e.jsxs(ee,{to:"/",className:"back-link",children:[e.jsx(L,{icon:rs})," Back to all tests"]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.7rem"},children:[e.jsx("span",{style:{wordBreak:"break-all",fontSize:"1.5rem",fontWeight:"bold"},children:t}),e.jsx(Ie,{status:o.status})]}),e.jsx("div",{style:{paddingTop:"1rem",paddingBottom:"1rem"},children:e.jsx(He,{headers:u,data:[d],row:l=>[e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.inputs}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.behaviors}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.fingerprints}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.executions}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.inputsSinceBranch}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.timeSpent})]})})]}),e.jsx(Lt,{tests:new Map([[t,o]]),testsLoaded:s,workerViewSetting:"graph_worker_view_test"}),Array.from(o.failures.values()).map(l=>e.jsx(Ys,{failure:l})),e.jsx($s,{test:o}),(i==null?void 0:i.includes(t))&&e.jsx("div",{className:"card",children:e.jsx(Ve,{title:"Patches",defaultState:"closed",headerClass:"card__header",children:e.jsx(Tt,{nodeid:t})})})]})}function ne({icon:t,tooltip:r}){return e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(L,{icon:t})}),tooltip:r})}function le({icon:t,value:r}){return e.jsxs("div",{className:"table__inline-statistic",children:[t,e.jsx("span",{className:"table__inline-statistic__value",children:r})]})}function Js({tests:t,onFilterChange:r}){const s=Array.from(t).sortKey(([p,f])=>[f.status,p]).map(([p,f])=>f),n=e.jsx(ne,{icon:ye,tooltip:"Number of inputs"}),i=e.jsx(ne,{icon:ve,tooltip:"Number of behaviors (typically branches) found"}),a=e.jsx(ne,{icon:be,tooltip:"Number of fingerprints (sets of behaviors) found"}),o=e.jsx(ne,{icon:ut,tooltip:"Inputs per second"}),d=e.jsx(ne,{icon:dt,tooltip:"Number of inputs since a new behavior"}),u=e.jsx(ne,{icon:je,tooltip:"Total time spent running"}),l=[{content:"Test",sortKey:p=>p.nodeid},{content:"Status",sortKey:p=>p.status,align:"center"},{content:n,align:"right",sortKey:p=>p.ninputs(null)},{content:i,align:"right",sortKey:p=>p.behaviors},{content:a,align:"right",sortKey:p=>p.fingerprints},{content:o,align:"right",sortKey:p=>Pt(p)??-1},{content:d,align:"right",sortKey:p=>p.since_new_behavior??0},{content:u,align:"right",sortKey:p=>p.elapsed_time(null)}],c=p=>{const f=Pe(p);return[e.jsx(ee,{to:`/tests/${encodeURIComponent(p.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:p.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(Ie,{status:p.status})}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.inputs}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.behaviors}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.fingerprints}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.executions}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.inputsSinceBranch}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.timeSpent})]};function m(p){const f=Pe(p);return e.jsxs("div",{className:"table__mobile-row",children:[e.jsxs("div",{className:"table__mobile-row__header",children:[e.jsx(ee,{to:`/tests/${encodeURIComponent(p.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:p.nodeid}),e.jsx(Ie,{status:p.status})]}),e.jsxs("div",{className:"table__mobile-row__statistics",children:[e.jsx(le,{icon:n,value:f.inputs}),e.jsx(le,{icon:i,value:f.behaviors}),e.jsx(le,{icon:o,value:f.executions}),e.jsx(le,{icon:d,value:f.inputsSinceBranch}),e.jsx(le,{icon:u,value:f.timeSpent})]})]})}function x(p){return[p.nodeid,Rt[p.status]]}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Tests"}),e.jsx(He,{headers:l,data:s,row:c,mobileRow:m,filterStrings:x,onFilterChange:r})]})}function Qs(){const{tests:t,testsLoaded:r}=We(),[s,n]=h.useState("");return e.jsxs("div",{className:"dashboard",children:[e.jsx(Lt,{tests:t,filterString:s,testsLoaded:r,workerViews:[Le.TOGETHER,Le.LATEST],workerViewSetting:"graph_worker_view_tests"}),e.jsx(Js,{tests:t,onFilterChange:n})]})}function Zs({min:t,max:r,value:s,onChange:n,step:i=1}){const[a,o]=h.useState(null),d=h.useRef(null);console.assert(t<=r,`min: ${t} max: ${r}`);const[u,l]=s,c=r-t,m=c===0?0:(u-t)/c*100,x=c===0?100:(l-t)/c*100,p=m<50?1:2,f=x<50?2:1,S=h.useCallback(v=>{if(!d.current)return t;const $=d.current.getBoundingClientRect(),b=Math.max(0,Math.min(100,(v-$.left)/$.width*100)),y=t+b/100*c,j=Math.round(y/i)*i;return Math.max(t,Math.min(r,j))},[t,r,c,i]),C=v=>$=>{$.preventDefault(),o(v)},_=h.useCallback(v=>{if(!a)return;const $=S(v.clientX);n(a==="min"?[Math.min($,l),l]:[u,Math.max($,u)])},[a,S,u,l,n]),T=h.useCallback(()=>{o(null)},[]),P=v=>{if(a)return;const $=S(v.clientX),b=Math.abs($-u),y=Math.abs($-l);b<y?n([Math.min($,l),l]):n([u,Math.max($,u)])};return h.useEffect(()=>a?(document.addEventListener("mousemove",_),document.addEventListener("mouseup",T),()=>{document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",T)}):()=>{},[a,_,T]),e.jsx("div",{className:"range-slider",children:e.jsx("div",{className:"range-slider__container",children:e.jsxs("div",{ref:d,className:"range-slider__track",onClick:P,children:[e.jsx("div",{className:"range-slider__range",style:{left:`${m}%`,width:`${x-m}%`}}),e.jsx("div",{className:"range-slider__thumb range-slider__thumb--min",style:{left:`${m}%`,zIndex:p},onMouseDown:C("min")}),e.jsx("div",{className:"range-slider__thumb range-slider__thumb--max",style:{left:`${x}%`,zIndex:f},onMouseDown:C("max")})]})})})}function fe(t){return new Date(t*1e3).toLocaleString()}const en=24*60*60;function it(t,r){return[Math.max(t,r-en),r]}function tn(t){let r=0;for(let a=0;a<t.length;a++)r=(r<<5)-r+t.charCodeAt(a)&4294967295;const s=Math.abs(r)%360,n=45+Math.abs(r>>8)%30,i=45+Math.abs(r>>16)%20;return`hsl(${s}, ${n}%, ${i}%)`}function _e({label:t,value:r}){return e.jsxs("div",{className:"workers__worker__details__item",children:[e.jsx("span",{className:"workers__worker__details__label",children:t}),e.jsx("span",{className:"workers__worker__details__value",children:r})]})}function sn(){const{tests:t}=We(),r=lt(),{showTooltip:s,hideTooltip:n,moveTooltip:i}=Oe(),[a,o]=h.useState(new Set),d=is(Array.from(t.values()).map(b=>Array.from(b.reports_by_worker.keys())).flat().sortKey(b=>b)),u=new Map;d.forEach(b=>{const y=[];u.set(b,y),Array.from(t.values()).forEach(j=>{if(!j.reports_by_worker.has(b))return;const E=j.reports_by_worker.get(b);y.push(...E.map(N=>({timestamp_monotonic:N.timestamp_monotonic,nodeid:j.nodeid})))}),y.sortKey(j=>j.timestamp_monotonic)});let l=1/0,c=-1/0,m=new Map;d.forEach(b=>{const y=u.get(b),j=[];let E=null;y.forEach((N,I)=>{l=Math.min(l,N.timestamp_monotonic),c=Math.max(c,N.timestamp_monotonic),!E||E.nodeid!==N.nodeid?(E&&j.push(E),E={nodeid:N.nodeid,start:N.timestamp_monotonic,end:N.timestamp_monotonic}):E.end=N.timestamp_monotonic,I===y.length-1&&E&&j.push(E)}),m.set(b,j)}),m=new Map([...m.entries()].sortKey(([b,y])=>y[0].start));const[x,p]=h.useState(it(l,c));h.useEffect(()=>{p(it(l,c))},[l,c]);const[f,S]=x,C=S-f,_=h.useCallback(b=>{let y,j;return C===0?(y=0,j=100):(y=(b.start-f)/C*100,j=(b.end-b.start)/C*100),{left:`${y}%`,width:`${j}%`,backgroundColor:tn(b.nodeid)}},[C,f,S]),T=h.useMemo(()=>{const b=new Map;for(const[y,j]of m.entries())b.set(y,j.filter(E=>E.end>=f&&E.start<=S));return b},[m,f,S]);function P(b){o(y=>{const j=new Set(y);return j.has(b)?j.delete(b):j.add(b),j})}function v({uuid:b,segments:y}){return e.jsxs("div",{className:`workers__worker ${a.has(b)?"workers__worker--expanded":""}`,onClick:()=>P(b),onMouseLeave:()=>n("workers"),children:[e.jsx("div",{className:"workers__worker__bar",onMouseLeave:()=>n("workers"),children:y.map((j,E)=>e.jsx("div",{className:"workers__timeline__segment",style:_(j),onClick:N=>{St(N,`/tests/${encodeURIComponent(j.nodeid)}`,r),N.stopPropagation()},onMouseEnter:N=>s(kt(j.nodeid),N.clientX,N.clientY,"workers"),onMouseLeave:()=>n("workers"),onMouseMove:N=>i(N.clientX,N.clientY,"workers")},E))}),a.has(b)&&e.jsx($,{uuid:b,segments:y})]},b)}function $({uuid:b,segments:y}){return e.jsx("div",{className:"workers__worker__details",children:e.jsxs("div",{className:"workers__worker__details__grid",children:[e.jsx(_e,{label:"Worker UUID",value:b}),e.jsx(_e,{label:"Lifetime",value:It(y[y.length-1].end-y[0].start)}),e.jsx(_e,{label:"Started",value:fe(y[0].start)}),e.jsx(_e,{label:"Last seen",value:fe(y[y.length-1].end)})]})})}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Workers "}),e.jsxs("div",{className:"card__body",children:[e.jsxs("div",{className:"card__text",children:[e.jsx("div",{className:"card__text__paragraph",children:"This page shows the history of your workers, and what tests they have been fuzzing."}),e.jsx("div",{className:"card__text__paragraph",children:'Roughly speaking, "one worker" = "one CPU core".'})]}),e.jsxs("div",{className:"workers",children:[e.jsx("div",{className:"workers__controls",children:e.jsx(Zs,{min:l,max:c,value:x,onChange:b=>p(b),step:(c-l)/1e3})}),e.jsxs("div",{className:"workers__timeline-header",children:[e.jsx("span",{className:"workers__timeline-header__label",children:fe(f)}),e.jsx("span",{className:"workers__timeline-header__label",children:fe(S)})]}),Array.from(T.entries()).map(([b,y])=>y.length>0&&e.jsx(v,{uuid:b,segments:y}))]})]})]})}function nn(){const t=Ut;return e.jsx(t,{children:e.jsx(xs,{children:e.jsx(Is,{children:e.jsx(js,{children:e.jsx(Wt,{children:e.jsxs(J,{element:e.jsx(Ps,{}),children:[e.jsx(J,{path:"/",element:e.jsx(Qs,{})}),e.jsx(J,{path:"/patches",element:e.jsx(Vs,{})}),e.jsx(J,{path:"/collected",element:e.jsx(Bs,{})}),e.jsx(J,{path:"/workers",element:e.jsx(sn,{})}),e.jsx(J,{path:"/tests/:nodeid",element:e.jsx(qs,{})}),e.jsx(J,{path:"*",element:e.jsx(zs,{})})]})})})})})})}fs.createRoot(document.getElementById("app")).render(e.jsx(ot.StrictMode,{children:e.jsx(nn,{})}));
