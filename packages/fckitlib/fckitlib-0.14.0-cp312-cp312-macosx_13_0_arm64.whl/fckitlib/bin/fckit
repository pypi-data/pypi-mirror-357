#!/usr/bin/env bash

FCKIT_VERSION_STR="0.14.0"
FCKIT_VERSION="0.14.0"

FCKIT_MAJOR_VERSION=0
FCKIT_MINOR_VERSION=14
FCKIT_PATCH_VERSION=0

FCKIT_GIT_SHA1="31c4898cffeabb2368686abe286c9732d008ceae"

#################################################################
# Commands
#################################################################

usage()
{
  echo "Usage: fckit [--version] [--info] [--git]"
  exit $1
}

version()
{
  echo "0.14.0"
}

print_feature()
{
  if [ -z "$1" ]; then
    echo "OFF"
  elif [[ $1 =~ (true|TRUE|ON|1) ]]; then
    echo "ON"
  else
    echo "OFF"
  fi
}


info()
{
  echo "fckit version (0.14.0), git-sha1 31c4898cffeabb2368686abe286c9732d008ceae"
  echo ""
  echo "Build:"
  echo "  build type      : RelWithDebInfo"
  echo "  timestamp       : 20250625101457"
  echo "  op. system      : Darwin-22.5.0 (macosx.64)"
  echo "  processor       : arm64"
  echo "  sources         : /opt/actions-runner/work/_work/fckit/fckit/proj"
  echo "  c++ compiler    : AppleClang 14.0.3.14030022"
  echo "    flags         :  -pipe -O2 -g -DNDEBUG"
  echo "  fortran compiler: GNU 14.2.0"
  echo "    flags         :  -O2 -g -DNDEBUG"
  echo ""
  echo "Features:"
  echo "  MPI             : $(print_feature )"
  echo "  final           : $(print_feature 1)"
  echo "  eckit           : $(print_feature 1)"
  echo ""
  echo "Dependencies: "
  if [ -n "1" ]; then
  echo "  eckit version (1.29.2), git-sha1 $(short_gitsha1 ade4e920b8fc209ef3db80ec654b7157529d6999)"
  else
  echo "  None"
  fi
}

gitsha1()
{
  echo "31c4898cffeabb2368686abe286c9732d008ceae"
}

short_gitsha1()
{
  if [ -z "$1" ]; then
    echo "unknown"
  else
    echo $1 | head -c 13
  fi
}

#################################################################
# Parse command-line
#################################################################

if test $# -eq 0; then
    usage 1
fi

while test $# -gt 0; do

    # Split --option=value in $opt="--option" and $val="value"

    opt=""
    val=""

    case "$1" in
    --*=*)
      opt=`echo "$1" | sed 's/=.*//'`
      val=`echo "$1" | sed 's/--[_a-zA-Z0-9]*=//'`
      ;;
    --*)
      opt=$1
      ;;
    *)
      break
      ;;
    esac

    # Parse options
    case "$opt" in
      --version)
        version
        ;;
      --git)
        gitsha1
          ;;
      --info)
        info
        ;;
      --)
        shift
        break
        ;;
      *)
        echo "unknown option: $opt"
        usage 1
        ;;
    esac
    shift
done
