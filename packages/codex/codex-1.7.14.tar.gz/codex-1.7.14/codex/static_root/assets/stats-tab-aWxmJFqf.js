import{_ as g,ae as j,q as c,b as l,a as u,A as b,w as k,v as d,a6 as I,F as p,z as h,d as K,B as w,D as y,H as B,s as _,l as T,ce as L,cf as P,cg as D,ch as v,ci as E,b8 as N,b9 as R,C as V,y as x}from"./main-Dl2Lrwga.js";import{V as G}from"./VTable-DuRw3_Nt.js";import{C as z}from"./confirm-dialog-Bkr6kSge.js";import{c as U}from"./copy-to-clipboard-DoUvDJVx.js";import{useAdminStore as C}from"./admin-rFfBszpt.js";import"./forwardRefs-DkWUbz_i.js";import"./VDialog-BScRe1ug.js";const F={name:"StatsTable",props:{title:{type:String,required:!0},items:{type:Object,required:!0}},data(){return{}},methods:{valueTable(e){return e&&typeof e=="object"?e:{}},tdClasses(e){return{indent:e[0]==="+"}},tdLabel(e){return e.replace(/^\+/,"")},nf(e){return typeof e=="number"?j.format(e):e}}},H={class:"statBlock"},$={key:0},q={colspan:"2",class:"subtitleRow"},M={key:1},X={class:"indent"};function Y(e,s,t,r,o,a){return d(),c("div",H,[l("h3",null,b(t.title),1),u(G,{class:"highlight-table"},{default:k(()=>[(d(!0),c(p,null,h(Object.entries(t.items),([n,i])=>(d(),c("tbody",{key:n},[typeof i=="object"?(d(),c("tr",$,[l("th",q,b(n),1)])):(d(),c("tr",M,[l("td",{class:K(a.tdClasses(n))},b(a.tdLabel(n)),3),l("td",null,b(a.nf(i)),1)])),(d(!0),c(p,null,h(Object.entries(a.valueTable(i)),([m,f])=>(d(),c("tr",{key:m},[l("td",X,b(m),1),l("td",null,b(a.nf(f)),1)]))),128))]))),128)),I(e.$slots,"default",{},void 0,!0)]),_:3})])}const J=g(F,[["render",Y],["__scopeId","data-v-4bb3ecd9"]]),A={topGroup:v,orderBy:D,fitTo:P,readingDirection:L},O={authGroupCount:"Authorization Groups",libraryCount:"Libraries",userAnonymousCount:"Anonymous Users",userRegisteredCount:"Registered Users"};Object.freeze(O);Object.freeze(A);const S=new Set(["storyArcNumbersCount","identifierTypesCount","contributorPersonsCount","contributorRolesCount"]);Object.freeze(S);const Q={name:"AdminTasksTab",components:{ConfirmDialog:z,StatsTable:J},data(){return{showTooltip:{show:!1},schemaHref:globalThis.CODEX.API_V3_PATH+"#/api/api_v3_admin_stats_retrieve"}},computed:{...y(V,{}),...y(C,{stats:e=>e.stats}),clipBoardEnabled(){return location.prototcal=="https:"},apiTooltip(){return this.clipBoardEnabled},clipBoardIcon(){return this.showTooltip?N:R},platformTable(){var s;const e={};for(const[t,r]of Object.entries((s=this.stats)==null?void 0:s.platform)){const o=this.keyToLabel(t),a=t==="system"?`${r.name} ${r.release}`:r;e[o]=a}return e},configTable(){var t;const e={};let s="";for(const[r,o]of Object.entries((t=this.stats)==null?void 0:t.config)){let a;if(r=="apiKey"){s=o;continue}else a=O[r];e[a]=o}return e["API Key"]=s,e},userSettingsTable(){var s;const e={};for(const[t,r]of Object.entries((s=this.stats)==null?void 0:s.sessions)){const o={},a=A[t];for(const[i,m]of Object.entries(r)){let f;f=a?a[E(i)]:i,o[f]=m}const n=this.keyToLabel(t);e[n]=o}return e},browserGroupsTable(){var s;const e={};for(const[t,r]of Object.entries((s=this.stats)==null?void 0:s.groups)){let o=this.keyToLabel(t);o!=="Series"&&(o+="s"),e[o]=r}return e},fileTypesTable(){var s;const e={};for(const[t,r]of Object.entries((s=this.stats)==null?void 0:s.fileTypes)){const o=t==="unknown"?T(t):this.keyToLabel(t).toUpperCase();e[o]=r}return e},metadataTable(){var s;const e={};for(const[t,r]of Object.entries((s=this.stats)==null?void 0:s.metadata)){let o=t==="countryCount"?"Countries":this.keyToLabel(t)+"s";S.has(t)&&(o=o.replace(/^\w+ /,"+")),e[o]=r}return e}},created(){this.loadStats()},methods:{...w(C,["loadStats","updateAPIKey"]),regenAPIKey(){this.updateAPIKey().then(this.loadStats).catch(console.warn)},onClickAPIKey(){this.clipBoardEnabled&&U(this.stats.config.apiKey,this.showTooltip)},keyToLabel(e){return e=e.replace(/Count$/,""),T(e)}}},W={key:0,id:"stats"},Z={id:"schemaDoc"},ee={colspan:"2"},te=["href"],se={colspan:"2"};function ae(e,s,t,r,o,a){const n=_("StatsTable"),i=_("ConfirmDialog");return e.stats?(d(),c("div",W,[u(n,{title:"Platform",items:a.platformTable},null,8,["items"]),u(n,{title:"Config",items:a.configTable},{default:k(()=>[l("tbody",null,[l("tr",Z,[l("td",ee,[s[0]||(s[0]=x(" The only endpoint accessible by API Key is ")),l("a",{href:o.schemaHref,target:"_blank"},"/admin/stats",8,te)])]),l("tr",null,[l("td",se,[u(i,{"button-text":"Regenerate API Key","title-text":"Regenerate",text:"API Key","confirm-text":"Regenerate",onConfirm:a.regenAPIKey},null,8,["onConfirm"])])])])]),_:1},8,["items"]),u(n,{title:"User Settings",items:a.userSettingsTable},null,8,["items"]),u(n,{title:"Browser Groups",items:a.browserGroupsTable},null,8,["items"]),u(n,{title:"File Types",items:a.fileTypesTable},null,8,["items"]),u(n,{title:"Metadata",items:a.metadataTable},null,8,["items"])])):B("",!0)}const de=g(Q,[["render",ae],["__scopeId","data-v-8fe4ac31"]]);export{de as default};
