import{g as Ve,p as Ce,cc as Ye,j as Pe,t as K,m as Je,k as Ze,A as ke,B as t,an as X,F as el,K as we,cd as Ee,J as Ie,N as Se,c7 as Re,ad as ll,s as tl,x as N,w as Z,a as me,I as Me,ae as al,h as nl,ai as sl,f as il,z as ol,c as W,H as rl,al as ul,ce as dl,Q as oe,ah as Be,R as F,S as b,U as s,Z as ie,as as se,bD as le,ao as L,ab as R,G as ce,$ as He,aX as ml,a3 as pl,bv as cl,bw as Le,a8 as P,a7 as te,W as ae,cf as C,cg as A,d as fl,o as qe,a9 as H,a0 as _,bm as vl,bo as ye,ch as gl,P as _e,br as yl,ci as ee,l as _l,b2 as hl,a4 as de,aV as bl,b as Vl,a_ as Cl,bx as kl,bE as Sl}from"./index-C8Wvo59W.js";import{a as j}from"./VBtn-DmOE8ObX.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Ll}from"./VSlider-BbdIm9Mu.js";import{V as Al}from"./VTextField-h2jTOaQT.js";import{V as ze}from"./VContainer-BR45fXaf.js";import{a as pe,V as he}from"./VSwitch-C763ACV_.js";import{V as Ue,a as be}from"./VRow-DV7BqAoZ.js";import{V as Ne}from"./VSpacer-CRNj-rDk.js";import{V as Oe,a as De}from"./VToolbar-COHqcQ5L.js";import{V as Fl}from"./VDialog-BKEcjOuu.js";import{V as Tl}from"./VAlert-DjHMaeFy.js";import"./VCheckboxBtn-DZffJlMk.js";/* empty css              */import"./VVirtualScroll-ZleTOGra.js";const $l=Ce({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:Re,iconColor:String,lineColor:String,...Se(),...Ie(),...Ee(),...we()},"VTimelineDivider"),Pl=Ve()({name:"VTimelineDivider",props:$l(),setup(l,k){let{slots:f}=k;const{sizeClasses:o,sizeStyles:n}=Ye(l,"v-timeline-divider__dot"),{backgroundColorStyles:q,backgroundColorClasses:O}=Pe(K(l,"dotColor")),{roundedClasses:S}=Je(l,"v-timeline-divider__dot"),{elevationClasses:E}=Ze(l),{backgroundColorClasses:x,backgroundColorStyles:r}=Pe(K(l,"lineColor"));return ke(()=>t("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":l.fillDot},l.class],style:l.style},[t("div",{class:["v-timeline-divider__before",x.value],style:r.value},null),!l.hideDot&&t("div",{key:"dot",class:["v-timeline-divider__dot",E.value,S.value,o.value],style:n.value},[t("div",{class:["v-timeline-divider__inner-dot",O.value,S.value],style:q.value},[f.default?t(el,{key:"icon-defaults",disabled:!l.icon,defaults:{VIcon:{color:l.iconColor,icon:l.icon,size:l.size}}},f.default):t(X,{key:"icon",color:l.iconColor,icon:l.icon,size:l.size},null)])]),t("div",{class:["v-timeline-divider__after",x.value],style:r.value},null)])),{}}}),We=Ce({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:Re,iconColor:String,lineInset:[Number,String],...Se(),...al(),...we(),...Ie(),...Ee(),...Me()},"VTimelineItem"),ne=Ve()({name:"VTimelineItem",props:We(),setup(l,k){let{slots:f}=k;const{dimensionStyles:o}=ll(l),n=tl(0),q=N();return Z(q,O=>{var S;O&&(n.value=((S=O.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:S.getBoundingClientRect().width)??0)},{flush:"post"}),ke(()=>{var O,S;return t("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":l.fillDot},l.class],style:[{"--v-timeline-dot-size":me(n.value),"--v-timeline-line-inset":l.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${me(l.lineInset)})`:me(0)},l.style]},[t("div",{class:"v-timeline-item__body",style:o.value},[(O=f.default)==null?void 0:O.call(f)]),t(Pl,{ref:q,hideDot:l.hideDot,icon:l.icon,iconColor:l.iconColor,size:l.size,elevation:l.elevation,dotColor:l.dotColor,fillDot:l.fillDot,rounded:l.rounded},{default:f.icon}),l.density!=="compact"&&t("div",{class:"v-timeline-item__opposite"},[!l.hideOpposite&&((S=f.opposite)==null?void 0:S.call(f))])])}),{}}}),ql=Ce({align:{type:String,default:"center",validator:l=>["center","start"].includes(l)},direction:{type:String,default:"vertical",validator:l=>["vertical","horizontal"].includes(l)},justify:{type:String,default:"auto",validator:l=>["auto","center"].includes(l)},side:{type:String,validator:l=>l==null||["start","end"].includes(l)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:l=>["start","end","both"].includes(l)},...dl(We({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...Se(),...ul(),...Me(),...rl()},"VTimeline"),Ol=Ve()({name:"VTimeline",props:ql(),setup(l,k){let{slots:f}=k;const{themeClasses:o}=nl(l),{densityClasses:n}=sl(l),{rtlClasses:q}=il();ol({VTimelineDivider:{lineColor:K(l,"lineColor")},VTimelineItem:{density:K(l,"density"),dotColor:K(l,"dotColor"),fillDot:K(l,"fillDot"),hideOpposite:K(l,"hideOpposite"),iconColor:K(l,"iconColor"),lineColor:K(l,"lineColor"),lineInset:K(l,"lineInset"),size:K(l,"size")}});const O=W(()=>{const E=l.side?l.side:l.density!=="default"?"end":null;return E&&`v-timeline--side-${E}`}),S=W(()=>{const E=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(l.truncateLine){case"both":return E;case"start":return E[0];case"end":return E[1];default:return null}});return ke(()=>t(l.tag,{class:["v-timeline",`v-timeline--${l.direction}`,`v-timeline--align-${l.align}`,`v-timeline--justify-${l.justify}`,S.value,{"v-timeline--inset-line":!!l.lineInset},o.value,n.value,O.value,q.value,l.class],style:[{"--v-timeline-line-thickness":me(l.lineThickness)},l.style]},f)),{}}}),Dl=oe({__name:"DSPPipeline",props:{dsp:{},selected:{}},emits:["onSelect","onAddFilter","onMoveFilter","onDeleteFilter"],setup(l,{emit:k}){const f=Be(),o=l,n=k,q=h=>o.selected===h?"primary":"secondary",O=h=>h==="input"||h==="output"?!1:!o.dsp.filters[h].enabled,S=h=>o.selected===h?"primary":f.global.current.value.dark?"grey-darken-3":"grey-lighten-3",E=h=>({"filter-selected":o.selected===h}),x=h=>{n("onSelect",h)},r=(h,D)=>{n("onMoveFilter",{index:h,direction:D})},$=h=>{n("onDeleteFilter",h)},B=function(h,D){const T=[{label:"settings.dsp.move_up",labelArgs:[],action:()=>{r(D,"up")},disabled:D===0,icon:"mdi-arrow-up"},{label:"settings.dsp.move_down",labelArgs:[],action:()=>{r(D,"down")},disabled:D===o.dsp.filters.length-1,icon:"mdi-arrow-down"},{label:"settings.dsp.delete_filter",labelArgs:[],action:()=>{$(D)},icon:"mdi-delete"}];pl.emit("contextmenu",{items:T,posX:h.clientX,posY:h.clientY})};return(h,D)=>(b(),F(Ol,{density:"compact",side:"end"},{default:s(()=>[t(ne,{"dot-color":q("input"),size:"x-small",onClick:D[0]||(D[0]=T=>x("input"))},{default:s(()=>[t(j,{flat:"",rounded:"pill",color:S("input"),class:se([E("input"),"dsp-pipeline-card"])},{default:s(()=>[t(le,{class:"px-3 py-1"},{default:s(()=>[L(R(h.$t("settings.dsp.input")),1)]),_:1})]),_:1},8,["color","class"])]),_:1},8,["dot-color"]),t(ne,{"hide-dot":!0,size:"x-small"}),(b(!0),ie(ce,null,He(h.dsp.filters,(T,M)=>(b(),F(ne,{key:M,"dot-color":q(M),size:"x-small","hide-dot":O(M),onClick:Q=>x(M),onContextmenu:ml(Q=>B(Q,M),["prevent"])},{default:s(()=>[t(j,{flat:"",rounded:"pill",color:S(M),class:se([E(M),"dsp-pipeline-card"])},{default:s(()=>[t(le,{class:"px-3 py-1"},{default:s(()=>[L(R(h.$t(`settings.dsp.types.${T.type}`)),1)]),_:2},1024)]),_:2},1032,["color","class"])]),_:2},1032,["dot-color","hide-dot","onClick","onContextmenu"]))),128)),t(ne,{"dot-color":"secondary",size:"x-small","hide-dot":!0},{default:s(()=>[t(j,{outlined:"",rounded:"pill",class:"dsp-pipeline-card add-filter-btn",elevation:0,onClick:D[1]||(D[1]=T=>n("onAddFilter"))},{default:s(()=>[t(le,{class:"py-1 d-flex align-center"},{default:s(()=>[t(X,{size:"small",class:"mr-1"},{default:s(()=>D[3]||(D[3]=[L("mdi-plus")])),_:1,__:[3]}),L(" "+R(h.$t("settings.dsp.filter.add")),1)]),_:1})]),_:1})]),_:1}),t(ne,{"hide-dot":!0,size:"x-small"}),t(ne,{"dot-color":q("output"),size:"x-small",onClick:D[2]||(D[2]=T=>x("output"))},{default:s(()=>[t(j,{flat:"",rounded:"pill",color:S("output"),class:se([E("output"),"dsp-pipeline-card"])},{default:s(()=>[t(le,{class:"px-3 py-1"},{default:s(()=>[L(R(h.$t("settings.dsp.output")),1)]),_:1})]),_:1},8,["color","class"])]),_:1},8,["dot-color"])]),_:1}))}}),wl=xe(Dl,[["__scopeId","data-v-f292f100"]]),El={style:{"min-width":"100px"},class:"v-label pl-2"},Il={style:{"min-width":"40px"},class:"pl-2"},Y=oe({__name:"DSPSlider",props:cl({type:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const k=l,f=Le(l,"modelValue"),o=N(!1),n=W(()=>k.type==="gain"?{min:-15,max:15,step:.1,label:P("settings.dsp.parameter.gain"),unit:"dB",is_log:!1}:k.type==="q"?{min:.1,max:20,step:.1,label:P("settings.dsp.parameter.q_factor"),unit:"",is_log:!1}:k.type==="frequency"?{min:20,max:2e4,step:1,label:P("settings.dsp.parameter.frequency"),unit:"Hz",is_log:!0}:k.type),q=W({get:()=>o.value?f.value.toString():f.value>1e3?f.value.toFixed(0):f.value>100?f.value.toFixed(1):f.value.toFixed(2),set:r=>{f.value=Number(r)}}),O=W({get:()=>n.value.is_log?Math.log10(f.value):f.value,set:r=>{n.value.is_log?f.value=Math.pow(10,r):f.value=r}}),S=W(()=>n.value.is_log?Math.log10(n.value.max):n.value.max),E=W(()=>n.value.is_log?Math.log10(n.value.min):n.value.min),x=W(()=>n.value.is_log?Math.log10(n.value.step):n.value.step);return(r,$)=>(b(),F(te,{flat:"",color:"transparent"},{default:s(()=>[t(le,{class:"d-flex align-center gap-4"},{default:s(()=>[ae("span",El,R(n.value.label),1),t(Ll,{modelValue:O.value,"onUpdate:modelValue":$[0]||($[0]=B=>O.value=B),min:E.value,max:S.value,step:x.value,"hide-details":"",class:"flex-grow-1 pr-4",density:"compact",color:"primary"},null,8,["modelValue","min","max","step"]),t(Al,{modelValue:q.value,"onUpdate:modelValue":$[1]||($[1]=B=>q.value=B),type:"number","hide-details":"",density:"compact",style:{"max-width":"100px"},onFocus:$[2]||($[2]=B=>o.value=!0),onBlur:$[3]||($[3]=B=>o.value=!1)},null,8,["modelValue"]),ae("span",Il,R(n.value.unit),1)]),_:1})]),_:1}))}}),Rl={class:"d-flex flex-wrap justify-end align-center ga-2 pr-2"},Ml={class:"d-flex align-center pl-1"},Bl=oe({__name:"DSPParametricEQ",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(l){const k={PK:C.PEAK,PEQ:C.PEAK,HP:C.HIGH_PASS,HPQ:C.HIGH_PASS,LP:C.LOW_PASS,LPQ:C.LOW_PASS,LS:C.LOW_SHELF,HS:C.HIGH_SHELF,NO:C.NOTCH},f={[C.PEAK]:"PK",[C.HIGH_PASS]:"HP",[C.LOW_PASS]:"LP",[C.LOW_SHELF]:"LS",[C.HIGH_SHELF]:"HS",[C.NOTCH]:"NO"},o=Object.entries(A).map(([a,e])=>({title:P(`settings.dsp.channels.${a}`),value:e})),n=a=>{const e=a.split(`
`),i=[];let V=!1,w={},y=A.ALL;for(const u of e)if(u.startsWith("Channel:")){const g=u.match(/Channel:\s*(.+)/);if(g&&g[1]){const c=g[1].trim().toUpperCase();c==="ALL"||c==="1 2"||c==="L R"?y=A.ALL:c==="L"||c==="1"||c==="FL"?(y=A.FL,V=!0):(c==="R"||c==="2"||c==="FR")&&(y=A.FR,V=!0)}w[y]||(w[y]=0)}else if(u.startsWith("Filter")){const g=u.match(/Filter(?:\s+\d+)?:\s+(ON|OFF)\s+(\w+)\s+(?:Fc\s+)?(\d+\.?\d*)\s*(?:Hz)?\s+(?:Gain\s+)?(-?\d+\.?\d*)\s+dB\s+(?:(?:Q\s+)?(\d+\.?\d*)|(?:BW\s+Oct\s+)(\d+\.?\d*))/);if(g){const[c,U,J,Te,ve,ge,G]=g;J!=="None"&&i.push({frequency:parseFloat(Te),gain:parseFloat(ve),q:parseFloat(ge),type:k[J]||C.PEAK,enabled:U==="ON",channel:y})}}else if(u.startsWith("Preamp")){const g=u.match(/Preamp:\s*(-?\d+\.?\d*)\s+dB/);g&&(w[y]=parseFloat(g[1]))}let v;V?v=r.value.bands.filter(u=>!i.some(g=>g.channel===u.channel||g.channel===A.ALL||u.channel===A.ALL)):I.value!==A.ALL?(v=r.value.bands.filter(u=>u.channel!==A.ALL&&u.channel!==I.value),w.ALL&&(w[I.value]=w.ALL,w.ALL=0),i.forEach(u=>{u.channel=I.value})):(v=[],r.value.per_channel_preamp={}),r.value.bands=[...v,...i],Object.keys(w).length>0?(w.ALL&&(r.value.preamp=w.ALL),Object.entries(w).forEach(([u,g])=>{u!==A.ALL&&(r.value.per_channel_preamp[u]=g)})):(r.value.preamp=0,r.value.per_channel_preamp={}),_e(()=>{p.value=-1})},q=a=>{const e=a.target;if(e.files&&e.files[0]){const i=e.files[0],V=new FileReader;V.onload=w=>{var y;(y=w.target)!=null&&y.result&&n(w.target.result)},V.readAsText(i)}},O=N(null),S=()=>{var a;(a=O.value)==null||a.click()},E=()=>{var w;let a="";if(a+=`Preamp: ${fe.value.toFixed(2)} dB
`,m.value){const y=Object.values(A);for(const v of y){if(v===A.ALL)continue;const u=((w=o.find(c=>c.value===v))==null?void 0:w.title)||v;a+=`
# ${u}
`,a+=`Channel: ${v===A.FL?"L":"R"}
`,r.value.per_channel_preamp[v]!==void 0&&(a+=`Preamp: ${r.value.per_channel_preamp[v].toFixed(2)} dB
`);let g=1;r.value.bands.forEach(c=>{if(c.channel===v||c.channel===A.ALL){const U=f[c.type];a+=`Filter ${g++}: ${c.enabled?"ON":"OFF"} ${U} Fc ${c.frequency.toFixed(1)} Hz Gain ${c.gain.toFixed(2)} dB Q ${c.q.toFixed(3)}
`}})}}else r.value.bands.forEach((y,v)=>{const u=f[y.type];a+=`Filter ${v+1}: ${y.enabled?"ON":"OFF"} ${u} Fc ${y.frequency.toFixed(1)} Hz Gain ${y.gain.toFixed(2)} dB Q ${y.q.toFixed(3)}
`});const e=new Blob([a],{type:"text/plain"}),i=URL.createObjectURL(e),V=document.createElement("a");V.href=i,V.download=`music_assistant_eq_settings_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(i)},x=Be(),r=Le(l,"modelValue"),$=N(null),B=N(null),h=Object.values(C).map(a=>({title:P(`settings.dsp.parametric_eq.filter_types.${a}`),value:a})),D=a=>![C.HIGH_PASS,C.LOW_PASS,C.NOTCH].includes(a),T=N({width:0,height:0,min_gain:-20,max_gain:20,min_freq:20,max_freq:2e4,padding_lr:40,padding_tb:20}),M=()=>{if(!$.value||!B.value)return;const a=x.global.current.value.dark,e=$.value.getContext("2d");if(!e)return;$.value.width=B.value.clientWidth*2,$.value.height=B.value.clientHeight*2,T.value.width=$.value.width/2,T.value.height=$.value.height/2,e.scale(2,2),e.clearRect(0,0,$.value.width,$.value.height),Ke(e,T.value);const i=e.canvas.width/2;e.canvas.height/2;const V=(y,v,u)=>{let g=`hsla(${v*360/r.value.bands.length}, 60%, ${a?70:50}%, 0.5)`;u.beginPath(),v===p.value?(u.lineWidth=5,g=`hsla(${v*360/r.value.bands.length}, 70%, ${a?70:60}%, 1)`):u.lineWidth=2,u.strokeStyle=g;const c=new Float32Array(i);for(let G=0;G<i;G++)c[G]=Qe(G,T.value);const U=new Float32Array(i),J=new Float32Array(i);Q(re,y).getFrequencyResponse(c,U,J);for(let G=T.value.padding_lr;G<i-T.value.padding_lr;G++){const Xe=20*Math.log10(U[G]),$e=ue(Xe,T.value);G===T.value.padding_lr?u.moveTo(G,$e):u.lineTo(G,$e)}u.stroke();const ve=Fe(y.frequency,T.value),ge=ue(y.gain,T.value);return u.beginPath(),u.fillStyle=g,u.arc(ve,ge,6,0,2*Math.PI),u.fill(),{frequencies:c,magResponse:U}},w=(y,v)=>{v.lineWidth=3,a?v.strokeStyle="#fff":v.strokeStyle="#000",v.beginPath();for(let u=T.value.padding_lr;u<i-T.value.padding_lr;u++){const g=ue(y[u],T.value);u===T.value.padding_lr?v.moveTo(u,g):v.lineTo(u,g)}v.stroke()};if(I.value===A.ALL&&m.value){const y=Object.values(A).filter(u=>u!==A.ALL),v={};y.forEach(u=>{v[u]=new Float32Array(i).fill((r.value.preamp??0)+(r.value.per_channel_preamp[u]??0))}),r.value.bands.forEach((u,g)=>{if(u.enabled){const{magResponse:c}=V(u,g,e);if(u.channel===A.ALL)y.forEach(U=>{for(let J=0;J<i;J++)v[U][J]+=20*Math.log10(c[J])});else for(let U=0;U<i;U++)v[u.channel][U]+=20*Math.log10(c[U])}}),y.forEach(u=>{w(v[u],e)})}else{const y=new Float32Array(i).fill((r.value.preamp??0)+(r.value.per_channel_preamp[I.value]??0));r.value.bands.forEach((v,u)=>{if(v.enabled&&v.channel===I.value||v.channel===A.ALL){const{magResponse:g}=V(v,u,e);for(let c=0;c<i;c++)y[c]+=20*Math.log10(g[c])}}),w(y,e)}},Q=(a,e)=>{const i=a.createBiquadFilter();switch(e.type){case C.HIGH_PASS:i.type="highpass";break;case C.LOW_PASS:i.type="lowpass";break;case C.HIGH_SHELF:i.type="highshelf";break;case C.LOW_SHELF:i.type="lowshelf";break;case C.NOTCH:i.type="notch";break;case C.PEAK:i.type="peaking";break}return i.frequency.value=e.frequency,i.Q.value=e.q,i.gain.value=e.gain,i},re=new AudioContext;W(()=>r.value.bands.map(a=>Q(re,a)));const m=W(()=>r.value.bands.some(a=>a.channel!==A.ALL)||Object.keys(r.value.per_channel_preamp).length>0&&Object.values(r.value.per_channel_preamp).some(a=>a!==0)),d=N(!1),p=N(-1),I=N(A.ALL),z=W(()=>r.value.bands[p.value]),fe=W({get:()=>r.value.preamp??0,set:a=>{r.value.preamp=a}}),Ae=W({get:()=>r.value.per_channel_preamp[I.value]??0,set:a=>{I.value!==A.ALL&&(r.value.per_channel_preamp[I.value]=a)}}),je=a=>{r.value.bands.splice(a,1),p.value>=r.value.bands.length&&_e(()=>{p.value=r.value.bands.length-1})},Ge=()=>{const a=r.value.bands.length;r.value.bands.push({frequency:1e3,q:1,gain:0,type:C.PEAK,enabled:!0,channel:I.value}),_e(()=>{p.value=a})};Z(()=>r.value.preamp,M),Z(()=>r.value.per_channel_preamp,M,{deep:!0}),Z(()=>(p.value,r.value.bands),()=>{p.value>=r.value.bands.length&&(p.value=r.value.bands.length-1),M()},{deep:!0}),Z(()=>I.value,M),Z(()=>x.global.current.value.dark,M),fl(()=>{m.value&&(d.value=!0)}),qe(()=>{M(),window.addEventListener("resize",M)});const Fe=(a,e)=>{const i=Math.log2(a/e.min_freq),V=Math.log2(e.max_freq/e.min_freq);return i/V*(e.width-e.padding_lr*2)+e.padding_lr},Qe=(a,e)=>{const i=Math.log2(e.max_freq/e.min_freq),V=e.min_freq*Math.pow(2,(a-e.padding_lr)/(e.width-e.padding_lr*2)*i);return Math.min(Math.max(V,e.min_freq),e.max_freq)},ue=(a,e)=>e.height/2-a*(e.height-2*e.padding_tb)/(2*Math.max(Math.abs(e.min_gain),Math.abs(e.max_gain))),Ke=(a,e)=>{const i=a.canvas.width/2,V=a.canvas.height/2;x.global.current.value.dark?(a.fillStyle="#eee",a.strokeStyle="#eee"):(a.fillStyle="#222",a.strokeStyle="#666"),a.lineWidth=1,[20,50,100,200,500,1e3,2e3,5e3,1e4,2e4].forEach(g=>{const c=Fe(g,e);a.beginPath(),a.moveTo(c,e.padding_tb),a.lineTo(c,V-e.padding_tb),a.stroke(),a.font="10px Arial",a.textAlign="center",a.fillText(g>=1e3?`${g/1e3}k`:g.toString(),c,V-5)});const v=e.max_gain-e.min_gain,u=Math.ceil(v/(e.height/30));for(let g=e.min_gain;g<=e.max_gain;g+=u){const c=ue(g,e);a.beginPath(),a.moveTo(e.padding_lr,c),a.lineTo(i-e.padding_lr,c),a.stroke(),a.font="10px Arial",a.textAlign="right",a.fillText(`${g}dB`,e.padding_lr-3,c+3)}};return qe(()=>{const a=new ResizeObserver(()=>{M()});return B.value&&a.observe(B.value),()=>{a.disconnect()}}),(a,e)=>(b(),F(ze,{class:"pa-2"},{default:s(()=>[ae("div",Rl,[d.value?(b(),F(pe,{key:1,modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=i=>I.value=i),class:"pa-2",items:_(o),label:_(P)("settings.dsp.parametric_eq.edited_channel"),variant:"outlined",density:"comfortable",style:{"min-width":"250px"},"hide-details":""},null,8,["modelValue","items","label"])):(b(),F(j,{key:0,variant:"outlined",onClick:e[0]||(e[0]=()=>{d.value=!0})},{default:s(()=>[t(X,{start:""},{default:s(()=>e[12]||(e[12]=[L("mdi-speaker-multiple")])),_:1,__:[12]}),L(" "+R(_(P)("settings.dsp.parametric_eq.show_multichannel_controls")),1)]),_:1})),t(j,{variant:"outlined",onClick:S},{default:s(()=>[t(X,{start:""},{default:s(()=>e[13]||(e[13]=[L("mdi-file-import")])),_:1,__:[13]}),L(" "+R(_(P)("settings.dsp.parametric_eq.import_apo")),1)]),_:1}),t(j,{variant:"outlined",onClick:E},{default:s(()=>[t(X,{start:""},{default:s(()=>e[14]||(e[14]=[L("mdi-file-export")])),_:1,__:[14]}),L(" "+R(_(P)("settings.dsp.parametric_eq.export_apo")),1)]),_:1}),ae("input",{ref_key:"fileInputRef",ref:O,type:"file",accept:".txt",class:"d-none",onChange:q},null,544)]),t(te,{elevation:"0",color:"transparent"},{default:s(()=>[ae("div",{ref_key:"graphContainer",ref:B,class:"graph-container"},[ae("canvas",{ref_key:"canvas",ref:$,class:"frequency-graph"},null,512)],512)]),_:1}),t(te,{elevation:"0",color:"transparent",class:"border-t border-b rounded-0"},{default:s(()=>[t(le,{class:"pa-0"},{default:s(()=>[t(vl,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=i=>p.value=i),class:"mb-0 pa-2",mandatory:"","selected-class":"primary"},{default:s(()=>[(b(),F(ye,{key:-1,value:-1,filter:"",variant:"elevated"},{default:s(()=>[L(R(_(P)("settings.dsp.parametric_eq.preamp",{index:100})),1)]),_:1})),(b(!0),ie(ce,null,He(r.value.bands,(i,V)=>(b(),F(ye,{key:V,value:V,class:se({"opacity-50":!i.enabled}),filter:"",variant:"elevated"},{default:s(()=>[L(R(i.channel===_(A).ALL?_(P)("settings.dsp.parametric_eq.band",{index:V+1}):_(P)("settings.dsp.parametric_eq.band_channel",{index:V+1,channel:_(P)(`settings.dsp.channels_compact.${i.channel}`)})),1)]),_:2},1032,["value","class"]))),128)),t(ye,{variant:"outlined",onClick:Ge},{default:s(()=>[t(X,{icon:"mdi-plus",start:""}),L(" "+R(I.value===_(A).ALL?_(P)("settings.dsp.parametric_eq.add_band"):_(P)("settings.dsp.parametric_eq.add_band_channel",{channel:_(P)(`settings.dsp.channels.${I.value}`)})),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),p.value===-1?(b(),F(te,{key:0,elevation:"0",color:"transparent"},{default:s(()=>[t(le,null,{default:s(()=>[t(Ue,{dense:""},{default:s(()=>[t(be,{cols:"12"},{default:s(()=>[t(Y,{modelValue:fe.value,"onUpdate:modelValue":e[3]||(e[3]=i=>fe.value=i),type:"gain"},null,8,["modelValue"]),I.value!==_(A).ALL?(b(),F(Y,{key:0,modelValue:Ae.value,"onUpdate:modelValue":e[4]||(e[4]=i=>Ae.value=i),type:{min:-15,max:15,step:.1,label:_(P)("settings.dsp.parametric_eq.per_channel_preamp",{channel:_(P)(`settings.dsp.channels.${I.value}`)}),unit:"dB",is_log:!1}},null,8,["modelValue","type"])):H("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):H("",!0),z.value?(b(),ie(ce,{key:1},[t(gl,null,{default:s(()=>[ae("div",Ml,[t(he,{modelValue:z.value.enabled,"onUpdate:modelValue":e[5]||(e[5]=i=>z.value.enabled=i),label:_(P)("settings.dsp.parametric_eq.enable_band"),density:"comfortable","hide-details":"",color:"primary"},null,8,["modelValue","label"]),t(Ne),t(j,{color:"error",variant:"tonal",onClick:e[6]||(e[6]=i=>je(p.value))},{default:s(()=>[t(X,null,{default:s(()=>e[15]||(e[15]=[L("mdi-delete")])),_:1,__:[15]}),L(" "+R(_(P)("settings.dsp.parametric_eq.delete_band")),1)]),_:1})])]),_:1}),t(pe,{modelValue:z.value.type,"onUpdate:modelValue":e[7]||(e[7]=i=>z.value.type=i),items:_(h),label:_(P)("settings.dsp.parametric_eq.filter_type"),variant:"outlined",density:"comfortable",class:"pa-4","hide-details":""},null,8,["modelValue","items","label"]),t(Y,{modelValue:z.value.frequency,"onUpdate:modelValue":e[8]||(e[8]=i=>z.value.frequency=i),type:"frequency"},null,8,["modelValue"]),D(z.value.type)?(b(),F(Y,{key:0,modelValue:z.value.gain,"onUpdate:modelValue":e[9]||(e[9]=i=>z.value.gain=i),type:"gain"},null,8,["modelValue"])):H("",!0),t(Y,{modelValue:z.value.q,"onUpdate:modelValue":e[10]||(e[10]=i=>z.value.q=i),type:"q"},null,8,["modelValue"]),d.value?(b(),F(pe,{key:1,modelValue:z.value.channel,"onUpdate:modelValue":e[11]||(e[11]=i=>z.value.channel=i),items:_(o),label:_(P)("settings.dsp.parametric_eq.channel"),variant:"outlined",density:"comfortable",class:"pa-4","hide-details":""},null,8,["modelValue","items","label"])):H("",!0)],64)):H("",!0)]),_:1}))}}),Hl=xe(Bl,[["__scopeId","data-v-ac29d681"]]),xl=oe({__name:"DSPToneControl",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(l){const k=Le(l,"modelValue");return(f,o)=>(b(),ie(ce,null,[t(Y,{modelValue:k.value.bass_level,"onUpdate:modelValue":o[0]||(o[0]=n=>k.value.bass_level=n),type:{min:-10,max:10,step:.1,label:f.$t("settings.dsp.tone_control.bass_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"]),t(Y,{modelValue:k.value.mid_level,"onUpdate:modelValue":o[1]||(o[1]=n=>k.value.mid_level=n),type:{min:-10,max:10,step:.1,label:f.$t("settings.dsp.tone_control.mid_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"]),t(Y,{modelValue:k.value.treble_level,"onUpdate:modelValue":o[2]||(o[2]=n=>k.value.treble_level=n),type:{min:-10,max:10,step:.1,label:f.$t("settings.dsp.tone_control.treble_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"])],64))}}),zl={key:0},nt=oe({__name:"EditPlayerDsp",props:{playerId:{}},setup(l){const{t:k}=yl();Sl();const f=l,o=N(),n=N(null),q=N(!1),O=N(ee.PARAMETRIC_EQ);N(window.innerWidth);const{mobile:S}=_l();let E=!1;const x=Object.values(ee).map(m=>({value:m,title:k(`settings.dsp.types.${m}`)})),r=m=>{n.value=m},$=m=>{var d;return k(m==="input"?"settings.dsp.input":m==="output"?"settings.dsp.output":`settings.dsp.types.${(d=o.value)==null?void 0:d.filters[m].type}`)},B=()=>{if(!o.value)return;let m;switch(O.value){case ee.PARAMETRIC_EQ:m={preamp:0,per_channel_preamp:{},enabled:!0,type:ee.PARAMETRIC_EQ,bands:[]};break;case ee.TONE_CONTROL:m={enabled:!0,type:ee.TONE_CONTROL,bass_level:0,mid_level:0,treble_level:0};break;default:return}o.value.filters.push(m),q.value=!1,r(o.value.filters.length-1)},h=(m,d)=>{if(!o.value)return;const p=d==="up"?m-1:m+1;if(p<0||p>=o.value.filters.length)return;const[I]=o.value.filters.splice(m,1);o.value.filters.splice(p,0,I),n.value===m?n.value=p:n.value===p&&(n.value=m)},D=m=>{var d;n.value===m&&(n.value="input"),(d=o.value)==null||d.filters.splice(m,1)};Z(S,m=>{!m&&n.value===null&&r("input")},{immediate:!0});const T=W(()=>hl(de.players[f.playerId],27));Z(()=>f.playerId,async m=>{m&&(o.value=await de.getDSPConfig(m))},{immediate:!0});const M=de.subscribe(bl.PLAYER_DSP_CONFIG_UPDATED,m=>{E=!0,o.value=m.data});Vl(M);let Q=null;const re=m=>{Q&&clearTimeout(Q),Q=setTimeout(async()=>{f.playerId&&await de.saveDSPConfig(f.playerId,m)},2e3)};return Z(o,(m,d)=>{if(E){Q&&clearTimeout(Q),E=!1;return}m!==null&&d&&re(d)},{deep:!0}),(m,d)=>o.value?(b(),ie("section",zl,[t(Oe,{color:"transparent",class:"border-b"},{default:s(()=>[t(he,{modelValue:o.value.enabled,"onUpdate:modelValue":d[0]||(d[0]=p=>o.value.enabled=p),"hide-details":"",color:"primary",class:"pl-4"},null,8,["modelValue"]),t(De,null,{default:s(()=>[L(R(m.$t("settings.dsp.configure_on",{name:T.value})),1)]),_:1})]),_:1}),t(ze,{class:"pa-4"},{default:s(()=>[o.value.enabled?H("",!0):(b(),F(Tl,{key:0,type:"info",class:"mt-4",color:"transparent"},{default:s(()=>[L(R(m.$t("settings.dsp.disabled_message")),1)]),_:1})),t(Ue,{class:se([{"justify-center":_(S)},"flex-nowrap"])},{default:s(()=>[!_(S)||n.value===null?(b(),F(be,{key:0,class:se(["flex-grow-0 flex-shrink-0",{"border-e pr-4":!_(S)}]),"align-self":"start"},{default:s(()=>[t(wl,{dsp:o.value,selected:n.value,onOnSelect:r,onOnAddFilter:d[1]||(d[1]=p=>q.value=!0),onOnMoveFilter:d[2]||(d[2]=p=>h(p.index,p.direction)),onOnDeleteFilter:D},null,8,["dsp","selected"])]),_:1},8,["class"])):H("",!0),n.value!=null?(b(),F(be,{key:1,style:{"min-width":"0"}},{default:s(()=>[t(Oe,{density:"compact",color:m.$vuetify.theme.current.dark?"surface":"surface-light",class:"border-b"},{default:s(()=>[_(S)?(b(),F(j,{key:0,class:"hidden-xs-only",icon:"",onClick:d[3]||(d[3]=p=>n.value=null)},{default:s(()=>[t(X,null,{default:s(()=>d[15]||(d[15]=[L("mdi-arrow-left")])),_:1,__:[15]})]),_:1})):H("",!0),t(De,null,{default:s(()=>[L(R($(n.value)),1)]),_:1}),typeof n.value=="number"&&!_(S)&&n.value>0?(b(),F(j,{key:1,icon:"",onClick:d[4]||(d[4]=p=>h(n.value,"up"))},{default:s(()=>[t(X,null,{default:s(()=>d[16]||(d[16]=[L("mdi-arrow-up")])),_:1,__:[16]})]),_:1})):H("",!0),typeof n.value=="number"&&!_(S)&&n.value<o.value.filters.length-1?(b(),F(j,{key:2,icon:"",onClick:d[5]||(d[5]=p=>h(n.value,"down"))},{default:s(()=>[t(X,null,{default:s(()=>d[17]||(d[17]=[L("mdi-arrow-down")])),_:1,__:[17]})]),_:1})):H("",!0),typeof n.value=="number"?(b(),F(he,{key:3,modelValue:o.value.filters[n.value].enabled,"onUpdate:modelValue":d[6]||(d[6]=p=>o.value.filters[n.value].enabled=p),"hide-details":"",color:"primary",class:"mr-4"},null,8,["modelValue"])):H("",!0),typeof n.value=="number"?(b(),F(j,{key:4,icon:"",onClick:d[7]||(d[7]=p=>D(n.value))},{default:s(()=>[t(X,null,{default:s(()=>d[18]||(d[18]=[L("mdi-delete")])),_:1,__:[18]})]),_:1})):H("",!0)]),_:1},8,["color"]),n.value==="input"?(b(),F(te,{key:0,flat:"",color:m.$vuetify.theme.current.dark?"surface":"surface-light"},{default:s(()=>[t(Y,{modelValue:o.value.input_gain,"onUpdate:modelValue":d[8]||(d[8]=p=>o.value.input_gain=p),type:"gain"},null,8,["modelValue"])]),_:1},8,["color"])):n.value==="output"?(b(),F(te,{key:1,flat:"",color:m.$vuetify.theme.current.dark?"surface":"surface-light"},{default:s(()=>[t(Y,{modelValue:o.value.output_gain,"onUpdate:modelValue":d[9]||(d[9]=p=>o.value.output_gain=p),type:"gain"},null,8,["modelValue"])]),_:1},8,["color"])):(b(),F(te,{key:2,flat:"",color:m.$vuetify.theme.current.dark?"surface":"surface-light"},{default:s(()=>[o.value.filters[n.value].type===_(ee).PARAMETRIC_EQ?(b(),F(Hl,{key:0,modelValue:o.value.filters[n.value],"onUpdate:modelValue":d[10]||(d[10]=p=>o.value.filters[n.value]=p)},null,8,["modelValue"])):H("",!0),o.value.filters[n.value].type===_(ee).TONE_CONTROL?(b(),F(xl,{key:1,modelValue:o.value.filters[n.value],"onUpdate:modelValue":d[11]||(d[11]=p=>o.value.filters[n.value]=p)},null,8,["modelValue"])):H("",!0)]),_:1},8,["color"]))]),_:1})):H("",!0)]),_:1},8,["class"])]),_:1}),t(Fl,{modelValue:q.value,"onUpdate:modelValue":d[14]||(d[14]=p=>q.value=p),"max-width":"300"},{default:s(()=>[t(te,null,{default:s(()=>[t(Cl,null,{default:s(()=>[L(R(m.$t("settings.dsp.filter.add")),1)]),_:1}),t(le,null,{default:s(()=>[t(pe,{modelValue:O.value,"onUpdate:modelValue":d[12]||(d[12]=p=>O.value=p),items:_(x),label:m.$t("settings.dsp.filter.type")},null,8,["modelValue","items","label"])]),_:1}),t(kl,null,{default:s(()=>[t(Ne),t(j,{onClick:d[13]||(d[13]=p=>q.value=!1)},{default:s(()=>[L(R(m.$t("cancel")),1)]),_:1}),t(j,{color:"primary",onClick:B},{default:s(()=>[L(R(m.$t("settings.dsp.filter.add")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):H("",!0)}});export{nt as default};
