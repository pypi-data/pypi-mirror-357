"use strict";(self.webpackChunkipylab=self.webpackChunkipylab||[]).push([[380],{380:(e,s,t)=>{t.r(s),t.d(s,{CommandPaletteModel:()=>r,CommandRegistryModel:()=>m,CustomMenuModel:()=>B,CustomToolbarModel:()=>L,IconModel:()=>I,IconView:()=>x,JupyterFrontEndModel:()=>_,PanelModel:()=>h,SessionManagerModel:()=>u,ShellModel:()=>p,SplitPanelModel:()=>f,SplitPanelView:()=>y,TitleModel:()=>k});var o,n,i=t(765),l=t(879),a=t(53),d=t(797);class m extends l.WidgetModel{defaults(){return{...super.defaults(),_model_name:m.model_name,_model_module:m.model_module,_model_module_version:m.model_module_version,_command_list:[],_commands:[]}}initialize(e,s){this._commands=m.commands,super.initialize(e,s),this.on("msg:custom",this._onMessage.bind(this)),this.on("comm_live_update",(()=>{this.comm_live||(o.customCommands.values().forEach((e=>e.dispose())),this._sendCommandList())}));const t=this.get("_commands");Promise.all(t.map((e=>this._addCommand(e)))).then((()=>this._sendCommandList())).catch(console.warn)}async _onMessage(e){switch(e.func){case"execute":this._execute(e.payload);break;case"addCommand":{await this._addCommand(e.payload);const s=this.get("_commands");this.set("_commands",s.concat(e.payload)),this.save_changes();break}case"removeCommand":this._removeCommand(e.payload)}}_sendCommandList(){this._commands.notifyCommandChanged(),this.set("_command_list",this._commands.listCommands()),this.save_changes()}_execute(e){const{id:s,args:t}=e;this._commands.execute(s,t)}async _addCommand(e){var s;const{id:t,caption:n,label:i,iconClass:a,icon:d}=e;this._commands.hasCommand(t)&&o.customCommands.get(t).dispose();let m=null;d&&(m=null===(s=await(0,l.unpack_models)(d,this.widget_manager))||void 0===s?void 0:s.labIcon);const r=e=>!e.isDisposed&&!!this.comm&&this.comm_live,u=this._commands.addCommand(t,{caption:n,label:i,iconClass:a,icon:m,execute:e=>{this.comm_live?this.send({event:"execute",id:t,args:JSON.stringify(e)},{}):u.dispose()},isEnabled:()=>r(u),isVisible:()=>r(u)});o.customCommands.set(t,u),this._sendCommandList()}_removeCommand(e){const{id:s}=e;o.customCommands.has(s)&&o.customCommands.get(s).dispose();const t=this.get("_commands").slice();a.ArrayExt.removeAllWhere(t,(e=>e.id===s)),this.set("_commands",t),this.save_changes(),this._sendCommandList()}}m.serializers={...l.WidgetModel.serializers},m.model_name="CommandRegistryModel",m.model_module=d.p,m.model_module_version=d.e,m.view_name=null,m.view_module=null,m.view_module_version=d.e,function(e){e.customCommands=new i.ObservableMap}(o||(o={}));class r extends l.WidgetModel{defaults(){return{...super.defaults(),_model_name:r.model_name,_model_module:r.model_module,_model_module_version:r.model_module_version,_items:[]}}initialize(e,s){this._palette=r.palette,super.initialize(e,s),this.on("msg:custom",this._onMessage.bind(this)),this.get("_items").forEach((e=>this._addItem(e)))}_onMessage(e){switch(e.func){case"addItem":{this._addItem(e.payload);const s=this.get("_items");this.set("_items",s.concat(e.payload)),this.save_changes();break}}}_addItem(e){if(!this._palette)return;const{id:s,category:t,args:o,rank:i}=e,l=`${s}-${t}`;if(n.customItems.has(l))return;const a=this._palette.addItem({command:s,category:t,args:o,rank:i});n.customItems.set(l,a)}}r.serializers={...l.DOMWidgetModel.serializers},r.model_name="CommandPaletteModel",r.model_module=d.p,r.model_module_version=d.e,r.view_name=null,r.view_module=null,r.view_module_version=d.e,function(e){e.customItems=new i.ObservableMap}(n||(n={}));class u extends l.WidgetModel{defaults(){return{...super.defaults(),_model_name:u.model_name,_model_module:u.model_module,_model_module_version:u.model_module_version,current_session:null,sessions:[]}}initialize(e,s){const{labShell:t,sessions:o,shell:n}=u;this._sessions=o,this._shell=n,this._labShell=t,o.runningChanged.connect(this._sendSessions,this),super.initialize(e,s),this.on("msg:custom",this._onMessage.bind(this)),this._labShell?(this._labShell.currentChanged.connect(this._currentChanged,this),this._labShell.activeChanged.connect(this._currentChanged,this)):this._currentChanged(),this._sendSessions(),this._sendCurrent(),this.send({event:"sessions_initialized"},{})}_onMessage(e){"refreshRunning"===e.func&&this._sessions.refreshRunning().then((()=>{this.send({event:"sessions_refreshed"},{})}))}_getSessionContext(e){var s,t,o;return null!==(o=null===(t=null===(s=null==e?void 0:e.sessionContext)||void 0===s?void 0:s.session)||void 0===t?void 0:t.model)&&void 0!==o?o:{}}_currentChanged(){this._current_session=this._getSessionContext(this._shell.currentWidget),this.set("current_session",this._current_session),this.set("sessions",(0,a.toArray)(this._sessions.running())),this.save_changes()}_sendSessions(){this.set("sessions",(0,a.toArray)(this._sessions.running())),this.save_changes()}_sendCurrent(){this._current_session=this._getSessionContext(this._shell.currentWidget),this.set("current_session",this._current_session),this.save_changes()}}u.serializers={...l.WidgetModel.serializers},u.model_name="SessionManagerModel",u.model_module=d.p,u.model_module_version=d.e,u.view_name=null,u.view_module=null,u.view_module_version=d.e;class _ extends l.WidgetModel{defaults(){return{...super.defaults(),_model_name:_.model_name,_model_module:_.model_module,_model_module_version:_.model_module_version}}initialize(e,s){this._app=_.app,super.initialize(e,s),this.send({event:"lab_ready"},{}),this.set("version",this._app.version),this.save_changes()}}_.serializers={...l.DOMWidgetModel.serializers},_.model_name="JupyterFrontEndModel",_.model_module=d.p,_.model_module_version=d.e,_.view_name=null,_.view_module=null,_.view_module_version=d.e;var c=t(560);class h extends c.VBoxModel{defaults(){return{...super.defaults(),_model_name:h.model_name,_model_module:h.model_module,_model_module_version:h.model_module_version}}}h.model_name="PanelModel",h.model_module=d.p,h.model_module_version=d.e;var g=t(179),v=t(230);class p extends l.WidgetModel{defaults(){return{...super.defaults(),_model_name:p.model_name,_model_module:p.model_module,_model_module_version:p.model_module_version,_widgets:[]}}initialize(e,s){this._shell=p.shell,this._labShell=p.labShell,super.initialize(e,s),this.on("msg:custom",this._onMessage.bind(this)),this.get("_widgets").forEach((e=>this._add(e)))}async _add(e){const{serializedWidget:s,area:t,args:o,id:n}=e,i=await(0,l.unpack_models)(s,this.widget_manager),d=await this.widget_manager.create_view(i,{}),m=await(0,l.unpack_models)(i.get("title"),this.widget_manager),r=d.luminoWidget;r.id=null!=n?n:g.DOMUtils.createDomID(),v.MessageLoop.installMessageHook(r,((e,s)=>{switch(s.type){case"close-request":{const s=this.get("_widgets").slice();a.ArrayExt.removeAllWhere(s,(s=>s.id===e.id)),this.set("_widgets",s),this.save_changes();break}}return!0}));const u=async()=>{r.title.caption=m.get("caption"),r.title.className=m.get("class_name"),r.title.closable=m.get("closable"),r.title.label=m.get("label"),r.title.dataset=m.get("dataset"),r.title.iconLabel=m.get("icon_label");const e=await(0,l.unpack_models)(m.get("icon"),this.widget_manager);r.title.icon=e?e.labIcon:null,r.title.iconClass=e?null:m.get("icon_class")};if(m.on("change",u),u(),("left"===t||"right"===t)&&this._labShell){let e;e="left"===t?this._labShell._leftHandler:this._labShell._rightHandler,e.sideBar.tabCloseRequested.connect(((e,s)=>{s.title.owner.close()})),r.addClass("jp-SideAreaWidget")}return this._shell.add(r,t,o),r.id}async _onMessage(e){switch(e.func){case"add":{const s=await this._add(e.payload),t=this.get("_widgets");this.set("_widgets",t.concat({...e.payload,id:s})),this.save_changes();break}case"expandLeft":this._labShell&&this._labShell.expandLeft();break;case"expandRight":this._labShell&&this._labShell.expandRight()}}}p.serializers={...l.WidgetModel.serializers},p.model_name="ShellModel",p.model_module=d.p,p.model_module_version=d.e,p.view_name=null,p.view_module=null,p.view_module_version=d.e;var b=t(256),w=t(692),M=t.n(w);class C extends b.SplitPanel{constructor(e){const s=e.view;delete e.view,super(e),this.addClass("jp-JupyterLuminoSplitPanelWidget"),this._view=s}processMessage(e){super.processMessage(e),this._view.processLuminoMessage(e)}dispose(){this.isDisposed||(super.dispose(),this._view&&this._view.remove(),this._view=null)}}class f extends h{defaults(){return{...super.defaults(),_model_name:f.model_name,_model_module:f.model_module,_model_module_version:f.model_module_version,_view_name:f.model_name,_view_module:f.model_module,_view_module_version:f.model_module_version}}}f.model_name="SplitPanelModel",f.model_module=d.p,f.model_module_version=d.e,f.view_name="SplitPanelView",f.view_module=d.p,f.view_module_name=d.e;class y extends c.VBoxView{_createElement(e){return this.luminoWidget=new C({view:this,orientation:this.model.get("orientation")}),this.luminoWidget.node}_setElement(e){if(this.el||e!==this.luminoWidget.node)throw new Error("Cannot reset the DOM element.");this.el=this.luminoWidget.node,this.$el=M()(this.luminoWidget.node)}initialize(e){super.initialize(e);const s=this.luminoWidget;this.model.on("change:orientation",(()=>{const e=this.model.get("orientation");s.orientation=e}))}async render(){super.render(),(await Promise.all(this.children_views.views)).forEach((async e=>{this.luminoWidget.addWidget(e.luminoWidget)}))}}class k extends l.WidgetModel{defaults(){return{...super.defaults(),_model_name:k.model_name,_model_module:k.model_module,_model_module_version:k.model_module_version}}initialize(e,s){super.initialize(e,s),this.on("change:icon",this.iconChanged)}async iconChanged(){const e=await(0,l.unpack_models)(this.get("icon"),this.widget_manager);e&&e.on("change",(()=>this.trigger("change")))}}k.model_name="TitleModel",k.model_module=d.p,k.model_module_version=d.e,k.view_name=null,k.view_module=null,k.view_module_version=d.e;var S=t(484);class x extends l.DOMWidgetView{initialize(e){super.initialize(e),this.iconElement=document.createElement("div"),this.el.appendChild(this.iconElement),this.update()}update(){const{labIcon:e}=this.model;e&&e.render(this.iconElement,{props:{tag:"div"}})}}class I extends l.DOMWidgetModel{defaults(){return{...super.defaults(),_model_name:I.model_name,_model_module:I.model_module,_model_module_version:I.model_module_version,_view_name:I.view_name,_view_module:I.view_module,_view_module_version:I.view_module_version}}initialize(e,s){super.initialize(e,s),this.on("change:name change:svgstr",this.updateIcon),this.updateIcon()}get labIcon(){return this._labIcon}updateIcon(){const e=this.get("name"),s=this.get("svgstr");this._labIcon&&this._labIcon.name===e||(this._labIcon=new S.LabIcon({name:e,svgstr:s})),this._labIcon.svgstr=s,this.trigger("change")}}I.model_name="IconModel",I.model_module=d.p,I.model_module_version=d.e,I.view_name="IconView",I.view_module=d.p,I.view_module_version=d.e;var z,W,T,A=t(88);!function(e){e.snippet="custom-menu:snippet",e.run_snippet="custom-menu:run-snippet"}(z||(z={}));class B extends l.WidgetModel{defaults(){return{...super.defaults(),_model_name:B.model_name,_model_module:B.model_module,_model_module_version:B.model_module_version}}initialize(e,s){super.initialize(e,s),this.on("msg:custom",this._onMessage.bind(this)),this._addMenuCommand(z.snippet,"Insert snippet in current cell",this._insertInActiveCell.bind(this)),this._addMenuCommand(z.run_snippet,"Insert snippet in current cell and run it",this._insertInActiveCellAndRun.bind(this))}async _onMessage(e){switch(e.func){case"addMenu":this.addMenu(e.payload);break;case"removeMenu":this.removeMenu(e.payload)}}createMenuFromSpec(e,s,t){const o=new b.Menu({commands:this.commands});if(o.title.label=e,t&&(o.title.className&&(o.title.className+=" "),o.title.className+=t,o.addClass(t)),null===s)return o;if("function"!=typeof s[Symbol.iterator])return console.log("unknown menu type '"+s+"'."),null;for(const e of s)if("submenu"===e.type){const s=this.createMenuFromSpec(e.name,e.payload,t);o.addItem({type:"submenu",submenu:s})}else"command"===e.type?o.addItem({type:"command",command:e.payload,args:{}}):"separator"===e.type?o.addItem({type:"separator"}):console.log("unknown menu type '"+e.type+"'.");return o}hasMenu(e){return this.mainMenu.menus.findIndex(((s,t,o)=>s.title.label===e))>=0}addMenu(e){const{title:s,spec:t,className:o}=e;if(this.hasMenu(s))console.log("menu '"+s+"' already exists.");else{const e=this.mainMenu.helpMenu.rank-1,n=this.createMenuFromSpec(s,t,o);this.mainMenu.addMenu(n,!0,{rank:e}),W.customMenus.set(s,n),n.activate()}this._sendMenuList()}removeMenu(e){const s=e.title,t=W.customMenus.get(s);void 0===t?console.log("unknown menu '"+s+"'."):(W.customMenus.delete(s),this.mainMenu.removeMenu(t),this._sendMenuList())}_addMenuCommand(e,s,t){this.commands.hasCommand(e)&&W.customCommands.get(e).dispose();const o=e=>!e.isDisposed&&!!this.comm&&this.comm_live,n=this.commands.addCommand(e,{caption:null,label:s,iconClass:null,icon:null,execute:e=>{this.comm_live?t(e):n.dispose()},isEnabled:()=>o(n),isVisible:()=>o(n)});W.customCommands.set(e,n)}_sendMenuList(){this.set("_menu_list",W.customMenus.keys()),this.save_changes()}get commands(){return B.commands}get mainMenu(){return B.mainMenu}get notebookPanel(){return B.notebookTracker.currentWidget}get activeCell(){return B.notebookTracker.activeCell}async _insertInActiveCell(e){if(this.activeCell||await A.NotebookActions.insertBelow(this.notebookPanel.content),await A.NotebookActions.focusActiveCell(this.notebookPanel.content,{waitUntilReady:!0}),this.activeCell){const s=this.activeCell.editor,t={column:0,line:0},o={column:s.getLine(s.lineCount-1).length,line:s.lineCount-1};s.focus(),s.setSelection({start:t,end:o}),"string"==typeof e?s.replaceSelection(e):"function"==typeof e[Symbol.iterator]?s.replaceSelection(e.join("\n")):s.replaceSelection(typeof e),await A.NotebookActions.changeCellType(this.notebookPanel.content,"code")}}async _insertInActiveCellAndRun(e){if(await this._insertInActiveCell(e),this.notebookPanel){const{context:e,content:s}=this.notebookPanel;await A.NotebookActions.run(s,e.sessionContext),await A.NotebookActions.selectBelow(this.notebookPanel.content)}else console.log("no current widget")}}B.serializers={...l.WidgetModel.serializers},B.model_name="CustomMenuModel",B.model_module=d.p,B.model_module_version=d.e,function(e){e.customCommands=new i.ObservableMap,e.customMenus=new i.ObservableMap}(W||(W={}));class L extends l.WidgetModel{defaults(){return{...super.defaults(),_model_name:L.model_name,_model_module:L.model_module,_model_module_version:L.model_module_version}}initialize(e,s){super.initialize(e,s),this.on("msg:custom",this._onMessage.bind(this))}async _onMessage(e){switch(e.func){case"addToolbarButton":await this.addToolbarButton(e.payload);break;case"removeToolbarButton":await this.removeToolbarButton(e.payload.name)}}async addToolbarButton(e){var s;const{name:t,execute:o,args:n,icon:i,iconClass:a,tooltip:d,label:m,after:r,className:u}=e;if(T.customToolbarButtons.has(t))return void console.log("button '"+t+"' already exists.");let _=null;i&&(_=i.startsWith("IPY_MODEL_")?null===(s=await(0,l.unpack_models)(i,this.widget_manager))||void 0===s?void 0:s.labIcon:S.LabIcon.resolve({icon:i}),_||console.log("icon "+i+" not found"));const c=new g.ToolbarButton({icon:_,iconClass:a,onClick:()=>{this.commands.execute(o,n)},tooltip:d,label:m});u&&u.split(/\s+/).forEach(c.addClass.bind(c)),this.toolbar.insertAfter(r,t,c)&&console.log("button '"+t+"' has been added."),T.customToolbarButtons.set(t,c),this._sendToolbarButtonList()}async removeToolbarButton(e){const s=T.customToolbarButtons.get(e);void 0===s?console.log("unknown button '"+e+"'."):(s.parent=null,T.customToolbarButtons.delete(e)),this._sendToolbarButtonList()}_sendToolbarButtonList(){this.set("_toolbar_buttons",T.customToolbarButtons.keys()),this.save_changes()}get commands(){return L.commands}get toolbar(){return L.notebookTracker.currentWidget.toolbar}}L.serializers={...l.WidgetModel.serializers},L.model_name="CustomToolbarModel",L.model_module=d.p,L.model_module_version=d.e,function(e){e.customToolbarButtons=new i.ObservableMap}(T||(T={}))}}]);