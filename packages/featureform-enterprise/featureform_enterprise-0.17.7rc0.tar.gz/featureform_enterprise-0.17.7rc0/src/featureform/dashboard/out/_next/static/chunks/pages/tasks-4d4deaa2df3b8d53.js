(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3689],{1849:function(a,b,c){"use strict";var d=c(64836);b.Z=void 0;var e=d(c(64938)),f=c(85893),g=(0,e.default)((0,f.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");b.Z=g},42761:function(a,b,c){"use strict";var d=c(64836);b.Z=void 0;var e=d(c(64938)),f=c(85893),g=(0,e.default)((0,f.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),"Search");b.Z=g},56670:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasks",function(){return c(40947)}])},40947:function(a,b,c){"use strict";c.r(b),c.d(b,{default:function(){return _}});var d=c(85893),e=c(67294),f=c(11163),g=c(47568),h=c(14924),i=c(26042),j=c(69396),k=c(34051),l=c.n(k),m=c(1849),n=c(42761),o=c(99226),p=c(83321),q=c(15861),r=c(87918),s=c(94054),t=c(33841),u=c(31085),v=c(18972),w=c(61903),x=c(87109),y=c(93946),z=c(34386),A=c(98456),B=c(13264),C=c(310),D=c(35133),E=c(82670),F=c(29815),G=c(14564),H=c(57850);function I(a){var b,c,e=a.status;return(0,d.jsx)(r.Z,{sx:{backgroundColor:null!==(b=({3:"#D1FAD0",2:"#FAECD0",1:"#FAECD0",4:"#FAD0F6",5:"#D6D0FA"})[e])&& void 0!==b?b:D.Cj},size:"small",label:null!==(c=({0:"No Status",1:"Created",2:"Pending",3:"Ready",4:"Failed",5:"Running"})[e])&& void 0!==c?c:"No Status"})}var J=c(50594),K=c(86886),L=c(23795),M=c(20999),N=c(81143),O="#B3B5DC",P="TaskRunCard",Q={taskCardBox:"".concat(P,"-taskCardBox"),inputRow:"".concat(P,"-inputRow"),activeButton:"".concat(P,"-activeButton"),activeChip:"".concat(P,"-activeChip"),inactiveChip:"".concat(P,"-inactiveChip"),inactiveButton:"".concat(P,"-inactiveButton"),buttonText:"".concat(P,"-buttonText"),filterInput:"".concat(P,"-filterInput"),search:"".concat(P,"-search")},R=(0,B.Z)("div")(function(){var a;return a={},(0,h.Z)(a,"& .".concat(Q.taskCardBox),{height:750,width:700}),(0,h.Z)(a,"& .".concat(Q.inputRow),{paddingBottom:10,"& button":{height:40}}),(0,h.Z)(a,"& .".concat(Q.activeButton),{color:"#000000",fontWeight:"bold"}),(0,h.Z)(a,"& .".concat(Q.activeChip),{color:D.Cj,background:"#7A14E5",height:20,width:25,fontSize:11}),(0,h.Z)(a,"& .".concat(Q.inactiveChip),{color:D.Cj,background:"#BFBFBF",height:20,width:25,fontSize:11}),(0,h.Z)(a,"& .".concat(Q.inactiveButton),{color:"#000000",background:D.Cj}),(0,h.Z)(a,"& .".concat(Q.buttonText),{textTransform:"none",paddingRight:10}),(0,h.Z)(a,"& .".concat(Q.filterInput),{minWidth:225,height:40}),(0,h.Z)(a,"& .".concat(Q.search),{background:"#101205",width:350,"& label":{color:O},"& label.Mui-focused":{color:O},"& .MuiOutlinedInput-root":{color:O,borderColor:O,"& fieldset":{borderColor:O},"&.Mui-focused fieldset":{borderColor:O}}}),a});function S(a){var b,c,h,i,j,k=a.handleClose,n=a.taskId,p=a.taskRunId,r=(0,C.E)(),s=(0,f.useRouter)(),t=(0,e.useState)({}),u=t[0],v=t[1],x=(0,e.useState)(!0),B=x[0],D=x[1],E=[{field:"runId",headerName:"runId",width:1,editable:!1,sortable:!1,filterable:!1,hide:!0,hideable:!1,display:!1},{field:"startTime",headerName:"Start Time",sortable:!1,filterable:!1,width:200,valueGetter:function(a){var b,c;return(c=new Date(null==a?void 0:null===(b=a.row)|| void 0===b?void 0:b.startTime)).toLocaleString()}},{field:"status",headerName:"Status",width:200,align:"right",editable:!1,sortable:!1,filterable:!1,renderCell:function(a){var b;return(0,d.jsx)(I,{status:null==a?void 0:null===(b=a.row)|| void 0===b?void 0:b.status})}},{field:"link",headerName:"Link",width:250,editable:!1,sortable:!1,filterable:!1,valueGetter:function(){return""}},],F=function(){var a,b,c,d,e,f,g=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},h=null==g?void 0:null===(a=g.taskRun)|| void 0===a?void 0:null===(b=a.target)|| void 0===b?void 0:b.name,i=null==g?void 0:null===(c=g.taskRun)|| void 0===c?void 0:null===(d=c.target)|| void 0===d?void 0:d.variant,j=M.Z[N.nf[null==g?void 0:null===(e=g.taskRun)|| void 0===e?void 0:null===(f=e.target)|| void 0===f?void 0:f.type]];if(h&&i&&j){var k="".concat(j.urlPath,"/").concat(h,"?variant=").concat(i);s.push(k)}else console.warn("handleResourceClick() could not create resource link. name(".concat(h,") variant(").concat(i,") resourceType(").concat(null==j?void 0:j.urlPath,")"))};(0,e.useEffect)(function(){var a,b=null;return(a=(0,g.Z)(l().mark(function a(){var c;return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!(n&&p&&B)){a.next=6;break}return a.next=3,r.getTaskRunDetails(n,p);case 3:v(c=a.sent),b=setTimeout(function(){D(!1)},750);case 6:case"end":return a.stop()}},a)})),function(){return a.apply(this,arguments)})(),function(){b&&clearTimeout(b)}},[n,p,B,r]);var G=function(){B||D(!0)};return(0,d.jsx)(R,{children:(0,d.jsxs)(o.Z,{className:Q.taskCardBox,children:[(0,d.jsxs)(o.Z,{style:{float:"right"},children:[(0,d.jsx)(z.Z,{title:"Refresh card",placement:"bottom",children:(0,d.jsx)(y.Z,{variant:"",size:"large",onClick:G,children:B?(0,d.jsx)(A.Z,{size:".75em"}):(0,d.jsx)(m.Z,{"data-testid":"taskRunRefreshIcon"})})}),(0,d.jsx)(y.Z,{variant:"",size:"large",onClick:function(){return k()},children:(0,d.jsx)(J.Z,{})})]}),(0,d.jsxs)(K.ZP,{style:{padding:10},container:!0,children:[(0,d.jsx)(K.ZP,{item:!0,xs:7,justifyContent:"flex-start",children:(0,d.jsx)(q.Z,{variant:"h5",children:(0,d.jsx)(L.Z,{style:{cursor:"pointer"},onClick:function(){return F(u)},children:null!==(h=null==u?void 0:null===(b=u.taskRun)|| void 0===b?void 0:b.name)&& void 0!==h?h:""})})}),(0,d.jsx)(K.ZP,{item:!0,xs:4,justifyContent:"center",children:(0,d.jsxs)(q.Z,{variant:"h6",children:[(0,d.jsx)("strong",{children:"Status:"})," ",(0,d.jsx)(I,{status:null!==(i=null==u?void 0:null===(c=u.taskRun)|| void 0===c?void 0:c.status)&& void 0!==i?i:""})]})}),(0,d.jsx)(K.ZP,{item:!0,xs:12,justifyContent:"flex-start",style:{paddingTop:20},children:(0,d.jsx)(q.Z,{variant:"h6",children:"Logs/Errors"})}),(0,d.jsx)(K.ZP,{item:!0,xs:12,justifyContent:"flex-start",children:(0,d.jsx)(w.Z,{style:{width:"100%"},variant:"filled",disabled:!0,value:function(){var a,b,c=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{},d="";return(null==c?void 0:null===(a=c.taskRun)|| void 0===a?void 0:a.logs)&&(d+=c.taskRun.logs.join("\n")),(null==c?void 0:null===(b=c.taskRun)|| void 0===b?void 0:b.error)&&(d+="\n"+c.taskRun.error),d}(u),multiline:!0,minRows:3})}),(0,d.jsx)(K.ZP,{item:!0,xs:12,justifyContent:"flex-start",style:{paddingTop:20},children:(0,d.jsx)(q.Z,{variant:"h6",children:"Other Runs"})}),(0,d.jsx)(K.ZP,{item:!0,xs:12,justifyContent:"flex-start"}),(0,d.jsx)(K.ZP,{item:!0,xs:12,justifyContent:"center",children:(0,d.jsx)(H._,{density:"compact",autoHeight:!0,"aria-label":"Other Runs",sx:{"& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-columnHeaderTitle":{fontWeight:"bold"}},rows:null!==(j=null==u?void 0:u.otherRuns)&& void 0!==j?j:[],disableColumnMenu:!0,rowsPerPageOptions:[5],columns:E,initialState:{pagination:{paginationModel:{page:0,pageSize:5}}},pageSize:5,getRowId:function(a){return a.runId}})})]})]})})}function T(a){var b=a.taskRunList,c=a.setPage,f=void 0===c?function(){return null}:c,g=a.count,h=a.currentPage,i=function(){l(!1)},j=(0,e.useState)(!1),k=j[0],l=j[1],m=(0,e.useState)({taskRun:{taskId:0,runId:0}}),n=m[0],o=m[1],p={0:"Resource Creation",1:"Health Check",2:"Metrics"},q=function(a){return(0,E.Z)(a,Date)&&!isNaN(a)},r=(0,F.Z)(void 0===b?[]:b).sort(function(a,b){var c,d,e=new Date(null===(c=a.taskRun)|| void 0===c?void 0:c.startTime),f=new Date(null===(d=b.taskRun)|| void 0===d?void 0:d.startTime);return q(e)&&q(f)?f.getTime()-e.getTime():(console.warn("A task start time prop is invalid:",null==a?void 0:a.taskRun,null==b?void 0:b.taskRun),0)}),s=function(a){var b=null==r?void 0:r.find(function(b){return b.taskRun.taskId===a.row.taskRun.taskId&&b.taskRun.runId===a.row.taskRun.runId});o(null!=b?b:{taskRun:{taskId:0,runId:0}}),l(function(b){return n!==a.row.id||!b})},t=[{field:"id",headerName:"Id",flex:1,width:100,editable:!1,sortable:!1,filterable:!1,hide:!0},{field:"taskId",headerName:"Task Id",flex:0,width:75,editable:!1,sortable:!1,filterable:!1,hide:!1,valueGetter:function(a){var b,c;return null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.taskRun)|| void 0===c?void 0:c.taskId}},{field:"runId",headerName:"Run Id",flex:0,width:75,editable:!1,sortable:!1,filterable:!1,hide:!1,valueGetter:function(a){var b,c;return null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.taskRun)|| void 0===c?void 0:c.runId}},{field:"name",headerName:"Task Name",flex:1,minWidth:250,editable:!1,sortable:!1,filterable:!1,valueGetter:function(a){var b,c;return null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.taskRun)|| void 0===c?void 0:c.name},hide:!0},{field:"resource",headerName:"Resource",flex:1,minWidth:150,editable:!1,sortable:!1,filterable:!1,valueGetter:function(a){var b,c,d;return null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.task)|| void 0===c?void 0:null===(d=c.target)|| void 0===d?void 0:d.name}},{field:"variant",headerName:"Variant",flex:1,minWidth:175,editable:!1,sortable:!1,filterable:!1,valueGetter:function(a){var b,c,d;return null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.task)|| void 0===c?void 0:null===(d=c.target)|| void 0===d?void 0:d.variant}},{field:"jobType",headerName:"Task Type",flex:1,minWidth:150,editable:!1,sortable:!1,filterable:!1,valueGetter:function(a){var b,c,d;return null!==(d=p[null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.task)|| void 0===c?void 0:c.type])&& void 0!==d?d:""}},{field:"status",headerName:"Status",flex:0,minWidth:75,editable:!1,sortable:!1,filterable:!1,valueGetter:function(a){var b,c;return null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.taskRun)|| void 0===c?void 0:c.status},renderCell:function(a){var b,c;return(0,d.jsx)(I,{status:null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.taskRun)|| void 0===c?void 0:c.status})}},{field:"startTime",headerName:"Start Time",flex:1,sortable:!1,filterable:!1,minWidth:175,valueGetter:function(a){var b,c,d;return(d=new Date(null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.taskRun)|| void 0===c?void 0:c.startTime)).toLocaleString()}},{field:"endTime",headerName:"End Time",flex:1,sortable:!1,filterable:!1,minWidth:175,valueGetter:function(a){var b,c,d,e=(d=new Date(null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.taskRun)|| void 0===c?void 0:c.endTime)).toLocaleString();return e.startsWith("12/31/1")?"---":e}},{field:"triggeredBy",headerName:"Triggered By",flex:1,width:125,editable:!1,valueGetter:function(a){var b,c,d;return null==a?void 0:null===(b=a.row)|| void 0===b?void 0:null===(c=b.taskRun)|| void 0===c?void 0:null===(d=c.trigger)|| void 0===d?void 0:d.triggerName},hide:!0},],u=U(null==r?void 0:r.length);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(G.ZP,{open:k,anchorReference:"anchorPosition",anchorPosition:{top:250,left:Number.MAX_SAFE_INTEGER},onClose:i,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:(0,d.jsx)(S,{handleClose:i,taskId:n.taskRun.taskId,taskRunId:n.taskRun.runId})}),(0,d.jsx)(H._,{autoHeight:!0,sx:{minWidth:300,"& .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-row:hover":{cursor:"pointer"},"& .MuiDataGrid-columnHeaderTitle":{fontWeight:"bold"}},onRowClick:s,rowsPerPageOptions:[15],disableColumnMenu:!0,density:"compact","aria-label":"Task Runs",rows:null!=r?r:[],columns:t,hideFooterSelectedRowCount:!0,rowCount:void 0===g?0:g,page:void 0===h?0:h,paginationMode:"server",onPageChange:function(a){f(a)},pageSize:u,getRowId:function(a){return a.id}})]})}function U(){var a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:0,b=5;return a>=10?15:a>=5?10:5}var V="TableDataWrapper",W={inputRow:"".concat(V,"-inputRow"),activeButton:"".concat(V,"-activeButton"),activeChip:"".concat(V,"-activeChip"),inactiveChip:"".concat(V,"-inactiveChip"),inactiveButton:"".concat(V,"-inactiveButton"),buttonText:"".concat(V,"-buttonText"),filterInput:"".concat(V,"-filterInput"),taskCardBox:"".concat(V,"-taskCardBox")},X=(0,B.Z)("div")(function(){var a;return a={},(0,h.Z)(a,"& .".concat(W.inputRow),{paddingBottom:10,"& button":{height:40}}),(0,h.Z)(a,"& .".concat(W.activeButton),{color:"#000000",fontWeight:"bold"}),(0,h.Z)(a,"& .".concat(W.activeChip),{color:D.Cj,background:"#7A14E5",height:20,width:25,fontSize:11}),(0,h.Z)(a,"& .".concat(W.inactiveChip),{color:D.Cj,background:"#BFBFBF",height:20,width:25,fontSize:11}),(0,h.Z)(a,"& .".concat(W.inactiveButton),{color:"#000000",background:D.Cj}),(0,h.Z)(a,"& .".concat(W.buttonText),{textTransform:"none",paddingRight:10}),(0,h.Z)(a,"& .".concat(W.filterInput),{minWidth:225,height:40}),(0,h.Z)(a,"& .".concat(W.taskCardBox),{height:750,width:700}),a});function Y(a){var b=a.taskName,c=void 0===b?"":b,f=a.taskVariant,h=(0,C.E)(),k="ACTIVE",B="COMPLETE",D="DATE",E=Object.freeze({status:"ALL",sortBy:D,searchText:"",variantSearch:"",pageSize:15,offset:0}),F=(0,e.useState)((0,j.Z)((0,i.Z)({},E),{searchText:c,variantSearch:void 0===f?"":f})),G=F[0],H=F[1],I=(0,e.useState)(c),J=I[0],K=I[1],L=(0,e.useState)(0),M=L[0],N=L[1],O=(0,e.useState)([]),P=O[0],Q=O[1],R=(0,e.useState)(!0),S=R[0],U=R[1],V=(0,e.useState)(),Y=V[0],Z=(0,e.useState)(),$=Z[0],_=(0,e.useState)(),aa=_[0];(0,e.useEffect)(function(){var a;(a=(0,g.Z)(l().mark(function a(){var b,c,d,e;return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!S){a.next=10;break}return a.next=3,h.getTaskRuns(G);case 3:return Q(null!==(c=null==(b=a.sent)?void 0:b.list)&& void 0!==c?c:[]),N(null!==(d=null==b?void 0:b.count)&& void 0!==d?d:0),e=setTimeout(function(){U(!1)},750),a.abrupt("return",function(){e&&clearTimeout(e)});case 10:case"end":return a.stop()}},a)})),function(){return a.apply(this,arguments)})()},[G,S]);var ab=function(){var a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:"ALL";H((0,j.Z)((0,i.Z)({},G),{status:a})),U(!0)},ac=function(a){var b,c,d=null!==(c=null==a?void 0:null===(b=a.target)|| void 0===b?void 0:b.value)&& void 0!==c?c:"";H((0,j.Z)((0,i.Z)({},G),{sortBy:d})),U(!0)},ad=function(){var a=arguments.length>0&& void 0!==arguments[0]?arguments[0]:"";H((0,j.Z)((0,i.Z)({},G),{searchText:a,variantSearch:""})),U(!0)},ae=function(){S||U(!0)},af=function(a){H((0,j.Z)((0,i.Z)({},G),{offset:a})),U(!0)},ag=function(){H((0,i.Z)({},E)),K(""),U(!0)};return(0,d.jsxs)(X,{children:[(0,d.jsxs)(o.Z,{className:W.inputRow,children:[(0,d.jsxs)(p.Z,{variant:"text",className:"ALL"===G.status?W.activeButton:W.inactiveButton,onClick:function(){return ab("ALL")},children:[(0,d.jsx)(q.Z,{variant:"button",className:W.buttonText,children:"All"}),(0,d.jsx)(r.Z,{label:Y,"data-testid":"allId",className:"ALL"===G.status?W.activeChip:W.inactiveChip})]}),(0,d.jsxs)(p.Z,{variant:"text",className:G.status===k?W.activeButton:W.inactiveButton,onClick:function(){return ab(k)},children:[(0,d.jsx)(q.Z,{variant:"button",className:W.buttonText,children:"Active"}),(0,d.jsx)(r.Z,{label:$,"data-testid":"activeId",className:G.status===k?W.activeChip:W.inactiveChip})]}),(0,d.jsxs)(p.Z,{variant:"text",className:G.status===B?W.activeButton:W.inactiveButton,onClick:function(){return ab(B)},children:[(0,d.jsx)(q.Z,{variant:"button",className:W.buttonText,children:"Complete"}),(0,d.jsx)(r.Z,{label:aa,"data-testid":"completeId",className:G.status===B?W.activeChip:W.inactiveChip})]}),(0,d.jsxs)(o.Z,{style:{float:"right"},children:[(0,d.jsxs)(s.Z,{style:{paddingRight:"15px"},children:[(0,d.jsx)(t.Z,{shrink:!0,id:"sortId",children:"Sort By"}),(0,d.jsxs)(u.Z,{value:G.sortBy,onChange:ac,label:"Sort By",notched:!0,className:W.filterInput,children:[(0,d.jsx)(v.Z,{value:"STATUS",children:"Status"}),(0,d.jsx)(v.Z,{value:D,children:"Date"}),(0,d.jsx)(v.Z,{value:"RUN_ID",children:"RunId"})]})]}),(0,d.jsx)(s.Z,{children:(0,d.jsx)(w.Z,{size:"small",InputLabelProps:{shrink:!0},label:"Search",onChange:function(a){var b,c=a.target.value;if(""===c){K(c),ad("");return}var d=null!==(b=a.target.value)&& void 0!==b?b:"";d.trim()&&K(d)},value:J,onKeyDown:function(a){"Enter"===a.key&&J&&ad(J)},InputProps:{endAdornment:(0,d.jsx)(x.Z,{position:"end",children:(0,d.jsx)(y.Z,{children:(0,d.jsx)(n.Z,{})})})},inputProps:{"aria-label":"search","data-testid":"searcInputId"}})}),(0,d.jsx)(z.Z,{title:"Refresh table",placement:"top",children:(0,d.jsx)(y.Z,{size:"large",onClick:ae,children:S?(0,d.jsx)(A.Z,{size:".85em","data-testid":"circularProgressId"}):(0,d.jsx)(m.Z,{"data-testid":"refreshIcon"})})}),(0,d.jsx)(z.Z,{title:"Clear filter inputs",placement:"top",children:(0,d.jsx)(y.Z,{size:"large",onClick:ag,children:(0,d.jsx)("img",{alt:"CLEAR","data-testid":"clearIcon",src:"/static/clearIcon.svg"})})})]})]}),(0,d.jsx)(T,{count:M,currentPage:G.offset,setPage:af,taskRunList:null==P?void 0:P.map(function(a){return(0,j.Z)((0,i.Z)({},a),{id:a.taskRun.taskId+"."+a.taskRun.runId})})})]})}var Z=(0,B.Z)("div")(function(){return{padding:20}});function $(a){var b=a.name,c=a.variant;return(0,d.jsxs)(Z,{children:[(0,d.jsx)("h3",{children:"Task Runs"}),(0,d.jsx)(Y,{taskName:void 0===b?"":b,taskVariant:void 0===c?"":c})]})}var _=function(){var a=(0,f.useRouter)().query,b=a.name,c=a.variant;return(0,d.jsx)($,{name:b,variant:c})}}},function(a){a.O(0,[9774,2888,179],function(){var b;return a(a.s=56670)}),_N_E=a.O()}])
//# sourceMappingURL=tasks-4d4deaa2df3b8d53.js.map