import{r as d,j as e}from"./@radix-Cdvw4jJ8.js";import{S as z}from"./plus-Cl0_rCVF.js";import{S as g}from"./refresh-BcTM09NW.js";import{S as y,P as C}from"./SearchField-DY6-UbRT.js";import{f as B,i as I,F as M,j as $,J as T,r as h,T as q,q as O,s as Q,t as G,v as p,B as m,x as v,g as x,aj as K,ak as U,G as P,a8 as V,a9 as Z,aa as J,bd as W,A,D as X,l as Y,m as ee,p as se,an as b,b1 as te,C as S,L as k,ai as ae,w as ne,z as u,k as re}from"./index-BFqbGSck.js";import{c as le,b as F}from"./@tanstack-5gTMR7G2.js";import{L as j,c as ie,f as oe}from"./@react-router-DeDfXbUF.js";import{D as N}from"./DisplayDate-8RESqe5H.js";import{S as ce}from"./SheetHeader-CASpN2Lz.js";import{S as de}from"./Tabs-DNSKblCM.js";import{u as me}from"./all-pipeline-runs-query-DCdax7I5.js";import{S as xe}from"./terminal-XFL_4QN-.js";import{g as he,E as pe}from"./ExecutionStatus-CWreILP0.js";import{s as ue}from"./index-BjUu1mP4.js";import{C as je}from"./ComponentBadge-CDgdd0Ks.js";import{S as E}from"./trash-DP6Tpp_E.js";import{D as fe,a as ge}from"./DeleteAlertDialog-VIOMDLmx.js";import{I as ye}from"./Infobox-CGxFvqzi.js";import{c as Ce,u as ve}from"./bulk-delete-C_kpIB9A.js";async function Ne({componentId:s}){const t=I($.components.detail(s)),a=await B(t,{method:"DELETE"});if(!a.ok){const n=await a.json().then(r=>Array.isArray(r.detail)?r.detail[1]:r.detail).catch(()=>`Error while deleting component ${s}`);throw new M({status:a.status,statusText:a.statusText,message:n})}return a.json()}function we(s){return le({...s,mutationFn:async({componentId:t})=>Ne({componentId:t})})}const{ContextProvider:es,useContext:w}=Ce();function R(){const{setRowSelection:s}=w(),{mutateAsync:t}=we();async function a(n){await t({componentId:n})}return ve({deleteFn:a,queryKeyToInvalidate:T.all,setRowSelection:s})}const be=s=>d.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...s},d.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 4C14.4477 4 14 3.55228 14 3C14 2.44772 14.4477 2 15 2H21C21.5523 2 22 2.44772 22 3V9C22 9.55228 21.5523 10 21 10C20.4477 10 20 9.55228 20 9V5.41421L14.7071 10.7071C14.3166 11.0976 13.6834 11.0976 13.2929 10.7071C12.9024 10.3166 12.9024 9.68342 13.2929 9.29289L18.5858 4H15ZM10.7071 13.2929C11.0976 13.6834 11.0976 14.3166 10.7071 14.7071L5.41421 20H9C9.55228 20 10 20.4477 10 21C10 21.5523 9.55228 22 9 22H3C2.73478 22 2.48043 21.8946 2.29289 21.7071C2.10536 21.5196 2 21.2652 2 21L2 15C2 14.4477 2.44772 14 3 14C3.55229 14 4 14.4477 4 15L4 18.5858L9.29289 13.2929C9.68342 12.9024 10.3166 12.9024 10.7071 13.2929Z"})),Se=[{id:"name",header:"Run",accessorFn:s=>{var t;return{id:s.id,name:s.name,status:(t=s.body)==null?void 0:t.status}},cell:({getValue:s})=>{const{name:t,status:a,id:n}=s();return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(xe,{className:`h-5 w-5 ${he(a)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{to:h.projects.runs.detail(n),className:"flex items-center gap-1",children:e.jsx("span",{className:"text-text-md font-semibold text-theme-text-primary",children:t})}),e.jsx(q,{children:e.jsxs(O,{children:[e.jsx(Q,{className:"hover:text-theme-text-brand hover:underline",children:e.jsx(pe,{status:a})}),e.jsx(G,{className:"z-20 capitalize",children:a})]})}),e.jsx(p,{copyText:t})]}),e.jsxs(j,{to:h.projects.runs.detail(n),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:n.split("-")[0]}),e.jsx(p,{copyText:n})]})]})]})}},{id:"created-at",header:"Created at",accessorFn:s=>{var t;return{date:(t=s.body)==null?void 0:t.created}},cell:({getValue:s})=>{const{date:t}=s();return e.jsx("div",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(N,{dateString:t})})}}];function ke({componentId:s}){const[t,a]=d.useState(void 0),[n,r]=d.useState(1),o={name:t,page:n},{data:i,refetch:c}=me({params:{...o,stack_component:s,sort_by:"desc:updated"}});return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(y,{inMemoryHandler:l=>{r(1),l||a(void 0),a(`contains:${l}`)},searchParams:{}})}),e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs(m,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>c(),children:[e.jsx(g,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:i?e.jsx(v,{columns:Se,data:i.items}):e.jsx(x,{className:"h-[500px] w-full"})}),i?i.total_pages>1&&e.jsx(C,{inMemoryHandler:r,searchParams:{},paginate:i}):e.jsx(x,{className:"h-[36px] w-[300px]"})]})]})})}function De(){return[{id:"name",header:"Stack",accessorFn:s=>s.name,cell:({row:s})=>{const{name:t,id:a}=s.original;return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(K,{type:"square",size:"md",children:e.jsx(U,{size:"md",children:t[0]})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h2",{className:"text-text-md font-semibold",children:t})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:a.split("-")[0]}),e.jsx(p,{copyText:a})]})]})]})}},{id:"author",header:"Author",accessorFn:s=>{var t;return{author:(t=s.resources)==null?void 0:t.user}},cell:({getValue:s})=>{const{author:t}=s();return t?e.jsx(P,{username:t.name||"default"}):null}},{id:"created",header:"Created at",accessorFn:s=>{var t;return(t=s.body)==null?void 0:t.created},cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(N,{dateString:s()})})}]}function Te({componentId:s}){const[t,a]=d.useState(void 0),[n,r]=d.useState(1),o={name:t,page:n},{refetch:i,data:c}=F(ue.stackList({...o,component_id:s,sort_by:"desc:updated"}));return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(y,{inMemoryHandler:l=>{r(1),l||a(void 0),a(`contains:${l}`)},searchParams:{}})}),e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs(m,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>i(),children:[e.jsx(g,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:c?e.jsx(v,{columns:De(),data:c.items}):e.jsx(x,{className:"h-[500px] w-full"})}),c?c.total_pages>1&&e.jsx(C,{inMemoryHandler:r,searchParams:{},paginate:c}):e.jsx(x,{className:"h-[36px] w-[300px]"})]})]})})}function D({children:s,onOpenChange:t,componentId:a}){return e.jsxs(V,{onOpenChange:t,children:[e.jsx(Z,{asChild:!0,children:s}),e.jsxs(J,{className:"w-[1000px] overflow-y-auto",children:[e.jsx(ce,{className:"gap-0.5",children:e.jsx(m,{className:"flex aspect-square items-center justify-center p-0",intent:"secondary",asChild:!0,emphasis:"minimal",children:e.jsxs(j,{to:h.components.detail(a),children:[e.jsx(be,{className:"h-5 w-5 shrink-0 fill-neutral-500"}),e.jsx("span",{className:"sr-only",children:"Expand component detail to page"})]})})}),e.jsxs("div",{className:"@container",children:[e.jsx(W,{isPanel:!0,componentId:a}),e.jsx(de,{isPanel:!0,runsTabContent:e.jsx(ke,{componentId:a}),stacksTabContent:e.jsx(Te,{componentId:a}),componentId:a})]})]})]})}function L({deleteHandler:s}){return e.jsx(fe,{title:"Delete Components",handleDelete:s,children:e.jsxs(ge,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."}),e.jsx(ye,{className:"mt-4 text-theme-text-primary",children:"If a component is still part of a stack, it will not be deleted."})]})})}function Pe({deleteHandler:s,open:t,setOpen:a}){return e.jsx(A,{open:t,onOpenChange:a,children:e.jsx(L,{deleteHandler:s})})}function Ae({id:s}){const[t,a]=d.useState(!1),n=ie(),{bulkDelete:r}=R();async function o(){await r([s]),a(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{deleteHandler:o,open:t,setOpen:a}),e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(m,{intent:"secondary",emphasis:"minimal",className:"flex aspect-square items-center justify-center p-0",children:e.jsx(ee,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})})}),e.jsxs(se,{align:"end",sideOffset:7,children:[e.jsxs(b,{onSelect:()=>n(h.components.edit(s)),className:"cursor-pointer space-x-2",children:[e.jsx(te,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Edit"})]}),e.jsxs(b,{onClick:()=>a(!0),className:"cursor-pointer space-x-2",children:[e.jsx(E,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})]})]})]})}function Fe(){return[{id:"select",meta:{width:"1%"},header:({table:s})=>e.jsx(S,{id:"check-all",checked:s.getIsAllRowsSelected(),onCheckedChange:t=>s.toggleAllRowsSelected(t==="indeterminate"?!0:t)}),cell:({row:s})=>e.jsx(S,{id:`check-${s.id}`,checked:s.getIsSelected(),onCheckedChange:s.getToggleSelectedHandler()})},{id:"name",header:"Component",accessorKey:"name",cell:({row:s})=>{var n;const t=s.original.id,a=s.original.name;return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx("img",{width:32,height:32,src:k(((n=s.original.body)==null?void 0:n.logo_url)||""),alt:"Flavor Icon"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{componentId:t,children:e.jsx("button",{children:e.jsx("h2",{className:"text-text-md font-semibold",children:a})})}),e.jsx(p,{copyText:a})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{componentId:t,children:e.jsx("button",{className:"text-text-xs text-theme-text-secondary",children:t.split("-")[0]})}),e.jsx(p,{copyText:t})]})]})]})}},{id:"type",header:"Component Type",accessorFn:s=>{var t;return(t=s.body)==null?void 0:t.type},cell:({row:s})=>{var a;const t=((a=s.original.body)==null?void 0:a.type)||"orchestrator";return e.jsx(je,{type:t,children:ae(t)})}},{id:"flavor",header:"Flavor",accessorFn:s=>{var t;return(t=s.body)==null?void 0:t.flavor_name},cell:({row:s})=>{var a,n;const t=(a=s.original.body)==null?void 0:a.flavor_name;return e.jsxs(ne,{rounded:!1,className:"w-fit gap-1 text-theme-text-primary",color:"grey",emphasis:"minimal",children:[e.jsx("img",{width:20,height:20,src:k(((n=s.original.body)==null?void 0:n.logo_url)||""),alt:"Flavor Icon of Component"}),e.jsx("p",{children:t})]})}},{id:"author",header:"Author",accessorFn:s=>{var t,a;return(a=(t=s.resources)==null?void 0:t.user)==null?void 0:a.name},cell:({row:s})=>{var a,n;const t=(n=(a=s.original.resources)==null?void 0:a.user)==null?void 0:n.name;return t?e.jsx(P,{username:t}):null}},{id:"created",header:"Created at",accessorFn:s=>{var t;return(t=s.body)==null?void 0:t.created},cell:({row:s})=>{var t;return e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(N,{dateString:((t=s.original.body)==null?void 0:t.created)||""})})}},{id:"admin_actions",header:"",cell:({row:s})=>e.jsx(Ae,{id:s.original.id})}]}const f=1,Ee=u.object({page:u.coerce.number().min(f).optional().default(f).catch(f),name:u.string().optional(),operator:u.enum(["and","or"]).optional()});function Re(){const[s]=oe(),{page:t,name:a,operator:n}=Ee.parse({page:s.get("page")||void 0,name:s.get("name")||void 0});return{page:t,name:a,logical_operator:n}}function Le(){const{bulkDelete:s}=R(),{selectedRowCount:t,selectedRowIDs:a}=w();async function n(){await s(a)}const r=t>1?"s":"",o=`${t} Component${r} selected`;return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:o}),e.jsxs(A,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(m,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(E,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(L,{deleteHandler:n})]})]})}function ss({fixedQueryParams:s,displayCreateComponent:t=!0}){const a=Re(),{rowSelection:n,setRowSelection:r,selectedRowCount:o}=w(),i=F({...T.componentList({...a,...s,sort_by:"desc:updated"}),throwOnError:!0}),c=Fe();if(i.isError)return null;const{data:l,refetch:_}=i;return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:o>=1?e.jsx(Le,{}):e.jsx(y,{searchParams:a})}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(m,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>_(),children:[e.jsx(g,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),t&&e.jsx(m,{size:"md",asChild:!0,children:e.jsxs(j,{to:h.components.create,children:[e.jsx(z,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Component"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:l?e.jsx(v,{getRowId:H=>H.id,rowSelection:n,onRowSelectionChange:r,columns:c,data:l.items}):e.jsx(x,{className:"h-[500px] w-full"})}),l?l.total_pages>1&&e.jsx(C,{searchParams:a,paginate:l}):e.jsx(x,{className:"h-[36px] w-[300px]"})]})]})})}export{es as C,ss as S};
