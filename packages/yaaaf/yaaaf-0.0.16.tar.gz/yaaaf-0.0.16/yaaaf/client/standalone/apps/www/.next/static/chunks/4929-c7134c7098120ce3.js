"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4929,5225,2914,2730,9267],{69267:(e,t,r)=>{r.r(t),r.d(t,{useAudioRecording:()=>n});var l=r(2265),a=r(82730);function n(e){let{transcribeAudio:t,onTranscriptionComplete:r}=e,[n,i]=(0,l.useState)(!1),[s,o]=(0,l.useState)(!!t),[c,u]=(0,l.useState)(!1),[d,f]=(0,l.useState)(!1),[m,h]=(0,l.useState)(null),p=(0,l.useRef)(null);(0,l.useEffect)(()=>{(async()=>{o(!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)&&!!t)})()},[t]);let x=async()=>{u(!1),f(!0);try{a.recordAudio.stop();let e=await p.current;if(t){let l=await t(e);null==r||r(l)}}catch(e){console.error("Error transcribing audio:",e)}finally{f(!1),i(!1),m&&(m.getTracks().forEach(e=>e.stop()),h(null)),p.current=null}},g=async()=>{if(n)await x();else try{i(!0),u(!0);let e=await navigator.mediaDevices.getUserMedia({audio:!0});h(e),p.current=(0,a.recordAudio)(e)}catch(e){console.error("Error recording audio:",e),i(!1),u(!1),m&&(m.getTracks().forEach(e=>e.stop()),h(null))}};return{isListening:n,isSpeechSupported:s,isRecording:c,isTranscribing:d,audioStream:m,toggleListening:g,stopRecording:x}}},45225:(e,t,r)=>{r.r(t),r.d(t,{useAutosizeTextArea:()=>a});var l=r(2265);function a(e){let{ref:t,maxHeight:r=Number.MAX_SAFE_INTEGER,borderWidth:a=0,dependencies:n}=e,i=(0,l.useRef)(null);(0,l.useLayoutEffect)(()=>{if(!t.current)return;let e=t.current,l=2*a;null===i.current&&(i.current=e.scrollHeight-l),e.style.removeProperty("height");let n=Math.max(Math.min(e.scrollHeight,r),i.current);e.style.height="".concat(n+l,"px")},[r,t,...n])}},82730:(e,t,r)=>{r.r(t),r.d(t,{recordAudio:()=>l});let l=function(){let e=async function(t){try{let r=new MediaRecorder(t,{mimeType:"audio/webm;codecs=opus"}),l=[];return new Promise((t,a)=>{r.ondataavailable=e=>{e.data.size>0&&l.push(e.data)},r.onstop=()=>{let e=new Blob(l,{type:"audio/webm"});t(e)},r.onerror=()=>{a(Error("MediaRecorder error occurred"))},r.start(1e3),e.currentRecorder=r})}catch(e){throw Error("Failed to start recording: "+(e instanceof Error?e.message:"Unknown error occurred"))}};return e.stop=()=>{let t=e.currentRecorder;t&&"inactive"!==t.state&&t.stop(),delete e.currentRecorder},e}()},2914:(e,t,r)=>{r.r(t),r.d(t,{AudioVisualizer:()=>i});var l=r(57437),a=r(2265);let n={FFT_SIZE:512,SMOOTHING:.8,MIN_BAR_HEIGHT:2,MIN_BAR_WIDTH:2,BAR_SPACING:1,COLOR:{MIN_INTENSITY:100,MAX_INTENSITY:255,INTENSITY_RANGE:155}};function i(e){let{stream:t,isRecording:r,onClick:i}=e,s=(0,a.useRef)(null),o=(0,a.useRef)(null),c=(0,a.useRef)(null),u=(0,a.useRef)(),d=(0,a.useRef)(null),f=()=>{u.current&&cancelAnimationFrame(u.current),o.current&&o.current.close()};(0,a.useEffect)(()=>f,[]),(0,a.useEffect)(()=>{t&&r?m():f()},[t,r]),(0,a.useEffect)(()=>{let e=()=>{if(s.current&&d.current){let e=d.current,t=s.current,r=window.devicePixelRatio||1,l=e.getBoundingClientRect();t.width=(l.width-2)*r,t.height=(l.height-2)*r,t.style.width="".concat(l.width-2,"px"),t.style.height="".concat(l.height-2,"px")}};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]);let m=async()=>{try{let e=new AudioContext;o.current=e;let r=e.createAnalyser();r.fftSize=n.FFT_SIZE,r.smoothingTimeConstant=n.SMOOTHING,c.current=r,e.createMediaStreamSource(t).connect(r),x()}catch(e){console.error("Error starting visualization:",e)}},h=e=>{let t=Math.floor(e*n.COLOR.INTENSITY_RANGE)+n.COLOR.MIN_INTENSITY;return"rgb(".concat(t,", ").concat(t,", ").concat(t,")")},p=(e,t,r,l,a,n)=>{e.fillStyle=n,e.fillRect(t,r-a,l,a),e.fillRect(t,r,l,a)},x=()=>{if(!r)return;let e=s.current,t=null==e?void 0:e.getContext("2d");if(!e||!t||!c.current)return;let l=window.devicePixelRatio||1;t.scale(l,l);let a=c.current,i=a.frequencyBinCount,o=new Uint8Array(i),d=()=>{u.current=requestAnimationFrame(d),a.getByteFrequencyData(o),t.clearRect(0,0,e.width/l,e.height/l);let r=Math.max(n.MIN_BAR_WIDTH,e.width/l/i-n.BAR_SPACING),s=e.height/l/2,c=0;for(let e=0;e<i;e++){let l=o[e]/255,a=Math.max(n.MIN_BAR_HEIGHT,l*s);p(t,c,s,r,a,h(l)),c+=r+n.BAR_SPACING}};d()};return(0,l.jsx)("div",{ref:d,className:"h-full w-full cursor-pointer rounded-lg bg-background/80 backdrop-blur",onClick:i,children:(0,l.jsx)("canvas",{ref:s,className:"h-full w-full"})})}},56089:(e,t,r)=>{r.r(t),r.d(t,{InterruptPrompt:()=>s});var l=r(57437),a=r(45811),n=r(71636),i=r(55188);function s(e){let{isOpen:t,close:r}=e;return(0,l.jsx)(a.M,{children:t&&(0,l.jsxs)(n.E.div,{initial:{top:0,filter:"blur(5px)"},animate:{top:-40,filter:"blur(0px)",transition:{type:"spring",filter:{type:"tween"}}},exit:{top:0,filter:"blur(5px)"},className:"absolute left-1/2 flex -translate-x-1/2 overflow-hidden whitespace-nowrap rounded-full border bg-background py-1 text-center text-sm text-muted-foreground",children:[(0,l.jsx)("span",{className:"ml-2.5",children:"Press Enter again to interrupt"}),(0,l.jsx)("button",{className:"ml-1 mr-2.5 flex items-center",type:"button",onClick:r,"aria-label":"Close",children:(0,l.jsx)(i.Z,{className:"h-3 w-3"})})]})})}},34929:(e,t,r)=>{r.r(t),r.d(t,{MessageInput:()=>y});var l=r(57437),a=r(2265),n=r(45811),i=r(71636),s=r(58022),o=r(37085),c=r(8423),u=r(44639),d=r(85712),f=r(1149),m=r(5757),h=r(37440),p=r(69267),x=r(45225),g=r(2914),w=r(82321),b=r(97585),v=r(56089);function y(e){var t;let{placeholder:r="Ask AI...",className:i,onKeyDown:d,submitOnEnter:f=!0,stop:g,isGenerating:y,enableInterrupt:A=!0,transcribeAudio:R,...I}=e,[S,T]=(0,a.useState)(!1),[M,k]=(0,a.useState)(!1),{isListening:C,isSpeechSupported:z,isRecording:_,isTranscribing:D,audioStream:F,toggleListening:P,stopRecording:H}=(0,p.useAudioRecording)({transcribeAudio:R,onTranscriptionComplete:e=>{var t;null===(t=I.onChange)||void 0===t||t.call(I,{target:{value:e}})}});(0,a.useEffect)(()=>{y||k(!1)},[y]);let O=e=>{I.allowAttachments&&I.setFiles(t=>null===t?e:null===e?t:[...t,...e])},B=(0,a.useRef)(null),[G,Z]=(0,a.useState)(0);(0,a.useEffect)(()=>{B.current&&Z(B.current.offsetHeight)},[I.value]);let L=I.allowAttachments&&I.files&&I.files.length>0;return(0,x.useAutosizeTextArea)({ref:B,maxHeight:240,borderWidth:1,dependencies:[I.value,L]}),(0,l.jsxs)("div",{className:"relative flex w-full",onDragOver:e=>{!0===I.allowAttachments&&(e.preventDefault(),T(!0))},onDragLeave:e=>{!0===I.allowAttachments&&(e.preventDefault(),T(!1))},onDrop:e=>{if(T(!1),!0!==I.allowAttachments)return;e.preventDefault();let t=e.dataTransfer;t.files.length&&O(Array.from(t.files))},children:[A&&(0,l.jsx)(v.InterruptPrompt,{isOpen:M,close:()=>k(!1)}),(0,l.jsx)(j,{isVisible:_,onStopRecording:H}),(0,l.jsx)("div",{className:"relative flex w-full items-center space-x-2",children:(0,l.jsxs)("div",{className:"relative flex-1",children:[(0,l.jsx)("textarea",{"aria-label":"Write your prompt here",placeholder:r,ref:B,onPaste:e=>{var t;let r=null===(t=e.clipboardData)||void 0===t?void 0:t.items;if(!r)return;let l=e.clipboardData.getData("text");if(l&&l.length>500&&I.allowAttachments){e.preventDefault(),O([new File([new Blob([l],{type:"text/plain"})],"Pasted text",{type:"text/plain",lastModified:Date.now()})]);return}let a=Array.from(r).map(e=>e.getAsFile()).filter(e=>null!==e);I.allowAttachments&&a.length>0&&O(a)},onKeyDown:e=>{if(f&&"Enter"===e.key&&!e.shiftKey){var t,r,l;if(e.preventDefault(),y&&g&&A){if(M)g(),k(!1),null===(l=e.currentTarget.form)||void 0===l||l.requestSubmit();else if(I.value||I.allowAttachments&&(null===(r=I.files)||void 0===r?void 0:r.length)){k(!0);return}}null===(t=e.currentTarget.form)||void 0===t||t.requestSubmit()}null==d||d(e)},className:(0,h.cn)("z-10 w-full grow resize-none rounded-xl border border-input bg-background p-3 pr-24 text-sm ring-offset-background transition-[border] placeholder:text-muted-foreground focus-visible:border-primary focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",L&&"pb-16",i),...I.allowAttachments?(0,m.a)(I,["allowAttachments","files","setFiles"]):(0,m.a)(I,["allowAttachments"])}),I.allowAttachments&&(0,l.jsx)("div",{className:"absolute inset-x-3 bottom-0 z-20 overflow-x-scroll py-3",children:(0,l.jsx)("div",{className:"flex space-x-3",children:(0,l.jsx)(n.M,{mode:"popLayout",children:null===(t=I.files)||void 0===t?void 0:t.map(e=>(0,l.jsx)(b.FilePreview,{file:e,onRemove:()=>{I.setFiles(t=>{if(!t)return null;let r=Array.from(t).filter(t=>t!==e);return 0===r.length?null:r})}},e.name+String(e.lastModified)))})})})]})}),(0,l.jsxs)("div",{className:"absolute right-3 top-3 z-20 flex gap-2",children:[I.allowAttachments&&(0,l.jsx)(w.z,{type:"button",size:"icon",variant:"outline",className:"h-8 w-8","aria-label":"Attach a file",onClick:async()=>{O(await function(){let e=document.createElement("input");return e.type="file",e.multiple=!0,e.accept="*/*",e.click(),new Promise(t=>{e.onchange=e=>{let r=e.currentTarget.files;if(r){t(Array.from(r));return}t(null)}})}())},children:(0,l.jsx)(s.Z,{className:"h-4 w-4"})}),z&&(0,l.jsx)(w.z,{type:"button",variant:"outline",className:(0,h.cn)("h-8 w-8",C&&"text-primary"),"aria-label":"Voice input",size:"icon",onClick:P,children:(0,l.jsx)(o.Z,{className:"h-4 w-4"})}),y&&g?(0,l.jsx)(w.z,{type:"button",size:"icon",className:"h-8 w-8","aria-label":"Stop generating",onClick:g,children:(0,l.jsx)(c.Z,{className:"h-3 w-3 animate-pulse",fill:"currentColor"})}):(0,l.jsx)(w.z,{type:"submit",size:"icon",className:"h-8 w-8 transition-opacity","aria-label":"Send message",disabled:""===I.value||y,children:(0,l.jsx)(u.Z,{className:"h-5 w-5"})})]}),I.allowAttachments&&(0,l.jsx)(N,{isDragging:S}),(0,l.jsx)(E,{isRecording:_,isTranscribing:D,audioStream:F,textAreaHeight:G,onStopRecording:H})]})}function N(e){let{isDragging:t}=e;return(0,l.jsx)(n.M,{children:t&&(0,l.jsxs)(i.E.div,{className:"pointer-events-none absolute inset-0 z-20 flex items-center justify-center space-x-2 rounded-xl border border-dashed border-border bg-background text-sm text-muted-foreground",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},"aria-hidden":!0,children:[(0,l.jsx)(s.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"Drop your files here to attach them."})]})})}function A(){return(0,l.jsxs)(i.E.div,{className:"flex h-full w-full flex-col items-center justify-center rounded-xl bg-background/80 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(d.Z,{className:"h-8 w-8 animate-spin text-primary"}),(0,l.jsx)(i.E.div,{className:"absolute inset-0 h-8 w-8 animate-pulse rounded-full bg-primary/20",initial:{scale:.8,opacity:0},animate:{scale:1.2,opacity:1},transition:{duration:1,repeat:1/0,repeatType:"reverse",ease:"easeInOut"}})]}),(0,l.jsx)("p",{className:"mt-4 text-sm font-medium text-muted-foreground",children:"Transcribing audio..."})]})}function j(e){let{isVisible:t,onStopRecording:r}=e;return(0,l.jsx)(n.M,{children:t&&(0,l.jsx)(i.E.div,{initial:{top:0,filter:"blur(5px)"},animate:{top:-40,filter:"blur(0px)",transition:{type:"spring",filter:{type:"tween"}}},exit:{top:0,filter:"blur(5px)"},className:"absolute left-1/2 flex -translate-x-1/2 cursor-pointer overflow-hidden whitespace-nowrap rounded-full border bg-background py-1 text-center text-sm text-muted-foreground",onClick:r,children:(0,l.jsxs)("span",{className:"mx-2.5 flex items-center",children:[(0,l.jsx)(f.Z,{className:"mr-2 h-3 w-3"}),"Click to finish recording"]})})})}function E(e){let{isRecording:t,isTranscribing:r,audioStream:a,textAreaHeight:n,onStopRecording:i}=e;return t?(0,l.jsx)("div",{className:"absolute inset-[1px] z-50 overflow-hidden rounded-xl",style:{height:n-2},children:(0,l.jsx)(g.AudioVisualizer,{stream:a,isRecording:t,onClick:i})}):r?(0,l.jsx)("div",{className:"absolute inset-[1px] z-50 overflow-hidden rounded-xl",style:{height:n-2},children:(0,l.jsx)(A,{})}):null}y.displayName="MessageInput"}}]);