/*! For license information please see deploy.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.deploy=t():e.deploy=t()}(self,(()=>(()=>{function e(){var n,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(e,o,a,i){var s=o&&o.prototype instanceof u?o:u,l=Object.create(s.prototype);return t(l,"_invoke",function(e,t,o){var a,i,s,u=0,l=o||[],d=!1,f={p:0,n:0,v:n,a:p,f:p.bind(n,4),d:function(e,t){return a=e,i=0,s=n,f.n=t,c}};function p(e,t){for(i=e,s=t,r=0;!d&&u&&!o&&r<l.length;r++){var o,a=l[r],p=f.p,m=a[2];e>3?(o=m===t)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=n):a[0]<=p&&((o=e<2&&p<a[1])?(i=0,f.v=t,f.n=a[1]):p<m&&(o=e<3||a[0]>t||t>m)&&(a[4]=e,a[5]=t,f.n=m,i=0))}if(o||e>1)return c;throw d=!0,t}return function(o,l,m){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,m),i=l,s=m;(r=i<2?n:s)||!d;){a||(i?i<3?(i>1&&(f.n=-1),p(i,s)):f.n=s:f.v=s);try{if(u=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=n}else if((r=(d=f.n<0)?s:e.call(t,f))!==c)break}catch(e){a=n,i=1,s=e}finally{u=1}}return{value:r,done:d}}}(e,a,i),!0),l}var c={};function u(){}function l(){}function d(){}r=Object.getPrototypeOf;var f=[][a]?r(r([][a]())):(t(r={},a,(function(){return this})),r),p=d.prototype=u.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,t(p,"constructor",d),t(d,"constructor",l),l.displayName="GeneratorFunction",t(d,i,"GeneratorFunction"),t(p),t(p,i,"Generator"),t(p,a,(function(){return this})),t(p,"toString",(function(){return"[object Generator]"})),(e=function(){return{w:s,m}})()}function t(e,n,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,r,o){if(n)a?a(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r;else{var i=function(n,r){t(e,n,(function(e){return this._invoke(n,r,e)}))};i("next",0),i("throw",1),i("return",2)}},t(e,n,r,o)}function n(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var i=e.apply(t,r);function s(e){n(i,o,a,s,c,"next",e)}function c(e){n(i,o,a,s,c,"throw",e)}s(void 0)}))}}return document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("deploy-btn"),n=document.getElementById("github-pages-form"),o=document.getElementById("deploy-status-msg"),a=document.getElementById("last-deployment-time"),i=document.getElementById("history-table"),s=i?i.querySelector("tbody"):null,c=document.getElementById("commit-message"),u=document.getElementById("repo-url"),l=document.getElementById("branch"),d=document.getElementById("username"),f=document.getElementById("email"),p=document.getElementById("token"),m=document.getElementById("cname");function y(){return g.apply(this,arguments)}function g(){return(g=r(e().m((function n(){var r,i,c;return e().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,fetch("/admin/api/deploy/config?"+(new Date).getTime(),{method:"GET",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});case 1:if((r=e.v).ok){e.n=2;break}throw new Error("Server responded with status: ".concat(r.status));case 2:return e.n=3,r.json();case 3:(i=e.v).config&&(u&&(u.value=i.config.repo_url||""),l&&(l.value=i.config.branch||""),d&&(d.value=i.config.username||""),f&&(f.value=i.config.email||""),p&&(p.value=i.config.has_token?"STORED_TOKEN":""),m&&(m.value=i.config.cname||"")),i.status&&(o&&(o.textContent=i.status.configured?"Configuration ready":"Not configured"),t&&(t.disabled=!i.status.configured),a&&i.status.last_deployment&&(a.textContent=v(i.status.last_deployment)),i.status.history&&s&&h(i.status.history)),e.n=5;break;case 4:e.p=4,c=e.v,console.error("Error loading fresh configuration data:",c);case 5:return e.a(2)}}),n,null,[[0,4]])})))).apply(this,arguments)}function h(e){if(s)try{if(s.innerHTML="",!e||0===e.length){var t=document.createElement("tr");return t.innerHTML='<td colspan="2">No deployment history available</td>',void s.appendChild(t)}e.forEach((function(e){var t=document.createElement("tr");t.innerHTML="\n                    <td>".concat(v(e.timestamp),'</td>\n                    <td><span class="status-badge status-').concat(e.status,'">').concat(e.status,"</span></td>\n                "),s.appendChild(t)}))}catch(e){console.error("Error updating history table full:",e)}}function v(e){if(!e)return"Never";try{return new Date(e).toLocaleString()}catch(t){return console.error("Error formatting date:",t),e||"Unknown"}}y();try{var b=document.querySelectorAll("#history-table tbody td:first-child");b&&b.length>0&&b.forEach((function(e){e&&(e.textContent=v(e.textContent))}))}catch(e){console.error("Error formatting history dates:",e)}function E(){return(E=r(e().m((function r(a){var i,s,c,u,l,d,f,p;return e().w((function(e){for(;;)switch(e.n){case 0:if(a.preventDefault(),e.p=1,i=new FormData(n),s={},i.forEach((function(e,t){("token"!==t||"STORED_TOKEN"!==e&&e)&&(s[t]=e)})),c=n.querySelector('button[type="submit"]')){e.n=2;break}return console.error("Submit button not found"),e.a(2);case 2:return u=c.textContent||"Save Configuration",c.innerHTML='<span class="spinner"></span> Saving...',c.disabled=!0,e.p=3,e.n=4,fetch("/admin/api/deploy/config",{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},body:JSON.stringify(s)});case 4:if((l=e.v).ok){e.n=5;break}throw new Error("Server responded with status: ".concat(l.status));case 5:return e.n=6,l.json();case 6:(d=e.v).success?(alert("Configuration saved successfully"),d.is_valid&&t?(t.disabled=!1,o&&(o.textContent="Configuration ready")):o&&(o.textContent="Configuration incomplete"),d.warnings&&d.warnings.length>0&&alert("Warning: "+d.warnings.join("\n")),y()):alert("Error saving configuration: "+(d.message||"Unknown error")),e.n=8;break;case 7:e.p=7,f=e.v,console.error("Error saving configuration:",f),alert("Error saving configuration: "+f.message);case 8:return e.p=8,c&&(c.innerHTML=u,c.disabled=!1),e.f(8);case 9:e.n=11;break;case 10:e.p=10,p=e.v,console.error("Error in form submission:",p),alert("An unexpected error occurred: "+p.message);case 11:return e.a(2)}}),r,null,[[3,7,8,9],[1,10]])})))).apply(this,arguments)}function w(){return(w=r(e().m((function n(){var r,i,s,u,l,d;return e().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,r=c&&c.value?c.value.trim():"",i=t.textContent||"Deploy to GitHub Pages",t.innerHTML='<span class="spinner"></span> Deploying...',t.disabled=!0,o&&(o.textContent="Deployment in progress..."),e.p=1,e.n=2,fetch("/admin/api/deploy/start",{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},body:JSON.stringify({commit_message:r})});case 2:if((s=e.v).ok){e.n=3;break}throw new Error("Server responded with status: ".concat(s.status));case 3:return e.n=4,s.json();case 4:(u=e.v).success?(o&&(o.textContent="Deployment successful!"),u.timestamp&&a&&(a.textContent=v(u.timestamp)),C(u.history),c&&(c.value=""),alert("Site deployed successfully!"),y()):(o&&(o.textContent="Deployment failed"),alert("Error deploying site: "+(u.message||"Unknown error"))),e.n=6;break;case 5:e.p=5,l=e.v,console.error("Error deploying site:",l),o&&(o.textContent="Deployment failed"),alert("Error deploying site: "+l.message);case 6:return e.p=6,t&&(t.innerHTML=i,t.disabled=!1),e.f(6);case 7:e.n=9;break;case 8:e.p=8,d=e.v,console.error("Error in deploy handler:",d),alert("An unexpected error occurred: "+d.message),t&&(t.innerHTML="Deploy to GitHub Pages",t.disabled=!1);case 9:return e.a(2)}}),n,null,[[1,5,6,7],[0,8]])})))).apply(this,arguments)}function C(e){if(e&&e.length&&s)try{var t=e[0];s.querySelector('td[colspan="2"]')&&(s.innerHTML="");var n=document.createElement("tr");n.innerHTML="\n                <td>".concat(v(t.timestamp),'</td>\n                <td><span class="status-badge status-').concat(t.status,'">').concat(t.status,"</span></td>\n            "),s.firstChild?s.insertBefore(n,s.firstChild):s.appendChild(n)}catch(e){console.error("Error updating history table:",e)}}n&&n.addEventListener("submit",(function(e){return E.apply(this,arguments)})),t&&t.addEventListener("click",(function(){return w.apply(this,arguments)}))})),{}})()));