orchestrator:
  id: fact-checker
  strategy: sequential
  queue: orka:fact-core
  agents:
    - domain_classifier
    - is_fact
    - requires_search
    - router_search
    - duck_search
    - need_answer
    - router_answer
    - build_answer
    - validate_fact

agents:
  - id: domain_classifier
    type: openai-classification
    prompt: >
      Classify this question {{ input }} one of the following domains {{ options }}
    options: [science, geography, history, technology, date check, general, people, culture, politics, sports]
    queue: orka:domain

  - id: is_fact
    type: openai-binary
    prompt: >
      Is this a `{{ input }}` fact assertion? Answer TRUE or FALSE.
    queue: orka:is_fact

  - id: requires_search
    type: openai-binary
    prompt: >
      Does this {{ input }} require external search to validate? Answer strictly TRUE or FALSE.
    queue: orka:need_search

  - id: router_search
    type: router
    params:
      decision_key: requires_search
      routing_map:
        true: ["duck_search", "need_answer", "router_answer"]
        false: ["validate_fact"]

  - id: duck_search
    type: duckduckgo
    prompt: > 
      {{ input }}
    queue: orka:search

  - id: need_answer
    type: openai-binary
    prompt: >
      Is this a {{ input }} is a question that requires an answer?
    queue: orka:is_fact

  - id: router_answer
    type: router
    params:
      decision_key: need_answer
      routing_map:
        true: ["build_answer"]
        false: ["validate_fact"]

  - id: validate_fact
    type: openai-binary
    prompt: |
      Given the fact "{{ input }}", and the search results "{{ previous_outputs.duck_search }}"?
    queue: orka:validation_queue

  - id: build_answer
    type: openai-answer
    prompt: |
      Given this question "{{ input }}", and the search results "{{ previous_outputs.duck_search }}", return a complelling answer.
    queue: orka:validation_queue