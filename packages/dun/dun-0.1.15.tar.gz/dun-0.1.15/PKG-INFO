Metadata-Version: 2.3
Name: dun
Version: 0.1.15
Summary: Dynamiczny procesor danych z automatycznym wykrywaniem bibliotek
License: MIT
Author: Tom Sapletta
Author-email: info@softreck.dev
Requires-Python: >=3.11,<4.0
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Provides-Extra: ollama
Requires-Dist: aiohttp (>=3.8.6,<4.0.0)
Requires-Dist: fastapi (>=0.104.1,<0.105.0)
Requires-Dist: loguru (>=0.7.2,<0.8.0)
Requires-Dist: numpy (>=1.26.0,<2.0.0)
Requires-Dist: ollama (>=0.1.5,<0.2.0) ; extra == "ollama"
Requires-Dist: pandas (>=2.0.0,<3.0.0)
Requires-Dist: pydantic (>=2.5.0,<3.0.0)
Requires-Dist: pydantic-settings (>=2.1.0,<3.0.0)
Requires-Dist: python-dateutil (>=2.8.2,<3.0.0)
Requires-Dist: python-dotenv (>=1.0.0,<2.0.0)
Requires-Dist: requests (>=2.31.0,<3.0.0)
Requires-Dist: rich (>=13.6.0,<14.0.0)
Requires-Dist: uvicorn[standard] (>=0.24.0,<0.25.0)
Description-Content-Type: text/markdown

# Dun - Dynamiczny Uniwersalny NarzÄ™dziownik

**D**ynamiczny **U**niwersalny **N**arzÄ™dziownik do przetwarzania danych z wykorzystaniem sztucznej inteligencji.

Alternatywnie:
- **D**ata **U**tility **N**etwork - NarzÄ™dzie do pracy z danymi i sieciÄ…

---

System automatycznego przetwarzania danych z wykorzystaniem LLM (Mistral 7B) do interpretacji Å¼Ä…daÅ„ w jÄ™zyku naturalnym i dynamicznego instalowania bibliotek Python.

# Dun - Dynamiczny Procesor Danych

> **Note:** UÅ¼ywaj komendy `dun` zamiast `python dun.py` do uruchamiania programu.

## ğŸš€ Funkcje

- **Interpretacja jÄ™zyka naturalnego**: Przetwarzanie Å¼Ä…daÅ„ w zwykÅ‚ym jÄ™zyku polskim
- **Dynamiczne zarzÄ…dzanie bibliotekami**: Automatyczna instalacja wymaganych pakietÃ³w Python
- **Przetwarzanie plikÃ³w CSV**: ÅÄ…czenie i analiza wielu plikÃ³w CSV w jeden zbiÃ³r danych
- **Lokalna skrzynka IMAP**: Testowa skrzynka pocztowa z przykÅ‚adowymi wiadomoÅ›ciami  
- **Integracja z Ollama**: Wykorzystanie modelu Mistral 7B do analizy Å¼Ä…daÅ„
- **Organizacja plikÃ³w**: Automatyczne sortowanie emaili wedÅ‚ug dat w strukturze folderÃ³w

## ğŸ“‚ Przetwarzanie plikÃ³w CSV

Dun umoÅ¼liwia Å‚atwe Å‚Ä…czenie i analizowanie wielu plikÃ³w CSV za pomocÄ… prostych poleceÅ„ w jÄ™zyku naturalnym. Funkcja ta dziaÅ‚a nawet bez dostÄ™pu do modelu LLM.

### PrzykÅ‚ady uÅ¼ycia

```bash
# PrzetwÃ³rz wszystkie pliki CSV w katalogu data/
dun "Przeanalizuj wszystkie pliki CSV w folderze data/"

# OkreÅ›l niestandardowy katalog wejÅ›ciowy i wyjÅ›ciowy
dun "PoÅ‚Ä…cz pliki CSV z folderu moje_dane i zapisz jako wynik.csv"

# Przetwarzanie z podglÄ…dem danych
dun "PokaÅ¼ podsumowanie danych z plikÃ³w CSV w folderze raporty/"
```

### Funkcje

- Automatyczne wykrywanie i Å‚Ä…czenie plikÃ³w CSV
- ObsÅ‚uga rÃ³Å¼nych formatÃ³w plikÃ³w (`.csv`, `.CSV`)
- Automatyczne wykrywanie nagÅ‚Ã³wkÃ³w kolumn
- ObsÅ‚uga duÅ¼ych zbiorÃ³w danych
- SzczegÃ³Å‚owe logowanie dziaÅ‚aÅ„

### Konfiguracja

UÅ¼yj zmiennych Å›rodowiskowych, aby dostosowaÄ‡ dziaÅ‚anie:

```bash
export INPUT_DIR=moje_dane
export OUTPUT_FILE=wyniki/poÅ‚Ä…czone_dane.csv
```

### WiÄ™cej informacji

Zobacz peÅ‚nÄ… dokumentacjÄ™ przetwarzania CSV w pliku [CSV_PROCESSOR.md](CSV_PROCESSOR.md).

## ğŸ“‹ Wymagania

- Docker & Docker Compose (opcjonalnie, tylko do uruchomienia z kontenera)
- Python 3.11+
- Poetry (zalecane) lub pip

## ğŸ”§ Instalacja i uruchomienie

### 1. Instalacja z uÅ¼yciem Poetry (zalecane)

```bash
# Klonowanie repozytorium
git clone <repository>
cd dun

# Instalacja zaleÅ¼noÅ›ci
poetry install

# Aktywacja Å›rodowiska wirtualnego
poetry shell

# Utworzenie przykÅ‚adowych emaili (opcjonalne)
python setup_test_emails.py
```

### 2. Instalacja z uÅ¼yciem pip

```bash
# Instalacja pakietu
pip install -e .

# lub dla instalacji globalnej
# pip install .
```

### 3. Uruchomienie (tryb interaktywny)

```bash
dun
```

### 4. Uruchomienie z Docker (opcjonalne)

```bash
# Zbuduj i uruchom wszystkie serwisy
docker-compose up --build

# Lub w tle
docker-compose up -d --build
```

### 4. Uruchomienie lokalne (opcjonalnie)

```bash
# Zainstaluj zaleÅ¼noÅ›ci
poetry install

# Uruchom gÅ‚Ã³wny skrypt
poetry run python dun.py
```

## âš™ï¸ Konfiguracja

Konfiguracja aplikacji odbywa siÄ™ poprzez zmienne Å›rodowiskowe. Skopiuj plik `.env.example` do `.env` i dostosuj ustawienia:

```bash
cp .env.example .env
```

### GÅ‚Ã³wne ustawienia

| Zmienna | WartoÅ›Ä‡ domyÅ›lna | Opis |
|---------|----------------|-------------|
| `APP_ENV` | `development` | Åšrodowisko dziaÅ‚ania (development, testing, production) |
| `APP_DEBUG` | `true` | Tryb debugowania (true/false) |
| `LOG_LEVEL` | `INFO` | Poziom logowania (DEBUG, INFO, WARNING, ERROR, CRITICAL) |
| `LOG_FILE` | `logs/dun.log` | ÅšcieÅ¼ka do pliku z logami |

### Konfiguracja IMAP

| Zmienna | WartoÅ›Ä‡ domyÅ›lna | Opis |
|---------|----------------|-------------|
| `IMAP_ENABLED` | `true` | WÅ‚Ä…cza/wyÅ‚Ä…cza obsÅ‚ugÄ™ IMAP |
| `IMAP_SERVER` | `localhost` | Adres serwera IMAP |
| `IMAP_PORT` | `143` | Port serwera IMAP |
| `IMAP_USERNAME` | `testuser@example.com` | Nazwa uÅ¼ytkownika IMAP |
| `IMAP_PASSWORD` | `testpass123` | HasÅ‚o IMAP |
| `IMAP_USE_SSL` | `false` | WÅ‚Ä…cza szyfrowanie SSL |
| `IMAP_FOLDER` | `INBOX` | DomyÅ›lny folder pocztowy |
| `IMAP_TIMEOUT` | `30` | Limit czasu poÅ‚Ä…czenia (w sekundach) |
| `IMAP_MARK_AS_READ` | `true` | Oznacz wiadomoÅ›ci jako przeczytane |
| `IMAP_DOWNLOAD_ATTACHMENTS` | `true` | Automatyczne pobieranie zaÅ‚Ä…cznikÃ³w |

### Konfiguracja Ollama (LLM)

| Zmienna | WartoÅ›Ä‡ domyÅ›lna | Opis |
|---------|----------------|-------------|
| `OLLAMA_ENABLED` | `true` | WÅ‚Ä…cza/wyÅ‚Ä…cza integracjÄ™ z Ollama |
| `OLLAMA_BASE_URL` | `http://localhost:11434` | Adres URL serwera Ollama |
| `OLLAMA_MODEL` | `mistral:7b` | Nazwa modelu jÄ™zykowego |
| `OLLAMA_TIMEOUT` | `120` | Limit czasu odpowiedzi (w sekundach) |
| `OLLAMA_MAX_TOKENS` | `2000` | Maksymalna liczba tokenÃ³w w odpowiedzi |
| `OLLAMA_TEMPERATURE` | `0.7` | Parametr kreatywnoÅ›ci (0-1) |
| `OLLAMA_TOP_P` | `0.9` | Parametr rÃ³Å¼norodnoÅ›ci odpowiedzi |

### ÅšcieÅ¼ki i katalogi

| Zmienna | WartoÅ›Ä‡ domyÅ›lna | Opis |
|---------|----------------|-------------|
| `APP_DIR` | `/app` | GÅ‚Ã³wny katalog aplikacji |
| `DATA_DIR` | `./data` | Katalog na dane |
| `OUTPUT_DIR` | `./output` | Katalog wyjÅ›ciowy |
| `TEMP_DIR` | `./temp` | Katalog tymczasowy |
| `CACHE_DIR` | `./.cache` | Katalog na cache |

### Ustawienia wydajnoÅ›ci

| Zmienna | WartoÅ›Ä‡ domyÅ›lna | Opis |
|---------|----------------|-------------|
| `MAX_WORKERS` | `4` | Maksymalna liczba wÄ…tkÃ³w roboczych |
| `TASK_TIMEOUT` | `300` | Limit czasu wykonania zadania (w sekundach) |
| `MAX_RETRIES` | `3` | Maksymalna liczba prÃ³b ponowienia |
| `RETRY_DELAY` | `5` | OpÃ³Åºnienie miÄ™dzy ponownymi prÃ³bami (w sekundach) |

### BezpieczeÅ„stwo

| Zmienna | WartoÅ›Ä‡ domyÅ›lna | Opis |
|---------|----------------|-------------|
| `ENABLE_RATE_LIMITING` | `true` | WÅ‚Ä…cza ograniczanie zapytaÅ„ |
| `MAX_REQUESTS_PER_MINUTE` | `60` | Maksymalna liczba zapytaÅ„ na minutÄ™ |
| `REQUIRE_AUTH` | `false` | Wymagaj uwierzytelniania |
| `AUTH_TOKEN` | - | Token uwierzytelniajÄ…cy |

## ğŸ—ï¸ Architektura

```
dun/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ processor_engine.py    # GÅ‚Ã³wny silnik procesora
â”‚   â””â”€â”€ llm_analyzer.py        # Analizator LLM
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ dovecot.conf          # Konfiguracja serwera IMAP
â”‚   â”œâ”€â”€ users                 # Dane uÅ¼ytkownikÃ³w
â”‚   â””â”€â”€ mail/                 # Folder z wiadomoÅ›ciami
â”œâ”€â”€ output/                   # Folder wynikowy
â”œâ”€â”€ dun.py                    # GÅ‚Ã³wny skrypt
â”œâ”€â”€ .env                      # Konfiguracja
â””â”€â”€ docker-compose.yml        # Definicja serwisÃ³w
```

## ğŸ“§ PrzykÅ‚adowe uÅ¼ycie

Po uruchomieniu systemu, procesor automatycznie:

1. **Analizuje Å¼Ä…danie**: 
   ```
   "Pobierz wszystkie wiadomoÅ›ci email ze skrzynki IMAP i zapisz je w folderach 
   uporzÄ…dkowanych wedÅ‚ug roku i miesiÄ…ca w formacie skrzynka/rok.miesiÄ…c/*.eml"
   ```

2. **Wykrywa wymagane biblioteki**: `imaplib`, `email`

3. **Instaluje biblioteki**: Automatycznie instaluje wymagane pakiety

4. **ÅÄ…czy siÄ™ z IMAP**: Wykorzystuje dane z `.env` do poÅ‚Ä…czenia

5. **Pobiera emaile**: Pobiera wszystkie wiadomoÅ›ci ze skrzynki

6. **Organizuje pliki**: Tworzy strukturÄ™ folderÃ³w:
   ```
   output/
   â””â”€â”€ skrzynka/
       â”œâ”€â”€ 2024.11/
       â”‚   â”œâ”€â”€ email_1.eml
       â”‚   â””â”€â”€ email_2.eml
       â”œâ”€â”€ 2024.12/
       â”‚   â””â”€â”€ email_3.eml
       â””â”€â”€ 2025.06/
           â”œâ”€â”€ email_4.eml
           â””â”€â”€ email_5.eml
   ```

## ğŸ”§ Konfiguracja

### Zmienne Å›rodowiskowe (.env)

```bash
# Konfiguracja IMAP
IMAP_SERVER=localhost          # Adres serwera IMAP
IMAP_PORT=143                  # Port IMAP
IMAP_USERNAME=testuser@example.com
IMAP_PASSWORD=testpass123
IMAP_USE_SSL=false            # UÅ¼ycie SSL

# ÅšcieÅ¼ki
OUTPUT_DIR=./output           # Folder wyjÅ›ciowy

# Ollama
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=mistral:7b

# Logowanie
LOG_LEVEL=INFO
```

### Testowa skrzynka IMAP

- **Serwer**: localhost:143
- **UÅ¼ytkownik**: testuser@example.com  
- **HasÅ‚o**: testpass123
- **ProtokÃ³Å‚**: IMAP bez SSL

## ğŸ“ PrzykÅ‚adowe Å¼Ä…dania w jÄ™zyku naturalnym

System rozpoznaje rÃ³Å¼ne typy Å¼Ä…daÅ„:

### 1. Pobieranie emaili
```
"Pobierz wszystkie wiadomoÅ›ci email ze skrzynki IMAP i zapisz je w folderach 
uporzÄ…dkowanych wedÅ‚ug roku i miesiÄ…ca w formacie skrzynka/rok.miesiÄ…c/*.eml"
```

### 2. Filtrowanie po dacie
```
"Pobierz emaile z ostatnich 30 dni i zapisz je w folderze recent_emails"
```

### 3. Filtrowanie po nadawcy
```  
"Pobierz wszystkie emaile od sender@example.com i zapisz je w osobnym folderze"
```

### 4. Analiza zaÅ‚Ä…cznikÃ³w
```
"Pobierz emaile z zaÅ‚Ä…cznikami i wyodrÄ™bnij wszystkie pliki PDF do folderu attachments"
```

## ğŸ” Monitorowanie

### Logi systemu
```bash
# PodglÄ…d logÃ³w Docker
docker-compose logs -f

# Logi konkretnego serwisu
docker-compose logs -f data-processor
docker-compose logs -f ollama
docker-compose logs -f mailserver
```

### Sprawdzenie statusu Ollama
```bash
curl http://localhost:11434/api/tags
```

### Testowanie IMAP
```bash
# Telnet do serwera IMAP
telnet localhost 143

# PrzykÅ‚adowe komendy IMAP
a1 LOGIN testuser@example.com testpass123
a2 SELECT INBOX
a3 SEARCH ALL
a4 LOGOUT
```

## ğŸ§ª RozwÃ³j i testowanie

### Struktura projektu
```python
# Dodawanie nowego procesora
class CustomProcessor:
    def setup(self):
        # Instaluj biblioteki
        pass
    
    def process(self, data):
        # Logika przetwarzania
        return result
```

### Dodawanie nowych szablonÃ³w LLM
```python
# W llm_analyzer.py
def _get_custom_processor(self) -> ProcessorConfig:
    code_template = '''
    # TwÃ³j kod tutaj
    result = {"status": "completed"}
    '''
    return ProcessorConfig(...)
```

## ğŸ”§ RozwiÄ…zywanie problemÃ³w

### Ollama nie odpowiada
```bash
# Restart Ollama
docker-compose restart ollama

# SprawdÅº czy model jest pobrany
docker-compose exec ollama ollama list
```

### IMAP connection refused
```bash
# SprawdÅº status serwera pocztowego
docker-compose restart mailserver

# SprawdÅº logi
docker-compose logs mailserver
```

### BÅ‚Ä™dy instalacji pakietÃ³w
```bash
# WyczyÅ›Ä‡ cache pip
docker-compose exec data-processor pip cache purge

# Restart kontenera
docker-compose restart data-processor
```

## ğŸ“Š PrzykÅ‚adowy wynik dziaÅ‚ania

```json
{
    "status": "completed",
    "downloaded_files": [
        "output/skrzynka/2024.11/email_1.eml",
        "output/skrzynka/2024.12/email_2.eml", 
        "output/skrzynka/2025.06/email_3.eml"
    ],
    "total_count": 3,
    "folders_created": [
        "output/skrzynka/2024.11",
        "output/skrzynka/2024.12", 
        "output/skrzynka/2025.06"
    ]
}
```

## ğŸš€ Rozszerzenia

System moÅ¼e byÄ‡ rozszerzony o:

- **WiÄ™cej procesorÃ³w**: CSV, JSON, XML, bazy danych
- **RÃ³Å¼ne protokoÅ‚y**: POP3, Exchange, SMTP
- **Chmura**: Integracja z Gmail API, Outlook
- **Analiza treÅ›ci**: NLP, klasyfikacja, sentiment analysis
- **Automatyzacja**: Cron jobs, watchdog, webhooks

## ğŸ§ª Testowanie

Projekt zawiera kompleksowe testy jednostkowe i integracyjne. Aby uruchomiÄ‡ testy:

```bash
# Zainstaluj zaleÅ¼noÅ›ci developerskie
poetry install --with dev

# Uruchom testy
poetry run pytest tests/

# Z pokryciem kodu (wymaga pytest-cov)
poetry run pytest --cov=dun tests/

# Generuj raport HTML z pokryciem
poetry run pytest --cov=dun --cov-report=html tests/
```

### Struktura testÃ³w

- `tests/unit/` - Testy jednostkowe poszczegÃ³lnych komponentÃ³w
- `tests/integration/` - Testy integracyjne sprawdzajÄ…ce wspÃ³Å‚dziaÅ‚anie komponentÃ³w
- `tests/conftest.py` - Konfiguracja i wspÃ³lne fikstury

## ğŸ“„ Licencja

Apache License - zobacz plik LICENSE
