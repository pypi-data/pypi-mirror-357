-- Generated Test Case: medium_3
-- Complexity: medium
-- Valid: Unknown
-- Non-Idempotent: Unknown

Here's a medium-complexity PostgreSQL migration example that uses custom types, triggers, and dollar-quoted functions, while being non-idempotent:

```sql