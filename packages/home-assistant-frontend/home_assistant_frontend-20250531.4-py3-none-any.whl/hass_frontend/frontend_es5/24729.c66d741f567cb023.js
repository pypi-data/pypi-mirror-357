"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["24729"],{10388:function(t,e,i){i.a(t,(async function(t,s){try{i.d(e,{c:()=>m,computeStateDisplay:()=>f});i(39710),i(87799),i(56389);var n=i(16230),a=i(38763),o=i(93836),r=i(40142),c=i(74266),l=i(45691),u=i(28598),h=i(27417),d=i(44272),_=t([o,u,r,l,c]);[o,u,r,l,c]=_.then?(await _)():_;const f=(t,e,i,s,n,a,o)=>{const r=null==a?void 0:a[e.entity_id];return m(t,i,s,n,r,e.entity_id,e.attributes,void 0!==o?o:e.state)},m=(t,e,i,s,_,f,m,b)=>{if(b===n.lz||b===n.nZ)return t(`state.default.${b}`);const p=(0,d.M)(f),g="counter"===p||"number"===p||"input_number"===p;if((0,u.sJ)(m,"sensor"===p?i:[])||g){if("duration"===m.device_class&&m.unit_of_measurement&&o.a_.includes(m.unit_of_measurement))try{return(0,o.LU)(e,b,m.unit_of_measurement,null==_?void 0:_.display_precision)}catch(y){}if("monetary"===m.device_class)try{return(0,u.uf)(b,e,Object.assign({style:"currency",currency:m.unit_of_measurement,minimumFractionDigits:2},(0,u.l4)({state:b,attributes:m},_)))}catch(y){}const i=(0,u.uf)(b,e,(0,u.l4)({state:b,attributes:m},_)),s=(null==_?void 0:_.translation_key)&&t(`component.${_.platform}.entity.${p}.${_.translation_key}.unit_of_measurement`)||m.unit_of_measurement;return s?`${i}${(0,h.L)(s,e)}${s}`:i}if(["date","input_datetime","time"].includes(p))try{const t=b.split(" ");if(2===t.length)return(0,c.o0)(new Date(t.join("T")),Object.assign(Object.assign({},e),{},{time_zone:a.c_.local}),s);if(1===t.length){if(b.includes("-"))return(0,r.p6)(new Date(`${b}T00:00`),Object.assign(Object.assign({},e),{},{time_zone:a.c_.local}),s);if(b.includes(":")){const t=new Date;return(0,l.mr)(new Date(`${t.toISOString().split("T")[0]}T${b}`),Object.assign(Object.assign({},e),{},{time_zone:a.c_.local}),s)}}return b}catch(v){return b}if(["button","conversation","event","image","input_button","notify","scene","stt","tag","tts","wake_word","datetime"].includes(p)||"sensor"===p&&"timestamp"===m.device_class)try{return(0,c.o0)(new Date(b),e,s)}catch(y){return b}return(null==_?void 0:_.translation_key)&&t(`component.${_.platform}.entity.${p}.${_.translation_key}.state.${b}`)||m.device_class&&t(`component.${p}.entity_component.${m.device_class}.state.${b}`)||t(`component.${p}.entity_component._.state.${b}`)||b};s()}catch(f){s(f)}}))},9224:function(t,e,i){i.d(e,{H:()=>s});const s=5},89166:function(t,e,i){i.a(t,(async function(t,s){try{i.d(e,{Nu:()=>j,V3:()=>S,Vk:()=>d,YA:()=>$,xS:()=>f,zP:()=>H});i(39710),i(26847),i(2394),i(18574),i(73042),i(81738),i(94814),i(29981),i(22960),i(6989),i(72489),i(87799),i(56303),i(67886),i(65451),i(46015),i(38334),i(94880),i(75643),i(29761),i(56389),i(27530);var n=i(44272),a=i(10388),o=i(15459),r=t([a]);a=(r.then?(await r)():r)[0];const c=["climate","humidifier","water_heater"],l=["climate","humidifier","input_datetime","water_heater","person","device_tracker"],u=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],h=(t,e)=>!t.states[e]||l.includes((0,n.M)(e)),d=(t,e,i,s,n)=>{const a={type:"history/stream",entity_ids:n,start_time:i.toISOString(),end_time:s.toISOString(),minimal_response:!0,no_attributes:!n.some((e=>h(t,e)))},o=new _(t);return t.connection.subscribeMessage((t=>e(o.processMessage(t))),a)};class _{processMessage(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;const e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,i={};for(const s of Object.keys(this.combinedHistory))i[s]=[];for(const s of Object.keys(t.states))i[s]=[];for(const s of Object.keys(i)){if(s in this.combinedHistory&&s in t.states){const e=this.combinedHistory[s],n=e[e.length-1];i[s]=e.concat(t.states[s]),t.states[s][0].lu<n.lu&&(i[s]=i[s].sort(((t,e)=>t.lu-e.lu)))}else s in this.combinedHistory?i[s]=this.combinedHistory[s]:i[s]=t.states[s];if(e&&s in this.combinedHistory){const t=i[s].filter((t=>t.lu<e));if(!t.length)continue;if(i[s]=i[s].filter((t=>t.lu>=e)),i[s].length&&i[s][0].lu===e)continue;const n=t[t.length-1];n.lu=e,i[s].unshift(n)}}return this.combinedHistory=i,this.combinedHistory}constructor(t,e){this.hass=t,this.hoursToShow=e,this.combinedHistory={}}}const f=(t,e,i,s,n,a=!0,o=!0)=>{const r={type:"history/stream",entity_ids:s,start_time:new Date((new Date).getTime()-3600*i*1e3).toISOString(),minimal_response:a,significant_changes_only:o,no_attributes:null!=n?n:!s.some((e=>h(t,e)))},c=new _(t,i);return t.connection.subscribeMessage((t=>e(c.processMessage(t))),r)},m=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||u.every((i=>t.attributes[i]===e.attributes[i]))),b=(t,e,i,s,n,r,c)=>{const l=[],u=r[0];for(const o of r){if(l.length>0&&o.s===l[l.length-1].state)continue;const r={};null!=c&&c.attributes.device_class&&(r.device_class=null==c?void 0:c.attributes.device_class),l.push({state_localize:(0,a.c)(t,e,[],i,s[n],n,Object.assign(Object.assign({},o.a||u.a),r),o.s),state:o.s,last_changed:1e3*(o.lc?o.lc:o.lu)})}return{name:(0,o.a)(n,(null==c?void 0:c.attributes)||u.a),entity_id:n,data:l}},p=(t,e,i,s)=>{const a=[];return Object.keys(i).forEach((t=>{const e=i[t],r=e[0],l=(0,n.M)(t),h=[];for(const i of e){let t;if(c.includes(l)){t={state:i.s,last_changed:1e3*i.lu,attributes:{}};for(const e of u)e in i.a&&(t.attributes[e]=i.a[e])}else t={state:i.s,last_changed:1e3*(i.lc?i.lc:i.lu),attributes:{}};h.length>1&&m(t,h[h.length-1])&&m(t,h[h.length-2])||h.push(t)}const d=t in s?s[t].attributes:"friendly_name"in r.a?r.a:void 0;a.push({domain:l,name:(0,o.a)(t,d||{}),entity_id:t,states:h})})),{unit:t,device_class:e,identifier:Object.keys(i).join(""),data:a}},g=["counter","input_number","number"],y=t=>g.includes(t),v=t=>"unit_of_measurement"in t||"state_class"in t,w=(t,e)=>null!=t.attributes.device_class&&e.includes(t.attributes.device_class),k=" ",$=(t,e,i,s,n=!1)=>{const a={};i.forEach((t=>{t in e&&(a[t]=e[t])}));const o={};Object.entries(a).forEach((([t,e])=>{const i=e.map((t=>({s:null!=t.mean?t.mean.toString():t.state.toString(),lc:t.start/1e3,a:{},lu:t.start/1e3})));o[t]=i}));const r=j(t,o,[],t.localize,s,n,!0);return((null==r?void 0:r.line)||[]).forEach((t=>{t.data.forEach((t=>{t.statistics=t.states,t.states=[]}))})),r},j=(t,e,i,s,a,o=!1,r=!1)=>{const c={},l=[],u={};if(new Set([...i,...Object.keys(e)]).forEach((i=>{i in e?u[i]=e[i]:t.states[i]&&(u[i]=[{s:t.states[i].state,a:t.states[i].attributes,lu:new Date(t.states[i].last_updated).getTime()/1e3}])})),!u)return{line:[],timeline:[]};Object.keys(u).forEach((e=>{var i;const h=u[e];if(0===h.length)return;const d=(0,n.M)(e),_=e in t.states?t.states[e]:void 0,f=_||y(d)?void 0:h.find((t=>t.a&&v(t.a)));let m;m=H(d,_,f,a,r)?(null==_?void 0:_.attributes.unit_of_measurement)||(null==f?void 0:f.a.unit_of_measurement)||k:{zone:s("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[d];const p={climate:"temperature",humidifier:"humidity",water_heater:"temperature"}[d]||(null===(i=(null==_?void 0:_.attributes)||(null==f?void 0:f.a))||void 0===i?void 0:i.device_class),g=O(m,p,o);m?g&&g in c&&e in c[g]?c[g][e].push(...h):g&&(g in c||(c[g]={}),c[g][e]=h):l.push(b(s,t.locale,t.config,t.entities,e,h,_))}));return{line:Object.keys(c).map((e=>{const i=e.split("_"),s=i[0],n=i[1]||void 0;return p(s,n,c[e],t.states)})),timeline:l}},O=(t,e,i)=>i?`${t}_${e||""}`:t,H=(t,e,i,s,n=!1)=>n||y(t)||null!=e&&v(e.attributes)||null!=e&&"sensor"===t&&w(e,s)||null!=i,S=(t,e,i=!0)=>{if(!e)return t;const s=Object.assign(Object.assign({},t),{},{line:[]}),n={};for(const c of t.line){const t=O(c.unit,c.device_class,i);t&&(n[t]={historyItem:c})}for(const c of e.line){var a,o;if(c.unit===k)c.unit=null!==(a=null===(o=t.line.find((t=>t.identifier===c.identifier)))||void 0===o?void 0:o.unit)&&void 0!==a?a:k;const e=O(c.unit,c.device_class,i);e&&(e in n?n[e].ltsItem=c:n[e]={ltsItem:c})}for(const{historyItem:c,ltsItem:l}of Object.values(n)){if(!c||!l){s.line.push(c||l);continue}const t=Object.assign(Object.assign({},c),{},{data:[]}),e=new Set([...c.data.map((t=>t.entity_id)),...l.data.map((t=>t.entity_id))]);for(const i of e){var r;const e=c.data.find((t=>t.entity_id===i)),s=l.data.find((t=>t.entity_id===i));if(!e||!s){t.data.push(e||s);continue}const n=(null===(r=e.states[0])||void 0===r?void 0:r.last_changed)||s.statistics[s.statistics.length-1].last_changed+1,a=[];for(const t of s.statistics){if(t.last_changed>=n)break;a.push(t)}t.data.push(0===a.length?e:Object.assign(Object.assign({},e),{},{statistics:a}))}s.line.push(t)}return s};s()}catch(c){s(c)}}))},13814:function(t,e,i){i.d(e,{g:()=>r});i(26847),i(2394),i(44438),i(81738),i(94814),i(22960),i(6989),i(93190),i(15519),i(56303),i(27530);var s=i(9224);const n=t=>t.reduce(((t,e)=>t+parseFloat(e.state)),0)/t.length,a=t=>parseFloat(t[t.length-1].state)||0,o=(t,e,i,o,r)=>{t.forEach((t=>{t.state=Number(t.state)})),t=t.filter((t=>!Number.isNaN(t.state)));const c=void 0!==(null==r?void 0:r.min)?r.min:Math.min(...t.map((t=>t.state))),l=void 0!==(null==r?void 0:r.max)?r.max:Math.max(...t.map((t=>t.state))),u=(new Date).getTime(),h=(t,i,s)=>{const n=u-new Date(i.last_changed).getTime();let a=Math.abs(n/36e5-e);return s?(a=60*(a-Math.floor(a)),a=Number((10*Math.round(a/10)).toString()[0])):a=Math.floor(a),t[a]||(t[a]=[]),t[a].push(i),t};if(t=t.reduce(((t,e)=>h(t,e,!1)),[]),o>1&&(t=t.map((t=>t.reduce(((t,e)=>h(t,e,!0)),[])))),t.length)return((t,e,i,o,r,c)=>{const l=[];let u=(c-r)/80;u=0!==u?u:80;let h=i/(e-(1===o?1:0));h=isFinite(h)?h:i;let d=t.filter(Boolean)[0];o>1&&(d=d.filter(Boolean)[0]);let _=[n(d),a(d)];const f=t=>80+s.H/2-(t-r)/u,m=(t,e,i=0,s=1)=>{if(s>1&&t)return t.forEach(((t,i)=>m(t,e,i,s-1)));const o=h*(e+i/6);t&&(_=[n(t),a(t)]);const r=f(t?_[0]:_[1]);return l.push([o,r])};for(let s=0;s<t.length;s+=1)m(t[s],s,0,o);return l.push([i,f(_[1])]),l})(t,e,i,o,c,l)},r=(t,e,i,s,n)=>{if(!t)return;const a=t.map((t=>({state:Number(t.s),last_changed:1e3*t.lu})));return o(a,e,i,s,n)}},88809:function(t,e,i){var s=i(73742),n=i(59048),a=i(7616),o=i(9224);i(26847),i(81738),i(94814),i(27530);let r,c,l,u,h=t=>t;class d extends n.oi{render(){return(0,n.dy)(r||(r=h` ${0} `),this._path?(0,n.YP)(c||(c=h`<svg width="100%" height="100%" viewBox="0 0 500 100"> <g> <mask id="fill"> <path class="fill" fill="white" d="${0} L 500, 100 L 0, 100 z"/> </mask> <rect height="100%" width="100%" id="fill-rect" fill="var(--accent-color)" mask="url(#fill)"></rect> <mask id="line"> <path fill="none" stroke="var(--accent-color)" stroke-width="${0}" stroke-linecap="round" stroke-linejoin="round" d="${0}"></path> </mask> <rect height="100%" width="100%" id="rect" fill="var(--accent-color)" mask="url(#line)"></rect> </g> </svg>`),this._path,o.H,this._path):(0,n.YP)(l||(l=h`<svg width="100%" height="100%" viewBox="0 0 500 100"></svg>`)))}willUpdate(t){this.coordinates&&t.has("coordinates")&&(this._path=(t=>{if(!t.length)return"";let e,i,s="",n=t.filter(Boolean)[0];s+=`M ${n[0]},${n[1]}`;for(const l of t)e=l,a=n[0],o=n[1],r=e[0],c=e[1],i=[(a-r)/2+r,(o-c)/2+c],s+=` ${i[0]},${i[1]}`,s+=` Q${e[0]},${e[1]}`,n=e;var a,o,r,c;return s+=` ${e[0]},${e[1]}`,s})(this.coordinates))}}d.styles=(0,n.iv)(u||(u=h`:host{display:flex;width:100%}.fill{opacity:.1}`)),(0,s.__decorate)([(0,a.Cb)()],d.prototype,"coordinates",void 0),(0,s.__decorate)([(0,a.SB)()],d.prototype,"_path",void 0),d=(0,s.__decorate)([(0,a.Mo)("hui-graph-base")],d)},8833:function(t,e,i){i.a(t,(async function(t,s){try{i.r(e),i.d(e,{HuiGraphHeaderFooter:()=>$});i(40777),i(39710),i(26847),i(87799),i(1455),i(27530);var n=i(73742),a=i(59048),o=i(7616),r=i(37528),c=i(44272),l=i(6514),u=i(89166),h=i(45063),d=i(13814),_=(i(88809),t([l,u]));[l,u]=_.then?(await _)():_;let f,m,b,p,g,y=t=>t;const v=6e4,w=60*v,k=["counter","input_number","number","sensor"];class $ extends a.oi{static async getConfigElement(){return await Promise.all([i.e("73614"),i.e("15601"),i.e("15634"),i.e("26452"),i.e("2769"),i.e("19596"),i.e("88930")]).then(i.bind(i,65697)),document.createElement("hui-graph-footer-editor")}static getStubConfig(t,e,i){return{type:"graph",entity:(0,h.j)(t,1,e,i,k,(t=>!isNaN(Number(t.state))&&!!t.attributes.unit_of_measurement))[0]||""}}getCardSize(){return 3}setConfig(t){if(null==t||!t.entity||!k.includes((0,c.M)(t.entity)))throw new Error("Specify an entity from within the sensor domain");const e=Object.assign({detail:1,hours_to_show:24},t);e.hours_to_show=Number(e.hours_to_show),e.detail=1===e.detail||2===e.detail?e.detail:1,this._config=e}render(){return this._config&&this.hass?this._error?(0,a.dy)(f||(f=y`<div class="errors">${0}</div>`),this._error):this._coordinates?this._coordinates.length?(0,a.dy)(p||(p=y` <hui-graph-base .coordinates="${0}"></hui-graph-base> `),this._coordinates):(0,a.dy)(b||(b=y` <div class="container"> <div class="info">No state history found.</div> </div> `)):(0,a.dy)(m||(m=y` <div class="container"> <ha-spinner size="small"></ha-spinner> </div> `)):a.Ld}connectedCallback(){super.connectedCallback(),this.hasUpdated&&this._config&&this._subscribeHistory()}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeHistory()}_subscribeHistory(){(0,r.p)(this.hass,"history")&&!this._subscribed&&this._config&&(this._subscribed=(0,u.xS)(this.hass,(t=>{this._subscribed&&this._config&&(this._coordinates=(0,d.g)(t[this._config.entity],this._config.hours_to_show,500,this._config.detail,this._config.limits)||[])}),this._config.hours_to_show,[this._config.entity]).catch((t=>{this._subscribed=void 0,this._error=t})),this._setRedrawTimer())}_redrawGraph(){this._coordinates&&(this._coordinates=[...this._coordinates])}_setRedrawTimer(){clearInterval(this._interval),this._interval=window.setInterval((()=>this._redrawGraph()),this._config.hours_to_show>24?w:v)}_unsubscribeHistory(){clearInterval(this._interval),this._subscribed&&(this._subscribed.then((t=>null==t?void 0:t())),this._subscribed=void 0)}updated(t){if(!this._config||!this.hass||!t.has("_config"))return;const e=t.get("_config");e&&this._subscribed&&e.entity===this._config.entity||(this._unsubscribeHistory(),this._subscribeHistory())}}$.styles=(0,a.iv)(g||(g=y`ha-spinner{position:absolute;top:calc(50% - 14px)}.container{display:flex;justify-content:center;position:relative;padding-bottom:20%}.info{position:absolute;top:calc(50% - 16px);color:var(--secondary-text-color)}`)),(0,n.__decorate)([(0,o.Cb)({attribute:!1})],$.prototype,"hass",void 0),(0,n.__decorate)([(0,o.Cb)()],$.prototype,"type",void 0),(0,n.__decorate)([(0,o.SB)()],$.prototype,"_config",void 0),(0,n.__decorate)([(0,o.SB)()],$.prototype,"_coordinates",void 0),$=(0,n.__decorate)([(0,o.Mo)("hui-graph-header-footer")],$),s()}catch(f){s(f)}}))}}]);
//# sourceMappingURL=24729.c66d741f567cb023.js.map