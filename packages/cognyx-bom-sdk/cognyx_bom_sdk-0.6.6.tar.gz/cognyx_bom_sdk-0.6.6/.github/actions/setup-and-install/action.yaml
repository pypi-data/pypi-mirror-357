name: Setup & install
description: Set up Python and install dependencies
inputs:
    python-version:
        description: 'Python version'
        required: true

runs:
    using: "composite"
    steps:
    -   uses: actions/setup-python@v5
        with:
            python-version: ${{ inputs.python-version }}

    -   name: Install uv
        shell: sh
        run: |
            curl -LsSf https://astral.sh/uv/install.sh | sh
            echo "$HOME/.cargo/bin" >> $GITHUB_PATH

    -   name: Cache dependencies
        uses: actions/cache@v4
        with:
            path: |
                ~/.cache/uv
                .venv
            key: ${{ runner.os }}-uv-${{ hashFiles('pyproject.toml') }}
            restore-keys: |
                ${{ runner.os }}-uv-

    -   name: Install dependencies
        shell: sh
        run: |
            uv venv
            . .venv/bin/activate
            uv sync --dev
        if: steps.cache-dependencies.outputs.cache-hit != 'true'
