var Dt=Object.defineProperty;var xt=(i,t,e)=>t in i?Dt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var ae=(i,t,e)=>xt(i,typeof t!="symbol"?t+"":t,e);import{d as B,f as R,B as h,C as y,D as ce,E as se,o as le,G as it,H as n,c as x,I as T,w as ne,a as b,F as j,J as te,z as C,K as Y,L as A,M as L,N as He,O as E,P as Ct,Q as Pt,R as We,S as lt,U as de,V,W as It,X as ee,Y as Ne,Z as qe,_ as Pe,$ as Ae,a0 as Tt,r as Ut,y as Rt,b as rt,a1 as Xe,a2 as At,n as ut,a3 as Oe,a4 as dt,a5 as Lt,a6 as Bt}from"./@vue-D35tL6nz.js";import{d as Be,c as Mt}from"./pinia-BkGwwmFF.js";import{u as me,a as ct,c as Et,b as qt}from"./vue-router-BoPcQ6kQ.js";import{M as Ft}from"./async-mutex-CSJywVGb.js";import{f as zt}from"./fast-xml-parser-BMstfEP2.js";import{P as Fe}from"./plotly.js-dist-C5a2sO8P.js";import{E as Ot,M as Ht}from"./md-editor-v3-Dl7IEjey.js";import{m as Wt}from"./gray-matter-Fs3drFNS.js";import"./vite-plugin-node-polyfills-CYF0W5wK.js";import"./strnum-u8jQhLSb.js";import"./copy-to-clipboard-B1uT6SkR.js";import"./toggle-selection-BHUZwh74.js";import"./@vavt-D0iSl322.js";import"./@codemirror-xEbqB7wZ.js";import"./@lezer-B2pTEO0R.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./medium-zoom-bWEtUbjf.js";import"./markdown-it-DI8MEbma.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-kMc2yuuw.js";import"./entities-C20TfXL6.js";import"./linkify-it-DmNjr4Kv.js";import"./punycode.js-Dj65hjkv.js";import"./markdown-it-image-figures-BD49Kf-b.js";import"./markdown-it-sub-Bxi31R0z.js";import"./markdown-it-sup-Bp2DoVCN.js";import"./node-stdlib-browser-d7cmxmpa.js";import"./section-matter-DWrNKXO4.js";import"./kind-of-l3izQsJJ.js";import"./extend-shallow-DA8A8LGH.js";import"./is-extendable-CiA4f1iz.js";import"./js-yaml-B7yGoGZD.js";import"./strip-bom-string-BxrG9K6S.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const Nt=B({__name:"Popup",props:{styleType:{default:"info"},position:{default:"top-center"}},setup(i){const t=i,e=R(()=>{switch(t.styleType){case"alert":case"error":return{backgroundColor:"rgba(180, 0, 20, 0.9)",color:"rgba(255, 255, 255, 1)"};case"warning":return{backgroundColor:"rgba(210, 150, 0, 0.9)",color:"rgba(255, 255, 255, 1)"};case"info":return{backgroundColor:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 1)"};case"success":return{backgroundColor:"rgba(0, 180, 0, 0.9)",color:"rgba(255, 255, 255, 1)"};default:return{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"var(--color-text)"}}}),a=R(()=>{if(t.position==="top-center")return{top:"30px",left:"50%",transform:"translate(-50%, 0)"};if(t.position==="center")return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};throw Error("Incorrect style.")});return(s,o)=>(h(),y("div",{id:"popup",style:se({...e.value,...a.value})},[ce(s.$slots,"default",{},void 0)],4))}}),q=(i,t)=>{const e=i.__vccOpts||i;for(const[a,s]of t)e[a]=s;return e},et=q(Nt,[["__scopeId","data-v-7a7b12ca"]]),ue="->";class H extends Set{static removeSpaces(t){const e=t.split(ue);for(let a=0;a<e.length;a++)e[a]=e[a].trim();return t=e.join(ue),t}constructor(t=null){t===null&&(t=[]);const e=t instanceof Set?t:new Set(t);e.forEach(a=>H.removeSpaces(a)),super(e)}copy(){return new H(this)}equals(t){if(t.size!==this.size)return!1;for(const e of this)if(!t.has(e))return!1;return!0}add(t){return super.add(H.removeSpaces(t))}has(t){return super.has(H.removeSpaces(t))}union(t){const e=new H(this);return e.union_(t),e}union_(t){return t.forEach(e=>this.add(e)),this}pop(t){const e=new H(this);return e.pop_(t),e}pop_(t){return t.forEach(e=>this.delete(e)),this}pop_ifcontains_(t){return t.forEach(e=>{this.has(e)&&this.delete(e)}),this}issubset(t){return _e.isSubset(this,t)}withParents(){const t=new H(this);return this.forEach(e=>t.union_(_e.allParentsOf(e))),t}withChildsFrom(t){const e=new H(this);return this.forEach(a=>e.union_(_e.allChildsOf(a,t))),e}allParents(){const t=new H;return this.forEach(e=>t.union_(_e.allParentsOf(e))),t}toArray(){return Array.from(this)}}class _e{static allParentsOf(t){const e=t.split(ue);if(e.length===1)return new H([]);const a=[],s=[];for(let o=0;o<e.length-1;o++)a.push(e[o]),s.push(a.join(ue));return new H(s)}static allChildsOf(t,e){const a=new H;for(const s of e)s.startsWith(t)&&s.length>t.length+ue.length&&s.substring(t.length,t.length+ue.length)===`${ue}`&&a.add(s);return a}static tagHierarchy(t){const e=ue;function a(l,r){const c=l.split(r);return c.length===1?[l]:[c[0],c.slice(1).join(r)]}function s(l,r=e){const c={},w=l.map(p=>a(p,r));for(const p of w)p[0]in c||(c[p[0]]=[]),p.length===2&&c[p[0]].push(p[1]);const m={};for(const p in c)m[p]=s(c[p],r);return m}function o(l,r=e){for(const c in l){const w=l[c];for(const m in w){const p=[c,m].join(e);w[p]=w[m],delete w[m]}o(w,r)}return l}return o(s(Array.from(t)))}static isSubset(t,e){let a=!0;for(const s of t)if(!e.has(s)){a=!1;break}return a}}class De{constructor(t,e){ae(this,"summary");ae(this,"supp");ae(this,"conn");this.summary=e,this.supp={note:null,abstract:null},this.conn=t}get backendUrl(){return this.conn.baseURL}get dtype(){return this.summary.doc_type}get tags(){return new H(this.summary.tags)}get uid(){return this.summary.uuid}get title(){return this.summary.title}get authors(){return this.summary.authors}get year(){return this.summary.year}get publication(){return this.summary.publication}get url(){return this.summary.url}get bibtex(){return this.summary.bibtex}toString(){return`${this.summary.title} - ${this.authorAbbr()} (${this.summary.year}) [uid: ${this.summary.uuid}]`}fetchAbstract(){return new Promise((t,e)=>{this.conn.getDatapointAbstract(this.summary.uuid).then(a=>{this.supp.abstract=a,t(a)}).catch(a=>{e(a)})})}uploadAbstract(t){return new Promise((e,a)=>{if(t===this.supp.abstract||t===null){e(!0);return}this.conn.setDatapointAbstract(this.summary.uuid,t).then(s=>{this.supp.abstract=t,e(s)}).catch(s=>{a(s)})})}fetchNote(){return new Promise((t,e)=>{this.conn.getDatapointNote(this.summary.uuid).then(a=>{this.supp.note=a,t(a)}).catch(a=>{e(a)})})}uploadNote(t){return t===null?Promise.reject("Note is null"):new Promise((e,a)=>{this.conn.setDatapointNote(this.summary.uuid,t).then(s=>{this.supp.note=t,this.summary.note_linecount=t.split(`
`).map(o=>o.trim()==""?0:1).reduce((o,l)=>o+l,0),e(s)}).catch(s=>{a(s)})})}deleteMiscFile(t){return this.conn.deleteMiscFile(this.summary.uuid,t)}renameMiscFile(t,e){return this.conn.renameMiscFile(this.summary.uuid,t,e)}listMiscFiles(){const t=this.conn.getMiscFileList(this.summary.uuid),e=`${this.backendUrl}/misc/${this.summary.uuid}`;return t.then(a=>a.map(s=>{const o=new URLSearchParams;return o.append("fname",s),o.append("_u",J().user.id.toString()),{fname:s,rpath:`./misc/${s}`,url:`${e.toString()}?${o.toString()}`}}))}uploadMisc(t){return new Promise((e,a)=>{this.conn.uploadMiscFiles(this.summary.uuid,t).then(s=>{e(s.map(o=>`./misc/${o}`))},s=>{a(s)})})}uploadDocument(t){return this.conn.uploadDocument(this.summary.uuid,t)}freeDocument(){return this.conn.deleteDocument(this.summary.uuid)}update(t=null){if(t!==null)return this.summary=t,Promise.resolve(t);const e=this.conn.getDatapointSummary(this.summary.uuid);return e.then(a=>{this.summary=a}),e}destory(){this.summary=Le}authorAbbr(){let t="";return this.summary.authors.length>1&&(t=" et al."),this.summary.authors[0]+t}authorYear(){return`${this.authorAbbr()} ${this.summary.year}`}yearAuthor(t=" "){return`${this.summary.year}${t}${this.authorAbbr()}`}isDummy(){return this.summary.uuid===Le.uuid}getRawDocURL(){const t=this.summary.uuid;return this.summary.has_file?`${this.backendUrl}/doc/${t}?u=${J().user.id}`:!this.summary.has_file&&this.url?this.url:"about:blank"}getOpenDocURL({extraPDFViewerParams:t={},urlHashMark:e=""}={}){const a=`${this.backendUrl}/pdfjs/web/viewer.html`;function s(r,c=a){const w=new URLSearchParams;c===a&&w.append("key",N().encKey),w.append("file",`${r}`);for(const m in t)w.append(m,t[m]);return`${c}?${w.toString()}`}function o(r){return e?(new URL(r).hash&&(r=r.slice(0,r.indexOf("#"))),`${r}#${e}`):r}let l="about:blank";if(this.isDummy()&&(l="about:blank"),this.summary.has_file&&this.summary.file_type==".pdf"){const r=this.getRawDocURL();l=s(o(r))}if(this.summary.has_file&&this.summary.file_type==".html"){const r=this.getRawDocURL();l=o(r)}return!this.summary.has_file&&this.summary.url&&(l=o(this.summary.url)),console.log("Open doc url: ",l),l}fileType(){return this.summary.has_file&&this.summary.file_type==".pdf"?"pdf":this.summary.has_file&&this.summary.file_type==".html"?"html":!this.summary.has_file&&this.summary.url?"url":!this.summary.has_file&&!this.summary.url?"":"unknown"}}const Le={doc_type:"",has_file:!1,file_type:"",year:"0000",title:" ",author:" ",authors:[" "],publication:null,tags:[],uuid:" ",url:"about:blank",time_added:0,time_modified:0,bibtex:"",doc_size:0,note_linecount:0,has_abstract:!1};class jt{constructor(t){ae(this,"cache");ae(this,"tags");ae(this,"uids");ae(this,"dataInfoAcquireMutex",new Ft);ae(this,"conn");ae(this,"_initliazed");this.cache={},this.uids=new Array,this.tags=new H,this._initliazed=!1,this.conn=t}get initialized(){return this._initliazed}async init(){console.time("Get init data"),await Promise.all([this.updateKeyCache(),this.updateTagCache()]),console.timeEnd("Get init data"),this._initliazed=!0,console.debug("Get init data of size: ",((JSON.stringify(this.uids)+JSON.stringify(this.tags)).length*2/1024/1024).toPrecision(2),"MB")}allTags(){return this.tags}allKeys(){return this.uids}async updateKeyCache(){this.uids=await this.conn.getAllKeys()}async updateTagCache(){this.tags=new H(await this.conn.getAllTags())}async update(t,e=!0){let a;return t.uuid in this.cache?(this.cache[t.uuid].update(t),a=this.cache[t.uuid].tags):(this.cache[t.uuid]=new De(this.conn,t),a=new H),this.uids.includes(t.uuid)||this.uids.unshift(t.uuid),e&&(o=>{const l=new H;for(const r in this.cache)l.union_(this.cache[r].tags);return this.tags.union_(l),!o.issubset(l)})(a)&&await this.updateTagCache(),this.cache[t.uuid]}clear(){this.cache={},this.uids=new Array,this.tags=new H([]),this._initliazed=!1}async delete(t,e=!0){let a;t in this.cache?(a=this.cache[t].tags,delete this.cache[t]):a=null,this.uids.includes(t)&&(this.uids=this.uids.filter(o=>o!==t)),e&&(o=>{if(o===null)return!0;const l=new H;for(const r in this.cache)l.union_(this.cache[r].tags);return!o.issubset(l)})(a)&&await this.updateTagCache()}hasCache(t){return t in this.cache}getDummy(){return new De(this.conn,Le)}async aget(t){if(!(t in this.cache))try{const e=await this.conn.getDatapointSummary(t);this.cache[t]=new De(this.conn,e)}catch(e){return console.warn("Caught error in aget: ",e),new De(this.conn,Le)}return this.cache[t]}async agetMany(t,e=!0,a=!0){const s=async()=>{this.dataInfoAcquireMutex.acquire();try{const r=Object.keys(this.cache),c=t.filter(p=>!r.includes(p));if(c.length===0)return t.map(p=>this.cache[p]);const w=await this.conn.getDatapointSummaries(c);console.debug("DEBUG: get data points of size: ",w.length),w.map(p=>new De(this.conn,p)).forEach(p=>{this.cache[p.uid]=p})}catch(r){throw r}finally{this.dataInfoAcquireMutex.release()}return t.map(r=>this.cache[r])},o=async()=>await Promise.all(t.map(r=>this.aget(r)));if(e)try{return await s()}catch(l){if(a)return console.warn("Caught error in agetMany: ",l),await o();throw l}return await o()}async agetByAuthor(t){const e=await this.conn.query({searchBy:"author",searchContent:t});return await this.agetMany(e.uids)}getCacheByTags(t){t=new H(t);const e=[];for(const a in this.cache){const s=this.cache[a],o=new H(s.summary.tags);t.issubset(o.withParents())&&e.push(s)}return e}}class tt{constructor(t,e){ae(this,"conn");ae(this,"info");this.conn=t,this.info=e}get baseURL(){return this.conn.baseURL}avatarURL(t=128,e=-1){let a;return e===null?a="":e<0?a=`&t=${Date.now()}`:a=`&t=${e}`,`${this.baseURL}/user-avatar/${this.info.username}?size=${t}${a}`}}class Kt{constructor(t){ae(this,"conn");this.conn=t}async list(){return(await this.conn.getUserList()).map(e=>new tt(this.conn,e))}async get(t){let e=await this.conn.getUserInfo(t);return new tt(this.conn,e)}}var pe=function i(t){function e(ie,z){return ie>>>z|ie<<32-z}for(var a=Math.pow,s=a(2,32),o="length",l,r,c="",w=[],m=t[o]*8,p=i.h=i.h||[],u=i.k=i.k||[],f=u[o],d={},k=2;f<64;k++)if(!d[k]){for(l=0;l<313;l+=k)d[l]=k;p[f]=a(k,.5)*s|0,u[f++]=a(k,1/3)*s|0}for(t+="";t[o]%64-56;)t+="\0";for(l=0;l<t[o];l++){if(r=t.charCodeAt(l),r>>8)throw new Error("ASCII check failed");w[l>>2]|=r<<(3-l)%4*8}for(w[w[o]]=m/s|0,w[w[o]]=m,r=0;r<w[o];){var P=w.slice(r,r+=16),S=p;for(p=p.slice(0,8),l=0;l<64;l++){var g=P[l-15],D=P[l-2],$=p[0],_=p[4],v=p[7]+(e(_,6)^e(_,11)^e(_,25))+(_&p[5]^~_&p[6])+u[l]+(P[l]=l<16?P[l]:P[l-16]+(e(g,7)^e(g,18)^g>>>3)+P[l-7]+(e(D,17)^e(D,19)^D>>>10)|0),U=(e($,2)^e($,13)^e($,22))+($&p[1]^$&p[2]^p[1]&p[2]);p=[v+U|0].concat(p),p[4]=p[4]+v|0}for(l=0;l<8;l++)p[l]=p[l]+S[l]|0}for(l=0;l<8;l++)for(r=3;r+1;r--){var Z=p[l]>>r*8&255;c+=(Z<16?0:"")+Z.toString(16)}return c};class Vt{constructor({baseUrlGetter:t=()=>"",tokenGetter:e=()=>"",sessionIDGetter:a=()=>""}){this._baseUrlGetter=t,this._tokenGetter=e,this._sessionIDGetter=a}get baseUrl(){return this._baseUrlGetter()}get token(){return this._tokenGetter()}get sessionID(){return this._sessionIDGetter()}async get(t,e={}){const a=new URL(`${this._baseUrlGetter()}${t}`);return Object.keys(e).forEach(s=>a.searchParams.append(s,e[s])),await this._fetch(a.toString(),{method:"GET"})}async post(t,e={}){const a=new FormData;for(const s in e){let o=e[s];o instanceof Array&&(o=JSON.stringify(o)),a.append(s,o)}return await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"POST",body:a})}async put(t,e){const a=new FormData;return a.append("key",this._tokenGetter()),a.append("session_id",this._sessionIDGetter()),a.append("file",e),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"PUT",body:a})}async delete(t,e={}){const a=new FormData;for(const s in e){let o=e[s];o instanceof Array&&(o=JSON.stringify(o)),a.append(s,o)}return a.append("key",this._tokenGetter()),a.append("session_id",this._sessionIDGetter()),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"DELETE",body:a})}async _fetch(t,e){if(e===void 0&&(e={}),e.headers===void 0?e.headers=new Headers:typeof e.headers=="string"?e.headers=new Headers(e.headers):e.headers=new Headers(e.headers),e.headers.append("Authorization",`Bearer ${this._tokenGetter()}`),(e==null?void 0:e.method)==="GET"){const s=new URL(t);s.searchParams.append("session_id",this._sessionIDGetter()),t=s.toString()}else if((e==null?void 0:e.method)==="POST"||(e==null?void 0:e.method)==="PUT"||(e==null?void 0:e.method)==="DELETE")if(typeof e.body=="string")e.body=JSON.stringify({session_id:this._sessionIDGetter(),...JSON.parse(e.body)});else if(e.body instanceof FormData)e.body.has("session_id")||e.body.append("session_id",this._sessionIDGetter());else throw new Error("Not implemented body type");const a=await fetch(t,e);if(!a.ok)throw new Error(`Request failed with status ${a.status}`);return a}}class Zt{constructor(t,e=()=>""){ae(this,"docDry",(t,e)=>this.doc(t,e).replace("/doc/","/doc-dry/"));ae(this,"docText",(t,e)=>this.doc(t,e).replace("/doc/","/doc-text/"));this.baseURLGetter=t,this.tokenGetter=e}get baseURL(){return this.baseURLGetter()}get token(){return this.tokenGetter()}doc(t,e){return`${this.baseURL}/doc/${t}?u=${e}`}databaseDownload(t=!1){return`${this.baseURL}/api/database/download?data=${t}&key=${this.token}`}miscFile(t,e){const a=encodeURIComponent(e);return`${this.baseURL}/misc/${t}?fname=${a}`}userAvatar(t,e={size:128,t:-1}){let a;return e.t===null?a="":e.t<0?a=`&t=${Date.now()}`:a=`&t=${e.t}`,`${this.baseURL}/user-avatar/${t}?size=${e.size}${a}`}}class Gt{constructor(t,e,a=null){if(a===null){const s=Math.random().toString(36).substring(2);a=()=>s}this.fetcher=new Vt({baseUrlGetter:t,tokenGetter:e,sessionIDGetter:a}),this.resolve=new Zt(t,e)}get baseURL(){return this.fetcher.baseUrl}async authorize(){return await this.fetcher.post("/api/auth").then(t=>t.json())}async status(){return await this.fetcher.get("/api/status").then(t=>t.json())}async getAllKeys(){return await this.fetcher.get("/api/database/keys").then(t=>t.json())}async getAllTags(){return await this.fetcher.get("/api/database/tags").then(t=>t.json())}async getDatabaseFeatureTSNE(t="doc_feature",e=3,a=10){return await this.fetcher.get(`/api/datafeat/tsne/${t}`,{n_component:e.toString(),perplexity:a.toString()}).then(s=>s.json())}async getDatabaseUsage(){return await this.fetcher.get("/api/database/usage").then(t=>t.json())}async getDatapointSummary(t){return await this.fetcher.get(`/api/datainfo/${t}`).then(e=>e.json())}async getDatapointSummaries(t){return await this.fetcher.post("/api/datainfo-list",{uids:JSON.stringify(t)}).then(e=>e.json())}async deleteDatapoint(t){return await this.fetcher.post("/api/dataman/delete",{uuid:t}).then(()=>!0)}async setDatapoint(t,{bibtex:e=null,tags:a=null,url:s=null}){if(!t&&(e===null||a===null||s===null))throw new Error("uid is null, other fields should be complete");const o={};return t!==null&&(o.uuid=t),e!==null&&(o.bibtex=e),a!==null&&(o.tags=JSON.stringify(a)),s!==null&&(o.url=s),await this.fetcher.post("/api/dataman/update",o).then(l=>l.json())}async getDatapointAbstract(t){return await this.fetcher.get(`/api/datainfo-supp/abstract/${t}`).then(e=>e.text())}async setDatapointAbstract(t,e){return await this.fetcher.post(`/api/datainfo-supp/abstract-update/${t}`,{content:e}).then(a=>!0)}async getDatapointNote(t){return await this.fetcher.get(`/api/datainfo-supp/note/${t}`).then(e=>e.text())}async setDatapointNote(t,e){return await this.fetcher.post(`/api/datainfo-supp/note-update/${t}`,{content:e}).then(a=>!0)}async query({tags:t=[],searchBy:e="title",searchContent:a="",maxResults:s=9999}={}){return await this.fetcher.post("/api/filter/basic",{tags:t,search_by:e,search_content:a,top_k:s}).then(o=>o.json())}async featurizeText(t,e=!1){return await this.fetcher.post("/api/iserver/textFeature",{text:t,require_cache:e}).then(a=>a.json())}reqAISummary(t,e,a=()=>{},s=!0,o="DEFAULT"){this.fetcher.post("/api/summary",{force:s,uuid:t,model:o}).then(l=>{if(!l.ok)throw e("(Error: "+l.status+")"),new Error("HTTP error "+l.status);const r=l.body.getReader(),c=({value:w,done:m})=>{if(m){a();return}let p=new TextDecoder().decode(w);return e(p),r.read().then(c)};return r.read().then(c)})}async getMiscFileList(t){return await this.fetcher.get(`/api/misc-list/${t}`).then(e=>e.json())}async deleteMiscFile(t,e){return await this.fetcher.delete(`/misc/${t}`,{fname:e}).then(()=>!0)}async renameMiscFile(t,e,a){return await this.fetcher.post(`/misc/${t}`,{fname:e,dst_fname:a}).then(()=>!0)}async uploadMiscFiles(t,e){return(await Promise.all(e.map(s=>new Promise((o,l)=>{this.fetcher.put(`/misc/${t}`,s).then(r=>r.json()).then(o).catch(l)})))).map(s=>s.file_name)}async uploadDocument(t,e){return await this.fetcher.put(`/doc/${t}`,e).then(a=>a.json())}async deleteDocument(t){return await this.fetcher.delete(`/doc/${t}`).then(e=>e.json())}async renameTagAll(t,e){return await this.fetcher.post("/api/database/tag-rename",{oldTag:t,newTag:e}).then(()=>!0)}async deleteTagAll(t){return await this.fetcher.post("/api/database/tag-delete",{tag:t}).then(()=>!0)}async getUserInfo(t){return await this.fetcher.post(`/api/user/info/${t}`).then(e=>e.json())}async setUserNickname(t){return await this.fetcher.post("/api/user/info-update",{name:t}).then(e=>e.json())}async setUserPassword(t){return await this.fetcher.post("/api/user/info-update",{password:pe(t)}).then(e=>e.json())}async getUserList(){return await this.fetcher.post("/api/user/list",{}).then(t=>t.json())}async uploadUserAvatar(t,e){return await this.fetcher.put(`/user-avatar/${t}`,e).then(a=>a.json())}async setUserAccess(t,e,a,s){const o={};return o.username=t,e!==null&&(o.is_admin=e.toString()),a!==null&&(o.mandatory_tags=JSON.stringify(a)),s!==null&&(o.max_storage=s),await this.fetcher.post("/api/userman/modify",o).then(l=>l.json())}async registerUser(t,e,a,s){return await this.fetcher.post("/api/userman/register",{invitation_code:t,username:e,password:pe(a),name:s}).then(o=>o.json())}async createUser(t,e,a,s,o,l){return await this.fetcher.post("/api/userman/create",{username:t,name:e,password:pe(a),is_admin:s.toString(),mandatory_tags:JSON.stringify(o),max_storage:l}).then(r=>r.json())}async deleteUser(t){return await this.fetcher.post("/api/userman/delete",{username:t}).then(()=>!0)}async getFeedList({maxResults:t=10,category:e="",timeBefore:a=-1,timeAfter:s=-1}){return console.log("reqFeedList",t,e,a,s),await this.fetcher.post("/api/feed/query",{max_results:t,category:e,time_before:a,time_after:s}).then(o=>o.json())}async getFeedCategories(){return await this.fetcher.get("/api/feed/categories").then(t=>t.json())}async changelog(){return await this.fetcher.get("/api/info/changelog").then(t=>t.json())}}const he={};window.g_eventHooks=he;function re(i,t){if(Array.isArray(i)){for(const e of i)re(e,t);return}he[i]===void 0&&(he[i]=[]),he[i].includes(t)||he[i].push(t)}function pt(i,t){if(Array.isArray(i)){for(const e of i)pt(e,t);return}he[i]!==void 0&&(he[i]=he[i].filter(e=>e!==t))}function Jt(i,t){le(()=>{re(i,t),console.log(`registered event callback [${i}]`,t.name)}),it(()=>{pt(i,t),console.log(`unregistered event callback [${i}]`,t.name)})}class Qt{constructor(t,e){ae(this,"resetRemainingRetries",()=>{this.__remainingRetries=10});ae(this,"decreaseRemainingRetries",()=>{this.__remainingRetries-=1});ae(this,"isOpen",()=>this.ws?this.ws.readyState===WebSocket.OPEN:!1);ae(this,"willTryReconnect",()=>this.__remainingRetries>0);this.__baseUrlGetter=t,this.__tokenGetter=e,this.resetRemainingRetries(),this.sessionID=pe(Date.now().toString()).slice(0,16),this.__eventCallback_records={onopenCallback:()=>{},onmessageCallback:a=>{},oncloseCallback:()=>{},onfailedToConnectCallback:()=>{}}}connect({onopenCallback:t=()=>{},onmessageCallback:e=o=>{},oncloseCallback:a=()=>{},onfailedToConnectCallback:s=()=>{}}={}){this.__eventCallback_records={onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:s};const o=new URLSearchParams(window.location.search);o.append("key",this.__tokenGetter()),o.append("session_id",this.sessionID);const l=this.__baseUrlGetter().replace("https://","wss://").replace("http://","ws://")+"/ws?"+o.toString();return console.log("connecting to server websocket at: ",l),this.ws=new WebSocket(l),this.ws.onmessage=r=>{console.log(r);const c=JSON.parse(r.data);if(c.type==="event"){const w=c.content;if(console.log(w),Object.keys(he).includes(w.type))for(const m of he[w.type])m(w)}e(r)},this.ws.onopen=()=>{console.log("connected to server websocket"),t(),this.resetRemainingRetries()},this.ws.onclose=()=>{console.log("server websocket closed, will try to reconnect in 1 second"),a(),this.willTryReconnect()?(this.decreaseRemainingRetries(),new Promise(r=>setTimeout(r,1e3)).then(()=>{this.ws.readyState===WebSocket.CLOSED&&this.connect({onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:s})})):s()},this}send(t){this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.log("server websocket not ready, cannot send data")}resetReconnect(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.resetRemainingRetries(),this.connect(this.__eventCallback_records)}close(){this.__remainingRetries=0,this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.close():console.log("server websocket not ready, cannot close")}}async function je(i){if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(i),!0;{const t=document.createElement("textarea");t.value=i,t.style.position="absolute",t.style.left="-99999999px",document.body.prepend(t),t.select();let e=!1;try{document.execCommand("copy")}catch(a){console.log(a),e=!0}finally{t.remove()}return!e}}function Yt(i){window.open(i,"_blank")}function ht(i,t){let e=null;return function(...a){e&&window.clearTimeout(e),e=window.setTimeout(()=>{i(...a),e=null},t)}}function ft(i){let t,e,a;function s(r){var c;return((c=i.match(new RegExp(`^\\s*${r}\\s*=\\s*({.*}|"[^"]*"),?\\s*$`,"m")))==null?void 0:c[1])||""}function o(r){return r.replace(/"/g,"").replace(/{/g,"").replace(/}/g,"").trim()}t=s("volume"),e=s("number"),e||(e=s("issue")),a=s("pages"),a=a.replace("--","-"),t=o(t),e=o(e),a=o(a);let l="";return t&&(l+=`${t}`),e&&(l+=`(${e})`),a&&(l?l+=`: ${a}`:l+=`${a}`),l}function nt(i,t,e=null){let a="";if(e){let s=new Date;s.setTime(s.getTime()+e*24*60*60*1e3),a=`expires=${s.toUTCString()}; `}document.cookie=`${i}=${t}; ${a} path=/; sameSite=Lax`}function Xt(i){return decodeURIComponent(document.cookie).split("; ").forEach(a=>{if(a.startsWith(`${i}=`)&&a.includes("expires"))return!0}),!1}function en(i){const e=decodeURIComponent(document.cookie).split("; ");let a="";return e.forEach(s=>{s.indexOf(i)===0&&(a=s.substring(`${i}=`.length))}),a}const W=Be("uiStatus",{state:()=>({tagStatus:{checked:new H,all:new H,unfolded:new H},shownDataUIDs:[],shownDataScores:[],searchState:{searchBy:"title",content:""},unfoldedDataUIDs:[],recentlyReadDataUIDs:[],preferredReaderLeftPanelWidthPerc:.65,showMiscPanel:!1,popupValues:{},databaseLoadingStatus:{nCurrent:0,nTotal:-1},dataEditorOpened:!1}),getters:{databaseLoadingProgress(){return this.databaseLoadingStatus.nTotal===-1?this.databaseLoadingStatus.nCurrent===0?0:1:this.databaseLoadingStatus.nCurrent/this.databaseLoadingStatus.nTotal},focusedDataUID(){return this.unfoldedDataUIDs.length===0?null:this.unfoldedDataUIDs[0]}},actions:{updateShownData(){const i=J();this.tagStatus.all=i.allTags,console.log("DEBUG: updateShownData() is called."),X().conn.query({tags:Array.from(this.tagStatus.checked),searchBy:this.searchState.searchBy,searchContent:this.searchState.content}).then(t=>{this.shownDataUIDs=t.uids,this.shownDataScores=t.scores})},addRecentlyReadDataUID(i,t=!1){if(this.recentlyReadDataUIDs.includes(i)){if(!t)return;this.removeRecentlyReadDataUID(i)}this.recentlyReadDataUIDs.unshift(i),this.recentlyReadDataUIDs.length>5&&this.recentlyReadDataUIDs.pop()},removeRecentlyReadDataUID(i){const t=this.recentlyReadDataUIDs.indexOf(i);t!==-1&&this.recentlyReadDataUIDs.splice(t,1)},showPopup(i,t="info",e=3e3){const a=Math.random().toString();this.popupValues[a]={content:i,styleType:t},setTimeout(()=>{delete this.popupValues[a]},e)},reloadDatabase(){J().reload(()=>{this.databaseLoadingStatus.nCurrent=0,J().database.clear(),this.shownDataUIDs=[],this.shownDataScores=[]},()=>{this.databaseLoadingStatus.nTotal=-1,this.tagStatus.all=J().database.allTags(),this.updateShownData()},()=>{this.showPopup(`Failed to load database from: ${X().conn.baseURL}`,"alert"),this.databaseLoadingStatus.nTotal=-1})}}}),X=Be("connection",{state:()=>{const i=new Qt(N().backend,()=>N().encKey);return{conn:new Gt(N().backend,()=>N().encKey,()=>i.sessionID),wsConn:i}}}),J=Be("data",{state:()=>({database:new jt(X().conn),userPool:new Kt(X().conn),user:{id:-1,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}}),getters:{allTags(){return this.database.allTags()}},actions:{clearUserInfo(){this.user={id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}},reload(i=()=>{this.database.clear()},t=()=>{},e=()=>{}){i();function a(s){s.database.init().then(o=>{t()},o=>{e(o)})}a(this)}}}),N=Be("settings",{state:()=>({__encKey:(()=>{const i=localStorage.getItem("encKey");return i?(localStorage.removeItem("encKey"),nt("encKey",i,1),i):en("encKey")})(),__showTagPanel:(localStorage.getItem("showTagPanel")||String(window.innerWidth>768))==="true",__showHomeInfoPanel:(localStorage.getItem("showHomeInfoPanel")||"false")==="true",__show3DScatterPlot:(localStorage.getItem("show3DScatterPlot")||"false")==="true",__readerLayoutType:localStorage.getItem("readerLayoutType")||"2",__numItemsPerPage:localStorage.getItem("numItemsPerPage")||"50",__backendHost:sessionStorage.getItem("backendUrl")||tn(),__backendPort:sessionStorage.getItem("backendPort")||nn(),loggedIn:!1}),getters:{encKey(){return this.__encKey},backendHost(){return this.__backendHost},backendPort(){return this.__backendPort},showTagPanel(){return this.__showTagPanel},showHomeInfoPanel(){return this.__showHomeInfoPanel},show3DScatterPlot(){return this.__show3DScatterPlot},readerLayoutType(){return parseInt(this.__readerLayoutType)},numItemsPerPage(){return parseInt(this.__numItemsPerPage)}},actions:{setEncKey(i,t=void 0){t===void 0&&(t=Xt("encKey")),this.__encKey=i,nt("encKey",i,t?7:null)},setBackendHost(i){this.__backendHost=i,sessionStorage.setItem("backendUrl",i)},setBackendPort(i){this.__backendPort=i,sessionStorage.setItem("backendPort",i)},setShowTagPanel(i){this.__showTagPanel=i,localStorage.setItem("showTagPanel",i.toString())},setShowHomeInfoPanel(i){this.__showHomeInfoPanel=i,localStorage.setItem("showHomeInfoPanel",i.toString())},setShow3DScatterPlot(i){this.__show3DScatterPlot=i,localStorage.setItem("show3DScatterPlot",i.toString())},setReaderLayoutType(i){this.__readerLayoutType=i.toString(),localStorage.setItem("readerLayoutType",i.toString())},setNumItemsPerPage(i){this.__numItemsPerPage=i.toString(),localStorage.setItem("numItemsPerPage",i.toString())},backend(){return`${this.backendHost}:${this.backendPort}`}}});function tn(){let i=window.location.protocol,t=window.location.hostname;return`${i}//${t}`}function nn(){const i=window.location.port;return i==="1420"?"8080":i}function Ke(i,t,e){N().setEncKey(i,e),t!==null?J().user=t:J().clearUserInfo(),t?N().loggedIn=!0:N().loggedIn=!1}function an(){Ke("",null,!0)}async function sn(){const i=X().conn,t=N().encKey;try{const e=await i.authorize();return Ke(t,e,!0),e}catch(e){return console.log("settingsAuthentication failed: ",e),null}}function on(i,t){return pe(i+pe(t))}const ln={class:"loading-widget"},rn=B({__name:"LoadingWidget",props:{size:{default:"40px"},border_width:{default:"5px"}},setup(i){const t=i,e=R(()=>({width:t.size,height:t.size,border:t.border_width+" solid var(--color-border)",borderTopColor:"var(--color-primary)"}));return(a,s)=>(h(),y("div",ln,[n("div",{class:"loading-widget__spinner",style:se(e.value)},null,4)]))}}),Me=q(rn,[["__scopeId","data-v-1d6933bb"]]),un={class:"loading-popout"},dn=B({__name:"LoadingPopout",props:{text:{default:"loading"}},setup(i){const t=i;return(e,a)=>(h(),y("div",un,[x(Me,{size:"25px"}),n("label",null,T(t.text),1)]))}}),mt=q(dn,[["__scopeId","data-v-95a13423"]]),xe=[];class Q{static registerThemeChangeCallback(t){xe.indexOf(t)===-1&&xe.push(t)}static unregisterThemeChangeCallback(t){const e=xe.indexOf(t);e!==-1&&xe.splice(e,1)}static toggleDarkMode(){document.documentElement.classList.contains("light")?Q.setDarkMode(!0):document.documentElement.classList.contains("dark")?Q.setDarkMode(!1):(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,Q.setDarkMode(!0))}static isDefaultDarkMode(){return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}static isDarkMode(){return document.documentElement.classList.contains("light")?!1:!!document.documentElement.classList.contains("dark")}static setDefaultDarkMode(){const t=localStorage.getItem("themeMode");t==="dark"?Q.setDarkMode(!0):t=="light"?Q.setDarkMode(!1):Q.isDefaultDarkMode()&&!Q.isDarkMode()&&this.setDarkMode(!0,!1)}static setDarkMode(t,e=!0){t?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"));for(let a of xe)a(t);if(e){const a=t?"dark":"light";localStorage.getItem("themeMode")!==a&&localStorage.setItem("themeMode",t?"dark":"light")}}static getThemeMode(){const t=localStorage.getItem("themeMode");return t==="dark"?"dark":t==="light"?"light":"auto"}static clear(){document.documentElement.classList.remove("dark"),document.documentElement.classList.remove("light"),this.setDefaultDarkMode(),localStorage.removeItem("themeMode")}}function at(i,t){let e=i.parentNode;for(;e!=null;){if(e==t)return!0;e=e.parentNode}return!1}function Ce(i){if(i===null||typeof i!="object")return i;let t=Array.isArray(i)?[]:{};for(let e in i)t[e]=Ce(i[e]);return t}function vt(i,t,e=!1){if(i.length!==t.length)throw new Error("arr.length !== scores.length");const a=new Array;for(let r=0;r<i.length;r++)a.push([i[r],t[r]]);let s;e?s=a.sort((r,c)=>r[1]-c[1]):s=a.sort((r,c)=>c[1]-r[1]);const o=new Array,l=new Array;for(const r of s)o.push(r[0]),l.push(r[1]);return[o,l]}const cn={id:"popups"},pn={id:"app"},hn=B({__name:"App",setup(i){const t=me(),e=W(),a=N();t.isReady().then(()=>{if(t.currentRoute.value.query.backendPort&&N().setBackendPort(t.currentRoute.value.query.backendPort),t.currentRoute.value.query.backendHost&&N().setBackendHost(t.currentRoute.value.query.backendHost),t.currentRoute.value.query.credential&&N().setEncKey(t.currentRoute.value.query.credential,!1),window.location.hash.split("?")[0]!=="#/login"){console.log("Authenticating...");const d=()=>{a.loggedIn?a.loggedIn=!1:s()};sn().then(k=>{k||d()},()=>{d()})}});function s(){J().$reset(),W().$reset(),o.close(),t.push({path:"/login",query:{from:t.currentRoute.value.fullPath}})}ne(()=>a.loggedIn,(d,k)=>{d?u():s()});const o=X().wsConn,l=b(!1),r=b(!1),c=b(window.location.hash.split("?")[0]==="#/login");t.afterEach((d,k)=>{c.value=d.path==="/login"});const w=R(()=>!l.value&&!c.value&&!r.value),m=R(()=>r.value&&!c.value);function p(){o.connect({onopenCallback:()=>{l.value=!0,r.value=!1},oncloseCallback:()=>l.value=!1,onfailedToConnectCallback:()=>r.value=!0})}setInterval(()=>{!o.isOpen()&&l.value&&!c.value&&!r.value?(console.log("DEBUG: Connection lost, try to reconnect"),l.value=!1,p()):c.value&&o.willTryReconnect()&&(console.log("DEBUG: In login page, close connection."),o.close())},5e3);function u(){p(),e.reloadDatabase()}re("add_entry",d=>{const k=J(),P=d.datapoint_summary;k.database.update(P).then(()=>{console.log("DEBUG: add entry update UI"),e.updateShownData()})}),re(["update_entry","update_note"],d=>{const k=J(),P=d.datapoint_summary;k.database.update(P).then(()=>{console.log("DEBUG: update entry update UI"),e.updateShownData()})}),re("delete_entry",d=>{const k=J(),P=d.uuid;k.database.delete(P).then(()=>{console.log("DEBUG: delete entry update UI"),e.updateShownData()})}),re(["delete_tag","update_tag"],d=>{const k=new H([d.src_tag]),P=J();(async function(){await P.database.updateTagCache();const g=P.database.getCacheByTags(k);await Promise.all(g.map(D=>D.update())),e.updateShownData(),console.log("DEBUG: update tag update UI")})()}),re("update_user",d=>{if(d.username===J().user.username){if(d.user_info===null)throw new Error("assertion failed: User info is null");for(const k of Object.keys(J().user))k!=="enc_key"&&(J().user[k]=d.user_info[k])}});const f=()=>{window.location.reload()};return le(()=>{Q.setDefaultDarkMode()}),(d,k)=>{const P=He("router-view");return h(),y(j,null,[n("div",cn,[(h(!0),y(j,null,te(Object.keys(C(e).popupValues),(S,g)=>(h(),Y(et,{key:g,styleType:C(e).popupValues[S].styleType,style:se({transform:`translate(-50%, ${-50+110*g}%) scale(0.9)`})},{default:L(()=>[E(T(C(e).popupValues[S].content),1)]),_:2},1032,["styleType","style"]))),128))]),w.value?(h(),Y(mt,{key:0,text:"connecting..."})):A("",!0),m.value?(h(),Y(et,{key:1,styleType:"info",position:"center"},{default:L(()=>[n("div",{style:{display:"flex","flex-direction":"column","align-items":"center",margin:"10px"}},[k[2]||(k[2]=n("div",null,[n("div",{style:{"font-size":"2em","font-weight":"bold",color:"var(--color-red)"}},"Failed to connect to server"),n("div",{style:{color:"gray"}},"Maximum retry exceeded")],-1)),n("div",{style:{"font-size":"1.2em","margin-top":"10px"}},[k[0]||(k[0]=E(" Please check if the server is running, make sure your network is working properly, and try to ")),n("a",{style:{"text-decoration":"underline",cursor:"pointer"},onClick:f},"reload the page"),k[1]||(k[1]=E(". "))])])]),_:1})):A("",!0),n("div",pn,[x(P,null,{default:L(({Component:S})=>[(h(),Y(Pt,{exclude:"Reader"},[(h(),Y(Ct(S)))],1024))]),_:1})])],64)}}}),fn=q(hn,[["__scopeId","data-v-934929d5"]]),mn={for:"chk"},vn={id:"checkCircle"},gn={key:0,id:"checkStatus"},yn=B({__name:"Toggle",props:{checked:{type:Boolean},identifier:{default:""}},emits:["onCheck"],setup(i,{emit:t}){const e=t,a=i;function s(o){e("onCheck",a.identifier)}return(o,l)=>(h(),y("div",{class:"toggle",onClick:s},[n("label",mn,[ce(o.$slots,"default",{},void 0)]),n("div",vn,[o.checked?(h(),y("div",gn)):A("",!0)])]))}}),ye=q(yn,[["__scopeId","data-v-582ee950"]]),wn={class:"toggleText"},_n={class:"children slideInDown"},bn=B({__name:"TagCollapsibleToggle",props:{tagStatus:{},identifier:{default:""},children:{}},emits:["update:tagStatus"],setup(i,{emit:t}){const e=i,a=t,s=R({get:()=>e.tagStatus,set:d=>a("update:tagStatus",d)}),o=R(()=>{let d="collapseButton";return Object.keys(e.children).length!==0&&(d+=" collapsible"),d}),l=b(null),r=R(()=>!e.tagStatus.unfolded.has(e.identifier)),c=R(()=>r.value?"triangle-right":"triangle-down rotate90in");function w(d){let k=s.value.unfolded;k.has(e.identifier)?k.delete(e.identifier):k.add(e.identifier)}const m=R(()=>e.tagStatus.checked.has(e.identifier));function p(d){if(d===void 0)return;let k=s.value.checked;k.has(d)?k.delete(d):k.add(d)}const u=b(null),f=d=>{d.button===2&&(w(),d.preventDefault())};return We(()=>{var d;(d=u.value)==null||d.addEventListener("contextmenu",f)}),lt(()=>{var d;(d=u.value)==null||d.removeEventListener("contextmenu",f)}),(d,k)=>(h(),y(j,null,[n("div",{class:"row",ref_key:"rowDiv",ref:u},[n("div",{id:"button",class:de(o.value),ref_key:"button",ref:l,onClick:w},[Object.keys(e.children).length!==0?(h(),y("div",{key:0,class:de(c.value)},null,2)):A("",!0)],2),n("div",wn,[x(ye,{checked:m.value,identifier:e.identifier,onOnCheck:p},{default:L(()=>[ce(d.$slots,"default",{},void 0,!0)]),_:3},8,["checked","identifier"])])],512),V(n("div",_n,[(h(!0),y(j,null,te(d.children,(P,S)=>(h(),Y(gt,{identifier:String(S),children:P,"tag-status":s.value,"onUpdate:tagStatus":k[0]||(k[0]=g=>s.value=g)},{default:L(()=>[E(T(String(S).split(C(ue)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tag-status"]))),256))],512),[[It,!r.value]])],64))}}),gt=q(bn,[["__scopeId","data-v-3c7d3255"]]),kn={id:"tagSelector-main",class:"hover-scrollable"},Sn=B({__name:"TagSelector",props:{tagStatus:{}},emits:["update:tagStatus"],setup(i,{emit:t}){const e=i,a=t,s=R(()=>_e.tagHierarchy(e.tagStatus.all)),o=R(()=>Object.keys(s.value).sort()),l=R({get:()=>e.tagStatus,set:r=>a("update:tagStatus",r)});return(r,c)=>(h(),y("div",kn,[(h(!0),y(j,null,te(o.value,w=>(h(),Y(gt,{identifier:String(w),children:s.value[w],tagStatus:l.value,"onUpdate:tagStatus":c[0]||(c[0]=m=>l.value=m)},{default:L(()=>[E(T(String(w).split(C(ue)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tagStatus"]))),256))]))}}),yt=q(Sn,[["__scopeId","data-v-f90dfe41"]]),$n={key:0,class:"prefix"},Dn=B({__name:"TagBubble",props:{tag:{},tStyle:{default:""}},emits:["click"],setup(i,{emit:t}){const e=i,a=t,s=R(()=>{const o=e.tag.split(ue);return o.length==1?["",o[0]]:[o.slice(0,o.length-1).join("·"),o[o.length-1]]});return(o,l)=>(h(),y("div",{class:de(`bubble${o.tStyle?" "+o.tStyle:""}`),onClick:l[0]||(l[0]=()=>a("click"))},[s.value[0]?(h(),y("div",$n,T(s.value[0]),1)):A("",!0),E(" "+T(s.value[1]),1)],2))}}),xn=q(Dn,[["__scopeId","data-v-f454bc70"]]),Cn=B({__name:"TagBubbleContainer",props:{tags:{},highlightTags:{default:null},mutedTags:{default:null},maxWidth:{default:null},middleAlign:{type:Boolean,default:!1}},emits:["clickOnBubble"],setup(i,{emit:t}){const e=i,a=t,s=R(()=>{const o={};for(const l of e.tags)e.highlightTags&&e.highlightTags.has(l)?o[l]="highlight":e.mutedTags&&e.mutedTags.has(l)?o[l]="muted":o[l]="";return o});return(o,l)=>(h(),y("div",{id:"bubbleContainer",style:se({maxWidth:`${(e.maxWidth?e.maxWidth:999)-10}px`,justifyContent:e.middleAlign?"center":"flex-start"})},[(h(!0),y(j,null,te(e.tags,r=>(h(),Y(xn,{onClick:()=>a("clickOnBubble",r),tag:r,"t-style":s.value[r]},null,8,["onClick","tag","t-style"]))),256))],4))}}),Ve=q(Cn,[["__scopeId","data-v-62e107cd"]]),Pn=B({__name:"FileTags",emits:["onCheck"],setup(i,{emit:t}){const e=t,a=W(),s=J(),o=b(null),l=b(null);ne(()=>a.unfoldedDataUIDs,()=>{a.unfoldedDataUIDs.length==0?l.value=null:a.shownDataUIDs.includes(a.unfoldedDataUIDs[0])&&s.database.aget(a.unfoldedDataUIDs[0]).then(u=>{l.value=u})});const r=R(()=>l.value==null?null:a.tagStatus.checked.withChildsFrom(l.value.tags)),c=R(()=>{const u=a.tagStatus.checked.copy();return l.value!==null&&u.pop_ifcontains_(l.value.tags),u});function w(){a.tagStatus.checked=new H,a.updateShownData()}ne(a.tagStatus,()=>e("onCheck",a.tagStatus),{deep:!0});function m(){const u=prompt("Old tag");if(u&&s.database.allTags().has(u)){const f=prompt("New tag");f&&X().conn.renameTagAll(u,f).then(()=>{a.showPopup("Tag renamed","success")},()=>{a.showPopup("Failed to rename tag","error")})}else a.showPopup("Invalid tag","warning")}function p(){const u=prompt("Tag to delete");if(u&&s.database.allTags().has(u)){if(!confirm(`Are you sure to delete tag "${u}"?`))return;X().conn.deleteTagAll(u).then(()=>{a.showPopup("Tag deleted","success")},()=>{a.showPopup("Failed to delete tag","error")})}else a.showPopup("Invalid tag","warning")}return(u,f)=>(h(),y("div",{id:"file-tags-main",ref_key:"ftPanel",ref:o},[n("div",{class:"title"},[n("div",{id:"title-title"},[f[3]||(f[3]=n("h3",{class:"green"},"Tags",-1)),n("div",{id:"title-buttons"},[n("div",{class:"button",onClick:m},"rename"),n("div",{class:"button",onClick:p},"delete")])]),f[4]||(f[4]=n("hr",null,null,-1))]),x(yt,{onOnCheck:f[0]||(f[0]=d=>e("onCheck",d)),tagStatus:C(a).tagStatus,"onUpdate:tagStatus":f[1]||(f[1]=d=>C(a).tagStatus=d)},null,8,["tagStatus"]),f[5]||(f[5]=n("hr",null,null,-1)),x(Ve,{onClickOnBubble:f[2]||(f[2]=d=>{C(a).tagStatus.checked.has(d)?C(a).tagStatus.checked.delete(d):C(a).tagStatus.checked.add(d),C(a).updateShownData()}),tags:l.value?l.value.tags:C(a).tagStatus.checked,"highlight-tags":r.value,"muted-tags":c.value,"max-width":o.value?o.value.clientWidth:null},null,8,["tags","highlight-tags","muted-tags","max-width"]),n("div",{class:"buttons"},[n("button",{id:"btnClear",class:"green",onClick:w},"CLEAR SELECTION")])],512))}}),In=q(Pn,[["__scopeId","data-v-daf9360f"]]),Tn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-80q-50%200-85-35t-35-85v-120h120v-560h600v680q0%2050-35%2085t-85%2035H240Zm480-80q17%200%2028.5-11.5T760-200v-600H320v480h360v120q0%2017%2011.5%2028.5T720-160ZM360-600v-80h360v80H360Zm0%20120v-80h360v80H360ZM240-160h360v-80H200v40q0%2017%2011.5%2028.5T240-160Zm0%200h-40%20400-360Z'/%3e%3c/svg%3e",Ze="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M480%20856q-115%200-197.5-82.5T200%20576q0-115%2082.5-197.5T480%20296q115%200%20197.5%2082.5T760%20576q0%20115-82.5%20197.5T480%20856Z'/%3e%3c/svg%3e",Un="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M331%20625h37v-83h48q15.725%200%2026.362-10.638Q453%20520.725%20453%20505v-48q0-15.725-10.638-26.362Q431.725%20420%20416%20420h-85v205Zm37-120v-48h48v48h-48Zm129%20120h84q15%200%2026-10.638%2011-10.637%2011-26.362V457q0-15.725-11-26.362Q596%20420%20581%20420h-84v205Zm37-37V457h47v131h-47Zm133%2037h37v-83h50v-37h-50v-48h50v-37h-87v205ZM260%20856q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h560q24%200%2042%2018t18%2042v560q0%2024-18%2042t-42%2018H260ZM140%20976q-24%200-42-18t-18-42V296h60v620h620v60H140Z'/%3e%3c/svg%3e",Rn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Z'/%3e%3c/svg%3e",An="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Zm0-60h500q45%200%2077-32t32-77q0-45-32-77t-77-32h-63v-84q0-91-61-154t-149-63q-88%200-149.5%2063T267%20534h-19q-62%200-105%2043.5T100%20685q0%2063%2044%20107t107%2044Zm229-260Z'/%3e%3c/svg%3e",Ln="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554h189L551%20236v186Z'/%3e%3c/svg%3e",Bn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554V236H220v680h520V422H551ZM220%20236v186-186%20680-680Z'/%3e%3c/svg%3e",Mn={key:0,id:"window"},En={class:"header"},qn=B({__name:"FloatingWindow",props:{title:{default:"_"},show:{type:Boolean},closeKey:{default:"Escape"},compact:{type:Boolean,default:!1},zIndex:{default:100}},emits:["close","onClose","update:show"],setup(i,{emit:t}){const e=i,a=t,s=R({get:()=>e.show,set:r=>{a("update:show",r)}});function o(){s.value=!1,a("onClose"),a("close")}function l(r){r.target===r.currentTarget&&o()}return window.addEventListener("keydown",r=>{r.key===e.closeKey&&(o(),r.preventDefault())}),(r,c)=>s.value?(h(),y("div",Mn,[n("div",{id:"blocker",onClick:l,style:se({"z-index":r.zIndex-1})},[n("div",{class:"floating-window",style:se({"z-index":r.zIndex})},[n("div",En,[n("label",null,T(e.title),1),n("button",{class:"close-button",onClick:o},c[0]||(c[0]=[n("span",{class:"close-icon"},"✕",-1)]))]),n("div",{class:"window-content scrollable",style:se({margin:e.compact?"0px":"15px",marginTop:e.compact?"0px":"5px"})},[ce(r.$slots,"default",{},void 0)],4)],4)],4)])):A("",!0)}}),ge=q(qn,[["__scopeId","data-v-c6dbcdc2"]]),Fn={id:"query-dialog-main"},zn={class:"content"},On={id:"buttons"},Hn=B({__name:"QueryDialog",props:{show:{type:Boolean},title:{default:"Query"},showCancel:{type:Boolean,default:!0},zIndex:{default:99}},emits:["update:show","onClose","onAccept","onCancel"],setup(i,{emit:t}){const e=i,a=t,s=R({get:()=>e.show,set:o=>{a("update:show",o)}});return(o,l)=>(h(),Y(ge,{show:s.value,"onUpdate:show":l[2]||(l[2]=r=>s.value=r),title:o.title,compact:!0,"z-index":o.zIndex,onOnClose:l[3]||(l[3]=()=>a("onClose"))},{default:L(()=>[n("div",Fn,[n("div",zn,[ce(o.$slots,"default",{},void 0,!0)]),n("div",On,[n("div",{class:"button ok-button",onClick:l[0]||(l[0]=()=>a("onAccept"))},"OK"),o.showCancel?(h(),y("div",{key:0,class:"button cancel-button last-button",onClick:l[1]||(l[1]=()=>a("onCancel"))},"Cancel")):A("",!0)])])]),_:3},8,["show","title","z-index"]))}}),we=q(Hn,[["__scopeId","data-v-81948a9f"]]),Wn={id:"tag-selector-with-entry-main"},Nn={style:{textAlign:"left"}},jn={id:"tagSelector",class:"scrollable"},Kn={class:"entry"},Vn=B({__name:"TagSelectorWithEntry",props:{tagStatus:{},tagInputValue:{default:""}},emits:["update:tagStatus","update:tagInputValue"],setup(i,{emit:t}){const e=i,a=t,s=R({get:()=>e.tagStatus,set:c=>a("update:tagStatus",c)}),o=b(e.tagInputValue);ne(()=>e.tagInputValue,c=>{o.value=c});const l=R({get:()=>o.value,set:c=>{a("update:tagInputValue",c),o.value=c}}),r=()=>{const c=l.value.trim();c!==""&&(s.value.all.add(c),s.value.checked.add(c),s.value.unfolded.union_(_e.allParentsOf(c)),l.value="")};return(c,w)=>(h(),y("div",Wn,[n("div",Nn,[w[2]||(w[2]=n("label",{for:"tagSelector"},"Tags",-1)),n("div",jn,[x(yt,{tagStatus:s.value,"onUpdate:tagStatus":w[0]||(w[0]=m=>s.value=m)},null,8,["tagStatus"])])]),n("div",Kn,[V(n("input",{type:"text",placeholder:"New tag","onUpdate:modelValue":w[1]||(w[1]=m=>l.value=m),onKeyup:Ne(r,["enter"])},null,544),[[ee,l.value]]),n("button",{class:de(`green${l.value?" to-be-confirmed":""}`),onClick:r},"ADD",2)])]))}}),Zn=q(Vn,[["__scopeId","data-v-990ad4c4"]]);async function Gn(i){const t=`https://export.arxiv.org/api/query?id_list=${i}`,a=await(await fetch(t,{method:"GET"})).text();let l=new zt.XMLParser().parse(a).feed.entry;function r(c){return Array.isArray(c.author)?c.author.map(w=>w.name):c.author?[c.author.name]:[]}if(l){const c=l.id.split("/").pop().split("v")[0],w=l.id,m=l.title,p=l.summary,u=r(l),f=l.updated,d=l.published;return{id:c,link:w,title:m,abstract:p,authors:u,updatedTime:f,publishedTime:d}}else throw new Error("Failed to fetch paper from arxiv")}function Jn(i){return`@article{${i.id},
  author = {${i.authors.join(" and ")}},
  title = {${i.title}},
  journal = {arXiv preprint arXiv:${i.id}},
  year = {${i.publishedTime.split("-")[0]}},
  abstract = {${i.abstract}}
  }`.replace(/  /g,"")}const st=(i,{entry:t="",title:e="",authors:a=[""],year:s=new Date().getFullYear()}={})=>(t||(t=`${s}_${Math.random().toString(36).substring(7)}`),i=="article"?`@article{${t},
        author = {${a.join(" and ")}},
        title = {${e}},
        journal = {},
        year = {${s}},
        abstract = {},
        volume = {},
        number = {},
        pages = {},
        month = {},
        doi = {},
        }`.replace(/  /g,""):i=="inproceedings"?`@inproceedings{${t},
        author = {${a.join(" and ")},
        title = {${e}},
        booktitle = {},
        year = {${s}},
        abstract = {},
        editor = {},
        volume = {},
        number = {},
        series = {},
        pages = {},
        }`.replace(/  /g,""):i=="webpage"||i=="online"?`@online{${t},
        title = {${e}},
        author = {${a.join(" and ")}},
        year = {${s}},
        url = {},
        note = {}
        }`.replace(/  /g,""):i=="misc"?`@misc{${t},
        author = {${a.join(" and ")}},
        title = {${e}},
        year = {${s}},
        url = {},
        }`.replace(/  /g,""):"");class ze{static async fromArxiv(t){let e=t.toLowerCase();e.startsWith("arxiv:")?e=e.split("arxiv:")[1]:e.includes("arxiv.org/abs/")?e=e.split("arxiv.org/abs/")[1]:e.includes("arxiv.org/pdf/")&&(e=e.split("arxiv.org/pdf/")[1].split(".pdf")[0]);const a=await Gn(e);return{bibtex:Jn(a),url:a.link}}static async fromWebpage(t){var c;const a=await(await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`)).text(),l=(c=new DOMParser().parseFromString(a,"text/html").querySelector("title"))==null?void 0:c.innerText;return{bibtex:`@misc{${t},
            author = {},
            title = {${l}},
            url = {${t}},
            year = {${new Date().getFullYear()}},
            }`.replace(/  /g,""),url:t}}static async fromDoi(t){const e=`https://api.crossref.org/works/${t}/transform/application/x-bibtex`;return{bibtex:await(await fetch(e,{method:"GET"})).text(),url:`https://doi.org/${t}`}}}const Qn={key:0,id:"arrow"},Yn=["onKeydown","onClick"],Xn=B({__name:"Menu",props:{show:{type:Boolean},menuItems:{},position:{},blocker:{type:Boolean,default:!1},middleTop:{type:Boolean,default:!1},zIndex:{default:100},arrow:{type:Boolean,default:!1}},emits:["update:show"],setup(i,{emit:t}){const e=i,a=t,s=R({get:()=>e.show,set:l=>{a("update:show",l)}});function o(){s.value=!1}return(l,r)=>(h(),y(j,null,[l.blocker?(h(),y("div",{key:0,id:"blocker",onClick:o,style:se({zIndex:e.zIndex-1})},null,4)):A("",!0),n("div",{id:"floatingMenu",style:se({left:e.position.x+"px",top:e.position.y+"px",visibility:s.value?"visible":"hidden",transform:e.middleTop?"translate(-50%, 0)":"",zIndex:e.zIndex})},[e.arrow?(h(),y("div",Qn)):A("",!0),(h(!0),y(j,null,te(e.menuItems,(c,w)=>(h(),y("div",{class:de(`non-selectable floatingMenuItem${w!==e.menuItems.length-1?"":" floatingMenuItemLast"}`),tabindex:"0",onKeydown:Ne(m=>{c.action(),o()},["enter"]),onClick:m=>{c.action(),o()}},T(c.name),43,Yn))),256))],4)],64))}}),ea=q(Xn,[["__scopeId","data-v-c6b659c7"]]),$e=B({name:"file-select-button",props:{asLink:{type:Boolean,default:!1},text:{type:String,default:"Upload"},action:{type:Function,required:!0},style:{type:Object,default:()=>({})}},setup(i,t){const e=b(null),a=o=>{const l=o.target;if(l.files&&l.files.length>0){const r=l.files[0];i.action(r)}};function s(){e.value.click()}return t.expose({click:s}),()=>x(j,null,[x("input",{type:"file",id:"upload-file",onChange:a,ref:e,style:{display:"none"}},null),i.asLink?x("a",{class:"btn upload-btn",rel:"noopener noreferrer",onClick:()=>e.value.click(),style:i.style},[i.text]):x("button",{type:"button",class:"btn upload-btn",onClick:()=>e.value.click(),style:i.style},[i.text])])}}),Ge=B({name:"editable-paragraph",props:{contentEditable:{type:Boolean,default:!0},style:{type:Object,default:()=>({})}},emits:["finish","change"],setup(i,t){const e=b(null),a=u=>{e.value.innerText=u},s=u=>{e.value.contentEditable=u.toString()},o=u=>e.value.contains(u),l=function(){return document.activeElement===e.value},r=R({get(){return e.value.innerText},set(u){e.value.innerText=u}});t.expose({setText:a,setEditable:s,contains:o,innerText:r,hasFocus:l});const c=()=>{t.emit("change",e.value.innerText)},w=()=>{t.emit("finish",e.value.innerText)},m=u=>{if(u.key==="Enter")if(u.ctrlKey||u.metaKey){u.preventDefault();const f=window.getSelection(),d=f==null?void 0:f.getRangeAt(0);if(d){const k=document.createElement("br");d.insertNode(k),d.setStartAfter(k),d.setEndAfter(k),f==null||f.removeAllRanges(),f==null||f.addRange(d)}}else e.value.blur()},p=u=>{var d;u.preventDefault();const f=(d=u.clipboardData)==null?void 0:d.getData("text/plain");document.execCommand("insertText",!1,f)};return()=>x("p",{class:"editable-paragraph",contenteditable:i.contentEditable,ref:e,onInput:c,onBlur:w,onKeydown:m,style:i.style,onPaste:p},[t.slots.default&&t.slots.default()])}}),ta=B({name:"menu-attached",props:{menuItems:{type:Array,required:!0}},setup(i,t){const e=b(!1),a=b(null),s=b({x:0,y:0});return ne(e,o=>{if(o){const l=a.value.getBoundingClientRect();s.value={x:l.left+l.width/2,y:l.bottom+5}}else s.value={x:0,y:0}}),()=>x("div",null,[x("div",{ref:a,onClick:()=>e.value=!e.value,onKeydown:o=>{o.key==="Enter"&&(o.preventDefault(),e.value=!e.value)}},[t.slots.default&&t.slots.default()]),x(ea,{show:e.value,"onUpdate:show":o=>e.value=o,menuItems:i.menuItems,position:s.value,middleTop:!0,arrow:!0},null)])}}),na=B({name:"CircularImage",props:{href:{type:String,required:!0},size:{type:String,required:!0},alt:{type:String,default:""}},emits:["click"],setup(i,t){const e={width:`${i.size}`,height:`${i.size}`,borderRadius:"50%",border:"1px solid var(--color-border)",overflow:"hidden"};return()=>x("img",{src:i.href,alt:i.alt,style:e,onClick:()=>t.emit("click")},null)}});function ot(i){function t(m,p){var f;const u=(f=m.split(".").pop())==null?void 0:f.toLowerCase();for(const d of p)if(u===d)return!0;return!1}function e(m){return!!(m.type.startsWith("image/")||t(m.name,["jpg","jpeg","png","gif","bmp","svg","webp"]))}function a(m){return!!(m.type==="application/pdf"||t(m.name,["pdf"]))}function s(m){return!!(m.type==="text/html"||t(m.name,["html"]))}function o(m){return!!(m.type==="text/plain"||t(m.name,["txt","bib","bibtex","nbib","enw","ris"]))}function l(m){return!!(a(m)||s(m)||e(m))}const r=[],c=[],w=[];for(let m=0;m<i.length;m++)o(i[m])?r.push(i[m]):l(i[m])?c.push(i[m]):w.push(i[m]);return{citation:r,document:c,unknown:w}}const aa={style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",width:"100%",height:"100%"}},sa={style:{margin:"10px"}},oa={style:{display:"flex",flexDirection:"row",gap:"10px",border:"1px solid var(--color-border)"}},ia={class:"bibsource-container"},la={class:"bibsource-container"},ra={class:"bibsource-container"},ua=["placeholder"],da={key:0},ca={id:"inputDiv"},pa={id:"inputLeft"},ha={id:"bibtexArea"},fa={class:"horizontal"},ma={id:"bibtexSource",class:"horizontal"},va={id:"urlArea"},ga={id:"inputRight"},ya={key:0,style:{display:"flex","justify-content":"center","align-items":"center","padding-inline":"15px"}},wa={style:{"margin-top":"5px","text-wrap":"nowrap","white-space":"nowrap","margin-inline":"5px"}},_a={key:1},ba=B({__name:"DataEditor",setup(i,{expose:t}){const e=W(),a=X().conn,s=b(!1),o=b(null),l=b(""),r=b(""),c=b(null),w=b({all:new H,checked:new H,unfolded:new H});function m(){const O={uuid:o.value?o.value.summary.uuid:null,bibtex:l.value,tags:Array.from(w.value.checked),url:r.value,file:c.value};f(),e.showPopup("Saving entry...","info"),a.setDatapoint(O.uuid,{bibtex:O.bibtex,tags:O.tags,url:O.url}).then(I=>{O.file?(e.showPopup("Uploading document...","info"),a.uploadDocument(I.uuid,O.file).then(M=>{e.showPopup("Saved","success")},()=>e.showPopup("Failed to upload document","error"))):e.showPopup("Saved","success")},()=>e.showPopup("Failed to save","error"))}const p=b("");function u({datapoint:O=null,bibtex:I=null,url:M=null,tags:oe=null}){e.dataEditorOpened||(e.dataEditorOpened=!0,O!==null&&(o.value=O,l.value=O.summary.bibtex,r.value=O.summary.url,oe===null&&(oe=new H(O.summary.tags))),I!==null&&(l.value=I),M!==null&&(r.value=M),oe!==null?(Array.isArray(oe)&&(oe=new H(oe)),w.value={all:new H(e.tagStatus.all).union(oe),checked:oe,unfolded:oe.allParents()}):w.value={all:new H(e.tagStatus.all),checked:new H(e.tagStatus.checked),unfolded:new H(e.tagStatus.unfolded)},s.value=!0)}function f(){s.value=!1,o.value=null,l.value="",r.value="",w.value={all:new H(e.tagStatus.all),checked:new H(e.tagStatus.checked),unfolded:new H(e.tagStatus.unfolded)},c.value=null,p.value="",z.value=!1,e.dataEditorOpened=!1}function d(){return s.value}function k(O){if(o.value)return e.showPopup("Document can only be added to new entry","error"),!1;if(!ot([O]).document)return e.showPopup("Unsupported file","error"),!1;if(c.value=O,console.log("file selected"),l.value.trim().length===0){console.log("try to extract bibtex from file");const I=O.name,M=O.lastModified;let oe=g.value;switch(I.split(".").pop()){case"pdf":oe="article";break;case"html":oe="online";break}const Re=st(oe,{title:I,year:new Date(M).getFullYear()});l.value=Re}return!0}function P(O){let I=!1;if(!O||O.length===0)return I;const M=ot(O);if((M.citation.length>1||M.document.length>1)&&e.showPopup("Only one citation and one document are allowed","error"),M.citation.length==0&&M.document.length==0&&(console.log("[Error] Got files: ",O),e.showPopup("Unsupported file type","error")),M.citation.length>0){const oe=M.citation[0];if(oe.size<64*1024){const Re=new FileReader;Re.onload=St=>{var Ye;const $t=(Ye=St.target)==null?void 0:Ye.result;l.value=$t},Re.readAsText(oe),I=!0}else e.showPopup("Text file too large","error")}return M.document.length>0&&(I=k(M.document[0])),I}t({show:u,close:f,isShown:d,loadFiles:P});const S=b(!1),g=b("article"),D=R(()=>st(g.value)),$=b(!1),_=b("arxiv"),v={arxiv:O=>ze.fromArxiv(O),doi:O=>ze.fromDoi(O),webpage:O=>ze.fromWebpage(O)},U={arxiv:"e.g. 2106.00001",doi:"e.g. 10.1145/344779.344937",webpage:"e.g. https://news.mit.edu/2021/xxx"},Z=b("");function ie(O){e.showPopup("Fetching from BibTeX source...","info"),$.value=!1,Z.value="",v[_.value](O).then(I=>{e.showPopup("Obtained bibtex from source","success"),l.value=I.bibtex,r.value=I.url},()=>{e.showPopup("Failed to fetch from source","error")})}const z=b(!1),F=b(null),K=O=>{O.preventDefault(),z.value=!0},G=O=>{O.preventDefault(),z.value=!1},fe=O=>{var M;O.preventDefault();const I=(M=O.dataTransfer)==null?void 0:M.files;I&&P(I),z.value=!1};return(O,I)=>(h(),y(j,null,[x(we,{show:S.value,"onUpdate:show":I[4]||(I[4]=M=>S.value=M),onOnAccept:I[5]||(I[5]=()=>{l.value=D.value,S.value=!1}),onOnCancel:I[6]||(I[6]=M=>S.value=!1),"z-index":102,title:"Select template"},{default:L(()=>[n("div",aa,[x(ye,{onOnCheck:I[0]||(I[0]=M=>g.value="article"),checked:g.value=="article"},{default:L(()=>I[22]||(I[22]=[E("Article")])),_:1},8,["checked"]),x(ye,{onOnCheck:I[1]||(I[1]=M=>g.value="inproceedings"),checked:g.value=="inproceedings"},{default:L(()=>I[23]||(I[23]=[E("Inproceedings")])),_:1},8,["checked"]),x(ye,{onOnCheck:I[2]||(I[2]=M=>g.value="webpage"),checked:g.value=="webpage"},{default:L(()=>I[24]||(I[24]=[E("Webpage")])),_:1},8,["checked"]),x(ye,{onOnCheck:I[3]||(I[3]=M=>g.value="misc"),checked:g.value=="misc"},{default:L(()=>I[25]||(I[25]=[E("Misc")])),_:1},8,["checked"])])]),_:1},8,["show"]),x(we,{show:$.value,"onUpdate:show":I[11]||(I[11]=M=>$.value=M),onOnCancel:I[12]||(I[12]=M=>$.value=!1),onOnAccept:I[13]||(I[13]=()=>{ie(Z.value)}),"z-index":102,title:"Source input"},{default:L(()=>[n("div",sa,[n("fieldset",oa,[I[29]||(I[29]=n("legend",null,"Source",-1)),n("div",ia,[V(n("input",{type:"radio",id:"bibsource-arxiv",name:"bibSource",value:"arxiv","onUpdate:modelValue":I[7]||(I[7]=M=>_.value=M)},null,512),[[qe,_.value]]),I[26]||(I[26]=n("legend",{for:"bibsource-arxiv"},"arxiv",-1))]),n("div",la,[V(n("input",{type:"radio",id:"bibsource-doi",name:"bibSource",value:"doi","onUpdate:modelValue":I[8]||(I[8]=M=>_.value=M)},null,512),[[qe,_.value]]),I[27]||(I[27]=n("legend",{for:"bibsource-doi"},"doi",-1))]),n("div",ra,[V(n("input",{type:"radio",id:"bibsource-webpage",name:"bibSource",value:"webpage","onUpdate:modelValue":I[9]||(I[9]=M=>_.value=M)},null,512),[[qe,_.value]]),I[28]||(I[28]=n("legend",{for:"bibsource-webpage"},"webpage",-1))])]),V(n("input",{type:"text","onUpdate:modelValue":I[10]||(I[10]=M=>Z.value=M),placeholder:U[_.value],style:{width:"100%",marginTop:"10px"}},null,8,ua),[[ee,Z.value]])])]),_:1},8,["show"]),x(we,{show:s.value,"onUpdate:show":I[21]||(I[21]=M=>s.value=M),title:o.value?o.value.authorAbbr():"new","show-cancel":!1,onOnAccept:m,onOnCance:f,onOnClose:f},{default:L(()=>[n("div",{id:"data-editor-main",ref_key:"dataEditorComponent",ref:F,onDragover:K,onDrop:fe,onDragend:G},[z.value?(h(),y("div",_a,I[34]||(I[34]=[n("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"430px",width:"590px",border:"5px dashed var(--color-border)","border-radius":"10px",margin:"15px"}},[n("div",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"10px"}},"Drop to insert citation or document"),n("div",{style:{"font-size":"12px",opacity:"0.5"}},"(only support bibtex/enw/nbib)")],-1)]))):(h(),y("div",da,[n("div",ca,[n("div",pa,[n("div",ha,[n("div",fa,[I[30]||(I[30]=n("label",{for:"bibtex"},"Bibtex",-1)),n("div",ma,[n("div",{class:"button",onClick:I[14]||(I[14]=M=>S.value=!0)},"template"),n("div",{class:"button",onClick:I[15]||(I[15]=M=>$.value=!0)},"from-source")])]),V(n("textarea",{id:"bibtex","onUpdate:modelValue":I[16]||(I[16]=M=>l.value=M),placeholder:"bibtex / enw / nbib",class:"scrollable wrapword",style:{resize:"none"}},null,512),[[ee,l.value]])]),n("div",va,[I[31]||(I[31]=n("label",{for:"url"},"URL: ",-1)),V(n("input",{id:"url","onUpdate:modelValue":I[17]||(I[17]=M=>r.value=M),placeholder:"url",type:"text"},null,512),[[ee,r.value]])])]),n("div",ga,[x(Zn,{"tag-status":w.value,"onUpdate:tagStatus":I[18]||(I[18]=M=>w.value=M),"tag-input-value":p.value,"onUpdate:tagInputValue":I[19]||(I[19]=M=>p.value=M)},null,8,["tag-status","tag-input-value"])])]),o.value===null?(h(),y("div",ya,[I[32]||(I[32]=n("div",{class:"hr"},null,-1)),n("div",wa,[E(T(c.value?c.value.name:"")+" ",1),c.value?(h(),y("a",{key:1,onClick:I[20]||(I[20]=M=>c.value=null),style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}," (Remove) ")):(h(),Y(C($e),{key:0,text:"Select document",action:k,"as-link":!0,style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}))]),I[33]||(I[33]=n("div",{class:"hr"},null,-1))])):A("",!0)]))],544)]),_:1},8,["show","title"])],64))}}),Je=q(ba,[["__scopeId","data-v-78415e79"]]),ka={class:"layout"},Sa={id:"info"},$a={id:"authorTD"},Da=["onClick"],xa={key:0,id:"otherPubTR"},Ca={colspan:"2"},Pa={id:"authorPapers"},Ia={id:"shortSummary"},Ta={id:"shortSummaryTitle"},Ua=B({__name:"DataSummary",props:{datapoint:{}},setup(i){const t=i,e=J(),a=b([]),s=b([]),o=R(()=>Object.fromEntries(a.value.map((g,D)=>[g.summary.uuid,s.value[D].toPrecision(3)]))),l=X().conn,r=b(null),c=b("");function w(g=!1){c.value="Loading...";let D="";m(),l.reqAISummary(t.datapoint.summary.uuid,$=>{$.replace(/\\n/g,"<br>"),D+=$,c.value=D},()=>{m(),console.log("finished")},g)}async function m(){let g=null;if(t.datapoint.supp.abstract?g=t.datapoint.supp.abstract:g=await t.datapoint.fetchAbstract(),g||(c.value&&!c.value.startsWith("Error")&&!c.value.startsWith("Loading")?g=c.value:g=t.datapoint.title),g=="")return;const D=await l.query({searchBy:"feature",searchContent:g,maxResults:9}),$=await e.database.agetMany(D.uids,!1),_=new Array;for(const v of $){const U=D.uids.indexOf(v.summary.uuid);if(U>=0)_.push(D.scores[U]);else throw new Error("Related article not found in search result, IMPOSSIBLE")}[a.value,s.value]=vt($,_,!1),a.value&&a.value[0].summary.uuid==t.datapoint.summary.uuid&&(a.value.shift(),s.value.shift())}const p=b(""),u=b([]),f=b({});async function d(){const g=t.datapoint.authors,D=await Promise.all(g.map($=>e.database.agetByAuthor($)));f.value={};for(let $=0;$<g.length;$++)f.value[g[$]]=D[$]}const k=R(()=>{const g={};for(const D in f.value)f.value[D]&&f.value[D].length>1?g[D]=f.value[D].length-1:g[D]=null;return g});function P(g){u.value=f.value[g],u.value||(u.value=[]),u.value=u.value.filter(D=>D.summary.uuid!=t.datapoint.summary.uuid),p.value===g?p.value="":p.value=g}le(()=>{d(),w(!1)});const S=R(()=>{const v=(Math.min(Math.max(window.innerWidth-600,0)/1800,1)-.5)*Math.PI,U=(Math.sin(v)+1)*.5*1200,Z=Math.round(U);return`${window.innerWidth-Z}px`});return(g,D)=>(h(),y("div",{id:"main",style:se({width:S.value})},[n("h2",null,T(g.datapoint.summary.title),1),n("div",ka,[n("div",Sa,[n("table",null,[n("tbody",null,[n("tr",null,[D[1]||(D[1]=n("td",null,[n("b",null,"Authors")],-1)),n("td",$a,[(h(!0),y(j,null,te(g.datapoint.summary.authors,$=>(h(),y("div",null,[n("span",null,T($),1),k.value[$]!==null?(h(),y("a",{key:0,onClick:()=>P($)}," ("+T(k.value[$])+") ",9,Da)):A("",!0)]))),256))])])]),x(Pe,{name:"slideDown"},{default:L(()=>[n("tbody",null,[p.value?(h(),y("tr",xa,[n("td",Ca,[n("b",null,T(`Other publications from ${p.value.toUpperCase()}:`),1),n("div",Pa,[x(ke,{uids:u.value.map($=>$.summary.uuid)},null,8,["uids"])])])])):A("",!0)])]),_:1}),n("tbody",null,[n("tr",null,[D[2]||(D[2]=n("td",null,[n("b",null,"Publication")],-1)),n("td",null,T(g.datapoint.summary.publication),1)])]),n("tbody",null,[n("tr",null,[D[3]||(D[3]=n("td",null,[n("b",null,"Year")],-1)),n("td",null,T(g.datapoint.summary.year),1)])]),n("tbody",null,[n("tr",null,[D[4]||(D[4]=n("td",null,[n("b",null,"Tags")],-1)),n("td",null,T(g.datapoint.summary.tags.toString()),1)])]),n("tbody",null,[n("tr",null,[D[5]||(D[5]=n("td",null,[n("b",null,"Type")],-1)),n("td",null,T(g.datapoint.fileType()+`${g.datapoint.summary.has_file?" ("+g.datapoint.summary.doc_size.toString()+"M)":""}`),1)])])])]),n("div",Ia,[n("div",Ta,[D[6]||(D[6]=n("b",null,"AI Summary",-1)),n("div",{class:"button",onClick:D[0]||(D[0]=$=>w(!0))},"↻")]),n("p",{id:"aiSummary",ref_key:"aiSummaryParagraph",ref:r},T(c.value),513)]),n("details",null,[D[7]||(D[7]=n("summary",null,[n("b",null,"Related Articles")],-1)),x(ke,{uids:a.value.map($=>$.summary.uuid),scores:o.value},null,8,["uids","scores"])])])],4))}}),Ra=q(Ua,[["__scopeId","data-v-e900d36c"]]),Aa={id:"citations",style:{textAlign:"left"}},La=["onClick"],Ba={class:"citation-type",style:{marginLeft:"10px",marginRight:"10px",borderRadius:"5px",backgroundColor:"var(--color-background-mute)",padding:"3px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"}},Ma={class:"citation-text",style:{overflowX:"hidden",whiteSpace:"nowrap"}},Ea={key:0},qa={key:0,id:"moreMain"},Fa={class:"row",id:"buttons"},za=["href"],Oa={key:0,class:"row",id:"actions"},Ha={id:"abstract"},Wa=B({__name:"FileRowMore",props:{datapoint:{},show:{type:Boolean}},setup(i,{expose:t}){const e=i,a=W(),s=b(null),o=async g=>{g.target instanceof HTMLDetailsElement&&!g.target.open||(s.value.setEditable(!1),s.value.innerText="Loading...",e.datapoint.fetchAbstract().then(D=>{s.value.innerText=D,s.value.setEditable(!0)},()=>{s.value.innerText="Failed to load abstract."}))},l=async g=>{g&&(await e.datapoint.uploadAbstract(g),await e.datapoint.update())},r=b(!1);function c(g,D){return[g,`${D.length>80?D.slice(0,80)+"...":D}`,D]}function w(g){je(g).then(D=>{D?a.showPopup("Copied to clipboard.","info"):a.showPopup("Failed to copy to clipboard.","error")})}const m=b(!1);function p(g){a.showPopup("uploading..."),e.datapoint.uploadDocument(g).then(D=>{e.datapoint.update(D),a.showPopup("Document uploaded","success")},()=>a.showPopup("Failed to upload document","error"))}function u(){window.confirm(`Free document? 
${e.datapoint.toString()}`)&&e.datapoint.freeDocument().then(g=>{e.datapoint.update(g),a.showPopup("Document deleted","info")},()=>a.showPopup("Failed to free document","error"))}function f(){const g=e.datapoint.summary.uuid;window.confirm(`[IMPORTANT] Delete? 
${e.datapoint.toString()}`)&&X().conn.deleteDatapoint(g).then(D=>{a.showPopup("Deleted")})}const d=b(null);function k(){d.value.show({datapoint:e.datapoint})}const P=R(()=>s.value===null?!d.value.isShown():!d.value.isShown()&&!s.value.hasFocus());t({editThisDatapoint:k,deleteThisDatapoint:f,shouldEnableEditDatapoint:P});const S=b(!1);return(g,D)=>{const $=He("router-link");return h(),y(j,null,[x(ge,{show:S.value,"onUpdate:show":D[0]||(D[0]=_=>S.value=_),title:"Summary"},{default:L(()=>[x(Ra,{datapoint:g.datapoint},null,8,["datapoint"])]),_:1},8,["show"]),x(ge,{show:r.value,"onUpdate:show":D[1]||(D[1]=_=>r.value=_),title:"Citations"},{default:L(()=>[(h(!0),y(j,null,te([c("Title",`${g.datapoint.summary.title}`),c("Author-year",`${g.datapoint.authorAbbr()} (${g.datapoint.summary.year})`),c("APA",`${g.datapoint.authorAbbr()} (${g.datapoint.summary.year}). ${g.datapoint.summary.title}. ${g.datapoint.summary.publication}.`),c("Bibtex",g.datapoint.summary.bibtex),c("DocURL",g.datapoint.getRawDocURL()),c("Markdown",`[${g.datapoint.authorAbbr()} (${g.datapoint.summary.year})](${g.datapoint.getRawDocURL()})`),c("UUID",`${g.datapoint.summary.uuid}`)],(_,v)=>(h(),y("div",Aa,[n("div",{onClick:()=>{w(_[2]),r.value=!1},style:{cursor:"pointer",display:"flex",flexDirection:"row"}},[n("div",Ba,T(_[0]),1),n("p",Ma,T(_[1]),1)],8,La),v!==6?(h(),y("hr",Ea)):A("",!0)]))),256))]),_:1},8,["show"]),x(Je,{ref_key:"dataEditor",ref:d},null,512),x(Pe,{name:"expand-transition"},{default:L(()=>[g.show?(h(),y("div",qa,[n("div",Fa,[x($,{to:`/reader/${e.datapoint.summary.uuid}`},{default:L(()=>D[6]||(D[6]=[E("Reader")])),_:1},8,["to"]),g.datapoint.url?(h(),y("a",{key:0,href:g.datapoint.url,target:"_blank"},"Link",8,za)):A("",!0),n("a",{rel:"noopener noreferrer",onClick:D[2]||(D[2]=()=>S.value=!S.value)},"Summary"),n("a",{rel:"noopener noreferrer",onClick:D[3]||(D[3]=()=>r.value=!r.value)},"Cite"),n("a",{rel:"noopener noreferrer",onClick:D[4]||(D[4]=()=>m.value=!m.value)},"Actions")]),x(Pe,{name:"actions"},{default:L(()=>[m.value?(h(),y("div",Oa,[n("a",{rel:"noopener noreferrer",class:"btn",onClick:k},"Edit"),g.datapoint.summary.has_file?(h(),y("a",{key:1,rel:"noopener noreferrer",onClick:u,class:"danger btn"},"Free document")):(h(),Y(C($e),{key:0,action:_=>p(_),text:"Upload document","as-link":!0},null,8,["action"])),n("a",{rel:"noopener noreferrer",onClick:f,class:"danger btn"},"Delete")])):A("",!0)]),_:1}),n("div",Ha,[n("details",{onToggle:o},[D[7]||(D[7]=n("summary",null,"Abstract",-1)),x(C(Ge),{id:"abstractParagraph",ref_key:"abstractParagraph",ref:s,style:{minHeight:"20px",fontFamily:"'Times New Roman', Times, serif"},onFinish:D[5]||(D[5]=_=>l(_))},null,512)],32)])])):A("",!0)]),_:1})],64)}}}),Na=q(Wa,[["__scopeId","data-v-f63a1dfe"]]),ja="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120v-640q0-33%2023.5-56.5T280-840h400q33%200%2056.5%2023.5T760-760v640L480-240%20200-120Zm80-122%20200-86%20200%2086v-518H280v518Zm0-518h400-400Z'/%3e%3c/svg%3e",Ka="data:image/svg+xml,%3c?xml%20version='1.0'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='24px'%20height='24px'%3e%3cpath%20d='M%206%202%20C%205.861875%202%205.7278809%202.0143848%205.5976562%202.0410156%20C%204.686084%202.2274316%204%203.033125%204%204%20L%204%2022%20L%2012%2019%20L%2020%2022%20L%2020%204%20C%2020%203.8625%2019.985742%203.7275391%2019.958984%203.5976562%20C%2019.799199%202.8163086%2019.183691%202.2008008%2018.402344%202.0410156%20C%2018.272119%202.0143848%2018.138125%202%2018%202%20L%206%202%20z'/%3e%3c/svg%3e",Va={class:"left",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",flexWrap:"nowrap",gap:"0.25rem"}},Za={id:"marks"},Ga=["src"],Ja=["src"],Qa={class:"row text"},Ya={style:{borderRadius:"10px",marginLeft:"5px",display:"flex",flexDirection:"column"}},Xa={id:"title",style:{display:"flex",fontSize:"1rem"}},es={style:{"margin-right":"0.1rem","margin-top":"0.25rem","font-size":"0.75rem",opacity:"0.8",display:"inline-block",filter:"drop-shadow(1px 1px 0.5px var(--color-border))"}},ts={style:{marginTop:"0px",padding:"0px",color:"var(--color-text-soft)",fontSize:"0.75rem"}},ns={class:"right row"},as={style:{"margin-right":"0.5rem"}},ss={id:"status-container"},os={class:"status"},is={key:0,src:Tn,alt:"",class:"icon"},ls={key:1,src:Ze,alt:"",class:"icon placeholder"},rs={class:"status"},us={key:0,src:Un,alt:"",class:"icon"},ds={key:1,src:Rn,alt:"",class:"icon"},cs={key:2,src:An,alt:"",class:"icon"},ps={key:3,src:Ze,alt:"",class:"icon placeholder"},hs={class:"status"},fs={key:0,src:Ln,alt:"",class:"icon"},ms={key:1,src:Bn,alt:"",class:"icon"},vs={key:2,src:Ze,alt:"",class:"icon placeholder"},gs=12,ys=1,ws=B({__name:"FileRow",props:{datapoint:{},unfoldedIds:{},hoveredIds:{},line_number:{default:0}},emits:["update:unfoldedIds","update:hoveredIds"],setup(i,{emit:t}){const e=i,a=t,s=R({get:()=>e.unfoldedIds,set:_=>a("update:unfoldedIds",_)}),o=R({get:()=>e.hoveredIds,set:_=>a("update:hoveredIds",_)}),l=R(()=>s.value.includes(e.datapoint.summary.uuid)),r=b(null),c=b(null),w=b(null),m=b(null);let p=!1;function u(_){if(at(_.target,r.value)){if(_.target.id=="authorYear"){const v=e.datapoint.getOpenDocURL();v!==""&&Yt(v),p=!0}if(!at(_.target,w.value)){if(p){p=!1;return}l.value?s.value=s.value.filter(v=>v!==e.datapoint.summary.uuid):s.value=[e.datapoint.summary.uuid]}}}const f=R(()=>{switch(e.datapoint.dtype){case"article":return"📄";case"book":return"📚";case"incollection":return"📖";case"inbook":return"📖";case"manual":return"📖";case"inproceedings":return"📜";case"conference":return"📜";case"misc":return"📎";case"thesis":return"🎓";case"phdthesis":return"🎓";case"mastersthesis":return"🎓";case"techreport":return"📑";case"unpublished":return"📝";case"webpage":return"🌐";case"online":return"🌐";default:return"❔"}}),d=R(()=>e.datapoint.yearAuthor("-")),k=b(!1);ne(k,_=>{_?o.value.push(e.datapoint.summary.uuid):o.value=o.value.filter(v=>v!==e.datapoint.summary.uuid)});const P=R(()=>k.value?"var(--color-background-theme-highlight)":s.value.includes(e.datapoint.summary.uuid)?"var(--color-background-theme)":e.line_number%2==0?"var(--color-background-ssoft)":"var(--color-background)"),S=R(()=>ft(e.datapoint.summary.bibtex));function g(_){const v=e.datapoint.summary.tags.slice();_?v.push("* Bookmark"):v.splice(v.indexOf("* Bookmark"),1);const U=e.datapoint.summary.uuid;X().conn.setDatapoint(U,{tags:v}).then(Z=>{e.datapoint.update(Z),W().updateShownData()},()=>W().showPopup("Failed to save","error")),p=!0}function D(){var _;return s.value.includes(e.datapoint.summary.uuid)&&k.value&&document.activeElement===document.body&&((_=m.value)==null?void 0:_.shouldEnableEditDatapoint)}function $(_){var v,U;_.code==="Space"&&D()&&((v=m.value)==null||v.editThisDatapoint(),_.preventDefault()),(_.code==="Delete"||_.code==="Backspace")&&D()&&((U=m.value)==null||U.deleteThisDatapoint(),_.preventDefault())}return ne(()=>s.value,_=>{_.includes(e.datapoint.summary.uuid)?window.addEventListener("keydown",$):window.removeEventListener("keydown",$)}),(_,v)=>(h(),y("div",{id:"fileRow",class:de(`${l.value?" unfolded":""}`),onClick:u,onMouseover:v[2]||(v[2]=U=>k.value=!0),onMouseleave:v[3]||(v[3]=U=>k.value=!1),ref_key:"dataCard",ref:r,style:se({backgroundColor:P.value})},[n("div",{id:"init",class:"row",ref_key:"initDiv",ref:c},[n("div",Va,[n("div",Za,[_.datapoint.summary.tags.includes("* Bookmark")?(h(),y("img",{key:0,src:C(Ka),alt:"",class:"icon redIcon",onClick:v[0]||(v[0]=()=>g(!1)),style:{height:"1rem"}},null,8,Ga)):(h(),y("img",{key:1,src:C(ja),alt:"",class:"icon",onClick:v[1]||(v[1]=()=>g(!0)),style:{height:"1rem"}},null,8,Ja))]),n("div",Qa,[n("div",Ya,[n("div",Xa,[n("p",null,[n("span",es,T(f.value),1),E(" "+T(_.datapoint.summary.title),1)])]),n("div",ts,T(d.value+", "+_.datapoint.publication+(S.value?". "+S.value:"")),1)])])]),n("div",ns,[n("div",as,[ce(_.$slots,"default",{},void 0)]),n("div",ss,[n("div",os,[_.datapoint.summary.has_abstract?(h(),y("img",is)):(h(),y("img",ls))]),n("div",rs,[_.datapoint.fileType()=="pdf"?(h(),y("img",us)):_.datapoint.fileType()=="html"?(h(),y("img",ds)):_.datapoint.fileType()=="url"?(h(),y("img",cs)):(h(),y("img",ps))]),n("div",hs,[_.datapoint.summary.note_linecount>gs?(h(),y("img",fs)):_.datapoint.summary.note_linecount>ys?(h(),y("img",ms)):(h(),y("img",vs))])])])],512),n("div",{id:"more",ref_key:"moreDiv",ref:w},[x(Na,{datapoint:_.datapoint,show:l.value,ref_key:"moreComponent",ref:m},null,8,["datapoint","show"])],512)],38))}}),_s=q(ws,[["__scopeId","data-v-3174e16e"]]),bs={id:"datacard-container-main"},ks={key:0,class:"relatedArticleScore"},Ss={key:1,id:"datacard-container-footer"},$s=["disabled"],Ds={style:{"margin-left":"10px","margin-right":"10px",display:"flex",gap:"5px"}},xs=["disabled"],Cs=B({__name:"FileRowContainer",props:{uids:{},unfoldedIds:{default:null},hoveredIds:{default:null},scores:{default:null},compact:{type:Boolean,default:!0}},emits:["update:datapoints","update:unfoldedIds","update:hoveredIds"],setup(i,{emit:t}){const e=i,a=t,s=b([]),o=R({get:()=>e.unfoldedIds==null?s.value:e.unfoldedIds,set:$=>{e.unfoldedIds==null?s.value=$:a("update:unfoldedIds",$)}}),l=b([]),r=R({get:()=>e.hoveredIds==null?l.value:e.hoveredIds,set:$=>{e.hoveredIds==null?l.value=$:a("update:hoveredIds",$)}}),c=b(null),w=b(null),m=b(0),p=N(),u=b([]),f=b([]),d=b(!1);function k(){console.debug("updateDisplayDataUIDs");const $=m.value*p.numItemsPerPage,_=Math.min($+p.numItemsPerPage,e.uids.length),v=e.uids.slice($,_);u.value=v}ne([()=>e.uids,()=>m.value,()=>p.numItemsPerPage],()=>{e.uids.length<m.value*p.numItemsPerPage&&(m.value=0),k()},{immediate:!0});function P(){let $=!0;(async()=>(await new Promise(_=>setTimeout(_,500)),$&&(d.value=!1)))(),console.debug("updateDisplayDataPoints"),J().database.agetMany(u.value).then(_=>{f.value=_,$=!1,d.value=!0})}ne(u,()=>{P()},{immediate:!0});const S=()=>{var $;m.value>=Math.ceil(e.uids.length/p.numItemsPerPage)-1||(m.value++,w.value.setText(""+(m.value+1)),($=c.value)==null||$.scrollTo({top:0,behavior:"auto"}))},g=()=>{var $;m.value!=0&&(m.value--,w.value.setText(""+(m.value+1)),($=c.value)==null||$.scrollTo({top:0,behavior:"auto"}))},D=$=>{const _=$.target;_.scrollTop==0||_.scrollTop+_.clientHeight>=_.scrollHeight};return($,_)=>(h(),y("div",bs,[n("div",{id:"datacard-container",style:se({gap:$.compact?"0px":"5px"}),ref_key:"datacardContainer",ref:c,onScroll:D,class:"scrollable"},[(h(!0),y(j,null,te(f.value,(v,U)=>(h(),Y(_s,{datapoint:v,"unfolded-ids":o.value,"onUpdate:unfoldedIds":_[0]||(_[0]=Z=>o.value=Z),"hovered-ids":r.value,"onUpdate:hoveredIds":_[1]||(_[1]=Z=>r.value=Z),line_number:U,compact:$.compact},{default:L(()=>[e.scores!=null&&e.scores[v.summary.uuid]!=null?(h(),y("label",ks,T(e.scores[v.summary.uuid]),1)):A("",!0)]),_:2},1032,["datapoint","unfolded-ids","hovered-ids","line_number","compact"]))),256))],36),d.value?A("",!0):(h(),Y(Pe,{key:0,name:"fade"},{default:L(()=>[x(mt,{text:"Loading data..."})]),_:1})),$.uids.length>C(p).numItemsPerPage?(h(),y("div",Ss,[n("button",{onClick:g,disabled:m.value==0},"Prev",8,$s),n("span",Ds,[x(C(Ge),{ref_key:"pageIndicatorEditableParagrah",ref:w,onFinish:_[2]||(_[2]=v=>{parseInt(v)>0&&parseInt(v)<=Math.ceil($.uids.length/C(p).numItemsPerPage)&&(m.value=parseInt(v)-1)})},{default:L(()=>[E(T(m.value+1),1)]),_:1},512),_[3]||(_[3]=E(" / ")),n("p",null,T(Math.ceil($.uids.length/C(p).numItemsPerPage)),1)]),n("button",{onClick:S,disabled:m.value>=Math.ceil($.uids.length/C(p).numItemsPerPage)-1},"Next",8,xs)])):A("",!0)]))}}),ke=q(Cs,[["__scopeId","data-v-a3cd371b"]]),Ps=["title"],Is=["src","alt"],Ts={for:"icon",class:"iconLabel non-selectable"},Us=B({__name:"ToolbarIcon",props:{iconSrc:{},labelText:{},title:{default:""},shortcut:{default:null}},emits:["onClick","click"],setup(i,{expose:t,emit:e}){const a=i,s=R(()=>a.title+(a.shortcut===null?"":` (${a.shortcut})`)),o=e,l=b(null);t({getBoundingClientRect:()=>{var p;return(p=l.value)==null?void 0:p.getBoundingClientRect()}});function c(){o("onClick"),o("click")}function w(p){if(p===null)return null;const u=p.toLowerCase().split("+");return f=>{u.includes("ctrl")&&!f.ctrlKey||u.includes("alt")&&!f.altKey||u.includes("shift")&&!f.shiftKey||u.includes("meta")&&!f.metaKey||u.includes(f.key.toLowerCase())&&(console.log("shortcut triggered: "+p+" | "+a.labelText),c(),f.preventDefault())}}const m=w(a.shortcut);return We(()=>{m!==null&&window.addEventListener("keydown",m)}),lt(()=>{m!==null&&window.removeEventListener("keydown",m)}),(p,u)=>(h(),y("span",{class:"hoverMaxout105 button non-selecable",onClick:c,onKeydown:Ne(c,["enter"]),tabindex:0,title:`${s.value}`,ref_key:"button",ref:l},[n("img",{id:"icon",class:"icon",src:p.iconSrc,alt:p.labelText.toUpperCase()+"_ICON"},null,8,Is),n("label",Ts,T(p.labelText),1)],40,Ps))}}),ve=q(Us,[["__scopeId","data-v-f0fccbdf"]]);let Rs=window.location.protocol,wt;wt=`${Rs}//${window.location.hostname}:${window.location.port}`;const As=`${wt}/documentation/`;console.log("production mode");function Ie(){const i=N().backendPort,t=N().backendHost;return i?`${t}:${i}`:t}const Ls={name:"Li, Mengxun",email:"mengxunli@whu.edu.cn"},be=["SweetiePie","CutiePatootie","CuddleBug","FluffyPaws","HoneyBee","SnuggleMuffin","SugarPlum","AngelFace","PawsomePuppy","TeddyBearHugs","PrettyKitty","LoveBug","BabyDoll","SunshineSmiles","FuzzyWuzzy","BumbleBee","CupcakeQueen","DoodleDaisy","PurrfectPaws","CuddlyKoala","SweetPea","BunnyHop","SparklePony","HappyPanda","DreamyDove","FluffyCloud","CherryBlossom","AngelicWhisper","SnickerDoodle","LuckyLadybug","BlossomButterfly","SugarCubes","CottonCandyDreams","HoneyBunches","FurryFriend","BabyBlueEyes","SweetCheeks","PawsitiveVibes","SnugglyBear","LovelyLlama","PurrfectlyAdorable","TwinkleToes","CuddleBunny","CookieCrumbs","SunnySmiles","FluffyKitten","DarlingDeer","ButterflyKisses","FuzzyWuzzyPanda","SweetDreamer","SillyGoose","DaisyDoodle","CupcakeCutie","BuzzyBee","SnoozySnail","CharmingChick","CandyCane","BerryBlossom","Dimples","CocoaCuddles","CheerfulCherub","PetalPaws","BubblyBumble","AngelWings","JollyJellybean","WhiskerWonder","SprinkleSmiles","GigglyGiraffe","DancingDaisy","SunnySideUp","SnugglySloth","CuteQuokka","PeachyPaws","BouncyBunny","DazzlingDimples","ChirpyChickadee","CandyHeart","CupcakeSprinkle","BuzzyButterfly","SnoozyPanda","CharmingCorgi","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy","ChirpyChickadee","CandyCane","CupcakeCutie","BuzzyButterfly","SnoozySnail","CharmingCherub","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy"],Bs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h357l-80%2080H200v560h560v-278l80-80v358q0%2033-23.5%2056.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12%2027-18t30-6q16%200%2030.5%206t26.5%2018l56%2057q11%2012%2017%2026.5t6%2029.5q0%2015-5.5%2029.5T897-728L530-360H360Zm481-424-56-56%2056%2056ZM440-440h56l232-232-28-28-29-28-231%20231v57Zm260-260-29-28%2029%2028%2028%2028-28-28Z'/%3e%3c/svg%3e",Ms={data(){return{usedSpace:0,totalSpace:1,unit:"MB"}},computed:{fillPercentage(){return`${Math.min(this.usedSpace/this.totalSpace,1)*100}%`}},mounted(){this.usedSpace=0,this.totalSpace=1,this.unit="MB",this.fetchDiskUsage()},methods:{fetchDiskUsage(){X().conn.getDatabaseUsage().then(i=>{const t=(i.disk_usage/1024/1024).toFixed(1),e=(i.disk_limit/1024/1024).toFixed(1);e>1024?(this.unit="GB",this.usedSpace=(t/1024).toFixed(1),this.totalSpace=(e/1024).toFixed(1)):(this.unit="MB",this.usedSpace=t,this.totalSpace=e)},()=>{console.log("failed to fetch disk usage")})}}},Es={id:"disk-usage-main"},qs={class:"disk-usage-bar"},Fs={class:"disk-usage-text"};function zs(i,t,e,a,s,o){return h(),y("div",Es,[n("div",qs,[n("div",{class:"disk-usage-fill",style:se({width:o.fillPercentage})},null,4)]),n("div",Fs," Space: "+T(s.usedSpace)+" / "+T(s.totalSpace)+" "+T(s.unit),1)])}const Os=q(Ms,[["render",zs],["__scopeId","data-v-4a0b9404"]]),Hs={id:"usercard-main"},Ws={id:"user-settings"},Ns={id:"password-container"},js={id:"info"},Ks={id:"user-desc"},Vs={id:"name-edit"},Zs={id:"name"},Gs=["src"],Js={key:0,class:"admin_hint"},Qs=B({__name:"UserCard",props:{userInfo:{},avatarSize:{default:"168px"}},emits:["update:userInfo"],setup(i,{emit:t}){const e=i,a=X().conn,s=t,o=R(()=>J().user.id===e.userInfo.id),l=b(null),r=b(c());function c(){return`${Ie()}/user-avatar/${e.userInfo.username}?t=${Date.now()}&size=256`}function w(P){if(!P.type.startsWith("image/")){W().showPopup("Please select an image file","error");return}W().showPopup("Uploading avatar..."),a.uploadUserAvatar(e.userInfo.username,P).then(S=>{r.value=c(),s("update:userInfo",S)},S=>{W().showPopup(S,"error")})}const m=b(!1),p=b(""),u=b(""),f=b(""),d=b("");function k(){if(p.value===""||p.value===e.userInfo.name||p.value!==e.userInfo.name&&a.setUserNickname(p.value).then(P=>{s("update:userInfo",P),m.value=!1},P=>{W().showPopup(P,"error")}),f.value!==""||d.value!==""){if(f.value===""){W().showPopup("Please enter the new password","error");return}if(f.value!==d.value){W().showPopup("The new passwords do not match","error");return}if(N().encKey!==pe(e.userInfo.username+pe(u.value))){W().showPopup("The old password is incorrect","error");return}a.setUserPassword(f.value).then(P=>{const S=pe(e.userInfo.username+pe(f.value));N().setEncKey(S),u.value="",f.value="",d.value="",m.value=!1},P=>{W().showPopup(P,"error")})}}return(P,S)=>(h(),y("div",Hs,[x(we,{show:m.value,"onUpdate:show":S[4]||(S[4]=g=>m.value=g),title:"User settings",onOnCancel:S[5]||(S[5]=g=>m.value=!1),onOnAccept:k},{default:L(()=>[n("div",Ws,[n("b",null,T(e.userInfo.username),1),V(n("input",{type:"text","onUpdate:modelValue":S[0]||(S[0]=g=>p.value=g),placeholder:"Nickname",class:"input"},null,512),[[ee,p.value]]),S[11]||(S[11]=n("hr",null,null,-1)),n("details",null,[S[10]||(S[10]=n("summary",null,"Change password",-1)),n("div",Ns,[V(n("input",{type:"password","onUpdate:modelValue":S[1]||(S[1]=g=>u.value=g),placeholder:"Old password",class:"input"},null,512),[[ee,u.value]]),V(n("input",{type:"password","onUpdate:modelValue":S[2]||(S[2]=g=>f.value=g),placeholder:"New password",class:"input"},null,512),[[ee,f.value]]),V(n("input",{type:"password","onUpdate:modelValue":S[3]||(S[3]=g=>d.value=g),placeholder:"Confirm new password",class:"input"},null,512),[[ee,d.value]])])])])]),_:1},8,["show"]),n("div",js,[n("div",{id:"avatar",style:se(o.value?{cursor:"pointer",borderRadius:"50%"}:{})},[x(C(na),{href:r.value,size:P.avatarSize,onClick:S[6]||(S[6]=g=>{var D;return o.value?(D=l.value)==null?void 0:D.click():()=>{}})},null,8,["href","size"]),x(C($e),{text:"Change avatar",action:w,ref_key:"avatarUploadBtn",ref:l,style:{display:"none"}},null,512)],4),n("div",Ks,[n("div",Vs,[n("h1",Zs,T(e.userInfo.name),1),o.value?(h(),y("img",{key:0,src:C(Bs),alt:"",class:"icon",id:"edit-settings-icon",onClick:S[7]||(S[7]=g=>m.value=!0)},null,8,Gs)):A("",!0)]),n("p",{onClick:S[8]||(S[8]=g=>m.value=!0),style:{cursor:"pointer"}},[E(T(e.userInfo.username)+" ",1),e.userInfo.is_admin?(h(),y("label",Js,"admin")):A("",!0)]),x(Os),S[12]||(S[12]=n("div",{style:{height:"0.2rem"}},null,-1))])]),n("p",{id:"credential",onClick:S[9]||(S[9]=()=>{C(je)(C(N)().encKey).then(()=>{C(W)().showPopup("Secret copied to clipboard","info")})})},"-- Credential:"+T(C(N)().encKey.substring(0,12))+" --",1)]))}}),Ys=q(Qs,[["__scopeId","data-v-39d7d19a"]]),Xs={props:{title:{type:String,required:!0},description:{type:String,required:!0}}},eo={class:"settings-container"},to={class:"settings-header"},no={class:"widget"};function ao(i,t,e,a,s,o){return h(),y("div",eo,[n("div",to,[n("label",null,T(e.title),1),n("p",null,T(e.description),1)]),n("div",no,[ce(i.$slots,"default",{},void 0)])])}const Te=q(Xs,[["render",ao],["__scopeId","data-v-f00f1fc8"]]),so=B({__name:"ConfigTheme",setup(i){const t=b("auto");function e(){t.value=Q.getThemeMode()}function a(s){s==="auto"?(Q.clear(),Q.setDefaultDarkMode()):s==="light"?Q.setDarkMode(!1):s==="dark"&&Q.setDarkMode(!0),e()}return e(),(s,o)=>(h(),Y(Te,{title:"Theme",description:"Change the theme of the app"},{default:L(()=>[V(n("select",{"onUpdate:modelValue":o[0]||(o[0]=l=>t.value=l),onChange:o[1]||(o[1]=l=>a(t.value)),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},o[2]||(o[2]=[n("option",{value:"auto"},"Auto",-1),n("option",{value:"light"},"Light",-1),n("option",{value:"dark"},"Dark",-1)]),544),[[Ae,t.value]])]),_:1}))}}),oo={class:"switch-toggle"},io=B({__name:"SwitchToggle",props:{checked:{type:Boolean}},emits:["update:checked"],setup(i,{emit:t}){const a=b(i.checked),s=t,o=b(null);return(l,r)=>(h(),y("div",oo,[V(n("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":r[0]||(r[0]=c=>a.value=c),onChange:r[1]||(r[1]=()=>{s("update:checked",a.value)}),ref_key:"checkerRef",ref:o},null,544),[[Tt,a.value]]),n("label",{class:"switch",onClick:r[2]||(r[2]=c=>{var w;return(w=o.value)==null?void 0:w.click()})})]))}}),Se=q(io,[["__scopeId","data-v-58ea3d44"]]),lo=B({__name:"ConfigShowTags",setup(i){const t=N(),e=R({get:()=>t.showTagPanel,set:a=>t.setShowTagPanel(a)});return(a,s)=>(h(),Y(Te,{title:"Tag Panel",description:"Show tag panel at home page"},{default:L(()=>[x(Se,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=o=>e.value=o)},null,8,["checked"])]),_:1}))}}),ro=B({__name:"ConfigShowHomeInfoPanel",setup(i){const t=N(),e=R({get:()=>t.showHomeInfoPanel,set:a=>t.setShowHomeInfoPanel(a)});return(a,s)=>(h(),Y(Te,{title:"Info Panel",description:"Show info panel at home page"},{default:L(()=>[x(Se,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=o=>e.value=o)},null,8,["checked"])]),_:1}))}}),uo=B({__name:"ConfigShowScatterPlot",setup(i){const t=N(),e=R({get:()=>t.show3DScatterPlot,set:a=>t.setShow3DScatterPlot(a)});return(a,s)=>(h(),Y(Te,{title:"Scatter Plot",description:"Show scatter plot at home page"},{default:L(()=>[x(Se,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=o=>e.value=o)},null,8,["checked"])]),_:1}))}}),co=["value"],po=B({__name:"ConfigPageCapacity",setup(i){const t=R({get:()=>N().numItemsPerPage,set:a=>N().setNumItemsPerPage(a)}),e=[10,20,50,100,200,500];return(a,s)=>(h(),Y(Te,{title:"Page Capacity",description:"Smaller number can improve performance"},{default:L(()=>[V(n("select",{"onUpdate:modelValue":s[0]||(s[0]=o=>t.value=o),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},[(h(),y(j,null,te(e,o=>n("option",{value:o,key:o},T(o),9,co)),64))],512),[[Ae,t.value]])]),_:1}))}}),ho={style:{display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.5rem",width:"100%",height:"100%",overflowY:"auto"}},fo={style:{display:"flex",justifyContent:"center",alignItems:"center"}},mo=B({__name:"SettingsWindow",setup(i){const t=J().user;return(e,a)=>(h(),y("div",ho,[n("div",fo,[x(Ys,{"user-info":C(t),"avatar-size":"120px"},null,8,["user-info"])]),a[0]||(a[0]=n("hr",null,null,-1)),x(so),x(po),x(lo),x(ro),x(uo)]))}});function Ee(){const i=Ut({width:window.innerWidth,height:window.innerHeight});function t(){i.width=window.innerWidth,i.height=window.innerHeight}window.addEventListener("resize",t);function e(){window.removeEventListener("resize",t)}return{...Rt(i),cleanup:e}}const vo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M180%20936q-24%200-42-18t-18-42V276q0-24%2018-42t42-18h291v60H180v600h291v60H180Zm486-185-43-43%20102-102H375v-60h348L621%20444l43-43%20176%20176-174%20174Z'/%3e%3c/svg%3e",go="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='m263-263%20290-143%20143-290-290%20143-143%20290Zm217-177q-17%200-28.5-11.5T440-480q0-17%2011.5-28.5T480-520q17%200%2028.5%2011.5T520-480q0%2017-11.5%2028.5T480-440Zm0%20360q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-156t86-127Q252-817%20325-848.5T480-880q83%200%20156%2031.5T763-763q54%2054%2085.5%20127T880-480q0%2082-31.5%20155T763-197.5q-54%2054.5-127%2086T480-80Zm0-60q142%200%20241-99.5T820-480q0-142-99-241t-241-99q-141%200-240.5%2099T140-480q0%20141%2099.5%20240.5T480-140Zm0-340Z'/%3e%3c/svg%3e",yo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-200h120v-240h240v240h120v-360L480-740%20240-560v360Zm-80%2080v-480l320-240%20320%20240v480H520v-240h-80v240H160Zm320-350Z'/%3e%3c/svg%3e",wo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M440-120v-240h80v80h320v80H520v80h-80Zm-320-80v-80h240v80H120Zm160-160v-80H120v-80h160v-80h80v240h-80Zm160-80v-80h400v80H440Zm160-160v-240h80v80h160v80H680v80h-80Zm-480-80v-80h400v80H120Z'/%3e%3c/svg%3e",_o={class:"nav-toggle"},bo=B({__name:"Toolbar",props:{returnHome:{type:Boolean,default:!0},compact:{type:Boolean,default:!0},showNavigator:{type:Boolean,default:!0}},setup(i){const t=i,e=me();function a(){an()}const s=b(null);let o=0;window.addEventListener("scroll",function(){const d=window.scrollY||document.documentElement.scrollTop;d<=o||o<10?s.value&&s.value.classList.contains("hidden")&&s.value.classList.remove("hidden"):s.value&&!s.value.classList.contains("hidden")&&s.value.classList.add("hidden"),o=d});const l=b(!1),r=ct(),c=R(()=>r.path.split("/")[1]),w=b(null),m=b(null),p=b(null),u=Ee();function f(){let d=0;return w.value&&(d+=w.value.getBoundingClientRect().width),m.value&&(d+=m.value.getBoundingClientRect().width),`calc(100% - ${d}px)`}return le(()=>{console.log("mounted",u.width,u.height,p.value),p.value&&(p.value.style.width=f()),ne([u.width,u.height],()=>{p.value&&(p.value.style.width=f())})}),rt(u.cleanup),(d,k)=>(h(),y(j,null,[x(ge,{show:l.value,"onUpdate:show":k[0]||(k[0]=P=>l.value=P),title:"Settings"},{default:L(()=>[x(mo)]),_:1},8,["show"]),n("div",{class:de(`main-toolbar ${t.compact?"compact-layout":"normal-layout shadow"}`),ref_key:"mainDiv",ref:s},[n("div",{class:"button",ref_key:"btnElem",ref:w},[t.returnHome?(h(),Y(ve,{key:0,iconSrc:C(yo),labelText:"Home",shortcut:"ctrl+h",onOnClick:k[1]||(k[1]=()=>{C(e).push("/")}),title:"home"},null,8,["iconSrc"])):(h(),Y(ve,{key:1,iconSrc:C(vo),labelText:"Logout",shortcut:"ctrl+q",onOnClick:a,title:"logout"},null,8,["iconSrc"])),x(ve,{iconSrc:C(wo),labelText:"Settings",shortcut:"ctrl+,",onOnClick:k[2]||(k[2]=()=>{l.value=!0}),title:"Open settings"},null,8,["iconSrc"]),d.showNavigator?A("",!0):(h(),Y(C(ta),{key:2,menuItems:[{name:"Home",action:()=>{C(e).push("/")}},{name:"Feed",action:()=>{C(e).push("/feed")}},{name:"About",action:()=>{C(e).push("/about")}}]},{default:L(()=>[x(ve,{iconSrc:C(go),labelText:"Explore",shortcut:"ctrl+e",title:"look around"},null,8,["iconSrc"])]),_:1},8,["menuItems"]))],512),n("div",{ref_key:"slotDiv",ref:p,id:"slot-div"},[ce(d.$slots,"default",{},void 0)],512),d.showNavigator?(h(),y("div",{key:0,id:"navigator",ref_key:"navElem",ref:m},[n("div",_o,[n("div",{class:de(`button ${c.value==="home"||!c.value?"active-nav":""}`),onClick:k[3]||(k[3]=()=>{C(e).push("/")})},"Home",2),n("div",{class:de(`button ${c.value==="feed"?"active-nav":""}`),onClick:k[4]||(k[4]=()=>{C(e).push("/feed")})},"Feed",2),n("div",{class:de(`button ${c.value==="about"?"active-nav":""}`),onClick:k[5]||(k[5]=()=>{C(e).push("/about")})},"About",2)])],512)):A("",!0)],2)],64))}}),Ue=q(bo,[["__scopeId","data-v-b68a45bc"]]),ko="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266%20200q-82.734%200-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681%2080-480.5q0-82.819%2031.5-155.659Q143-709%20197.5-763t127.341-85.5Q397.681-880%20480.5-880q82.819%200%20155.659%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.266q0%2082.734-31.5%20155.5T763-197.684q-54%2054.316-127%2086Q563-80%20480.266-80Zm.234-60Q622-140%20721-239.5t99-241Q820-622%20721.188-721%20622.375-820%20480-820q-141%200-240.5%2098.812Q140-622.375%20140-480q0%20141%2099.5%20240.5t241%2099.5Zm-.5-340Z'/%3e%3c/svg%3e",_t="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480-160q-133%200-226.5-93.5T160-480q0-133%2093.5-226.5T480-800q85%200%20149%2034.5T740-671v-129h60v254H546v-60h168q-38-60-97-97t-137-37q-109%200-184.5%2075.5T220-480q0%20109%2075.5%20184.5T480-220q83%200%20152-47.5T728-393h62q-29%20105-115%20169t-195%2064Z'/%3e%3c/svg%3e",So=B({__name:"Splitter",props:Xe({direction:{},movable:{type:Boolean,default:!0},minSplitRatio:{default:0},maxSplitRatio:{default:1},mode:{default:"ab"},splitterWidth:{default:"3px"},overflow:{default:"auto"}},{splitRatio:{default:.5},splitRatioModifiers:{}}),emits:Xe(["moveStart","moveStop"],["update:splitRatio"]),setup(i,{emit:t}){const e=i,a=At(i,"splitRatio"),s=t,o=b(null),l=b(null),r=b(null),c=b(null),w=b(!1);function m(){e.mode=="ab"&&l.value&&r.value&&(e.direction==="vertical"?(l.value.style.width=`calc(${a.value*100}%)`,r.value.style.width=`calc(${(1-a.value)*100}%)`):(l.value.style.height=`calc(${a.value*100}%)`,r.value.style.height=`calc(${(1-a.value)*100}%)`)),e.mode=="a"&&l.value&&(e.direction==="vertical"?l.value.style.width="100%":l.value.style.height="100%"),e.mode=="b"&&r.value&&(e.direction==="vertical"?r.value.style.width="100%":r.value.style.height="100%")}function p(d){c.value&&c.value.contains(d.target)&&(w.value=!0),s("moveStart",d)}function u(){w.value=!1,s("moveStop")}function f(d){if(w.value&&l.value&&r.value&&c.value){const k="touches"in d?d.touches[0].clientX:d.clientX,P="touches"in d?d.touches[0].clientY:d.clientY,S=l.value.getBoundingClientRect(),g=o.value.getBoundingClientRect(),D=e.direction==="vertical"?(k-S.left)/g.width:(P-S.top)/g.height;a.value=Math.max(e.minSplitRatio,Math.min(e.maxSplitRatio,D)),d.preventDefault()}}return window.addEventListener("mousedown",p),window.addEventListener("touchstart",p),window.addEventListener("mouseup",u),window.addEventListener("touchend",u),window.addEventListener("mousemove",f),window.addEventListener("touchmove",f),ne(()=>[e.direction,e.mode,a.value],()=>{ut(m)}),le(()=>{m()}),(d,k)=>(h(),y("div",{id:"sp-container",ref_key:"container",ref:o,style:se(e.direction==="vertical"?{flexDirection:"row"}:{flexDirection:"column"})},[e.mode=="ab"||e.mode=="a"?(h(),y("div",{key:0,ref_key:"aPane",ref:l,class:"splitter-pane panel",style:se({overflow:e.overflow})},[ce(d.$slots,"a",{},void 0)],4)):A("",!0),e.mode=="ab"&&e.movable?(h(),y("div",{key:1,ref_key:"splitter",ref:c,class:"splitter",style:se(e.direction==="vertical"?{cursor:"col-resize",height:"100%",width:d.splitterWidth}:{cursor:"row-resize",width:"100%",height:d.splitterWidth})},null,4)):A("",!0),e.mode=="ab"||e.mode=="b"?(h(),y("div",{key:2,ref_key:"bPane",ref:r,class:"splitter-pane panel",style:se({overflow:e.overflow})},[ce(d.$slots,"b",{},void 0)],4)):A("",!0)],4))}}),Qe=q(So,[["__scopeId","data-v-6432f398"]]),$o=B({__name:"Plot3d",props:{data:{}},setup(i,{expose:t}){const e=b(null),a=i,s=R(()=>a.data.map(d=>({x:d.x,y:d.y,z:d.z,mode:"markers",type:"scatter3d",hoverinfo:"text",hoverlabel:{bgcolor:"#181818",font:{color:"white"}},text:d.text,marker:{size:3.5,opacity:d.opacity,color:d.color}}))),o={autosize:!0,margin:{l:0,r:0,b:0,t:0},showlegend:!1,scene:{xaxis:{title:"",showticklabels:!1,tickfont:{size:10}},yaxis:{title:"",showticklabels:!1,tickfont:{size:10}},zaxis:{title:"",showticklabels:!1,tickfont:{size:10}}},paper_bgcolor:"#f6f6f6",plot_bgcolor:"#f6f6f6"},l={...o,paper_bgcolor:"#151515",plot_bgcolor:"#151515",font:{color:"white"}},r=b(Q.isDarkMode()?"dark":"light");Q.registerThemeChangeCallback(()=>{r.value=Q.isDarkMode()?"dark":"light",p()});const c=R(()=>r.value==="dark"?l:o),w={modeBarButtonsToRemove:["toImage","sendDataToCloud","resetCameraLastSave3d","resetCameraDefault3d"],displaylogo:!1,responsive:!0};let m=null;function p(){if(!e.value)return;Fe.react(e.value,s.value,c.value,w),e.value.layout.scene&&m&&Fe.relayout(e.value,"scene.camera",m)}return t({update:p}),le(()=>{Fe.newPlot(e.value,s.value,c.value,w).then(()=>{e.value.on("plotly_relayout",u=>{if(console.log("plotly_relayout",u),!u["scene.camera"])return;const f=u["scene.camera"];m=Ce(f)})}),e.value.on("plotly_click",function(u){u.points||console.log("Not clicking on any data.");const f=u.points[0].x,d=u.points[0].y,k=u.points[0].z,P=u.points[0].pointNumber;console.log(`You clicked on ${f}, ${d}, ${k} (point ${P})}`)}),ne(s,()=>{p()})}),(u,f)=>(h(),y("div",{id:"ploty-chart",ref_key:"plotlyChart",ref:e},null,512))}}),Do=q($o,[["__scopeId","data-v-db3ba83e"]]),xo={id:"main-filtervis"},Co={key:0,id:"plot3dDiv"},Po={key:0,id:"loadingDiv",class:"full"},Io={key:1,class:"status"},To=B({__name:"FilterVis",setup(i){const t=J(),e=b(null),a=W(),s=N(),o=b(null),l=R(()=>{if(o.value===null)return{};const u=t.database.allKeys(),f={};for(const d of u)o.value[d]&&(f[d]=o.value[d]);return f});async function r(u,f="rgb(100, 100, 200)"){const d=l.value;if(!d)u=[];else for(let v=u.length-1;v>=0;v--)d[u[v]]===void 0&&u.splice(v,1);const k=u.length,P=await t.database.agetMany(u),S=new Float32Array(k),g=new Float32Array(k),D=new Float32Array(k),$=new Array(k);for(const[v,U]of u.entries()){let Z=d[U];if(Z==null)throw new Error("uid not found in feats: "+U);S[v]=Z[0],g[v]=Z[1],D[v]=Z[2];const ie=P[v];$[v]=`${ie.authorYear()}<br>${ie.summary.title}`}let _;if(typeof f=="string")_=f;else if(f instanceof Array)if(typeof f[0]=="string")_=f;else{const v=f,U=Math.max(...v),Z=Math.min(...v),ie={0:Q.isDarkMode()?[50,50,50]:[220,220,220],1:[50,200,150]};_=v.map(F=>{const K=(F-Z)/(U-Z),G=Array(3);for(let fe=0;fe<3;fe++)G[fe]=Math.round(ie[0][fe]*(1-K)+ie[1][fe]*K);return`rgb(${G[0]}, ${G[1]}, ${G[2]})`})}else throw new Error("Invalid color type");return{x:S,y:g,z:D,opacity:.75,color:_,text:$}}const c=b(null);async function w(){const u=a.shownDataScores;let f;u?f=await r(Ce(a.shownDataUIDs),u):f=await r(Ce(a.shownDataUIDs));const k=t.database.allKeys().filter(g=>a.shownDataUIDs.indexOf(g)==-1),P=await r(k,Q.isDarkMode()?"rgb(50, 50, 50)":"rgb(220, 220, 220)"),S=await r(Ce(a.unfoldedDataUIDs),"rgb(255, 0, 0)");c.value=[f,P,S]}const m=R(()=>Object.keys(l.value).length>0);async function p(){o.value=null;const u=X().conn,f=(await u.status()).n_data;let d;f<50?d=-1:f<100?d=5:f<300?d=8:f<500?d=12:d=15,console.log("dataset size: ",f,"perp: ",d),o.value=await u.getDatabaseFeatureTSNE("doc_feature",3,d)}return ne(()=>[a.shownDataUIDs,a.unfoldedDataUIDs],()=>{w()}),ne(()=>s.show3DScatterPlot,u=>{u&&p().then(()=>{w()})}),le(()=>{s.show3DScatterPlot&&p().then(()=>{w()})}),(u,f)=>(h(),y("div",xo,[C(s).show3DScatterPlot?(h(),y("div",Co,[x(Do,{data:c.value?c.value:[],ref_key:"plot3DRef",ref:e},null,8,["data"]),!m.value||!l.value?(h(),y("div",Po,[o.value===null?(h(),Y(Me,{key:0})):(h(),y("p",Io,"Data not ready"))])):A("",!0)])):A("",!0)]))}}),Uo=q(To,[["__scopeId","data-v-089a8693"]]),Ro={id:"searchbar"},Ao={id:"searchbar-container"},Lo=["value"],Bo=B({__name:"Searchbar",setup(i){const t=W(),e=["title","author","year","note","publication","feature","uuid"],a=b(""),s=b(null);function o(){const c={searchBy:s.value.value,content:a.value};t.searchState=c,console.debug("search status updated",c),t.updateShownData()}const l=ht(o,300);function r(c){return c.charAt(0).toUpperCase()+c.slice(1)}return(c,w)=>(h(),y("div",Ro,[n("div",Ao,[n("select",{ref_key:"searchSelector",ref:s,name:"search_type",id:"searchType",onChange:o},[(h(),y(j,null,te(e,m=>n("option",{value:m},T(r(m)),9,Lo)),64))],544),V(n("input",{type:"text",id:"searchbar-input",placeholder:"Search","onUpdate:modelValue":w[0]||(w[0]=m=>a.value=m),onInput:w[1]||(w[1]=(...m)=>C(l)&&C(l)(...m))},null,544),[[ee,a.value]])])]))}}),Mo=q(Bo,[["__scopeId","data-v-0e98011a"]]);class Eo{constructor(t){ae(this,"router");this.router=t}getURLParams(){const t={},e=this.router.currentRoute.value.query;for(const a in e)t[a]=e[a];return t}setURLParam(t,e){const a=this.getURLParams();a[t]=e,this.router.push({query:a})}updateURLWithParam(t,e){const a=this.getURLParams();return a[t]=e,this.router.resolve({query:a}).href}}function qo(i,{router:t=null,datapoint:e=null}){const a=t?new Eo(t):null;if(i=i.replace(/^---[\s\S]*?---/,""),e){const s=J().user;i=i.replace(new RegExp("./misc/","g"),`${Ie()}/misc/${e.summary.uuid}?u=${s.id}&&fname=`),a&&(window.location.href.includes("/reader/")?i=i.replace(new RegExp("\\$\\{doc\\}#","g"),a.updateURLWithParam("docHashMark","")):i=i.replace(new RegExp("\\$\\{doc\\}#","g"),`${e.getOpenDocURL()}#`))}return i}const Fo={id:"noteEditor"},zo={key:2,id:"save-hint"},Oo={style:{"padding-inline":"5px","padding-block":"0.5rem"}},Ho={key:0,style:{display:"flex",gap:"5px"}},Wo=["href"],No={key:1,style:{display:"flex"}},jo={id:"btn-container"},Ko=["id"],Vo={key:0,id:"misc-container",class:"hover-scrollable"},Zo={key:0,style:{"font-weight":"bold",color:"var(--color-text-soft)",top:"0.5rem"}},Go=["href"],Jo={key:0,style:{color:"var(--color-text-soft)"}},Qo={class:"misc-file-op-container"},Yo=["onClick"],Xo=["onClick"],ei=["onClick"],ti=B({__name:"NoteEditor",props:{datapoint:{},autoEnableEdit:{type:Boolean,default:!1}},setup(i,{expose:t}){const e=i,a=me(),s=b(""),o=b({}),l=R(()=>{var z;return!e.datapoint||((z=e.datapoint)==null?void 0:z.isDummy())}),r=b(Q.isDarkMode()?"dark":"light"),c=()=>r.value=Q.isDarkMode()?"dark":"light";le(()=>Q.registerThemeChangeCallback(c)),it(()=>Q.unregisterThemeChangeCallback(c)),ne(()=>s.value,z=>{try{const F=Wt(z);if(typeof F.data!="object"||F.data===o.value)return;o.value=F.data,console.log("DEBUG: front matter",o.value)}catch{}});const w=R(()=>qo(s.value,{router:a,datapoint:e.datapoint})),m=b(null),p=W(),u=b([]),f=b(""),d=R(()=>{function z(G){return G.replace(/\n/g,"").replace(/\r/g,"")}if(z(f.value)===z(s.value))return"";const F=z(f.value).trim(),K=z(s.value).trim();if(F.length!==K.length)return console.log("length diff",F.length,K.length),"Unsaved";for(let G=0;G<F.length;G++)if(F[G]!==K[G]){console.log("diff at",G,F[G],K[G]),console.log("char code",F.charCodeAt(G),K.charCodeAt(G));break}return"Unsaved"});function k(){s.value="",f.value="",u.value=[]}async function P(){if(!e.datapoint||e.datapoint.isDummy())return;const z=await e.datapoint.fetchNote();f.value=z,s.value=z,e.autoEnableEdit&&!z&&(U.value=!1)}async function S(){!e.datapoint||e.datapoint.isDummy()||(u.value=await e.datapoint.listMiscFiles())}async function g(){!e.datapoint||e.datapoint.isDummy()||await Promise.all([P(),S()])}We(g),le(g),ne(()=>e.datapoint,()=>{l.value?k():(g(),console.log("datapoint changed, fetching note and misc files..."))});async function D(){!e.datapoint||e.datapoint.isDummy()||(await e.datapoint.uploadNote(s.value),f.value=s.value)}const $=async z=>{!e.datapoint||e.datapoint.isDummy()||(await e.datapoint.deleteMiscFile(z),u.value=u.value.filter(F=>F.fname!==z),W().showPopup("File deleted","info"))},_=async(z,F)=>{if(!(!e.datapoint||e.datapoint.isDummy())){if(z.split(".").pop()!==F.split(".").pop()){W().showPopup("File extension must be the same","error");return}await e.datapoint.renameMiscFile(z,F),s.value=s.value.replace(z,F),S(),W().showPopup("File renamed","info")}},v=async z=>{if(!e.datapoint||e.datapoint.isDummy())return;p.showPopup("Upload","info"),(await e.datapoint.uploadMisc(z)).map(K=>m.value.insert(()=>({targetValue:`![image](${K})`,select:!1,deviationStart:0,deviationEnd:0}))),D(),S()},U=b(!0);function Z(z){return s.value.indexOf(z)>=0}function ie(z){const F=window.prompt(z);if(!F)throw new Error("User cancelled");return F}return t({preview:U,fetchNote:P}),Jt("update_note",z=>{if(!e.datapoint||e.datapoint.isDummy()||z.session_id===X().wsConn.sessionID)return;z.datapoint_summary.uuid===e.datapoint.uid&&g().then(()=>{W().showPopup("update note from other clients","info")})}),(z,F)=>(h(),y("div",Fo,[n("div",{class:"editor",onDblclick:F[1]||(F[1]=K=>U.value=!1)},[U.value?(h(),Y(C(Ht),{key:1,"model-value":w.value,theme:r.value,"preview-theme":"vuepress"},null,8,["model-value","theme"])):(h(),Y(C(Ot),{key:0,ref_key:"mdEditor",ref:m,modelValue:s.value,"onUpdate:modelValue":F[0]||(F[0]=K=>s.value=K),preview:!1,language:"en-US",theme:r.value,onOnSave:D,onOnUploadImg:v,disabled:l.value,toolbars:["bold","underline","italic","-","strikeThrough","title","quote","unorderedList","orderedList","task","-","link","-","revoke","next","save","=","catalog"]},null,8,["modelValue","theme","disabled"])),!U.value&&d.value?(h(),y("div",zo,T(d.value),1)):A("",!0)],32),n("div",Oo,[(h(!0),y(j,null,te(o.value,(K,G)=>(h(),y(j,{key:G},[G=="links"?(h(),y("div",Ho,[F[4]||(F[4]=n("label",{class:"frontmatter-label"},"LINKS",-1)),(h(!0),y(j,null,te(K,(fe,O)=>(h(),y(j,null,[typeof O=="string"?(h(),y("a",{key:0,class:"frontmatter-link",href:fe,target:"_blank"},T(O),9,Wo)):A("",!0)],64))),256))])):(h(),y("div",No,[F[5]||(F[5]=E(" [unknown-entry] ")),n("b",null,T(G)+": ",1),E(T(K),1)]))],64))),128))]),n("div",jo,[n("button",{onClick:F[2]||(F[2]=K=>U.value=!U.value)},T(U.value?"Edit":"Preview"),1),x(C($e),{action:K=>{!e.datapoint||e.datapoint.isDummy()||e.datapoint.uploadMisc([K]).then(G=>{C(W)().showPopup("File uploaded","success"),S(),m.value.insert(()=>({targetValue:`[${K.name}](${G[0]})`,select:!1,deviationStart:0,deviationEnd:0}))})}},null,8,["action"])]),n("div",{id:"misc-toggle",onClick:F[3]||(F[3]=()=>{C(p).showMiscPanel=!C(p).showMiscPanel})},[n("div",{id:C(p).showMiscPanel?"triangle-down":"triangle"},null,8,Ko)]),C(p).showMiscPanel?(h(),y("div",Vo,[u.value.length===0?(h(),y("div",Zo," No attached files. ")):A("",!0),(h(!0),y(j,null,te(u.value,K=>(h(),y("div",{key:K.fname,class:"misc-file"},[n("div",null,[n("a",{href:K.url,target:"_blank"},T(K.fname),9,Go),Z(K.fname)?A("",!0):(h(),y("label",Jo," (no-ref) "))]),n("div",Qo,[n("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:G=>{C(je)(K.fname),C(W)().showPopup("Copied")}}," copy ",8,Yo),n("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:G=>_(K.fname,ie("New name"))}," rename ",8,Xo),Z(K.fname)?A("",!0):(h(),y("a",{key:0,style:{color:"var(--color-danger)",cursor:"pointer"},onClick:G=>$(K.fname)}," delete ",8,ei))])]))),128))])):A("",!0)]))}}),bt=q(ti,[["__scopeId","data-v-fb234051"]]);function ni(i){const t=X().conn,e=b({}),a=()=>{Promise.all(i.value.map(s=>t.query({searchBy:"author",searchContent:s}))).then(s=>{for(let o=0;o<i.value.length;o++)e.value[i.value[o]]=s[o].uids})};return ne(i,a,{immediate:!0}),{authorPapers:e,updateAuthorPapers:a}}const ai={style:{"font-weight":"bold"}},si={id:"summary-panel-main"},oi={class:"title"},ii={class:"authors-div"},li={class:"author-container"},ri={class:"author"},ui=["onClick"],di={key:0,class:"publication"},ci={key:1,class:"docsize"},pi=B({__name:"InfoPanel",props:{datapoint:{}},setup(i){const t=i,e=R(()=>t.datapoint?t.datapoint:J().database.getDummy()),a=R(()=>t.datapoint?ft(t.datapoint.summary.bibtex):""),s=R(()=>{var p;return((p=t.datapoint)==null?void 0:p.authors)||[]}),{authorPapers:o}=ni(s),l=R(()=>{const p={};for(const[u,f]of Object.entries(o.value))p[u]=f.filter(d=>{var k;return d!==((k=t.datapoint)==null?void 0:k.uid)});return p}),r=b(""),{width:c}=Ee(),w=R(()=>c.value>768?"horizontal":"vertical"),m=c.value>768?.3:.5;return(p,u)=>(h(),y(j,null,[x(ge,{show:r.value.length>0,onClose:u[0]||(u[0]=f=>r.value="")},{default:L(()=>[n("h2",ai," All entries by "+T(r.value),1),u[1]||(u[1]=n("div",{style:{height:"10px"}},null,-1)),x(ke,{uids:C(o)[r.value]},null,8,["uids"])]),_:1},8,["show"]),x(Qe,{direction:w.value,"split-ratio":C(m)},{a:L(()=>[n("div",si,[n("h2",oi,T(e.value.summary.title),1),n("div",ii,[(h(!0),y(j,null,te(s.value,f=>{var d;return h(),y("div",li,[n("span",ri,T(f),1),((d=l.value[f])==null?void 0:d.length)>0?(h(),y("span",{key:0,class:"author-paper-count",onClick:k=>r.value=f}," ("+T(l.value[f].length)+") ",9,ui)):A("",!0)])}),256))]),e.value.isDummy()?A("",!0):(h(),y("div",di,T(e.value.publication+`. (${e.value.year})`+(a.value?", "+a.value:"")),1)),e.value.summary.doc_size?(h(),y("div",ci,[n("span",null,T(e.value.summary.doc_size)+" MB ",1)])):A("",!0)])]),b:L(()=>[x(bt,{datapoint:p.datapoint},null,8,["datapoint"])]),_:1},8,["direction","split-ratio"])],64))}}),hi=q(pi,[["__scopeId","data-v-b81a3032"]]),fi={id:"main-home",class:"gradIn compact"},mi={class:"horizontal fullHeight"},vi={key:0,id:"left-panel"},gi={id:"doc-panel",class:"panel1"},yi={key:0,class:"fullWidth"},wi={id:"doc-top-bar"},_i={style:{"flex-grow":"1"}},bi={style:{display:"flex","flex-grow":"0","margin-right":"5px","margin-block":"5px"}},ki={key:1,id:"blankPlaceholder",style:{"user-select":"none"}},Si={key:0,style:{"font-size":"xx-large","font-weight":"bold"}},$i={key:1,style:{"font-size":"medium","margin-top":"0"}},Di={name:"Home",inheritAttrs:!1,customOptions:{}},xi=B({...Di,setup(i){const t=W(),e=J(),a=N(),{width:s}=Ee(),l=me().currentRoute.value.query.tags;l!=null&&(t.tagStatus.checked=new H(l.split("&&")),t.tagStatus.unfolded=t.tagStatus.checked.allParents());const r=b(null);ne(()=>t.focusedDataUID,f=>{f?e.database.aget(f).then(d=>{r.value=d}):r.value=null});let c=new H;ne(()=>t.tagStatus,()=>{const f=t.tagStatus.checked;f.equals(c)||(t.updateShownData(),c=f.copy())},{deep:!0});const w=b(null);function m(){w.value.show({datapoint:null})}function p(f){var k;f.preventDefault();const d=(k=f.dataTransfer)==null?void 0:k.files;d&&(m(),w.value.loadFiles(d)||w.value.close())}function u(){t.reloadDatabase(),X().wsConn.resetReconnect()}return(f,d)=>(h(),y(j,null,[x(Je,{ref_key:"dataEditor",ref:w},null,512),x(Ue,{"return-home":!1,compact:!0}),n("div",fi,[n("div",mi,[x(Pe,{name:"left-in"},{default:L(()=>[C(a).showTagPanel?(h(),y("div",vi,[x(In)])):A("",!0)]),_:1}),x(Qe,{direction:C(s)>768?"vertical":"horizontal",mode:C(a).showHomeInfoPanel?"ab":"a","split-ratio":C(s)>768?.8:.6},{a:L(()=>[n("div",gi,[C(a).show3DScatterPlot?(h(),y("div",yi,[x(Uo)])):A("",!0),n("div",{class:"scrollable",id:"doc-container",onDragover:d[1]||(d[1]=k=>k.preventDefault()),onDrop:p},[n("div",wi,[n("div",_i,[x(Mo)]),n("div",bi,[x(ve,{iconSrc:C(ko),labelText:"New",title:"Add new data to database",onClick:m,shortcut:"ctrl+n"},null,8,["iconSrc"]),x(ve,{iconSrc:C(_t),labelText:"Reload",title:"Reload database",onClick:u},null,8,["iconSrc"])])]),C(t).shownDataUIDs.length?(h(),Y(ke,{key:0,uids:C(t).shownDataUIDs,unfoldedIds:C(t).unfoldedDataUIDs,"onUpdate:unfoldedIds":d[0]||(d[0]=k=>C(t).unfoldedDataUIDs=k)},null,8,["uids","unfoldedIds"])):(h(),y("div",ki,[C(e).database.initialized?(h(),y("p",Si," Nothing to show ")):A("",!0),C(e).database.initialized?(h(),y("p",$i,[d[2]||(d[2]=E(" Add your first enty by clicking the ")),n("b",null,[n("a",{onClick:m,style:{cursor:"pointer","border-radius":"5px","padding-inline":"3px","background-color":"var(--color-background-soft)"}},"⊕ New")]),d[3]||(d[3]=E(" button above.")),d[4]||(d[4]=n("br",null,null,-1))])):A("",!0),C(e).database.initialized?A("",!0):(h(),Y(Me,{key:2}))]))],32)])]),b:L(()=>[x(hi,{datapoint:r.value},null,8,["datapoint"])]),_:1},8,["direction","mode","split-ratio"])])])],64))}}),Ci=q(xi,[["__scopeId","data-v-39258474"]]);function Pi(i,t=!1){t&&(i*=1e3);const e=new Date(i);let a=e.getFullYear().toString();a.length!==4&&(a="0".repeat(4-a.length)+a);let s=(e.getMonth()+1).toString();s.length===1&&(s="0"+s);let o=e.getDate().toString();o.length===1&&(o="0"+o);let l=`${a}-${s}-${o} `;const r={hourCycle:"h23",hour:"2-digit",minute:"2-digit",second:"2-digit"};return l+=e.toLocaleTimeString([],r),l}const Ii={id:"authorPapers"},Ti={id:"feed-main",class:"slideInFast"},Ui={class:"articleBlock"},Ri={class:"titleBlock"},Ai={style:{"font-weight":"bold"}},Li={style:{display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}},Bi={class:"titleId"},Mi={class:"authors"},Ei={class:"authorSpan"},qi=["href"],Fi={key:1},zi=["onClick"],Oi={key:3},Hi={class:"actions"},Wi=["href"],Ni=["href"],ji={style:{"font-family":"'Times New Roman', Times, serif"}},Ki={id:"relatedArticles"},Vi=B({__name:"ArticleBlock",props:{article:{}},setup(i){const t=i,e=J(),a=X().conn,s=b(null);async function o(){var P;(P=s.value)==null||P.show({datapoint:null,bibtex:t.article.bibtex,tags:[],url:t.article.url})}const l=b({});async function r(){for(let P=0;P<t.article.authors.length;P++){const S=t.article.authors[P],g=t.article.authors_other_publications[P],D=await e.database.agetMany(g);l.value[S]=D}}r();const c=R(()=>{const P={};for(const S in l.value)l.value[S]?P[S]=l.value[S].length:P[S]=null;return P}),w=b(!1),m=b([]);function p(P){m.value=l.value[P],m.value||(m.value=[]),w.value=!0}const u=b([]),f=b([]),d=R(()=>{const P={};for(let S=0;S<u.value.length;S++)P[u.value[S].summary.uuid]=f.value[S].toPrecision(4);return P});function k(){u.value.length>0||a.query({searchBy:"feature",searchContent:t.article.abstract,maxResults:10}).then(P=>{const S=P.scores,g=P.uids,D=vt(g,S);e.database.agetMany(D[0],!1).then($=>{u.value=$;const _=[];for(const v of $){const U=g.indexOf(v.summary.uuid);U>=0&&_.push(S[U])}f.value=_})})}return(P,S)=>(h(),y(j,null,[x(Je,{ref_key:"dataEditor",ref:s},null,512),x(ge,{show:w.value,"onUpdate:show":S[0]||(S[0]=g=>w.value=g),title:"Publications in the database",onOnClose:S[1]||(S[1]=g=>m.value=[])},{default:L(()=>[n("div",Ii,[x(ke,{uids:m.value.map(g=>g.summary.uuid)},null,8,["uids"])])]),_:1},8,["show"]),n("div",Ti,[n("div",Ui,[n("div",Ri,[n("h2",Ai,T(t.article.title),1),n("div",Li,[x(Ve,{tags:t.article.tags},null,8,["tags"]),n("label",Bi,T(t.article.uuid),1)])]),n("div",Mi,[(h(!0),y(j,null,te(t.article.authors,(g,D)=>(h(),y("span",Ei,[t.article.tags.some($=>$.startsWith("arxiv"))?(h(),y("a",{key:0,class:"link",href:`https://arxiv.org/search/?query=${g}&searchtype=author`,target:"_blank"},T(g),9,qi)):(h(),y("label",Fi,T(g),1)),c.value[g]?(h(),y("a",{key:2,class:"pubCount",onClick:()=>p(g)},T(`(${c.value[g]})`),9,zi)):A("",!0),D<t.article.authors.length-1?(h(),y("span",Oi,", ")):A("",!0)]))),256))]),n("div",Hi,[n("a",{href:P.article.url,target:"_blank"},"Link",8,Wi),S[2]||(S[2]=E(" | ")),n("a",{href:`https://arxiv.org/pdf/${P.article.uuid}.pdf`,target:"_blank"},"PDF",8,Ni),S[3]||(S[3]=E(" | ")),n("a",{onClick:o},"Collect")]),n("p",null,"Added: "+T(C(Pi)(t.article.time_added,!0)),1),n("details",null,[S[4]||(S[4]=n("summary",null,"Abstract",-1)),n("p",ji,T(t.article.abstract),1)]),n("details",null,[n("summary",{onClick:k},"Related articles"),n("div",Ki,[x(ke,{uids:u.value.map(g=>g.summary.uuid),scores:d.value},null,8,["uids","scores"])])])])])],64))}}),Zi=q(Vi,[["__scopeId","data-v-9dd873b4"]]),Gi={id:"toolbar"},Ji={id:"main"},Qi={style:{"margin-block":"1rem"}},Yi=["src"],Xi={id:"settings"},el={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",gap:"0.5rem","flex-flow":"row wrap"}},tl=["value"],nl=["value"],al={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",gap:"0.5rem"}},sl={key:0,id:"loadingPlaceholder"},ol={key:1,id:"loadingPlaceholder"},il=B({__name:"Feed",setup(i){const t=X().conn,e=me();function a(D=0){const $=new Date;return $.setDate($.getDate()+D),$.toISOString().split("T")[0]}const s=b("arxiv"),o=b(!1),l=b(["arxiv"]),r=b(a(1)),c=b(a(-1)),w=b(parseInt(e.currentRoute.value.query.maxResults)||100),m=b(""),p=b(null),u=b([]),f=R(function(){return[...u.value].sort(($,_)=>{if(p.value===null||!$.feature||!_.feature)return 0;{const v=new Float32Array($.feature),U=new Float32Array(_.feature),Z=p.value,ie=v.reduce((F,K,G)=>F+(K-Z[G])**2,0),z=U.reduce((F,K,G)=>F+(K-Z[G])**2,0);return ie-z}})});function d(){if(m.value.trim()===""){p.value=null;return}t.featurizeText(m.value).then(D=>{p.value=new Float32Array(D)},()=>{console.log("failed to featurize")})}const k=ht(d,100);w.value>200&&(window.alert("maxResults cannot be larger than 200"),w.value=200);let P=e.currentRoute.value.query.search||"";P!==""&&(m.value=P);const S=b(null);async function g(){u.value=[];const D=X().conn;l.value=["arxiv"].concat(await D.getFeedCategories()),o.value=!0;const $=new Date(r.value).getTime()/1e3,_=new Date(c.value).getTime()/1e3;try{const v=await D.getFeedList({maxResults:w.value,category:s.value,timeBefore:$,timeAfter:_});u.value=v,d()}finally{o.value=!1}}return le(()=>{g().then(()=>S.value.classList.remove("spin"),()=>{S.value.classList.remove("spin"),window.alert("Failed to fetch articles")})}),(D,$)=>(h(),y(j,null,[n("div",Gi,[x(Ue,{ref:"toolbar"},null,512)]),n("div",Ji,[n("h1",Qi,[$[7]||($[7]=E(" Daily Feed ")),n("img",{ref_key:"refreshButton",ref:S,src:C(_t),alt:"",class:"icon spin",title:"refresh the page",onClick:$[0]||($[0]=_=>{const v=_.target;v.classList.contains("spin")||(v.classList.add("spin"),g().then(()=>v.classList.remove("spin")))})},null,8,Yi)]),n("div",Xi,[n("div",el,[n("span",null,[$[8]||($[8]=E(" Category: ")),V(n("select",{name:"category",id:"category-select","onUpdate:modelValue":$[1]||($[1]=_=>s.value=_),onChange:g},[(h(!0),y(j,null,te(l.value,_=>(h(),y("option",{value:_},T(_),9,tl))),256))],544),[[Ae,s.value]])]),n("span",null,[$[9]||($[9]=E(" Max results: ")),V(n("select",{"onUpdate:modelValue":$[2]||($[2]=_=>w.value=_),onChange:g},[(h(),y(j,null,te([20,50,100,200,500],_=>n("option",{value:_},T(_),9,nl)),64))],544),[[Ae,w.value]])]),n("span",null,[$[10]||($[10]=E(" From: ")),V(n("input",{type:"date","onUpdate:modelValue":$[3]||($[3]=_=>c.value=_),onChange:g},null,544),[[ee,c.value]])]),n("span",null,[$[11]||($[11]=E(" To: ")),V(n("input",{type:"date","onUpdate:modelValue":$[4]||($[4]=_=>r.value=_),onChange:g},null,544),[[ee,r.value]])])]),n("div",al,[V(n("input",{type:"text",placeholder:"Search",onInput:$[5]||($[5]=(..._)=>C(k)&&C(k)(..._)),"onUpdate:modelValue":$[6]||($[6]=_=>m.value=_),autocomplete:"off"},null,544),[[ee,m.value]])])]),f.value.length===0&&o.value?(h(),y("div",sl,[$[12]||($[12]=n("b",null,"Fetching...",-1)),x(Me)])):A("",!0),f.value.length===0&&!o.value?(h(),y("div",ol,$[13]||($[13]=[n("b",null,"No articles found",-1)]))):A("",!0),(h(!0),y(j,null,te(f.value,_=>(h(),Y(Zi,{article:_},null,8,["article"]))),256))])],64))}}),ll=q(il,[["__scopeId","data-v-ace03a53"]]),rl={class:"main"},ul={id:"login",class:"slideIn"},dl={class:"loginLine"},cl={class:"loginLine"},pl=["type"],hl={class:"options"},fl={key:0,class:"error"},ml=B({__name:"LoginInput",setup(i){const t=b(""),e=b(""),a=b(""),s=b(!0),o=b(!1),l=R(()=>o.value?"text":"password"),r=b("Login"),c=me(),w=b(""),m=b("");c.isReady().then(()=>{ut(()=>{w.value=N().backendHost,m.value=N().backendPort})});function p(){N().setBackendHost(w.value),N().setBackendPort(m.value),r.value="Connecting...";const u=X().conn,f=on(t.value,e.value);N().setEncKey(f,!1),u.authorize().then(d=>{Ke(f,d,s.value),a.value="";const k=c.currentRoute.value.query.from;k?(console.log("Redirecting to",k),c.push(k)):c.push("/"),r.value="Login"},d=>{a.value=d,r.value="Login"})}return(u,f)=>(h(),y("div",rl,[n("div",ul,[n("form",null,[n("div",dl,[V(n("input",{class:"key-input",type:"text",id:"username-input","onUpdate:modelValue":f[0]||(f[0]=d=>t.value=d),placeholder:"Username",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[ee,t.value]])]),n("div",cl,[V(n("input",{class:"key-input",type:l.value,id:"password-input","onUpdate:modelValue":f[1]||(f[1]=d=>e.value=d),placeholder:"Password"},null,8,pl),[[Oe,e.value]])]),n("div",hl,[x(ye,{checked:s.value,onOnCheck:f[2]||(f[2]=()=>{s.value=!s.value})},{default:L(()=>f[8]||(f[8]=[E("Stay login")])),_:1},8,["checked"]),x(ye,{checked:o.value,onOnCheck:f[3]||(f[3]=()=>{o.value=!o.value})},{default:L(()=>f[9]||(f[9]=[E("Show key")])),_:1},8,["checked"])]),A("",!0),n("button",{type:"submit",onClick:dt(p,["prevent"])},T(r.value),1)]),a.value?(h(),y("p",fl,T(a.value),1)):A("",!0)])]))}}),vl=q(ml,[["__scopeId","data-v-34f6e322"]]),gl={props:{defaultInvitationCode:{type:String,default:""}},data(){return{invitationCode:this.defaultInvitationCode,username:"",password:"",passwordConfirm:"",name:be[Math.floor(Math.random()*be.length)],showPassword:!1}},emits:["register-success","register-fail"],components:{SwitchToggle:Se},methods:{submitForm(i){if(this.password!==this.passwordConfirm){this.$emit("register-fail","Passwords do not match");return}X().conn.registerUser(this.invitationCode,this.username,this.password,this.name).then(()=>{this.$emit("register-success")},t=>{t.message.includes("409")?this.$emit("register-fail","Username already exists"):t.message.includes("401")?this.$emit("register-fail","Invalid invitation code"):t.message.includes("403")?this.$emit("register-fail","Invitation code expired"):t.message.includes("507")?this.$emit("register-fail","Maximum number of users reached"):this.$emit("register-fail",t)}),i.preventDefault()}}},yl={id:"form-container"},wl={class:"form-elem"},_l={class:"form-elem"},bl={class:"form-elem"},kl=["type"],Sl={class:"form-elem"},$l=["type"],Dl={class:"form-elem"},xl={id:"show-password-container"};function Cl(i,t,e,a,s,o){const l=He("SwitchToggle");return h(),y("form",{onSubmit:t[6]||(t[6]=(...r)=>o.submitForm&&o.submitForm(...r)),id:"registration-form"},[n("div",yl,[n("div",wl,[t[7]||(t[7]=n("div",{style:{color:"var(--color-text-soft)","font-size":"smaller","padding-inline":"0.5rem"}}," Get an invitation from the server administrator ",-1)),V(n("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>s.invitationCode=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[ee,s.invitationCode]]),t[8]||(t[8]=n("span",null,"Invitation code",-1))]),n("div",_l,[V(n("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>s.username=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[ee,s.username]]),t[9]||(t[9]=n("span",null,"Username",-1))]),n("div",bl,[V(n("input",{type:`${s.showPassword?"text":"password"}`,"onUpdate:modelValue":t[2]||(t[2]=r=>s.password=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,kl),[[Oe,s.password]]),t[10]||(t[10]=n("span",null,"Password",-1))]),n("div",Sl,[V(n("input",{type:`${s.showPassword?"text":"password"}`,"onUpdate:modelValue":t[3]||(t[3]=r=>s.passwordConfirm=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,$l),[[Oe,s.passwordConfirm]]),t[11]||(t[11]=n("span",null,"Confirm password",-1))]),n("div",Dl,[V(n("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=r=>s.name=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[ee,s.name]]),t[12]||(t[12]=n("span",null,"Name",-1))])]),n("div",xl,[x(l,{checked:s.showPassword,"onUpdate:checked":t[5]||(t[5]=r=>s.showPassword=r)},null,8,["checked"]),t[13]||(t[13]=n("label",null,"Show password",-1))]),t[14]||(t[14]=n("button",{type:"submit"},"Register",-1))],32)}const Pl=q(gl,[["render",Cl],["__scopeId","data-v-892e7367"]]),Il={id:"login-main"},Tl={id:"container"},Ul={for:"login",id:"info"},Rl=["href"],Al=B({__name:"Login",setup(i){Q.setDefaultDarkMode();const t=b(""),e=b(!1),a=me();return console.log(a.currentRoute.value.query.invitation),a.currentRoute.value.query.invitation&&(e.value=!0,t.value=a.currentRoute.value.query.invitation),(s,o)=>(h(),y(j,null,[x(ge,{title:"User registration",show:e.value,"onUpdate:show":o[2]||(o[2]=l=>e.value=l),compact:!0},{default:L(()=>[x(Pl,{"default-invitation-code":t.value,onRegisterSuccess:o[0]||(o[0]=()=>{e.value=!1,C(W)().showPopup("Registration successful","success")}),onRegisterFail:o[1]||(o[1]=l=>C(W)().showPopup(l,"error"))},null,8,["default-invitation-code"])]),_:1},8,["show"]),n("div",Il,[n("div",Tl,[x(vl),n("label",Ul,[o[4]||(o[4]=E(" Need assistant? - ")),n("a",{onClick:o[3]||(o[3]=l=>e.value=!0)},"Register"),o[5]||(o[5]=E(" | ")),n("a",{href:`mailto:${C(Ls).email}`},"Contact me",8,Rl)])])])],64))}}),Ll=q(Al,[["__scopeId","data-v-def42eb3"]]),Bl={id:"reader-tab"},Ml=["onClick","tooltip"],El={class:"reader-tab-item-text"},ql=["onClick"],Fl=B({__name:"ReaderTab",props:{thisDatapoint:{},datapoints:{}},setup(i){const t=i,e=me(),a=W();function s(r){return`${r.summary.year}-${r.summary.title}`}const o=r=>{e.push("/reader/"+r.summary.uuid)},l=r=>{a.removeRecentlyReadDataUID(r.summary.uuid);const c=t.datapoints.findIndex(w=>w.summary.uuid===r.summary.uuid);c!==-1&&(t.datapoints.splice(c,1),t.thisDatapoint.summary.uuid===r.summary.uuid&&(t.datapoints.length>0?e.push("/reader/"+t.datapoints[0].summary.uuid):e.push("/")))};return(r,c)=>(h(),y("div",Bl,[(h(!0),y(j,null,te(t.datapoints,w=>(h(),y("div",{class:de("reader-tab-item"+(t.thisDatapoint.summary.uuid===w.summary.uuid?" active":"")),key:w.summary.uuid,onClick:m=>o(w),tooltip:w.summary.title},[n("div",El,T(s(w)),1),n("div",{class:"reader-tab-item-close",onClick:dt(m=>l(w),["stop"])},null,8,ql)],10,Ml))),128))]))}}),zl=q(Fl,[["__scopeId","data-v-c6171aab"]]),Ol={id:"body"},Hl=["src"],Wl=B({__name:"ReaderBody",props:{datapoint:{},layoutType:{}},setup(i,{expose:t}){const e=i,a=me(),s=R(()=>{let p=a.currentRoute.value.query.docHashMark;return p||(p=""),e.datapoint.fileType()=="pdf"&&!p.includes("pagemode=")&&(p+="&pagemode=none"),p}),o=b(!1),l=b(null);t({noteEditor:l});function r(m){N().setReaderLayoutType(m)}ne(()=>e.layoutType,(m,p)=>{console.log("layoutType changed:",p,"->",m),r(m)});const c=b(Q.isDarkMode()?"dark":"light");Q.registerThemeChangeCallback(()=>c.value=Q.isDarkMode()?"dark":"light");const w=R(()=>`${e.datapoint.getOpenDocURL({extraPDFViewerParams:{"color-mode":c.value},urlHashMark:s.value})}`);return le(()=>{r(e.layoutType)}),(m,p)=>(h(),y("div",Ol,[x(Qe,{direction:"vertical","split-ratio":C(W)().preferredReaderLeftPanelWidthPerc,"onUpdate:splitRatio":p[2]||(p[2]=u=>C(W)().preferredReaderLeftPanelWidthPerc=u),"splitter-width":"4px",mode:{0:"a",1:"b",2:"ab"}[m.layoutType],onMoveStart:p[3]||(p[3]=()=>o.value=!0),onMoveStop:p[4]||(p[4]=()=>o.value=!1),overflow:"unset"},{a:L(()=>[m.datapoint.summary.has_file?(h(),y("iframe",{key:0,src:w.value,title:"doc",frameborder:"0",style:se({"pointer-events":o.value?"none":"auto"})},null,12,Hl)):(h(),y("div",{key:1,style:{display:"flex","justify-content":"center","align-items":"center",height:"100%",width:"100%"},onDragover:p[0]||(p[0]=u=>u.preventDefault()),onDrop:p[1]||(p[1]=u=>{var d;u.preventDefault();const f=(d=u.dataTransfer)==null?void 0:d.files;C(W)().showPopup("Upload file","info"),f&&f.length==1&&m.datapoint.uploadDocument(f[0]).then(()=>{C(W)().showPopup("File uploaded","success")})})},[p[5]||(p[5]=n("div",{style:{color:"var(--color-text-soft)","font-weight":"bold","font-size":"large"}},"No file, drag and drop to  ",-1)),x(C($e),{action:u=>m.datapoint.uploadDocument(u),text:"upload","as-link":!0,style:{"font-weight":"bold","font-size":"large",cursor:"pointer"}},null,8,["action"])],32))]),b:L(()=>[x(bt,{datapoint:m.datapoint,"auto-enable-edit":!0,ref_key:"noteEditor",ref:l},null,8,["datapoint"])]),_:1},8,["split-ratio","mode"])]))}}),Nl=q(Wl,[["__scopeId","data-v-e87ddb4e"]]),jl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M180-120q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H180Zm390%200q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H570Zm210-660H570v600h210v-600ZM570-180h210-210Z'/%3e%3c/svg%3e",Kl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M220-160q-24%200-42-18t-18-42v-143h60v143h520v-143h60v143q0%2024-18%2042t-42%2018H220Zm230-153v-371L330-564l-43-43%20193-193%20193%20193-43%2043-120-120v371h-60Z'/%3e%3c/svg%3e",Vl={id:"toolbar-ops"},Zl={id:"main-reader",class:"gradIn"},Gl={name:"Reader",inheritAttrs:!1,customOptions:{}},Jl=B({...Gl,setup(i){const t=J(),e=W(),a=ct(),s=b(t.database.getDummy()),o=b([]);async function l(){const P=await t.database.aget(a.params.id);P&&(s.value=P),e.addRecentlyReadDataUID(P.uid),t.database.agetMany(e.recentlyReadDataUIDs).then(S=>{S.reverse(),o.value=S}),console.log("Reader: updated datapoint",P.summary.title,"uid",P.uid)}ne(()=>a.params.id,()=>{l()});const r=b(N().readerLayoutType);window.innerWidth<800&&(r.value=0);function c(){if(window.innerWidth<800)r.value=(r.value+1)%2;else switch(r.value){case 0:r.value=2;break;case 1:r.value=2;break;case 2:r.value=0;break}}const w=b(null);function m(P){function S(){s.value.uploadDocument(P).then(g=>{s.value.update(g),e.showPopup("Document uploaded","success")},()=>e.showPopup("Failed to upload document","error"))}s.value.summary.has_file?s.value.freeDocument().then(g=>{s.value.update(g),S()},()=>e.showPopup("Failed to free document","error")):S()}const p=Ee(),u=b(null),f=b(null);function d(){if(u.value&&f.value){const P=f.value.getBoundingClientRect().width;u.value.style.width=`calc(100% - ${P}px)`}}const k=b(null);return le(()=>{console.log("Reader mounted"),l(),ne([p.width,p.height],()=>{d()}),d()}),Lt(()=>{d()}),rt(()=>{console.log("Reader unmounted"),p.cleanup()}),(P,S)=>(h(),y(j,null,[x(Ue,{compact:!0,"show-navigator":!1},{default:L(()=>[n("div",Vl,[n("div",{ref_key:"toolbarOpsLeft",ref:u},[x(zl,{"this-datapoint":s.value,datapoints:o.value},null,8,["this-datapoint","datapoints"])],512),n("div",{class:"toolbar-ops-right",ref_key:"toolbarOpsRight",ref:f},[x(C($e),{action:m,ref_key:"fileSelectionBtn",ref:w,style:{display:"none"}},null,512),x(ve,{iconSrc:C(Kl),labelText:"replace",shortcut:"ctrl+u",onOnClick:S[0]||(S[0]=()=>w.value.click()),title:"upload a new document"},null,8,["iconSrc"]),x(ve,{iconSrc:C(jl),labelText:"layout",shortcut:"ctrl+r",onOnClick:c,title:"change layout"},null,8,["iconSrc"])],512)])]),_:1}),n("div",Zl,[x(Nl,{datapoint:s.value,layoutType:r.value,ref_key:"readerBody",ref:k},null,8,["datapoint","layoutType"])])],64))}}),Ql=q(Jl,[["__scopeId","data-v-04fdd177"]]),Yl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360%20560v-123l221-220q9-9%2020-13t22-4q12%200%2023%204.5t20%2013.5l37%2037q8%209%2012.5%2020t4.5%2022q0%2011-4%2022.5T863-380L643-160H520Zm300-263-37-37%2037%2037ZM580-220h38l121-122-18-19-19-18-122%20121v38Zm141-141-19-18%2037%2037-18-19Z'/%3e%3c/svg%3e",Xl={id:"users-widget-main"},er={id:"user-editor-main"},tr={class:"horizontal"},nr=["src"],ar={id:"user-editor"},sr={class:"horizontal"},or={class:"horizonal",style:{display:"flex","align-items":"center",gap:"0.5rem"}},ir={class:"full-width left-align"},lr={key:0,class:"full-width left-align"},rr={id:"mandatory-tag-edit"},ur={id:"delete-user-dialog-main"},dr={id:"create-user-main"},cr={id:"create-user-table"},pr={style:{display:"flex","align-items":"center","padding-block":"0.25rem"}},hr={id:"user-widget-header"},fr={key:0},mr={class:"user-line"},vr={key:0},gr=["onClick"],yr=["src"],wr={class:"center full-width full-height"},_r=["src"],br={class:"username"},kr={style:{"text-align":"right"}},Sr={key:1,class:"admin_hint"},$r={key:0,colspan:"5"},Dr=B({__name:"UsersWidget",setup(i){const t=b([]),e=R(()=>J().user.is_admin),a=X().conn,s=b(!1),o=b({});function l(_){if(!e.value)return;const v=JSON.parse(JSON.stringify(_));o.value=v,o.value.max_storage/=1024*1024,s.value=!0}function r(_){const v=_.split(";").map(U=>U.trim());v.length===1&&v[0]===""?o.value.mandatory_tags=[]:o.value.mandatory_tags=v}function c(){console.log(o.value),a.setUserAccess(o.value.username,o.value.is_admin,o.value.mandatory_tags,o.value.max_storage*1024*1024).then(_=>{s.value=!1},_=>{console.log(_),W().showPopup(_,"error")})}const w=b(!1),m=b("");function p(){if(m.value!==o.value.username){W().showPopup("Wrong input","error");return}a.deleteUser(o.value.username).then(_=>{W().showPopup(`User ${o.value.username} deleted`,"info"),w.value=!1,s.value=!1},_=>{console.log(_),W().showPopup(_,"error")})}const u=b(!1),f=b(""),d=b(be[Math.floor(Math.random()*be.length)]),k=b(""),P=b(!1),S=b(""),g=b(100);function D(){u.value=!1,f.value="",d.value=be[Math.floor(Math.random()*be.length)],k.value="",P.value=!1,S.value=""}function $(){if(f.value===""){W().showPopup("Please enter the username","error");return}const _=S.value.split(";").map(v=>v.trim());_.length===1&&_[0]===""&&_.splice(0,1),a.createUser(f.value,d.value,k.value,P.value,_,g.value).then(v=>{W().showPopup(`User ${f.value} created`,"success"),D()},v=>{console.log(v),W().showPopup(v,"error")})}return le(()=>{a.getUserList().then(_=>{t.value=_},_=>{console.log(_)})}),re("add_user",_=>{const v=_.user_info;t.value.push(v)}),re("update_user",_=>{const v=_.user_info;t.value.map((U,Z)=>{U.id===v.id&&(t.value[Z]=v)})}),re("delete_user",_=>{const v=_.username;t.value=t.value.filter(U=>U.username!==v)}),(_,v)=>(h(),y("div",Xl,[x(we,{show:s.value,"onUpdate:show":v[4]||(v[4]=U=>s.value=U),title:"editor",onOnAccept:c,onOnCancel:v[5]||(v[5]=()=>s.value=!1)},{default:L(()=>[n("div",er,[n("div",tr,[n("img",{src:`${C(Ie)()}/user-avatar/${o.value.username}?size=128`,alt:"",class:"avatar-big"},null,8,nr),n("div",ar,[n("div",sr,[n("h2",null,T(o.value.name),1),E(" ("+T(o.value.username)+") ",1)]),n("div",or,[v[18]||(v[18]=n("b",null,"Administrator ",-1)),x(Se,{checked:o.value.is_admin,"onUpdate:checked":v[0]||(v[0]=U=>o.value.is_admin=U)},null,8,["checked"])]),n("div",ir,[v[19]||(v[19]=n("b",null,"Max Storage (MB):",-1)),v[20]||(v[20]=n("br",null,null,-1)),V(n("input",{type:"number","onUpdate:modelValue":v[1]||(v[1]=U=>o.value.max_storage=U)},null,512),[[ee,o.value.max_storage]])]),o.value.is_admin?A("",!0):(h(),y("div",lr,[v[21]||(v[21]=n("b",null,"Mandatory Tags:",-1)),n("div",rr,[x(C(Ge),{style:{width:"100%"},"content-editable":!o.value.is_admin,onFinish:v[2]||(v[2]=U=>r(U))},{default:L(()=>[E(T(o.value.mandatory_tags.join("; ")),1)]),_:1},8,["content-editable"])])]))])]),n("input",{id:"delete-user-button",type:"button",value:"Delete user",onClick:v[3]||(v[3]=()=>{w.value=!0})})])]),_:1},8,["show"]),x(we,{show:w.value,"onUpdate:show":v[7]||(v[7]=U=>w.value=U),title:"Delete user",onOnCancel:v[8]||(v[8]=()=>{w.value=!1,m.value=""}),onOnClose:v[9]||(v[9]=()=>{w.value=!1,m.value=""}),onOnAccept:p},{default:L(()=>[n("div",ur,[n("p",null,[v[22]||(v[22]=E(" Are you sure to delete user ")),n("b",null,T(o.value.name)+" ("+T(o.value.username)+")",1),v[23]||(v[23]=E("? "))]),v[24]||(v[24]=n("p",{style:{color:"var(--color-danger)"}}," All data under this user will be deleted! ",-1)),v[25]||(v[25]=n("hr",{style:{"margin-block":"1rem"}},null,-1)),v[26]||(v[26]=E(" Type ")),n("b",null,T(o.value.username),1),v[27]||(v[27]=E(" to confirm: ")),V(n("input",{type:"text",id:"delete-user-input","onUpdate:modelValue":v[6]||(v[6]=U=>m.value=U),autocomplete:"off"},null,512),[[ee,m.value]])])]),_:1},8,["show"]),x(we,{show:u.value,"onUpdate:show":v[16]||(v[16]=U=>u.value=U),onOnCancel:D,onOnAccept:$,onOnClose:D},{default:L(()=>[n("div",dr,[n("table",cr,[n("tbody",null,[n("tr",null,[v[28]||(v[28]=n("td",null,"Username:",-1)),n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":v[10]||(v[10]=U=>f.value=U),autocomplete:"off",class:"create-user-input"},null,512),[[ee,f.value]])])])]),n("tbody",null,[n("tr",null,[v[29]||(v[29]=n("td",null,"Name:",-1)),n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":v[11]||(v[11]=U=>d.value=U),autocomplete:"off",class:"create-user-input"},null,512),[[ee,d.value]])])])]),n("tbody",null,[n("tr",null,[v[30]||(v[30]=n("td",null,"Password:",-1)),n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":v[12]||(v[12]=U=>k.value=U),autocomplete:"off",class:"create-user-input"},null,512),[[ee,k.value]])])])]),n("tbody",null,[n("tr",null,[v[31]||(v[31]=n("td",null,"Max Storage (MB):",-1)),n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":v[13]||(v[13]=U=>g.value=U),autocomplete:"off",class:"create-user-input"},null,512),[[ee,g.value]])])])]),n("tbody",null,[n("tr",null,[v[32]||(v[32]=n("td",null,"Mandatory Tags:",-1)),n("td",null,[V(n("input",{type:"text","onUpdate:modelValue":v[14]||(v[14]=U=>S.value=U),autocomplete:"off",class:"create-user-input",placeholder:"Separate with semicolon ';'"},null,512),[[ee,S.value]])])])]),n("tbody",null,[n("tr",null,[v[33]||(v[33]=n("td",null,"Administrator:",-1)),n("td",pr,[x(Se,{checked:P.value,"onUpdate:checked":v[15]||(v[15]=U=>P.value=U)},null,8,["checked"])])])])])])]),_:1},8,["show"]),n("div",hr,[v[34]||(v[34]=n("div",null,[n("b",null," Users ")],-1)),e.value?(h(),y("div",{key:0,id:"add-user-div",onClick:v[17]||(v[17]=()=>u.value=!0)},"+")):A("",!0)]),n("table",null,[n("tbody",null,[n("tr",null,[e.value?(h(),y("th",fr)):A("",!0),v[35]||(v[35]=n("th",null," Avatar ",-1)),v[36]||(v[36]=n("th",null," Username ",-1)),v[37]||(v[37]=n("th",null," Name ",-1)),v[38]||(v[38]=n("th",null," Storage ",-1)),v[39]||(v[39]=n("th",null," Accessibility ",-1))])]),n("tbody",null,[(h(!0),y(j,null,te(t.value,U=>(h(),y("tr",mr,[e.value?(h(),y("td",vr,[n("div",{class:"edit-button",onClick:()=>l(U)},[n("img",{src:C(Yl),alt:"",class:"icon"},null,8,yr)],8,gr)])):A("",!0),n("td",null,[n("div",wr,[n("img",{src:`${C(Ie)()}/user-avatar/${U.username}?size=60`,alt:"",class:"avatar"},null,8,_r)])]),n("td",br,T(U.username),1),n("td",null,T(U.name),1),n("td",kr,T(U.max_storage/1024/1024>1024?`${(U.max_storage/1024/1024/1024).toFixed(1)} G`:`${(U.max_storage/1024/1024).toFixed(0)} M`),1),n("td",null,[U.is_admin?(h(),y("label",Sr,"ADMIN")):(h(),Y(Ve,{key:0,tags:U.mandatory_tags,"max-width":200,"middle-align":!0},null,8,["tags"]))])]))),256))]),n("tbody",null,[n("tr",null,[t.value.length===0?(h(),y("td",$r," No users ")):A("",!0)])])])]))}}),kt=q(Dr,[["__scopeId","data-v-283cd287"]]),xr={class:"toolbar"},Cr={id:"about-main",class:"slideIn"},Pr={class:"content"},Ir=["href"],Tr=["href"],Ur=["href"],Rr=["href"],Ar={class:"content"},Lr={key:0},Br={key:0},Mr={style:{border:"1px solid var(--color-border)","border-radius":"10px",display:"flex","justify-content":"center","margin-block":"10px",padding:"10px",width:"100%"}},Er={class:"content link-container"},qr=["href"],Fr=["href"],zr={id:"versionHistory",class:"content"},Or={class:"block"},Hr={key:0},Wr={key:1},Nr=B({__name:"About",setup(i){const t=b([]),e=b(!1),a=X().conn,s=J().user.is_admin,o=()=>{a.changelog().then(p=>{t.value=p},p=>{console.error(p)})},l=b(-1),r=R(()=>{if(l.value===-1)return"N/A";const p=Math.floor(l.value/3600),u=Math.floor((l.value-p*3600)/60),f=Math.floor(l.value-p*3600-u*60);return`${p}h ${u}m ${f}s`}),c=b({backend:Ie(),version:"",uptime:r,_uptime:-1,numDocs:-1,numConnections:-1,numConnectionsAll:-1}),w=()=>{a.status().then(p=>{l.value=p.uptime,c.value.version=p.version,c.value.numDocs=p.n_data,c.value.numConnections=p.n_connections,c.value.numConnectionsAll=p.n_connections_all},p=>{console.error(p)})},m=R(()=>t.value.slice().reverse());return o(),w(),window.setInterval(()=>l.value++,1e3),re("login",p=>{c.value.numConnectionsAll++,p.user_info.id==J().user.id&&c.value.numConnections++}),re("logout",p=>{c.value.numConnectionsAll--,p.user_info.id==J().user.id&&c.value.numConnections--}),(p,u)=>(h(),y(j,null,[n("div",xr,[x(Ue)]),n("div",Cr,[u[14]||(u[14]=n("h1",null,"About",-1)),u[15]||(u[15]=n("div",{class:"content"},[n("p",null,[E(" Lires is a self-hosted web application for research literature management. "),n("br"),E(" It is open source and available at "),n("a",{href:"https://github.com/MenxLi/Lires",target:"_blank"},"GitHub - MenxLi/Lires"),E(". "),n("br")])],-1)),n("div",Pr,[u[3]||(u[3]=n("h2",null," Resources ",-1)),n("ul",null,[n("li",null,[n("a",{class:"resource",href:C(As),target:"_blank"},u[2]||(u[2]=[n("b",null,"User manual",-1)]),8,Ir)]),n("li",null,[n("a",{class:"resource",onClick:u[0]||(u[0]=f=>e.value=!0),style:{cursor:"pointer"}},"Change log")]),n("li",null,[n("a",{class:"resource",href:C(N)().backend()+`/_resources/lires-obsidian-plugin.zip?key=${C(N)().encKey}`},"Obsidian plugin",8,Tr)]),n("li",null,[n("a",{class:"resource",href:C(N)().backend()+`/_resources/api.zip?key=${C(N)().encKey}`},"API-Javascript",8,Ur)]),n("li",null,[n("a",{class:"resource",href:C(N)().backend()+`/_resources/api.py?key=${C(N)().encKey}`},"API-Python",8,Rr)])])]),n("div",Ar,[u[11]||(u[11]=n("h2",null," Dashboard ",-1)),n("details",null,[u[9]||(u[9]=n("summary",null,"Server status ",-1)),n("ul",null,[n("li",null,[u[4]||(u[4]=n("b",null,"Backend",-1)),E(": "+T(c.value.backend),1)]),n("li",null,[u[5]||(u[5]=n("b",null,"Version",-1)),E(": "+T(c.value.version),1)]),n("li",null,[u[6]||(u[6]=n("b",null,"Uptime",-1)),E(": "+T(c.value.uptime),1)]),n("li",null,[u[7]||(u[7]=n("b",null,"Connection count",-1)),E(": "+T(c.value.numConnections),1)]),C(s)?(h(),y("li",Lr,[u[8]||(u[8]=n("b",null,"Total connection count",-1)),E(": "+T(c.value.numConnectionsAll),1)])):A("",!0)])]),C(s)?(h(),y("details",Br,[u[10]||(u[10]=n("summary",null," User management ",-1)),n("div",Mr,[x(kt)])])):A("",!0)]),n("div",Er,[n("a",{href:C(a).resolve.databaseDownload(!1),target:"_blank"},"Download database index",8,qr),u[12]||(u[12]=E(" | ")),n("a",{href:C(a).resolve.databaseDownload(!0),target:"_blank"},"Download full database",8,Fr)]),x(ge,{show:e.value,"onUpdate:show":u[1]||(u[1]=f=>e.value=f),title:"Change log"},{default:L(()=>[n("div",zr,[u[13]||(u[13]=n("h1",{style:{"margin-bottom":"0px"}}," Version history ",-1)),(h(!0),y(j,null,te(m.value.length,f=>(h(),y("div",Or,[n("h2",null,T(m.value[f-1][0].toString()),1),n("ul",null,[(h(!0),y(j,null,te(m.value[f-1][1],d=>(h(),y("li",null,[typeof d=="string"?(h(),y("div",Hr,T(d),1)):typeof d=="object"?(h(),y("div",Wr,[E(T(Object.keys(d)[0])+" ",1),n("ul",null,[(h(!0),y(j,null,te(d[Object.keys(d)[0]],k=>(h(),y("li",null,T(k),1))),256))])])):A("",!0)]))),256))])]))),256))])]),_:1},8,["show"])])],64))}}),jr=q(Nr,[["__scopeId","data-v-2f65f22c"]]),Kr={},Vr={id:"widget-container-main"};function Zr(i,t){return h(),y("div",Vr,[ce(i.$slots,"default",{},void 0)])}const Gr=q(Kr,[["render",Zr],["__scopeId","data-v-257ac3c4"]]),Jr={id:"main-dashboard",class:"slideIn"},Qr=B({__name:"Dashboard",setup(i){return(t,e)=>(h(),y(j,null,[x(Ue),n("div",Jr,[x(Gr,null,{default:L(()=>[x(kt)]),_:1})])],64))}}),Yr=q(Qr,[["__scopeId","data-v-6b501763"]]),Xr=[{path:"/",component:Ci},{path:"/feed",component:ll},{path:"/login",component:Ll},{path:"/reader/:id",component:Ql},{path:"/about",component:jr},{path:"/dashboard/:username",component:Yr}],eu=Et({history:qt(),routes:Xr}),tu=Mt();Bt(fn).use(tu).use(eu).mount("#app");
